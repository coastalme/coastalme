<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.13.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>CoastalME (Coastal Modelling Environment): do_shore_platform_erosion.cpp Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<script type="text/javascript" src="../../clipboard.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../cookie.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">CoastalME (Coastal Modelling Environment)
   </div>
   <div id="projectbrief">Simulates the long-term behaviour of complex coastlines</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(1); });
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('d6/db6/do__shore__platform__erosion_8cpp_source.html','../../'); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">do_shore_platform_erosion.cpp</div></div>
</div><!--header-->
<div class="contents">
<a href="../../d6/db6/do__shore__platform__erosion_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a id="l00001" name="l00001"></a><span class="lineno">    1</span></div>
<div class="line"><a id="l00012" name="l00012"></a><span class="lineno">   12</span> </div>
<div class="line"><a id="l00013" name="l00013"></a><span class="lineno">   13</span><span class="comment">/*==============================================================================================================================</span></div>
<div class="line"><a id="l00014" name="l00014"></a><span class="lineno">   14</span><span class="comment"></span> </div>
<div class="line"><a id="l00015" name="l00015"></a><span class="lineno">   15</span><span class="comment">This file is part of CoastalME, the Coastal Modelling Environment.</span></div>
<div class="line"><a id="l00016" name="l00016"></a><span class="lineno">   16</span><span class="comment"></span> </div>
<div class="line"><a id="l00017" name="l00017"></a><span class="lineno">   17</span><span class="comment">CoastalME is free software; you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation; either version 3 of the License, or (at your option) any later version.</span></div>
<div class="line"><a id="l00018" name="l00018"></a><span class="lineno">   18</span><span class="comment"></span> </div>
<div class="line"><a id="l00019" name="l00019"></a><span class="lineno">   19</span><span class="comment">This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for more details.</span></div>
<div class="line"><a id="l00020" name="l00020"></a><span class="lineno">   20</span><span class="comment"></span> </div>
<div class="line"><a id="l00021" name="l00021"></a><span class="lineno">   21</span><span class="comment">You should have received a copy of the GNU General Public License along with this program; if not, write to the Free Software Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.</span></div>
<div class="line"><a id="l00022" name="l00022"></a><span class="lineno">   22</span><span class="comment"></span> </div>
<div class="line"><a id="l00023" name="l00023"></a><span class="lineno">   23</span><span class="comment">==============================================================================================================================*/</span></div>
<div class="line"><a id="l00024" name="l00024"></a><span class="lineno">   24</span><span class="preprocessor">#include &lt;assert.h&gt;</span></div>
<div class="line"><a id="l00025" name="l00025"></a><span class="lineno">   25</span> </div>
<div class="line"><a id="l00026" name="l00026"></a><span class="lineno">   26</span><span class="preprocessor">#include &lt;cmath&gt;</span></div>
<div class="line"><a id="l00027" name="l00027"></a><span class="lineno">   27</span> </div>
<div class="line"><a id="l00028" name="l00028"></a><span class="lineno">   28</span><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"><a id="l00029" name="l00029"></a><span class="lineno">   29</span><span class="keyword">using </span>std::cerr;</div>
<div class="line"><a id="l00030" name="l00030"></a><span class="lineno">   30</span><span class="keyword">using </span>std::cout;</div>
<div class="line"><a id="l00031" name="l00031"></a><span class="lineno">   31</span><span class="keyword">using </span>std::endl;</div>
<div class="line"><a id="l00032" name="l00032"></a><span class="lineno">   32</span><span class="keyword">using </span>std::ios;</div>
<div class="line"><a id="l00033" name="l00033"></a><span class="lineno">   33</span> </div>
<div class="line"><a id="l00034" name="l00034"></a><span class="lineno">   34</span><span class="preprocessor">#include &lt;iomanip&gt;</span></div>
<div class="line"><a id="l00035" name="l00035"></a><span class="lineno">   35</span><span class="keyword">using </span>std::setiosflags;</div>
<div class="line"><a id="l00036" name="l00036"></a><span class="lineno">   36</span> </div>
<div class="line"><a id="l00037" name="l00037"></a><span class="lineno">   37</span><span class="preprocessor">#include &lt;array&gt;</span></div>
<div class="line"><a id="l00038" name="l00038"></a><span class="lineno">   38</span><span class="keyword">using </span>std::array;</div>
<div class="line"><a id="l00039" name="l00039"></a><span class="lineno">   39</span> </div>
<div class="line"><a id="l00040" name="l00040"></a><span class="lineno">   40</span><span class="preprocessor">#include &lt;algorithm&gt;</span></div>
<div class="line"><a id="l00041" name="l00041"></a><span class="lineno">   41</span><span class="keyword">using </span>std::shuffle;</div>
<div class="line"><a id="l00042" name="l00042"></a><span class="lineno">   42</span> </div>
<div class="line"><a id="l00043" name="l00043"></a><span class="lineno">   43</span><span class="preprocessor">#include &quot;<a class="code" href="../../d6/d2a/cme_8h.html">cme.h</a>&quot;</span></div>
<div class="line"><a id="l00044" name="l00044"></a><span class="lineno">   44</span><span class="preprocessor">#include &quot;<a class="code" href="../../d7/d47/hermite__cubic_8h.html">hermite_cubic.h</a>&quot;</span></div>
<div class="line"><a id="l00045" name="l00045"></a><span class="lineno">   45</span><span class="preprocessor">#include &quot;<a class="code" href="../../df/dd3/interpolate_8h.html">interpolate.h</a>&quot;</span></div>
<div class="line"><a id="l00046" name="l00046"></a><span class="lineno">   46</span><span class="preprocessor">#include &quot;<a class="code" href="../../dd/d6a/simulation_8h.html">simulation.h</a>&quot;</span></div>
<div class="line"><a id="l00047" name="l00047"></a><span class="lineno">   47</span><span class="preprocessor">#include &quot;<a class="code" href="../../de/d65/coast_8h.html">coast.h</a>&quot;</span></div>
<div class="line"><a id="l00048" name="l00048"></a><span class="lineno">   48</span> </div>
<div class="line"><a id="l00049" name="l00049"></a><span class="lineno">   49</span><span class="comment">//===============================================================================================================================</span></div>
<div class="line"><a id="l00051" name="l00051"></a><span class="lineno">   51</span><span class="comment">//===============================================================================================================================</span></div>
<div class="foldopen" id="foldopen00052" data-start="{" data-end="}">
<div class="line"><a id="l00052" name="l00052"></a><span class="lineno"><a class="line" href="../../d1/d98/classCSimulation.html#a3710924bc49104a656245ffbd76e8ea3">   52</a></span><span class="keywordtype">int</span> <a class="code hl_function" href="../../d1/d98/classCSimulation.html#a3710924bc49104a656245ffbd76e8ea3">CSimulation::nDoAllShorePlatFormErosion</a>(<span class="keywordtype">void</span>)</div>
<div class="line"><a id="l00053" name="l00053"></a><span class="lineno">   53</span>{</div>
<div class="line"><a id="l00054" name="l00054"></a><span class="lineno">   54</span>   <span class="keywordflow">if</span> (<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a0245d3cbdd603fbeced6ca1465eb3f16">m_nLogFileDetail</a> &gt;= <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a540d8a94fc09b0b14fd8ab657445b67a">LOG_FILE_MIDDLE_DETAIL</a>)</div>
<div class="line"><a id="l00055" name="l00055"></a><span class="lineno">   55</span>      <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a222962121613613a48f518e0c2110f21">LogStream</a> &lt;&lt; <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#ad67e8c5b30a0572f64ecfb5c062c2edc">m_ulIter</a> &lt;&lt; <span class="stringliteral">&quot;: Calculating shore platform erosion&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a id="l00056" name="l00056"></a><span class="lineno">   56</span> </div>
<div class="line"><a id="l00057" name="l00057"></a><span class="lineno">   57</span>   <span class="comment">// // DEBUG CODE ===========================================================================================================</span></div>
<div class="line"><a id="l00058" name="l00058"></a><span class="lineno">   58</span>   <span class="comment">// string strOutFile = m_strOutPath + &quot;01_polygon_shore_platform_test_&quot;;</span></div>
<div class="line"><a id="l00059" name="l00059"></a><span class="lineno">   59</span>   <span class="comment">// strOutFile += to_string(m_ulIter);</span></div>
<div class="line"><a id="l00060" name="l00060"></a><span class="lineno">   60</span>   <span class="comment">// strOutFile += &quot;.tif&quot;;</span></div>
<div class="line"><a id="l00061" name="l00061"></a><span class="lineno">   61</span>   <span class="comment">//</span></div>
<div class="line"><a id="l00062" name="l00062"></a><span class="lineno">   62</span>   <span class="comment">// GDALDriver* pDriver = GetGDALDriverManager()-&gt;GetDriverByName(&quot;gtiff&quot;);</span></div>
<div class="line"><a id="l00063" name="l00063"></a><span class="lineno">   63</span>   <span class="comment">// GDALDataset* pDataSet = pDriver-&gt;Create(strOutFile.c_str(), m_nXGridSize, m_nYGridSize, 1, GDT_Float64, m_papszGDALRasterOptions);</span></div>
<div class="line"><a id="l00064" name="l00064"></a><span class="lineno">   64</span>   <span class="comment">// pDataSet-&gt;SetProjection(m_strGDALBasementDEMProjection.c_str());</span></div>
<div class="line"><a id="l00065" name="l00065"></a><span class="lineno">   65</span>   <span class="comment">// pDataSet-&gt;SetGeoTransform(m_dGeoTransform);</span></div>
<div class="line"><a id="l00066" name="l00066"></a><span class="lineno">   66</span>   <span class="comment">// double* pdRaster = new double[m_nXGridSize * m_nYGridSize];</span></div>
<div class="line"><a id="l00067" name="l00067"></a><span class="lineno">   67</span>   <span class="comment">// int n = 0;</span></div>
<div class="line"><a id="l00068" name="l00068"></a><span class="lineno">   68</span>   <span class="comment">// int nInPoly = 0;</span></div>
<div class="line"><a id="l00069" name="l00069"></a><span class="lineno">   69</span>   <span class="comment">// int nNotInPoly = 0;</span></div>
<div class="line"><a id="l00070" name="l00070"></a><span class="lineno">   70</span>   <span class="comment">//</span></div>
<div class="line"><a id="l00071" name="l00071"></a><span class="lineno">   71</span>   <span class="comment">// for (int nY = 0; nY &lt; m_nYGridSize; nY++)</span></div>
<div class="line"><a id="l00072" name="l00072"></a><span class="lineno">   72</span>   <span class="comment">// {</span></div>
<div class="line"><a id="l00073" name="l00073"></a><span class="lineno">   73</span>   <span class="comment">//    for (int nX = 0; nX &lt; m_nXGridSize; nX++)</span></div>
<div class="line"><a id="l00074" name="l00074"></a><span class="lineno">   74</span>   <span class="comment">//    {</span></div>
<div class="line"><a id="l00075" name="l00075"></a><span class="lineno">   75</span>   <span class="comment">//       int nID = m_pRasterGrid-&gt;m_Cell[nX][nY].nGetPolygonID();</span></div>
<div class="line"><a id="l00076" name="l00076"></a><span class="lineno">   76</span>   <span class="comment">//       if (nID == INT_NODATA)</span></div>
<div class="line"><a id="l00077" name="l00077"></a><span class="lineno">   77</span>   <span class="comment">//          nNotInPoly++;</span></div>
<div class="line"><a id="l00078" name="l00078"></a><span class="lineno">   78</span>   <span class="comment">//       else</span></div>
<div class="line"><a id="l00079" name="l00079"></a><span class="lineno">   79</span>   <span class="comment">//          nInPoly++;</span></div>
<div class="line"><a id="l00080" name="l00080"></a><span class="lineno">   80</span>   <span class="comment">//</span></div>
<div class="line"><a id="l00081" name="l00081"></a><span class="lineno">   81</span>   <span class="comment">//       pdRaster[n++] = nID;</span></div>
<div class="line"><a id="l00082" name="l00082"></a><span class="lineno">   82</span>   <span class="comment">//    }</span></div>
<div class="line"><a id="l00083" name="l00083"></a><span class="lineno">   83</span>   <span class="comment">// }</span></div>
<div class="line"><a id="l00084" name="l00084"></a><span class="lineno">   84</span>   <span class="comment">//</span></div>
<div class="line"><a id="l00085" name="l00085"></a><span class="lineno">   85</span>   <span class="comment">// GDALRasterBand* pBand = pDataSet-&gt;GetRasterBand(1);</span></div>
<div class="line"><a id="l00086" name="l00086"></a><span class="lineno">   86</span>   <span class="comment">// pBand-&gt;SetNoDataValue(m_dMissingValue);</span></div>
<div class="line"><a id="l00087" name="l00087"></a><span class="lineno">   87</span>   <span class="comment">// int nRet = pBand-&gt;RasterIO(GF_Write, 0, 0, m_nXGridSize, m_nYGridSize, pdRaster, m_nXGridSize, m_nYGridSize, GDT_Float64, 0, 0, NULL);</span></div>
<div class="line"><a id="l00088" name="l00088"></a><span class="lineno">   88</span>   <span class="comment">// if (nRet == CE_Failure)</span></div>
<div class="line"><a id="l00089" name="l00089"></a><span class="lineno">   89</span>   <span class="comment">//    LogStream &lt;&lt; nRet &lt;&lt; endl;</span></div>
<div class="line"><a id="l00090" name="l00090"></a><span class="lineno">   90</span>   <span class="comment">//</span></div>
<div class="line"><a id="l00091" name="l00091"></a><span class="lineno">   91</span>   <span class="comment">// GDALClose(pDataSet);</span></div>
<div class="line"><a id="l00092" name="l00092"></a><span class="lineno">   92</span>   <span class="comment">// delete[] pdRaster;</span></div>
<div class="line"><a id="l00093" name="l00093"></a><span class="lineno">   93</span>   <span class="comment">//</span></div>
<div class="line"><a id="l00094" name="l00094"></a><span class="lineno">   94</span>   <span class="comment">// LogStream &lt;&lt; m_ulIter &lt;&lt; &quot; Number of cells in a polygon = &quot; &lt;&lt; nInPoly &lt;&lt; endl;</span></div>
<div class="line"><a id="l00095" name="l00095"></a><span class="lineno">   95</span>   <span class="comment">// LogStream &lt;&lt; m_ulIter &lt;&lt; &quot; Number of cells not in any polygon = &quot; &lt;&lt; nNotInPoly &lt;&lt; endl;</span></div>
<div class="line"><a id="l00096" name="l00096"></a><span class="lineno">   96</span>   <span class="comment">// // DEBUG CODE ===========================================================================================================</span></div>
<div class="line"><a id="l00097" name="l00097"></a><span class="lineno">   97</span> </div>
<div class="line"><a id="l00098" name="l00098"></a><span class="lineno">   98</span>   <span class="comment">// TODO 023 Only do potential erosion if cell is in a polygon</span></div>
<div class="line"><a id="l00099" name="l00099"></a><span class="lineno">   99</span> </div>
<div class="line"><a id="l00100" name="l00100"></a><span class="lineno">  100</span>   <span class="comment">// Set direction</span></div>
<div class="line"><a id="l00101" name="l00101"></a><span class="lineno">  101</span>   <span class="keyword">static</span> <span class="keywordtype">bool</span> bDownCoast = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00102" name="l00102"></a><span class="lineno">  102</span> </div>
<div class="line"><a id="l00103" name="l00103"></a><span class="lineno">  103</span>   <span class="comment">// Do this for each coast</span></div>
<div class="line"><a id="l00104" name="l00104"></a><span class="lineno">  104</span>   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> nCoast = 0; nCoast &lt; static_cast&lt;int&gt;(<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>.size()); nCoast++)</div>
<div class="line"><a id="l00105" name="l00105"></a><span class="lineno">  105</span>   {</div>
<div class="line"><a id="l00106" name="l00106"></a><span class="lineno">  106</span>      <span class="keywordtype">int</span> <span class="keyword">const</span> nNumProfiles = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].nGetNumProfiles();</div>
<div class="line"><a id="l00107" name="l00107"></a><span class="lineno">  107</span> </div>
<div class="line"><a id="l00108" name="l00108"></a><span class="lineno">  108</span>      <span class="comment">// Calculate potential platform erosion along each coastline-normal profile, do in down-coast sequence</span></div>
<div class="line"><a id="l00109" name="l00109"></a><span class="lineno">  109</span>      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> nn = 0; nn &lt; nNumProfiles; nn++)</div>
<div class="line"><a id="l00110" name="l00110"></a><span class="lineno">  110</span>      {</div>
<div class="line"><a id="l00111" name="l00111"></a><span class="lineno">  111</span>         <a class="code hl_class" href="../../da/dae/classCGeomProfile.html">CGeomProfile</a>* pProfile;</div>
<div class="line"><a id="l00112" name="l00112"></a><span class="lineno">  112</span>         <span class="keywordflow">if</span> (bDownCoast)</div>
<div class="line"><a id="l00113" name="l00113"></a><span class="lineno">  113</span>            pProfile = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].pGetProfileWithDownCoastSeq(nn);</div>
<div class="line"><a id="l00114" name="l00114"></a><span class="lineno">  114</span>         <span class="keywordflow">else</span></div>
<div class="line"><a id="l00115" name="l00115"></a><span class="lineno">  115</span>            pProfile = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].pGetProfileWithUpCoastSeq(nn);</div>
<div class="line"><a id="l00116" name="l00116"></a><span class="lineno">  116</span> </div>
<div class="line"><a id="l00117" name="l00117"></a><span class="lineno">  117</span>         <span class="keywordtype">int</span> <span class="keyword">const</span> nRet = <a class="code hl_function" href="../../d1/d98/classCSimulation.html#a94021023e2af53e0b800dc821108ee2c">nCalcPotentialPlatformErosionOnProfile</a>(nCoast, pProfile);</div>
<div class="line"><a id="l00118" name="l00118"></a><span class="lineno">  118</span>         <span class="keywordflow">if</span> (nRet != <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#aa768cb14b5c6123ee95e6e4ebd9fe331">RTN_OK</a>)</div>
<div class="line"><a id="l00119" name="l00119"></a><span class="lineno">  119</span>            <span class="keywordflow">return</span> nRet;</div>
<div class="line"><a id="l00120" name="l00120"></a><span class="lineno">  120</span>      }</div>
<div class="line"><a id="l00121" name="l00121"></a><span class="lineno">  121</span> </div>
<div class="line"><a id="l00122" name="l00122"></a><span class="lineno">  122</span>      <span class="comment">// Calculate potential platform erosion between the coastline-normal profiles. Do this in down-coast sequence</span></div>
<div class="line"><a id="l00123" name="l00123"></a><span class="lineno">  123</span>      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> nn = 0; nn &lt; nNumProfiles - 1; nn++)</div>
<div class="line"><a id="l00124" name="l00124"></a><span class="lineno">  124</span>      {</div>
<div class="line"><a id="l00125" name="l00125"></a><span class="lineno">  125</span>         <a class="code hl_class" href="../../da/dae/classCGeomProfile.html">CGeomProfile</a>* pProfile = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].pGetProfileWithDownCoastSeq(nn);</div>
<div class="line"><a id="l00126" name="l00126"></a><span class="lineno">  126</span> </div>
<div class="line"><a id="l00127" name="l00127"></a><span class="lineno">  127</span>         <span class="comment">// Calculate potential erosion for sea cells between this profile and the next profile (or up to the edge of the grid) on these cells</span></div>
<div class="line"><a id="l00128" name="l00128"></a><span class="lineno">  128</span>         <span class="keywordtype">int</span> nRet = <a class="code hl_function" href="../../d1/d98/classCSimulation.html#a5ecb98fb61c4e0ae63cc6c7786c7a0bf">nCalcPotentialPlatformErosionBetweenProfiles</a>(nCoast, pProfile, <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a29fcc12f725cf70f82b391b4fd46d171">DIRECTION_DOWNCOAST</a>);</div>
<div class="line"><a id="l00129" name="l00129"></a><span class="lineno">  129</span>         <span class="keywordflow">if</span> (nRet != <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#aa768cb14b5c6123ee95e6e4ebd9fe331">RTN_OK</a>)</div>
<div class="line"><a id="l00130" name="l00130"></a><span class="lineno">  130</span>            <span class="keywordflow">return</span> nRet;</div>
<div class="line"><a id="l00131" name="l00131"></a><span class="lineno">  131</span> </div>
<div class="line"><a id="l00132" name="l00132"></a><span class="lineno">  132</span>         nRet = <a class="code hl_function" href="../../d1/d98/classCSimulation.html#a5ecb98fb61c4e0ae63cc6c7786c7a0bf">nCalcPotentialPlatformErosionBetweenProfiles</a>(nCoast, pProfile, <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#abe5cabe81fdbe153e73fd894b3794e50">DIRECTION_UPCOAST</a>);</div>
<div class="line"><a id="l00133" name="l00133"></a><span class="lineno">  133</span>         <span class="keywordflow">if</span> (nRet != <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#aa768cb14b5c6123ee95e6e4ebd9fe331">RTN_OK</a>)</div>
<div class="line"><a id="l00134" name="l00134"></a><span class="lineno">  134</span>            <span class="keywordflow">return</span> nRet;</div>
<div class="line"><a id="l00135" name="l00135"></a><span class="lineno">  135</span>      }</div>
<div class="line"><a id="l00136" name="l00136"></a><span class="lineno">  136</span>   }</div>
<div class="line"><a id="l00137" name="l00137"></a><span class="lineno">  137</span> </div>
<div class="line"><a id="l00138" name="l00138"></a><span class="lineno">  138</span>   <span class="comment">// Swap direction for next timestep</span></div>
<div class="line"><a id="l00139" name="l00139"></a><span class="lineno">  139</span>   bDownCoast = ! bDownCoast;</div>
<div class="line"><a id="l00140" name="l00140"></a><span class="lineno">  140</span> </div>
<div class="line"><a id="l00141" name="l00141"></a><span class="lineno">  141</span>   <span class="comment">// Fills in &#39;holes&#39; in the potential platform erosion i.e. orphan cells which get omitted because of rounding problems</span></div>
<div class="line"><a id="l00142" name="l00142"></a><span class="lineno">  142</span>   <a class="code hl_function" href="../../d1/d98/classCSimulation.html#aa1822cd0877dd757ed449591018be8d4">FillPotentialPlatformErosionHoles</a>();</div>
<div class="line"><a id="l00143" name="l00143"></a><span class="lineno">  143</span> </div>
<div class="line"><a id="l00144" name="l00144"></a><span class="lineno">  144</span>   <span class="comment">// Do the same for beach protection</span></div>
<div class="line"><a id="l00145" name="l00145"></a><span class="lineno">  145</span>   <a class="code hl_function" href="../../d1/d98/classCSimulation.html#a45b070d19448816f0a4345981d81239e">FillInBeachProtectionHoles</a>();</div>
<div class="line"><a id="l00146" name="l00146"></a><span class="lineno">  146</span> </div>
<div class="line"><a id="l00147" name="l00147"></a><span class="lineno">  147</span>   <span class="comment">// Finally calculate actual platform erosion on all sea cells (both on profiles, and between profiles)</span></div>
<div class="line"><a id="l00148" name="l00148"></a><span class="lineno">  148</span>   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> nX = 0; nX &lt; <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1652253500dab35e6f6f9f734207e20b">m_nXGridSize</a>; nX++)</div>
<div class="line"><a id="l00149" name="l00149"></a><span class="lineno">  149</span>   {</div>
<div class="line"><a id="l00150" name="l00150"></a><span class="lineno">  150</span>      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> nY = 0; nY &lt; <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a3755fdc07c0ac9f2ce6c2237cfef50ce">m_nYGridSize</a>; nY++)</div>
<div class="line"><a id="l00151" name="l00151"></a><span class="lineno">  151</span>      {</div>
<div class="line"><a id="l00152" name="l00152"></a><span class="lineno">  152</span>         <span class="keywordflow">if</span> (<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nX][nY].bPotentialPlatformErosion())</div>
<div class="line"><a id="l00153" name="l00153"></a><span class="lineno">  153</span>            <span class="comment">// Calculate actual (supply-limited) shore platform erosion on each cell that has potential platform erosion, also add the eroded sand/coarse sediment to that cell&#39;s polygon, ready to be redistributed within the polygon during beach erosion/deposition</span></div>
<div class="line"><a id="l00154" name="l00154"></a><span class="lineno">  154</span>            <a class="code hl_function" href="../../d1/d98/classCSimulation.html#a9f6cbe5853ed2e733f85a88419341950">DoActualPlatformErosionOnCell</a>(nX, nY);</div>
<div class="line"><a id="l00155" name="l00155"></a><span class="lineno">  155</span>      }</div>
<div class="line"><a id="l00156" name="l00156"></a><span class="lineno">  156</span>   }</div>
<div class="line"><a id="l00157" name="l00157"></a><span class="lineno">  157</span> </div>
<div class="line"><a id="l00158" name="l00158"></a><span class="lineno">  158</span>   <span class="keywordflow">if</span> (<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a0245d3cbdd603fbeced6ca1465eb3f16">m_nLogFileDetail</a> &gt;= <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#aa58b13ad2e88aaa20449bfea242396a4">LOG_FILE_ALL</a>)</div>
<div class="line"><a id="l00159" name="l00159"></a><span class="lineno">  159</span>   {</div>
<div class="line"><a id="l00160" name="l00160"></a><span class="lineno">  160</span>      <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a222962121613613a48f518e0c2110f21">LogStream</a> &lt;&lt; <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#ad67e8c5b30a0572f64ecfb5c062c2edc">m_ulIter</a> &lt;&lt; <span class="stringliteral">&quot;: total potential shore platform erosion (m^3) = &quot;</span> &lt;&lt; <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a6478fd59a34c3fb4891f570d32a22ddb">m_dThisIterPotentialPlatformErosion</a> * <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#ac26ef813bdee563625a9a7be573a3741">m_dCellArea</a> &lt;&lt; <span class="stringliteral">&quot; (on profiles = &quot;</span> &lt;&lt; <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a8cc291f5951942ece85859272e871fa1">m_dTotPotentialPlatformErosionOnProfiles</a> * <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#ac26ef813bdee563625a9a7be573a3741">m_dCellArea</a> &lt;&lt; <span class="stringliteral">&quot;, between profiles = &quot;</span> &lt;&lt; <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a46df9f5bbc643a6884c18ebe097bdb79">m_dTotPotentialPlatformErosionBetweenProfiles</a> * <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#ac26ef813bdee563625a9a7be573a3741">m_dCellArea</a> &lt;&lt; <span class="stringliteral">&quot;)&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a id="l00161" name="l00161"></a><span class="lineno">  161</span> </div>
<div class="line"><a id="l00162" name="l00162"></a><span class="lineno">  162</span>      <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a222962121613613a48f518e0c2110f21">LogStream</a> &lt;&lt; <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#ad67e8c5b30a0572f64ecfb5c062c2edc">m_ulIter</a> &lt;&lt; <span class="stringliteral">&quot;: total actual shore platform erosion (m^3) = &quot;</span> &lt;&lt; (<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#aeafa6e4b5ab61733094effce380cff63">m_dThisIterActualPlatformErosionFineCons</a> + <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a7848fdd8286f9734860955b855be74be">m_dThisIterActualPlatformErosionSandCons</a> + <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a351c28119561e99ad17a539274dbea27">m_dThisIterActualPlatformErosionCoarseCons</a>) * <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#ac26ef813bdee563625a9a7be573a3741">m_dCellArea</a> &lt;&lt; <span class="stringliteral">&quot; (fine = &quot;</span> &lt;&lt; <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#aeafa6e4b5ab61733094effce380cff63">m_dThisIterActualPlatformErosionFineCons</a> * <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#ac26ef813bdee563625a9a7be573a3741">m_dCellArea</a> &lt;&lt; <span class="stringliteral">&quot;, sand = &quot;</span> &lt;&lt; <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a7848fdd8286f9734860955b855be74be">m_dThisIterActualPlatformErosionSandCons</a> * <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#ac26ef813bdee563625a9a7be573a3741">m_dCellArea</a> &lt;&lt; <span class="stringliteral">&quot;, coarse = &quot;</span> &lt;&lt; <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a351c28119561e99ad17a539274dbea27">m_dThisIterActualPlatformErosionCoarseCons</a> * <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#ac26ef813bdee563625a9a7be573a3741">m_dCellArea</a> &lt;&lt; <span class="stringliteral">&quot;)&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a id="l00163" name="l00163"></a><span class="lineno">  163</span>   }</div>
<div class="line"><a id="l00164" name="l00164"></a><span class="lineno">  164</span> </div>
<div class="line"><a id="l00165" name="l00165"></a><span class="lineno">  165</span>   <span class="keywordflow">return</span> <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#aa768cb14b5c6123ee95e6e4ebd9fe331">RTN_OK</a>;</div>
<div class="line"><a id="l00166" name="l00166"></a><span class="lineno">  166</span>}</div>
</div>
<div class="line"><a id="l00167" name="l00167"></a><span class="lineno">  167</span> </div>
<div class="line"><a id="l00168" name="l00168"></a><span class="lineno">  168</span><span class="comment">//===============================================================================================================================</span></div>
<div class="line"><a id="l00170" name="l00170"></a><span class="lineno">  170</span><span class="comment">//===============================================================================================================================</span></div>
<div class="foldopen" id="foldopen00171" data-start="{" data-end="}">
<div class="line"><a id="l00171" name="l00171"></a><span class="lineno"><a class="line" href="../../d1/d98/classCSimulation.html#a94021023e2af53e0b800dc821108ee2c">  171</a></span><span class="keywordtype">int</span> <a class="code hl_function" href="../../d1/d98/classCSimulation.html#a94021023e2af53e0b800dc821108ee2c">CSimulation::nCalcPotentialPlatformErosionOnProfile</a>(<span class="keywordtype">int</span> <span class="keyword">const</span> nCoast, <a class="code hl_class" href="../../da/dae/classCGeomProfile.html">CGeomProfile</a>* pProfile)</div>
<div class="line"><a id="l00172" name="l00172"></a><span class="lineno">  172</span>{</div>
<div class="line"><a id="l00173" name="l00173"></a><span class="lineno">  173</span>   <span class="comment">// Only work on this profile if it is problem-free TODO 024 Or if it has just hit dry land?</span></div>
<div class="line"><a id="l00174" name="l00174"></a><span class="lineno">  174</span>   <span class="keywordflow">if</span> (! pProfile-&gt;<a class="code hl_function" href="../../da/dae/classCGeomProfile.html#aac223e2610d50ca2c7eadaf8542e9498">bOKIncStartAndEndOfCoast</a>())               <span class="comment">//  || (pProfile-&gt;nGetProblemCode() == PROFILE_DRYLAND))</span></div>
<div class="line"><a id="l00175" name="l00175"></a><span class="lineno">  175</span>      <span class="keywordflow">return</span> <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#aa768cb14b5c6123ee95e6e4ebd9fe331">RTN_OK</a>;</div>
<div class="line"><a id="l00176" name="l00176"></a><span class="lineno">  176</span> </div>
<div class="line"><a id="l00177" name="l00177"></a><span class="lineno">  177</span>   <span class="comment">// Get the length of the profile (in cells) and the index of the coast point at which this profile starts</span></div>
<div class="line"><a id="l00178" name="l00178"></a><span class="lineno">  178</span>   <span class="keywordtype">int</span> <span class="keyword">const</span> nProfSize = pProfile-&gt;<a class="code hl_function" href="../../da/dae/classCGeomProfile.html#a8a29c3fa364ab1f7b3930b7a9c83f45f">nGetNumCellsInProfile</a>();</div>
<div class="line"><a id="l00179" name="l00179"></a><span class="lineno">  179</span>   <span class="keywordtype">int</span> <span class="keyword">const</span> nCoastPoint = pProfile-&gt;<a class="code hl_function" href="../../da/dae/classCGeomProfile.html#a343fd2b73e3a87cf425572860e79ebd6">nGetCoastPoint</a>();</div>
<div class="line"><a id="l00180" name="l00180"></a><span class="lineno">  180</span> </div>
<div class="line"><a id="l00181" name="l00181"></a><span class="lineno">  181</span>   <span class="comment">// Get the breaking depth for this profile from the coastline point</span></div>
<div class="line"><a id="l00182" name="l00182"></a><span class="lineno">  182</span>   <span class="keywordtype">double</span> dDepthOfBreaking = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].dGetDepthOfBreaking(nCoastPoint);</div>
<div class="line"><a id="l00183" name="l00183"></a><span class="lineno">  183</span>   <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d6/d2a/cme_8h.html#a61afa8560a3b39c80657661a1d8f76ab">bFPIsEqual</a>(dDepthOfBreaking, <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#ac003bdff958dca839f5d274f15786e07">DBL_NODATA</a>, <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a08b1623863ee3bd4300a8892de323722">TOLERANCE</a>))</div>
<div class="line"><a id="l00184" name="l00184"></a><span class="lineno">  184</span>      <span class="comment">// This profile is not in the active zone, so no platform erosion here</span></div>
<div class="line"><a id="l00185" name="l00185"></a><span class="lineno">  185</span>      <span class="keywordflow">return</span> <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#aa768cb14b5c6123ee95e6e4ebd9fe331">RTN_OK</a>;</div>
<div class="line"><a id="l00186" name="l00186"></a><span class="lineno">  186</span>   </div>
<div class="line"><a id="l00187" name="l00187"></a><span class="lineno">  187</span>   <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d6/d2a/cme_8h.html#a61afa8560a3b39c80657661a1d8f76ab">bFPIsEqual</a>(dDepthOfBreaking, 0.0, <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a08b1623863ee3bd4300a8892de323722">TOLERANCE</a>))</div>
<div class="line"><a id="l00188" name="l00188"></a><span class="lineno">  188</span>   {</div>
<div class="line"><a id="l00189" name="l00189"></a><span class="lineno">  189</span>      <span class="comment">// Safety check, altho&#39; this shouldn&#39;t happen</span></div>
<div class="line"><a id="l00190" name="l00190"></a><span class="lineno">  190</span>      <span class="keywordflow">if</span> (<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a0245d3cbdd603fbeced6ca1465eb3f16">m_nLogFileDetail</a> &gt;= <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a85da1142fa4655ec66f1e391444a6d9a">LOG_FILE_HIGH_DETAIL</a>)</div>
<div class="line"><a id="l00191" name="l00191"></a><span class="lineno">  191</span>         <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a222962121613613a48f518e0c2110f21">LogStream</a> &lt;&lt; <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#ad67e8c5b30a0572f64ecfb5c062c2edc">m_ulIter</a> &lt;&lt; <span class="stringliteral">&quot;: depth of breaking is zero for profile &quot;</span> &lt;&lt; pProfile-&gt;<a class="code hl_function" href="../../da/dae/classCGeomProfile.html#aacd98f9837c3c7cf7414764b73275fba">nGetCoastID</a>() &lt;&lt; <span class="stringliteral">&quot; of coast &quot;</span> &lt;&lt; nCoast &lt;&lt; endl;</div>
<div class="line"><a id="l00192" name="l00192"></a><span class="lineno">  192</span>      </div>
<div class="line"><a id="l00193" name="l00193"></a><span class="lineno">  193</span>      <span class="keywordflow">return</span> <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#aa768cb14b5c6123ee95e6e4ebd9fe331">RTN_OK</a>;   </div>
<div class="line"><a id="l00194" name="l00194"></a><span class="lineno">  194</span>   }</div>
<div class="line"><a id="l00195" name="l00195"></a><span class="lineno">  195</span> </div>
<div class="line"><a id="l00196" name="l00196"></a><span class="lineno">  196</span>   <span class="comment">//   LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: ON PROFILE nProfile = &quot; &lt;&lt; nProfile &lt;&lt; &quot; dDepthOfBreaking = &quot; &lt;&lt; dDepthOfBreaking &lt;&lt; endl;</span></div>
<div class="line"><a id="l00197" name="l00197"></a><span class="lineno">  197</span> </div>
<div class="line"><a id="l00198" name="l00198"></a><span class="lineno">  198</span>   <span class="comment">// Get the height of the associated breaking wave from the coast point: this height is used in beach protection calcs</span></div>
<div class="line"><a id="l00199" name="l00199"></a><span class="lineno">  199</span>   <span class="keywordtype">double</span> <span class="keyword">const</span> dBreakingWaveHeight = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].dGetBreakingWaveHeight(nCoastPoint);</div>
<div class="line"><a id="l00200" name="l00200"></a><span class="lineno">  200</span> </div>
<div class="line"><a id="l00201" name="l00201"></a><span class="lineno">  201</span>   <span class="comment">// Calculate the length of the profile in external CRS units</span></div>
<div class="line"><a id="l00202" name="l00202"></a><span class="lineno">  202</span>   <span class="keywordtype">int</span> <span class="keyword">const</span> nSegments = pProfile-&gt;<a class="code hl_function" href="../../da/dae/classCGeomProfile.html#abaf88697019588a2b0901bd19044aee4">nGetProfileSize</a>() - 1;</div>
<div class="line"><a id="l00203" name="l00203"></a><span class="lineno">  203</span>   <span class="keywordtype">double</span> dProfileLenXY = 0;</div>
<div class="line"><a id="l00204" name="l00204"></a><span class="lineno">  204</span>   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> nSeg = 0; nSeg &lt; nSegments; nSeg++)</div>
<div class="line"><a id="l00205" name="l00205"></a><span class="lineno">  205</span>   {</div>
<div class="line"><a id="l00206" name="l00206"></a><span class="lineno">  206</span>      <span class="comment">// Do once for every line segment</span></div>
<div class="line"><a id="l00207" name="l00207"></a><span class="lineno">  207</span>      <span class="keywordtype">double</span> <span class="keyword">const</span> dSegStartX = pProfile-&gt;<a class="code hl_function" href="../../da/dae/classCGeomProfile.html#aaa8ddb9c775927bdb7940f7826f90a74">pPtGetPointInProfile</a>(nSeg)-&gt;<a class="code hl_function" href="../../d5/d4e/classCGeom2DPoint.html#a250f937d03cfdf6e0244b74ad2bf96a4">dGetX</a>();</div>
<div class="line"><a id="l00208" name="l00208"></a><span class="lineno">  208</span>      <span class="keywordtype">double</span> <span class="keyword">const</span> dSegStartY = pProfile-&gt;<a class="code hl_function" href="../../da/dae/classCGeomProfile.html#aaa8ddb9c775927bdb7940f7826f90a74">pPtGetPointInProfile</a>(nSeg)-&gt;<a class="code hl_function" href="../../d5/d4e/classCGeom2DPoint.html#a216921dc2c592d9468e6430fee7c7719">dGetY</a>();</div>
<div class="line"><a id="l00209" name="l00209"></a><span class="lineno">  209</span>      <span class="keywordtype">double</span> <span class="keyword">const</span> dSegEndX = pProfile-&gt;<a class="code hl_function" href="../../da/dae/classCGeomProfile.html#aaa8ddb9c775927bdb7940f7826f90a74">pPtGetPointInProfile</a>(nSeg + 1)-&gt;<a class="code hl_function" href="../../d5/d4e/classCGeom2DPoint.html#a250f937d03cfdf6e0244b74ad2bf96a4">dGetX</a>(); <span class="comment">// Is OK</span></div>
<div class="line"><a id="l00210" name="l00210"></a><span class="lineno">  210</span>      <span class="keywordtype">double</span> <span class="keyword">const</span> dSegEndY = pProfile-&gt;<a class="code hl_function" href="../../da/dae/classCGeomProfile.html#aaa8ddb9c775927bdb7940f7826f90a74">pPtGetPointInProfile</a>(nSeg + 1)-&gt;<a class="code hl_function" href="../../d5/d4e/classCGeom2DPoint.html#a216921dc2c592d9468e6430fee7c7719">dGetY</a>();</div>
<div class="line"><a id="l00211" name="l00211"></a><span class="lineno">  211</span> </div>
<div class="line"><a id="l00212" name="l00212"></a><span class="lineno">  212</span>      <span class="keywordtype">double</span> <span class="keyword">const</span> dSegLen = hypot(dSegStartX - dSegEndX, dSegStartY - dSegEndY);</div>
<div class="line"><a id="l00213" name="l00213"></a><span class="lineno">  213</span>      dProfileLenXY += dSegLen;</div>
<div class="line"><a id="l00214" name="l00214"></a><span class="lineno">  214</span>   }</div>
<div class="line"><a id="l00215" name="l00215"></a><span class="lineno">  215</span> </div>
<div class="line"><a id="l00216" name="l00216"></a><span class="lineno">  216</span>   <span class="comment">// Next calculate the average distance between profile points, again in external CRS units. Assume that the sample points are equally spaced along the profile (not quite true)</span></div>
<div class="line"><a id="l00217" name="l00217"></a><span class="lineno">  217</span>   <span class="keywordtype">double</span> <span class="keyword">const</span> dSpacingXY = dProfileLenXY / (nProfSize - 1);</div>
<div class="line"><a id="l00218" name="l00218"></a><span class="lineno">  218</span> </div>
<div class="line"><a id="l00219" name="l00219"></a><span class="lineno">  219</span>   <span class="comment">// Set up vectors for the coastline-normal profile elevations. The length of this vector line is given by the number of cells &#39;under&#39; the profile. Thus each point on the vector relates to a single cell in the grid. This assumes that all points on the profile vector are equally spaced (not quite true, depends on the orientation of the line segments which comprise the profile)</span></div>
<div class="line"><a id="l00220" name="l00220"></a><span class="lineno">  220</span>   <span class="comment">// The elevation of each of these profile points is the elevation of the centroid of the cell that is &#39;under&#39; the point. However we cannot always be confident that this is the &#39;true&#39; elevation of the point on the vector since (unless the profile runs planview N-S or W-E) the vector does not always run exactly through the centroid of the cell</span></div>
<div class="line"><a id="l00221" name="l00221"></a><span class="lineno">  221</span>   vector&lt;double&gt; VdProfileZ(nProfSize, 0);        <span class="comment">// Initial (pre-erosion) elevation of both consolidated and unconsolidated sediment for cells &#39;under&#39; the profile</span></div>
<div class="line"><a id="l00222" name="l00222"></a><span class="lineno">  222</span>   vector&lt;double&gt; VdProfileDistXY(nProfSize, 0);   <span class="comment">// Along-profile distance measured from the coast, in external CRS units</span></div>
<div class="line"><a id="l00223" name="l00223"></a><span class="lineno">  223</span>   vector&lt;double&gt; dVConsProfileZ(nProfSize, 0);    <span class="comment">// Initial (pre-erosion) elevation of consolidated sediment only for cells &#39;under&#39; the profile</span></div>
<div class="line"><a id="l00224" name="l00224"></a><span class="lineno">  224</span>   vector&lt;double&gt; dVConsZDiff(nProfSize, 0);</div>
<div class="line"><a id="l00225" name="l00225"></a><span class="lineno">  225</span>   vector&lt;double&gt; dVConsSlope(nProfSize, 0);</div>
<div class="line"><a id="l00226" name="l00226"></a><span class="lineno">  226</span> </div>
<div class="line"><a id="l00227" name="l00227"></a><span class="lineno">  227</span>   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; nProfSize; i++)</div>
<div class="line"><a id="l00228" name="l00228"></a><span class="lineno">  228</span>   {</div>
<div class="line"><a id="l00229" name="l00229"></a><span class="lineno">  229</span>      <span class="keywordtype">int</span> <span class="keyword">const</span> nX = pProfile-&gt;<a class="code hl_function" href="../../da/dae/classCGeomProfile.html#ada96aa991d179ac71f4523de7a4be560">pPtiVGetCellsInProfile</a>()-&gt;at(i).nGetX();</div>
<div class="line"><a id="l00230" name="l00230"></a><span class="lineno">  230</span>      <span class="keywordtype">int</span> <span class="keyword">const</span> nY = pProfile-&gt;<a class="code hl_function" href="../../da/dae/classCGeomProfile.html#ada96aa991d179ac71f4523de7a4be560">pPtiVGetCellsInProfile</a>()-&gt;at(i).nGetY();</div>
<div class="line"><a id="l00231" name="l00231"></a><span class="lineno">  231</span> </div>
<div class="line"><a id="l00232" name="l00232"></a><span class="lineno">  232</span>      <span class="comment">// Get the number of the highest layer with non-zero thickness</span></div>
<div class="line"><a id="l00233" name="l00233"></a><span class="lineno">  233</span>      <span class="keywordtype">int</span> <span class="keyword">const</span> nTopLayer = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nX][nY].nGetTopNonZeroLayerAboveBasement();</div>
<div class="line"><a id="l00234" name="l00234"></a><span class="lineno">  234</span> </div>
<div class="line"><a id="l00235" name="l00235"></a><span class="lineno">  235</span>      <span class="comment">// Safety check</span></div>
<div class="line"><a id="l00236" name="l00236"></a><span class="lineno">  236</span>      <span class="keywordflow">if</span> (nTopLayer == <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a01aa8b423260b337ddff2016107b51a0">INT_NODATA</a>)</div>
<div class="line"><a id="l00237" name="l00237"></a><span class="lineno">  237</span>         <span class="keywordflow">return</span> <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a0af2b64c1c33dbf4d223944b0bf234e6">RTN_ERR_NO_TOP_LAYER</a>;</div>
<div class="line"><a id="l00238" name="l00238"></a><span class="lineno">  238</span> </div>
<div class="line"><a id="l00239" name="l00239"></a><span class="lineno">  239</span>      <span class="keywordflow">if</span> (nTopLayer == <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a01522c1e8423c6586193dd5ca0c76171">NO_NONZERO_THICKNESS_LAYERS</a>)</div>
<div class="line"><a id="l00240" name="l00240"></a><span class="lineno">  240</span>         <span class="comment">// TODO 025 We are down to basement</span></div>
<div class="line"><a id="l00241" name="l00241"></a><span class="lineno">  241</span>         <span class="keywordflow">return</span> <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#aa768cb14b5c6123ee95e6e4ebd9fe331">RTN_OK</a>;</div>
<div class="line"><a id="l00242" name="l00242"></a><span class="lineno">  242</span> </div>
<div class="line"><a id="l00243" name="l00243"></a><span class="lineno">  243</span>      <span class="comment">// Get the elevation for consolidated sediment only on this cell</span></div>
<div class="line"><a id="l00244" name="l00244"></a><span class="lineno">  244</span>      dVConsProfileZ[i] = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nX][nY].dGetConsSedTopForLayerAboveBasement(nTopLayer);</div>
<div class="line"><a id="l00245" name="l00245"></a><span class="lineno">  245</span> </div>
<div class="line"><a id="l00246" name="l00246"></a><span class="lineno">  246</span>      <span class="comment">// Get the elevation for both consolidated and unconsolidated sediment on this cell</span></div>
<div class="line"><a id="l00247" name="l00247"></a><span class="lineno">  247</span>      VdProfileZ[i] = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nX][nY].dGetSedimentTopElev();</div>
<div class="line"><a id="l00248" name="l00248"></a><span class="lineno">  248</span> </div>
<div class="line"><a id="l00249" name="l00249"></a><span class="lineno">  249</span>      <span class="comment">// And store the X-Y plane distance from the start of the profile</span></div>
<div class="line"><a id="l00250" name="l00250"></a><span class="lineno">  250</span>      VdProfileDistXY[i] = i * dSpacingXY;</div>
<div class="line"><a id="l00251" name="l00251"></a><span class="lineno">  251</span>   }</div>
<div class="line"><a id="l00252" name="l00252"></a><span class="lineno">  252</span> </div>
<div class="line"><a id="l00253" name="l00253"></a><span class="lineno">  253</span>   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; nProfSize - 1; i++)</div>
<div class="line"><a id="l00254" name="l00254"></a><span class="lineno">  254</span>   {</div>
<div class="line"><a id="l00255" name="l00255"></a><span class="lineno">  255</span>      <span class="comment">// For the consolidated-only profile, get the Z differences (already in external CRS units)</span></div>
<div class="line"><a id="l00256" name="l00256"></a><span class="lineno">  256</span>      dVConsZDiff[i] = dVConsProfileZ[i] - dVConsProfileZ[i + 1];</div>
<div class="line"><a id="l00257" name="l00257"></a><span class="lineno">  257</span> </div>
<div class="line"><a id="l00258" name="l00258"></a><span class="lineno">  258</span>      <span class="comment">// Calculate dZ/dXY, the Z slope (i.e. rise over run) in the XY direction. Note that we use the elevation difference on the seaward side of &#39;this&#39; point</span></div>
<div class="line"><a id="l00259" name="l00259"></a><span class="lineno">  259</span>      dVConsSlope[i] = dVConsZDiff[i] / dSpacingXY;</div>
<div class="line"><a id="l00260" name="l00260"></a><span class="lineno">  260</span>   }</div>
<div class="line"><a id="l00261" name="l00261"></a><span class="lineno">  261</span> </div>
<div class="line"><a id="l00262" name="l00262"></a><span class="lineno">  262</span>   <span class="comment">// Sort out the final value</span></div>
<div class="line"><a id="l00263" name="l00263"></a><span class="lineno">  263</span>   dVConsSlope[nProfSize - 1] = dVConsSlope[nProfSize - 2];</div>
<div class="line"><a id="l00264" name="l00264"></a><span class="lineno">  264</span> </div>
<div class="line"><a id="l00265" name="l00265"></a><span class="lineno">  265</span>   <span class="keywordflow">if</span> (<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#aeb78392a5380da7a2caca22bae4cfcc8">m_nProfileSmoothWindow</a> &gt; 0)</div>
<div class="line"><a id="l00266" name="l00266"></a><span class="lineno">  266</span>   {</div>
<div class="line"><a id="l00267" name="l00267"></a><span class="lineno">  267</span>      <span class="comment">// Smooth the vector of slopes for the consolidated-only profile</span></div>
<div class="line"><a id="l00268" name="l00268"></a><span class="lineno">  268</span>      dVConsSlope = <a class="code hl_function" href="../../d1/d98/classCSimulation.html#a67daaf20e2c3f0d684df910b6b5353ad">dVSmoothProfileSlope</a>(&amp;dVConsSlope);</div>
<div class="line"><a id="l00269" name="l00269"></a><span class="lineno">  269</span>   }</div>
<div class="line"><a id="l00270" name="l00270"></a><span class="lineno">  270</span> </div>
<div class="line"><a id="l00271" name="l00271"></a><span class="lineno">  271</span>   vector&lt;double&gt; dVProfileDepthOverDB(nProfSize, 0);          <span class="comment">// Depth over wave breaking depth at the coastline-normal sample points</span></div>
<div class="line"><a id="l00272" name="l00272"></a><span class="lineno">  272</span>   vector&lt;double&gt; dVProfileErosionPotential(nProfSize, 0);     <span class="comment">// Erosion potential at the coastline-normal sample points</span></div>
<div class="line"><a id="l00273" name="l00273"></a><span class="lineno">  273</span> </div>
<div class="line"><a id="l00274" name="l00274"></a><span class="lineno">  274</span>   <span class="comment">// Calculate the erosion potential along this profile using the shape function</span></div>
<div class="line"><a id="l00275" name="l00275"></a><span class="lineno">  275</span>   <span class="keywordtype">double</span> dTotalErosionPotential = 0;</div>
<div class="line"><a id="l00276" name="l00276"></a><span class="lineno">  276</span>   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; nProfSize; i++)</div>
<div class="line"><a id="l00277" name="l00277"></a><span class="lineno">  277</span>   {</div>
<div class="line"><a id="l00278" name="l00278"></a><span class="lineno">  278</span>      <span class="comment">// Use the actual depth of water here (i.e. the depth to the top of the unconsolidated sediment, including the thickness of consolidated sediment beneath it)</span></div>
<div class="line"><a id="l00279" name="l00279"></a><span class="lineno">  279</span>      dVProfileDepthOverDB[i] = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a115ab27bae37ce2d0de57cbdaeaba852">m_dThisIterSWL</a> - VdProfileZ[i];</div>
<div class="line"><a id="l00280" name="l00280"></a><span class="lineno">  280</span>      dVProfileDepthOverDB[i] /= dDepthOfBreaking;</div>
<div class="line"><a id="l00281" name="l00281"></a><span class="lineno">  281</span> </div>
<div class="line"><a id="l00282" name="l00282"></a><span class="lineno">  282</span>      <span class="comment">// Constrain dDepthOverDB[i] to be between 0 (can get small -ve values due to rounding errors) and m_dDepthOverDBMax</span></div>
<div class="line"><a id="l00283" name="l00283"></a><span class="lineno">  283</span>      dVProfileDepthOverDB[i] = <a class="code hl_function" href="../../d6/d2a/cme_8h.html#a7e895b460cef877dec4d12ead0c74f15">tMax</a>(dVProfileDepthOverDB[i], 0.0);</div>
<div class="line"><a id="l00284" name="l00284"></a><span class="lineno">  284</span>      dVProfileDepthOverDB[i] = <a class="code hl_function" href="../../d6/d2a/cme_8h.html#a068017859403c0629d89f8d348f6c224">tMin</a>(dVProfileDepthOverDB[i], <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a6cab4d9561ad835328f1df42d03edf97">m_dDepthOverDBMax</a>);</div>
<div class="line"><a id="l00285" name="l00285"></a><span class="lineno">  285</span> </div>
<div class="line"><a id="l00286" name="l00286"></a><span class="lineno">  286</span>      <span class="comment">// And then use the look-up table to find the value of erosion potential at this point on the profile</span></div>
<div class="line"><a id="l00287" name="l00287"></a><span class="lineno">  287</span>      dVProfileErosionPotential[i] = <a class="code hl_function" href="../../d1/d98/classCSimulation.html#a0998fa493e91a4e27c79dadb568e7abe">dLookUpErosionPotential</a>(dVProfileDepthOverDB[i]);</div>
<div class="line"><a id="l00288" name="l00288"></a><span class="lineno">  288</span> </div>
<div class="line"><a id="l00289" name="l00289"></a><span class="lineno">  289</span>      <span class="comment">// If erosion potential (a -ve value) is tiny, set it to zero</span></div>
<div class="line"><a id="l00290" name="l00290"></a><span class="lineno">  290</span>      <span class="keywordflow">if</span> (dVProfileErosionPotential[i] &gt; -<a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a992c7916632c97c6c1fa25fd5a788282">SEDIMENT_ELEV_TOLERANCE</a>)</div>
<div class="line"><a id="l00291" name="l00291"></a><span class="lineno">  291</span>         dVProfileErosionPotential[i] = 0;</div>
<div class="line"><a id="l00292" name="l00292"></a><span class="lineno">  292</span> </div>
<div class="line"><a id="l00293" name="l00293"></a><span class="lineno">  293</span>      <span class="comment">// Keep track of the total erosion potential for this profile</span></div>
<div class="line"><a id="l00294" name="l00294"></a><span class="lineno">  294</span>      dTotalErosionPotential += dVProfileErosionPotential[i];</div>
<div class="line"><a id="l00295" name="l00295"></a><span class="lineno">  295</span>   }</div>
<div class="line"><a id="l00296" name="l00296"></a><span class="lineno">  296</span> </div>
<div class="line"><a id="l00297" name="l00297"></a><span class="lineno">  297</span>   <span class="comment">// Constrain erosion potential at every point on the profile, so that the integral of erosion potential on the whole profile is unity (Walkden and Hall 2005). Note that here, erosion potential is -ve so we must constrain to -1</span></div>
<div class="line"><a id="l00298" name="l00298"></a><span class="lineno">  298</span>   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; nProfSize; i++)</div>
<div class="line"><a id="l00299" name="l00299"></a><span class="lineno">  299</span>   {</div>
<div class="line"><a id="l00300" name="l00300"></a><span class="lineno">  300</span>      <span class="keywordflow">if</span> (dTotalErosionPotential &lt; 0)</div>
<div class="line"><a id="l00301" name="l00301"></a><span class="lineno">  301</span>         dVProfileErosionPotential[i] /= (-dTotalErosionPotential);</div>
<div class="line"><a id="l00302" name="l00302"></a><span class="lineno">  302</span>   }</div>
<div class="line"><a id="l00303" name="l00303"></a><span class="lineno">  303</span> </div>
<div class="line"><a id="l00304" name="l00304"></a><span class="lineno">  304</span>   vector&lt;double&gt; dVRecessionXY(nProfSize, 0);</div>
<div class="line"><a id="l00305" name="l00305"></a><span class="lineno">  305</span>   vector&lt;double&gt; dVSCAPEXY(nProfSize, 0);</div>
<div class="line"><a id="l00306" name="l00306"></a><span class="lineno">  306</span> </div>
<div class="line"><a id="l00307" name="l00307"></a><span class="lineno">  307</span>   <span class="comment">// Calculate recession at every point on the coastline-normal profile</span></div>
<div class="line"><a id="l00308" name="l00308"></a><span class="lineno">  308</span>   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; nProfSize; i++)</div>
<div class="line"><a id="l00309" name="l00309"></a><span class="lineno">  309</span>   {</div>
<div class="line"><a id="l00310" name="l00310"></a><span class="lineno">  310</span>      <span class="comment">// dRecession = dForce * (dBeachProtection / dR) * dErosionPotential * dSlope * dTime</span></div>
<div class="line"><a id="l00311" name="l00311"></a><span class="lineno">  311</span>      <span class="comment">// where:</span></div>
<div class="line"><a id="l00312" name="l00312"></a><span class="lineno">  312</span>      <span class="comment">//     dVRecession [m] is the landward migration distance defined in the profile relative (XY) CRS</span></div>
<div class="line"><a id="l00313" name="l00313"></a><span class="lineno">  313</span>      <span class="comment">//     dForce is given by Equation 4 in Walkden &amp; Hall, 2005</span></div>
<div class="line"><a id="l00314" name="l00314"></a><span class="lineno">  314</span>      <span class="comment">//     dVBeachProtection [1] is beach protection factor [1, 0] = [no protection, fully protected]. (This is calculated later, see dCalcBeachProtectionFactor())</span></div>
<div class="line"><a id="l00315" name="l00315"></a><span class="lineno">  315</span>      <span class="comment">//     dVR  [m^(9/4)s^(2/3)] is the material strength and some hydrodynamic constant</span></div>
<div class="line"><a id="l00316" name="l00316"></a><span class="lineno">  316</span>      <span class="comment">//     dVProfileErosionPotential [?] is the erosion potential at each point along the profile</span></div>
<div class="line"><a id="l00317" name="l00317"></a><span class="lineno">  317</span>      <span class="comment">//     dVSlope [1] is the along-profile slope</span></div>
<div class="line"><a id="l00318" name="l00318"></a><span class="lineno">  318</span>      <span class="comment">//     m_dTimeStep * 3600 [s] is the time interval in seconds</span></div>
<div class="line"><a id="l00319" name="l00319"></a><span class="lineno">  319</span>      <span class="comment">//</span></div>
<div class="line"><a id="l00320" name="l00320"></a><span class="lineno">  320</span>      <span class="comment">// dRecession is horizontal recession (along the XY direction):</span></div>
<div class="line"><a id="l00321" name="l00321"></a><span class="lineno">  321</span>      <span class="comment">//</span></div>
<div class="line"><a id="l00322" name="l00322"></a><span class="lineno">  322</span>      <span class="comment">// dVRecessionXY[i] = (dForce * dVBeachProtection[i] * dVErosionPotentialFunc[i] * dVSlope[i] * m_dTimeStep * 3600) / dVR[i]</span></div>
<div class="line"><a id="l00323" name="l00323"></a><span class="lineno">  323</span>      <span class="comment">//</span></div>
<div class="line"><a id="l00324" name="l00324"></a><span class="lineno">  324</span>      <span class="comment">// XY recession must be -ve or zero. If it is +ve then it represents accretion not erosion, which must be described by a different set of equations. So we also need to constrain XY recession to be &lt;= 0</span></div>
<div class="line"><a id="l00325" name="l00325"></a><span class="lineno">  325</span>      dVRecessionXY[i] = <a class="code hl_function" href="../../d6/d2a/cme_8h.html#a068017859403c0629d89f8d348f6c224">tMin</a>(<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].dGetWaveEnergyAtBreaking(nCoastPoint) * dVProfileErosionPotential[i] * dVConsSlope[i] / <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a73e84e0701260f3729b25018aa6d8059">m_dR</a>, 0.0);</div>
<div class="line"><a id="l00326" name="l00326"></a><span class="lineno">  326</span>      dVSCAPEXY[i] = VdProfileDistXY[i] - dVRecessionXY[i];</div>
<div class="line"><a id="l00327" name="l00327"></a><span class="lineno">  327</span>   }</div>
<div class="line"><a id="l00328" name="l00328"></a><span class="lineno">  328</span> </div>
<div class="line"><a id="l00329" name="l00329"></a><span class="lineno">  329</span>   vector&lt;double&gt; dVChangeElevZ(nProfSize, 0);</div>
<div class="line"><a id="l00330" name="l00330"></a><span class="lineno">  330</span> </div>
<div class="line"><a id="l00331" name="l00331"></a><span class="lineno">  331</span>   <span class="comment">// We have calculated the XY-plane recession at every point on the profile, so now convert this to a change in Z-plane elevation at every inundated point on the profile (not the coast point). Again we use the elevation difference on the seaward side of &#39;this&#39; point</span></div>
<div class="line"><a id="l00332" name="l00332"></a><span class="lineno">  332</span>   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 1; i &lt; nProfSize - 1; i++)</div>
<div class="line"><a id="l00333" name="l00333"></a><span class="lineno">  333</span>   {</div>
<div class="line"><a id="l00334" name="l00334"></a><span class="lineno">  334</span>      <span class="comment">// Vertical lowering dZ = dXY * tan(a), where tan(a) is the slope of the SCAPE profile in the XY direction</span></div>
<div class="line"><a id="l00335" name="l00335"></a><span class="lineno">  335</span>      <span class="keywordtype">double</span> dSCAPEHorizDist = dVSCAPEXY[i + 1] - dVSCAPEXY[i];</div>
<div class="line"><a id="l00336" name="l00336"></a><span class="lineno">  336</span>      <span class="keywordtype">double</span> dSCAPEVertDist = dVConsProfileZ[i] - dVConsProfileZ[i + 1];</div>
<div class="line"><a id="l00337" name="l00337"></a><span class="lineno">  337</span>      <span class="keywordtype">double</span> dSCAPESlope = dSCAPEVertDist / dSCAPEHorizDist;</div>
<div class="line"><a id="l00338" name="l00338"></a><span class="lineno">  338</span>      <span class="keywordtype">double</span> dDeltaZ = dVRecessionXY[i] * dSCAPESlope;</div>
<div class="line"><a id="l00339" name="l00339"></a><span class="lineno">  339</span>      <span class="comment">// Safety check: if thickness model has some jumps, dVConsProfileZ might be very high, limiting dSCAPESlope to 0 because all time erode a high fix quantity</span></div>
<div class="line"><a id="l00340" name="l00340"></a><span class="lineno">  340</span>      <span class="keywordflow">if</span> (dSCAPESlope &gt; 1)</div>
<div class="line"><a id="l00341" name="l00341"></a><span class="lineno">  341</span>      {</div>
<div class="line"><a id="l00342" name="l00342"></a><span class="lineno">  342</span>         dDeltaZ = 0;</div>
<div class="line"><a id="l00343" name="l00343"></a><span class="lineno">  343</span>      }</div>
<div class="line"><a id="l00344" name="l00344"></a><span class="lineno">  344</span> </div>
<div class="line"><a id="l00345" name="l00345"></a><span class="lineno">  345</span>      <span class="keywordtype">int</span> <span class="keyword">const</span> nX = pProfile-&gt;<a class="code hl_function" href="../../da/dae/classCGeomProfile.html#ada96aa991d179ac71f4523de7a4be560">pPtiVGetCellsInProfile</a>()-&gt;at(i).nGetX();</div>
<div class="line"><a id="l00346" name="l00346"></a><span class="lineno">  346</span>      <span class="keywordtype">int</span> <span class="keyword">const</span> nY = pProfile-&gt;<a class="code hl_function" href="../../da/dae/classCGeomProfile.html#ada96aa991d179ac71f4523de7a4be560">pPtiVGetCellsInProfile</a>()-&gt;at(i).nGetY();</div>
<div class="line"><a id="l00347" name="l00347"></a><span class="lineno">  347</span> </div>
<div class="line"><a id="l00348" name="l00348"></a><span class="lineno">  348</span>      <span class="comment">// Store the local slope of the consolidated sediment, this is just for output display purposes</span></div>
<div class="line"><a id="l00349" name="l00349"></a><span class="lineno">  349</span>      <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nX][nY].SetLocalConsSlope(dVConsSlope[i]);</div>
<div class="line"><a id="l00350" name="l00350"></a><span class="lineno">  350</span> </div>
<div class="line"><a id="l00351" name="l00351"></a><span class="lineno">  351</span>      <span class="comment">// dDeltaZ is zero or -ve: if dDeltaZ is zero then do nothing, if -ve then remove some sediment from this cell</span></div>
<div class="line"><a id="l00352" name="l00352"></a><span class="lineno">  352</span>      <span class="keywordflow">if</span> (dDeltaZ &lt; 0)</div>
<div class="line"><a id="l00353" name="l00353"></a><span class="lineno">  353</span>      {</div>
<div class="line"><a id="l00354" name="l00354"></a><span class="lineno">  354</span>         <span class="comment">// If there has already been potential erosion on this cell, then it must be a shared line segment (i.e. has co-incident profiles)</span></div>
<div class="line"><a id="l00355" name="l00355"></a><span class="lineno">  355</span>         <span class="keywordtype">double</span> dPrevPotentialErosion = -<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nX][nY].dGetPotentialPlatformErosion();</div>
<div class="line"><a id="l00356" name="l00356"></a><span class="lineno">  356</span>         <span class="keywordflow">if</span> (dPrevPotentialErosion &lt; 0)</div>
<div class="line"><a id="l00357" name="l00357"></a><span class="lineno">  357</span>         {</div>
<div class="line"><a id="l00358" name="l00358"></a><span class="lineno">  358</span>            <span class="comment">// Average the two values</span></div>
<div class="line"><a id="l00359" name="l00359"></a><span class="lineno">  359</span>            <span class="comment">//               LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: [&quot; &lt;&lt; nX &lt;&lt; &quot;][&quot; &lt;&lt; nY &lt;&lt; &quot;] under profile &quot; &lt;&lt; nProfile &lt;&lt; &quot; has previous potential platform erosion = &quot; &lt;&lt; dPrevPotentialErosion &lt;&lt; endl;</span></div>
<div class="line"><a id="l00360" name="l00360"></a><span class="lineno">  360</span>            dDeltaZ = ((dDeltaZ + dPrevPotentialErosion) / 2);</div>
<div class="line"><a id="l00361" name="l00361"></a><span class="lineno">  361</span>         }</div>
<div class="line"><a id="l00362" name="l00362"></a><span class="lineno">  362</span> </div>
<div class="line"><a id="l00363" name="l00363"></a><span class="lineno">  363</span>         <span class="comment">// Constrain the lowering so we don&#39;t get negative slopes or +ve erosion amounts (dDeltaZ must be -ve), this is implicit in SCAPE</span></div>
<div class="line"><a id="l00364" name="l00364"></a><span class="lineno">  364</span>         dDeltaZ = <a class="code hl_function" href="../../d6/d2a/cme_8h.html#a7e895b460cef877dec4d12ead0c74f15">tMax</a>(dDeltaZ, -dVConsZDiff[i]);</div>
<div class="line"><a id="l00365" name="l00365"></a><span class="lineno">  365</span>         dDeltaZ = <a class="code hl_function" href="../../d6/d2a/cme_8h.html#a068017859403c0629d89f8d348f6c224">tMin</a>(dDeltaZ, 0.0);</div>
<div class="line"><a id="l00366" name="l00366"></a><span class="lineno">  366</span>         dVChangeElevZ[i] = dDeltaZ;</div>
<div class="line"><a id="l00367" name="l00367"></a><span class="lineno">  367</span> </div>
<div class="line"><a id="l00368" name="l00368"></a><span class="lineno">  368</span>         <span class="comment">// Set the potential (unconstrained) erosion for this cell, is a +ve value</span></div>
<div class="line"><a id="l00369" name="l00369"></a><span class="lineno">  369</span>         <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nX][nY].SetPotentialPlatformErosion(-dDeltaZ);</div>
<div class="line"><a id="l00370" name="l00370"></a><span class="lineno">  370</span> </div>
<div class="line"><a id="l00371" name="l00371"></a><span class="lineno">  371</span>         <span class="comment">// Update this-timestep totals</span></div>
<div class="line"><a id="l00372" name="l00372"></a><span class="lineno">  372</span>         <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#aa86b50dc1f1dd9fb62827667aadfb542">m_ulThisIterNumPotentialPlatformErosionCells</a>++;</div>
<div class="line"><a id="l00373" name="l00373"></a><span class="lineno">  373</span>         <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a6478fd59a34c3fb4891f570d32a22ddb">m_dThisIterPotentialPlatformErosion</a> -= dDeltaZ;       <span class="comment">// Since dDeltaZ is a -ve value</span></div>
<div class="line"><a id="l00374" name="l00374"></a><span class="lineno">  374</span><span class="comment">//          assert(isfinite(m_dThisIterPotentialPlatformErosion));</span></div>
<div class="line"><a id="l00375" name="l00375"></a><span class="lineno">  375</span><span class="comment">//          assert(m_dThisIterPotentialPlatformErosion &gt;= 0);</span></div>
<div class="line"><a id="l00376" name="l00376"></a><span class="lineno">  376</span> </div>
<div class="line"><a id="l00377" name="l00377"></a><span class="lineno">  377</span>         <span class="comment">// Increment the check values</span></div>
<div class="line"><a id="l00378" name="l00378"></a><span class="lineno">  378</span>         <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#abef67c0ac30d52706bdf5e57f44380df">m_ulTotPotentialPlatformErosionOnProfiles</a>++;</div>
<div class="line"><a id="l00379" name="l00379"></a><span class="lineno">  379</span>         <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a8cc291f5951942ece85859272e871fa1">m_dTotPotentialPlatformErosionOnProfiles</a> -= dDeltaZ;</div>
<div class="line"><a id="l00380" name="l00380"></a><span class="lineno">  380</span>      }</div>
<div class="line"><a id="l00381" name="l00381"></a><span class="lineno">  381</span> </div>
<div class="line"><a id="l00382" name="l00382"></a><span class="lineno">  382</span>      <span class="comment">// Finally, calculate the beach protection factor, this will be used in estimating actual (supply-limited) erosion</span></div>
<div class="line"><a id="l00383" name="l00383"></a><span class="lineno">  383</span>      <span class="keywordtype">double</span> dBeachProtectionFactor = <a class="code hl_function" href="../../d1/d98/classCSimulation.html#addce7ee7de6383e6cf4b074db90f012e">dCalcBeachProtectionFactor</a>(nX, nY, dBreakingWaveHeight);</div>
<div class="line"><a id="l00384" name="l00384"></a><span class="lineno">  384</span>      <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nX][nY].SetBeachProtectionFactor(dBeachProtectionFactor);</div>
<div class="line"><a id="l00385" name="l00385"></a><span class="lineno">  385</span>   }</div>
<div class="line"><a id="l00386" name="l00386"></a><span class="lineno">  386</span> </div>
<div class="line"><a id="l00387" name="l00387"></a><span class="lineno">  387</span>   <span class="comment">// If desired, save this coastline-normal profile data for checking purposes</span></div>
<div class="line"><a id="l00388" name="l00388"></a><span class="lineno">  388</span>   <span class="keywordflow">if</span> (<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#ae059490cc0533a19928e70214e21036b">m_bOutputProfileData</a>)</div>
<div class="line"><a id="l00389" name="l00389"></a><span class="lineno">  389</span>   {</div>
<div class="line"><a id="l00390" name="l00390"></a><span class="lineno">  390</span>      <span class="keywordtype">int</span> nRet = <a class="code hl_function" href="../../d1/d98/classCSimulation.html#a62a7753e37f9e236df3a6213b07585ec">nSaveProfile</a>(nCoast, pProfile, nProfSize, &amp;VdProfileDistXY, &amp;dVConsProfileZ, &amp;dVProfileDepthOverDB, &amp;dVProfileErosionPotential, &amp;dVConsSlope, &amp;dVRecessionXY, &amp;dVChangeElevZ, pProfile-&gt;<a class="code hl_function" href="../../da/dae/classCGeomProfile.html#ada96aa991d179ac71f4523de7a4be560">pPtiVGetCellsInProfile</a>(), &amp;dVSCAPEXY);</div>
<div class="line"><a id="l00391" name="l00391"></a><span class="lineno">  391</span>      <span class="keywordflow">if</span> (nRet != <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#aa768cb14b5c6123ee95e6e4ebd9fe331">RTN_OK</a>)</div>
<div class="line"><a id="l00392" name="l00392"></a><span class="lineno">  392</span>         <span class="keywordflow">return</span> nRet;</div>
<div class="line"><a id="l00393" name="l00393"></a><span class="lineno">  393</span>   }</div>
<div class="line"><a id="l00394" name="l00394"></a><span class="lineno">  394</span> </div>
<div class="line"><a id="l00395" name="l00395"></a><span class="lineno">  395</span>   <span class="keywordflow">return</span> <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#aa768cb14b5c6123ee95e6e4ebd9fe331">RTN_OK</a>;</div>
<div class="line"><a id="l00396" name="l00396"></a><span class="lineno">  396</span>}</div>
</div>
<div class="line"><a id="l00397" name="l00397"></a><span class="lineno">  397</span> </div>
<div class="line"><a id="l00398" name="l00398"></a><span class="lineno">  398</span><span class="comment">//===============================================================================================================================</span></div>
<div class="line"><a id="l00400" name="l00400"></a><span class="lineno">  400</span><span class="comment">//===============================================================================================================================</span></div>
<div class="foldopen" id="foldopen00401" data-start="{" data-end="}">
<div class="line"><a id="l00401" name="l00401"></a><span class="lineno"><a class="line" href="../../d1/d98/classCSimulation.html#a5ecb98fb61c4e0ae63cc6c7786c7a0bf">  401</a></span><span class="keywordtype">int</span> <a class="code hl_function" href="../../d1/d98/classCSimulation.html#a5ecb98fb61c4e0ae63cc6c7786c7a0bf">CSimulation::nCalcPotentialPlatformErosionBetweenProfiles</a>(<span class="keywordtype">int</span> <span class="keyword">const</span> nCoast, <a class="code hl_class" href="../../da/dae/classCGeomProfile.html">CGeomProfile</a>* pProfile, <span class="keywordtype">int</span> <span class="keyword">const</span> nDirection)</div>
<div class="line"><a id="l00402" name="l00402"></a><span class="lineno">  402</span>{</div>
<div class="line"><a id="l00403" name="l00403"></a><span class="lineno">  403</span>   <span class="comment">// Only work on this profile if it is problem-free</span></div>
<div class="line"><a id="l00404" name="l00404"></a><span class="lineno">  404</span>   <span class="keywordflow">if</span> (! pProfile-&gt;<a class="code hl_function" href="../../da/dae/classCGeomProfile.html#aac223e2610d50ca2c7eadaf8542e9498">bOKIncStartAndEndOfCoast</a>())</div>
<div class="line"><a id="l00405" name="l00405"></a><span class="lineno">  405</span>      <span class="keywordflow">return</span> <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#aa768cb14b5c6123ee95e6e4ebd9fe331">RTN_OK</a>;</div>
<div class="line"><a id="l00406" name="l00406"></a><span class="lineno">  406</span> </div>
<div class="line"><a id="l00407" name="l00407"></a><span class="lineno">  407</span>   <span class="keywordtype">int</span> <span class="keyword">const</span> nProfSize = pProfile-&gt;<a class="code hl_function" href="../../da/dae/classCGeomProfile.html#a8a29c3fa364ab1f7b3930b7a9c83f45f">nGetNumCellsInProfile</a>();</div>
<div class="line"><a id="l00408" name="l00408"></a><span class="lineno">  408</span>   <span class="keywordtype">int</span> <span class="keyword">const</span> nCoastProfileStart = pProfile-&gt;<a class="code hl_function" href="../../da/dae/classCGeomProfile.html#a343fd2b73e3a87cf425572860e79ebd6">nGetCoastPoint</a>();</div>
<div class="line"><a id="l00409" name="l00409"></a><span class="lineno">  409</span>   <span class="keywordtype">int</span> <span class="keyword">const</span> nProfileStartX = pProfile-&gt;<a class="code hl_function" href="../../da/dae/classCGeomProfile.html#ada96aa991d179ac71f4523de7a4be560">pPtiVGetCellsInProfile</a>()-&gt;at(0).nGetX();</div>
<div class="line"><a id="l00410" name="l00410"></a><span class="lineno">  410</span>   <span class="keywordtype">int</span> <span class="keyword">const</span> nProfileStartY = pProfile-&gt;<a class="code hl_function" href="../../da/dae/classCGeomProfile.html#ada96aa991d179ac71f4523de7a4be560">pPtiVGetCellsInProfile</a>()-&gt;at(0).nGetY();</div>
<div class="line"><a id="l00411" name="l00411"></a><span class="lineno">  411</span>   <span class="keywordtype">int</span> <span class="keyword">const</span> nCoastMax = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].nGetCoastlineSize();</div>
<div class="line"><a id="l00412" name="l00412"></a><span class="lineno">  412</span>   <span class="keywordtype">int</span> nDistFromProfile = 0;</div>
<div class="line"><a id="l00413" name="l00413"></a><span class="lineno">  413</span>   <span class="keywordtype">int</span> nParCoastXLast = nProfileStartX;</div>
<div class="line"><a id="l00414" name="l00414"></a><span class="lineno">  414</span>   <span class="keywordtype">int</span> nParCoastYLast = nProfileStartY;</div>
<div class="line"><a id="l00415" name="l00415"></a><span class="lineno">  415</span> </div>
<div class="line"><a id="l00416" name="l00416"></a><span class="lineno">  416</span>   <span class="comment">// Start at the coast end of this coastline-normal profile, then move one cell forward along the coast, then construct a parallel profile from this new coastline start cell. Calculate erosion along this parallel profile in the same way as above. Move another cell forward along the coastline, do the same. Keep going until hit another profile</span></div>
<div class="line"><a id="l00417" name="l00417"></a><span class="lineno">  417</span>   <span class="keywordflow">while</span> (<span class="keyword">true</span>)</div>
<div class="line"><a id="l00418" name="l00418"></a><span class="lineno">  418</span>   {</div>
<div class="line"><a id="l00419" name="l00419"></a><span class="lineno">  419</span>      <span class="comment">// Increment the distance from the start coast-normal profile</span></div>
<div class="line"><a id="l00420" name="l00420"></a><span class="lineno">  420</span>      nDistFromProfile++;</div>
<div class="line"><a id="l00421" name="l00421"></a><span class="lineno">  421</span> </div>
<div class="line"><a id="l00422" name="l00422"></a><span class="lineno">  422</span>      <span class="comment">// Start the parallel profile nDistFromProfile cells along the coastline from the coastline-normal profile, direction depending on nDirection</span></div>
<div class="line"><a id="l00423" name="l00423"></a><span class="lineno">  423</span>      <span class="keywordtype">int</span> nThisPointOnCoast = nCoastProfileStart;</div>
<div class="line"><a id="l00424" name="l00424"></a><span class="lineno">  424</span>      <span class="keywordflow">if</span> (nDirection == <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a29fcc12f725cf70f82b391b4fd46d171">DIRECTION_DOWNCOAST</a>)</div>
<div class="line"><a id="l00425" name="l00425"></a><span class="lineno">  425</span>         nThisPointOnCoast += nDistFromProfile;</div>
<div class="line"><a id="l00426" name="l00426"></a><span class="lineno">  426</span>      <span class="keywordflow">else</span></div>
<div class="line"><a id="l00427" name="l00427"></a><span class="lineno">  427</span>         nThisPointOnCoast -= nDistFromProfile;</div>
<div class="line"><a id="l00428" name="l00428"></a><span class="lineno">  428</span> </div>
<div class="line"><a id="l00429" name="l00429"></a><span class="lineno">  429</span>      <span class="comment">// Have we reached the beginning of the coast?</span></div>
<div class="line"><a id="l00430" name="l00430"></a><span class="lineno">  430</span>      <span class="keywordflow">if</span> ((nDirection == <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#abe5cabe81fdbe153e73fd894b3794e50">DIRECTION_UPCOAST</a>) &amp;&amp; (nThisPointOnCoast &lt; 0))</div>
<div class="line"><a id="l00431" name="l00431"></a><span class="lineno">  431</span>      {</div>
<div class="line"><a id="l00432" name="l00432"></a><span class="lineno">  432</span><span class="comment">//         LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: LEAVING LOOP since hit nThisPointOnCoast = &quot; &lt;&lt; nThisPointOnCoast &lt;&lt; &quot; while doing potential platform erosion &quot; &lt;&lt; (nDirection == DIRECTION_DOWNCOAST ? &quot;down&quot; : &quot;up&quot;) &lt;&lt; &quot;-coast from profile = &quot; &lt;&lt; nProfile &lt;&lt; &quot;, dist from profile = &quot; &lt;&lt;  nDistFromProfile &lt;&lt; endl;</span></div>
<div class="line"><a id="l00433" name="l00433"></a><span class="lineno">  433</span> </div>
<div class="line"><a id="l00434" name="l00434"></a><span class="lineno">  434</span>         <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00435" name="l00435"></a><span class="lineno">  435</span>      }</div>
<div class="line"><a id="l00436" name="l00436"></a><span class="lineno">  436</span> </div>
<div class="line"><a id="l00437" name="l00437"></a><span class="lineno">  437</span>      <span class="comment">// Have we reached the end of the coast?</span></div>
<div class="line"><a id="l00438" name="l00438"></a><span class="lineno">  438</span>      <span class="keywordflow">if</span> ((nDirection == <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a29fcc12f725cf70f82b391b4fd46d171">DIRECTION_DOWNCOAST</a>) &amp;&amp; (nThisPointOnCoast &gt;= nCoastMax))</div>
<div class="line"><a id="l00439" name="l00439"></a><span class="lineno">  439</span>      {</div>
<div class="line"><a id="l00440" name="l00440"></a><span class="lineno">  440</span>         <span class="comment">//         LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: LEAVING LOOP since hit nThisPointOnCoast = &quot; &lt;&lt; nThisPointOnCoast &lt;&lt; &quot; while doing potential platform erosion &quot; &lt;&lt; (nDirection == DIRECTION_DOWNCOAST ? &quot;down&quot; : &quot;up&quot;) &lt;&lt; &quot;-coast from profile = &quot; &lt;&lt; nProfile &lt;&lt; &quot;, dist from profile = &quot; &lt;&lt;  nDistFromProfile &lt;&lt; endl;</span></div>
<div class="line"><a id="l00441" name="l00441"></a><span class="lineno">  441</span> </div>
<div class="line"><a id="l00442" name="l00442"></a><span class="lineno">  442</span>         <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00443" name="l00443"></a><span class="lineno">  443</span>      }</div>
<div class="line"><a id="l00444" name="l00444"></a><span class="lineno">  444</span> </div>
<div class="line"><a id="l00445" name="l00445"></a><span class="lineno">  445</span>      <span class="comment">//       LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: from profile &quot; &lt;&lt; nProfile &lt;&lt; &quot;, doing potential platform erosion &quot; &lt;&lt; (nDirection == DIRECTION_DOWNCOAST ? &quot;down&quot; : &quot;up&quot;) &lt;&lt; &quot;-coast, dist from profile = &quot; &lt;&lt;  nDistFromProfile &lt;&lt; endl;</span></div>
<div class="line"><a id="l00446" name="l00446"></a><span class="lineno">  446</span> </div>
<div class="line"><a id="l00447" name="l00447"></a><span class="lineno">  447</span>      <span class="keywordtype">double</span> dDepthOfBreaking = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].dGetDepthOfBreaking(nThisPointOnCoast);</div>
<div class="line"><a id="l00448" name="l00448"></a><span class="lineno">  448</span>      <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d6/d2a/cme_8h.html#a61afa8560a3b39c80657661a1d8f76ab">bFPIsEqual</a>(dDepthOfBreaking, <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#ac003bdff958dca839f5d274f15786e07">DBL_NODATA</a>, <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a08b1623863ee3bd4300a8892de323722">TOLERANCE</a>))</div>
<div class="line"><a id="l00449" name="l00449"></a><span class="lineno">  449</span>      {</div>
<div class="line"><a id="l00450" name="l00450"></a><span class="lineno">  450</span>         <span class="comment">// This parallel profile is not in the active zone, so no platform erosion here. Move on to the next point along the coastline in this direction</span></div>
<div class="line"><a id="l00451" name="l00451"></a><span class="lineno">  451</span>         <span class="comment">// if (m_nLogFileDetail == LOG_FILE_ALL)</span></div>
<div class="line"><a id="l00452" name="l00452"></a><span class="lineno">  452</span>            <span class="comment">// LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: not in active zone at coastline &quot; &lt;&lt; nCoast &lt;&lt; &quot; coast point &quot; &lt;&lt; nThisPointOnCoast &lt;&lt; &quot; when constructing parallel profile for potential platform erosion. Working from profile &quot; &lt;&lt; pProfile-&gt;nGetCoastID() &lt;&lt; &quot;, &quot; &lt;&lt; (nDirection == DIRECTION_DOWNCOAST ? &quot;down&quot; : &quot;up&quot;) &lt;&lt; &quot;-coast, dist from profile = &quot; &lt;&lt; nDistFromProfile &lt;&lt; endl;</span></div>
<div class="line"><a id="l00453" name="l00453"></a><span class="lineno">  453</span> </div>
<div class="line"><a id="l00454" name="l00454"></a><span class="lineno">  454</span>         <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l00455" name="l00455"></a><span class="lineno">  455</span>      }</div>
<div class="line"><a id="l00456" name="l00456"></a><span class="lineno">  456</span> </div>
<div class="line"><a id="l00457" name="l00457"></a><span class="lineno">  457</span><span class="comment">//      LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: BETWEEN PROFILES &quot; &lt;&lt; (nDirection == DIRECTION_DOWNCOAST ? &quot;down&quot; : &quot;up&quot;) &lt;&lt; &quot;-coast from profile &quot; &lt;&lt; nProfile &lt;&lt; &quot; nThisPointOnCoast = &quot; &lt;&lt; nThisPointOnCoast &lt;&lt; &quot; dDepthOfBreaking = &quot; &lt;&lt; dDepthOfBreaking &lt;&lt; &quot; nParProfSize = &quot; &lt;&lt; nParProfSize &lt;&lt; endl;</span></div>
<div class="line"><a id="l00458" name="l00458"></a><span class="lineno">  458</span> </div>
<div class="line"><a id="l00459" name="l00459"></a><span class="lineno">  459</span>      <span class="comment">// All is OK, so get the grid coordinates of this point, which is the coastline start point for the parallel profile</span></div>
<div class="line"><a id="l00460" name="l00460"></a><span class="lineno">  460</span>      <span class="keywordtype">int</span> <span class="keyword">const</span> nParCoastX = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].pPtiGetCellMarkedAsCoastline(nThisPointOnCoast)-&gt;nGetX();</div>
<div class="line"><a id="l00461" name="l00461"></a><span class="lineno">  461</span>      <span class="keywordtype">int</span> <span class="keyword">const</span> nParCoastY = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].pPtiGetCellMarkedAsCoastline(nThisPointOnCoast)-&gt;nGetY();</div>
<div class="line"><a id="l00462" name="l00462"></a><span class="lineno">  462</span> </div>
<div class="line"><a id="l00463" name="l00463"></a><span class="lineno">  463</span>      <span class="keywordflow">if</span> ((nParCoastX == nParCoastXLast) &amp;&amp; (nParCoastY == nParCoastYLast))</div>
<div class="line"><a id="l00464" name="l00464"></a><span class="lineno">  464</span>      {</div>
<div class="line"><a id="l00465" name="l00465"></a><span class="lineno">  465</span>         <span class="comment">// Should not happen, but could do due to rounding errors</span></div>
<div class="line"><a id="l00466" name="l00466"></a><span class="lineno">  466</span>         <span class="keywordflow">if</span> (<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a0245d3cbdd603fbeced6ca1465eb3f16">m_nLogFileDetail</a> &gt;= <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#aa58b13ad2e88aaa20449bfea242396a4">LOG_FILE_ALL</a>)</div>
<div class="line"><a id="l00467" name="l00467"></a><span class="lineno">  467</span>            <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a222962121613613a48f518e0c2110f21">LogStream</a> &lt;&lt; <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a957ca99e98618160534cafb0929f743d">WARN</a> &lt;&lt; <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#ad67e8c5b30a0572f64ecfb5c062c2edc">m_ulIter</a> &lt;&lt; <span class="stringliteral">&quot;: rounding problem on coast &quot;</span> &lt;&lt; nCoast &lt;&lt; <span class="stringliteral">&quot; profile &quot;</span> &lt;&lt; pProfile-&gt;<a class="code hl_function" href="../../da/dae/classCGeomProfile.html#aacd98f9837c3c7cf7414764b73275fba">nGetCoastID</a>() &lt;&lt; <span class="stringliteral">&quot; at [&quot;</span> &lt;&lt; nParCoastX &lt;&lt; <span class="stringliteral">&quot;][&quot;</span> &lt;&lt; nParCoastY &lt;&lt; <span class="stringliteral">&quot;]&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a id="l00468" name="l00468"></a><span class="lineno">  468</span> </div>
<div class="line"><a id="l00469" name="l00469"></a><span class="lineno">  469</span>         <span class="comment">// So move on to the next point along the coastline in this direction</span></div>
<div class="line"><a id="l00470" name="l00470"></a><span class="lineno">  470</span>         <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l00471" name="l00471"></a><span class="lineno">  471</span>      }</div>
<div class="line"><a id="l00472" name="l00472"></a><span class="lineno">  472</span> </div>
<div class="line"><a id="l00473" name="l00473"></a><span class="lineno">  473</span>      <span class="comment">// Is this coastline start point the start point of an adjacent coastline-normal vector?</span></div>
<div class="line"><a id="l00474" name="l00474"></a><span class="lineno">  474</span>      <span class="keywordflow">if</span> (<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nParCoastX][nParCoastY].bIsProfile())</div>
<div class="line"><a id="l00475" name="l00475"></a><span class="lineno">  475</span>      {</div>
<div class="line"><a id="l00476" name="l00476"></a><span class="lineno">  476</span><span class="comment">//         LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: coast &quot; &lt;&lt; nCoast &lt;&lt; &quot;, LEAVING LOOP since hit another profile at nThisPointOnCoast = &quot; &lt;&lt; nThisPointOnCoast &lt;&lt; &quot; while doing potential platform erosion &quot; &lt;&lt; (nDirection == DIRECTION_DOWNCOAST ? &quot;down&quot; : &quot;up&quot;) &lt;&lt; &quot;-coast from profile = &quot; &lt;&lt; nProfile &lt;&lt; &quot;, dist from profile = &quot; &lt;&lt;  nDistFromProfile &lt;&lt; endl;</span></div>
<div class="line"><a id="l00477" name="l00477"></a><span class="lineno">  477</span>         <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00478" name="l00478"></a><span class="lineno">  478</span>      }</div>
<div class="line"><a id="l00479" name="l00479"></a><span class="lineno">  479</span> </div>
<div class="line"><a id="l00480" name="l00480"></a><span class="lineno">  480</span>      <span class="comment">// Get the height of the associated breaking wave from the coast point: this height is used in beach protection calcs. Note that it will be DBL_NODATA if not in active zone</span></div>
<div class="line"><a id="l00481" name="l00481"></a><span class="lineno">  481</span>      <span class="keywordtype">double</span> <span class="keyword">const</span> dBreakingWaveHeight = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].dGetBreakingWaveHeight(nThisPointOnCoast);</div>
<div class="line"><a id="l00482" name="l00482"></a><span class="lineno">  482</span> </div>
<div class="line"><a id="l00483" name="l00483"></a><span class="lineno">  483</span>      <span class="comment">// OK, now construct a parallel profile</span></div>
<div class="line"><a id="l00484" name="l00484"></a><span class="lineno">  484</span>      vector&lt;CGeom2DIPoint&gt; PtiVGridParProfile; <span class="comment">// Integer coords (grid CRS) of cells under the parallel profile</span></div>
<div class="line"><a id="l00485" name="l00485"></a><span class="lineno">  485</span>      vector&lt;CGeom2DPoint&gt; PtVExtCRSParProfile; <span class="comment">// coordinates (external CRS) of cells under the parallel profile</span></div>
<div class="line"><a id="l00486" name="l00486"></a><span class="lineno">  486</span> </div>
<div class="line"><a id="l00487" name="l00487"></a><span class="lineno">  487</span>      <a class="code hl_function" href="../../d1/d98/classCSimulation.html#a39a93413881b60c7fa43dc992c5520d0">ConstructParallelProfile</a>(nProfileStartX, nProfileStartY, nParCoastX, nParCoastY, nProfSize, pProfile-&gt;<a class="code hl_function" href="../../da/dae/classCGeomProfile.html#ada96aa991d179ac71f4523de7a4be560">pPtiVGetCellsInProfile</a>(), &amp;PtiVGridParProfile, &amp;PtVExtCRSParProfile);</div>
<div class="line"><a id="l00488" name="l00488"></a><span class="lineno">  488</span> </div>
<div class="line"><a id="l00489" name="l00489"></a><span class="lineno">  489</span>      <span class="keywordtype">int</span> <span class="keyword">const</span> nParProfSize = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(PtiVGridParProfile.size());</div>
<div class="line"><a id="l00490" name="l00490"></a><span class="lineno">  490</span>      <span class="comment">// We have a parallel profile which starts at the coast, but is it long enough to be useful? May have been cut short because it extended outside the grid, or we hit an adjacent profile</span></div>
<div class="line"><a id="l00491" name="l00491"></a><span class="lineno">  491</span>      <span class="keywordflow">if</span> (nParProfSize &lt; 3)</div>
<div class="line"><a id="l00492" name="l00492"></a><span class="lineno">  492</span>      {</div>
<div class="line"><a id="l00493" name="l00493"></a><span class="lineno">  493</span>         <span class="comment">// We cannot use this parallel profile, it is too short to calculate along-profile slope, so abandon it and move on to the next parallel profile in this direction</span></div>
<div class="line"><a id="l00494" name="l00494"></a><span class="lineno">  494</span>         nParCoastXLast = nParCoastX;</div>
<div class="line"><a id="l00495" name="l00495"></a><span class="lineno">  495</span>         nParCoastYLast = nParCoastY;</div>
<div class="line"><a id="l00496" name="l00496"></a><span class="lineno">  496</span>         <span class="comment">//         LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: parallel profile abandoned since too short, starts at [&quot; &lt;&lt; nParCoastX &lt;&lt; &quot;][&quot; &lt;&lt; nParCoastY &lt;&lt; &quot;] coastline point &quot; &lt;&lt; nThisPointOnCoast &lt;&lt; &quot;, length = &quot; &lt;&lt; nParProfSize &lt;&lt; endl;</span></div>
<div class="line"><a id="l00497" name="l00497"></a><span class="lineno">  497</span>         <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l00498" name="l00498"></a><span class="lineno">  498</span>      }</div>
<div class="line"><a id="l00499" name="l00499"></a><span class="lineno">  499</span> </div>
<div class="line"><a id="l00500" name="l00500"></a><span class="lineno">  500</span>      <span class="comment">// This parallel profile is OK, so calculate potential erosion along it. First calculate the length of the parallel profile in external CRS units</span></div>
<div class="line"><a id="l00501" name="l00501"></a><span class="lineno">  501</span>      <span class="keywordtype">double</span> <span class="keyword">const</span> dParProfileLenXY = <a class="code hl_function" href="../../d1/d98/classCSimulation.html#a407e01ecfd7c564c74f4474216ce2e16">dGetDistanceBetween</a>(&amp;PtVExtCRSParProfile[0], &amp;PtVExtCRSParProfile[nParProfSize - 1]);</div>
<div class="line"><a id="l00502" name="l00502"></a><span class="lineno">  502</span> </div>
<div class="line"><a id="l00503" name="l00503"></a><span class="lineno">  503</span>      <span class="comment">// Next calculate the distance between profile points, again in external CRS units. Assume that the sample points are equally spaced along the parallel profile (not quite true)</span></div>
<div class="line"><a id="l00504" name="l00504"></a><span class="lineno">  504</span>      <span class="keywordtype">double</span> dParSpacingXY = dParProfileLenXY / (nParProfSize - 1);</div>
<div class="line"><a id="l00505" name="l00505"></a><span class="lineno">  505</span> </div>
<div class="line"><a id="l00506" name="l00506"></a><span class="lineno">  506</span>      <span class="comment">// Safety check</span></div>
<div class="line"><a id="l00507" name="l00507"></a><span class="lineno">  507</span>      <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d6/d2a/cme_8h.html#a61afa8560a3b39c80657661a1d8f76ab">bFPIsEqual</a>(dParSpacingXY, 0.0, <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a08b1623863ee3bd4300a8892de323722">TOLERANCE</a>))</div>
<div class="line"><a id="l00508" name="l00508"></a><span class="lineno">  508</span>         dParSpacingXY = <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a08b1623863ee3bd4300a8892de323722">TOLERANCE</a>;</div>
<div class="line"><a id="l00509" name="l00509"></a><span class="lineno">  509</span>      <span class="comment">//      LogStream &lt;&lt; &quot;dParSpacingXY = &quot; &lt;&lt; dParSpacingXY &lt;&lt; endl;</span></div>
<div class="line"><a id="l00510" name="l00510"></a><span class="lineno">  510</span> </div>
<div class="line"><a id="l00511" name="l00511"></a><span class="lineno">  511</span>      vector&lt;double&gt; dVParProfileZ(nParProfSize, 0);      <span class="comment">// Initial (pre-erosion) elevation of both consolidated and unconsolidated sediment for cells &#39;under&#39; the parallel profile</span></div>
<div class="line"><a id="l00512" name="l00512"></a><span class="lineno">  512</span>      vector&lt;double&gt; dVParProfileDistXY(nParProfSize, 0); <span class="comment">// Along-profile distance measured from the coast, in external CRS units</span></div>
<div class="line"><a id="l00513" name="l00513"></a><span class="lineno">  513</span>      vector&lt;double&gt; dVParConsProfileZ(nParProfSize, 0);  <span class="comment">// Initial (pre-erosion) elevation of consolidated sediment only for cells &#39;under&#39; the parallel profile</span></div>
<div class="line"><a id="l00514" name="l00514"></a><span class="lineno">  514</span>      vector&lt;double&gt; dVParConsZDiff(nParProfSize, 0);</div>
<div class="line"><a id="l00515" name="l00515"></a><span class="lineno">  515</span>      vector&lt;double&gt; dVParConsSlope(nParProfSize, 0);</div>
<div class="line"><a id="l00516" name="l00516"></a><span class="lineno">  516</span> </div>
<div class="line"><a id="l00517" name="l00517"></a><span class="lineno">  517</span>      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; nParProfSize; i++)</div>
<div class="line"><a id="l00518" name="l00518"></a><span class="lineno">  518</span>      {</div>
<div class="line"><a id="l00519" name="l00519"></a><span class="lineno">  519</span>         <span class="keywordtype">int</span> <span class="keyword">const</span> nXPar = PtiVGridParProfile[i].nGetX();</div>
<div class="line"><a id="l00520" name="l00520"></a><span class="lineno">  520</span>         <span class="keywordtype">int</span> <span class="keyword">const</span> nYPar = PtiVGridParProfile[i].nGetY();</div>
<div class="line"><a id="l00521" name="l00521"></a><span class="lineno">  521</span> </div>
<div class="line"><a id="l00522" name="l00522"></a><span class="lineno">  522</span>         <span class="comment">// Is this a sea cell?</span></div>
<div class="line"><a id="l00523" name="l00523"></a><span class="lineno">  523</span>         <span class="keywordflow">if</span> (! <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nXPar][nYPar].bIsInundated())</div>
<div class="line"><a id="l00524" name="l00524"></a><span class="lineno">  524</span>         {</div>
<div class="line"><a id="l00525" name="l00525"></a><span class="lineno">  525</span>            <span class="comment">// It isn&#39;t so move along, nothing to do here</span></div>
<div class="line"><a id="l00526" name="l00526"></a><span class="lineno">  526</span>            <span class="comment">//             LogStream &lt;&lt; m_ulIter &lt;&lt; &quot; : [&quot; &lt;&lt; nXPar &lt;&lt; &quot;][&quot; &lt;&lt; nYPar &lt;&lt; &quot;] is not inundated&quot; &lt;&lt; endl;</span></div>
<div class="line"><a id="l00527" name="l00527"></a><span class="lineno">  527</span>            <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l00528" name="l00528"></a><span class="lineno">  528</span>         }</div>
<div class="line"><a id="l00529" name="l00529"></a><span class="lineno">  529</span> </div>
<div class="line"><a id="l00530" name="l00530"></a><span class="lineno">  530</span>         <span class="comment">// Is this cell in a polygon?</span></div>
<div class="line"><a id="l00531" name="l00531"></a><span class="lineno">  531</span>         <span class="keywordtype">int</span> nPolyID = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nXPar][nYPar].nGetPolygonID();</div>
<div class="line"><a id="l00532" name="l00532"></a><span class="lineno">  532</span>         <span class="keywordflow">if</span> (nPolyID == <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a01aa8b423260b337ddff2016107b51a0">INT_NODATA</a>)</div>
<div class="line"><a id="l00533" name="l00533"></a><span class="lineno">  533</span>         {</div>
<div class="line"><a id="l00534" name="l00534"></a><span class="lineno">  534</span>            <span class="comment">// It isn&#39;t. This can happen at the seaward end of polygons TODO 026 Is it a problem?</span></div>
<div class="line"><a id="l00535" name="l00535"></a><span class="lineno">  535</span>            <span class="comment">//             LogStream &lt;&lt; m_ulIter &lt;&lt; &quot; : [&quot; &lt;&lt; nXPar &lt;&lt; &quot;][&quot; &lt;&lt; nYPar &lt;&lt; &quot;] = {&quot; &lt;&lt; dGridCentroidXToExtCRSX(nXPar) &lt;&lt; &quot;, &quot; &lt;&lt; dGridCentroidYToExtCRSY(nYPar) &lt;&lt; &quot;} is not in a polygon&quot; &lt;&lt; endl;</span></div>
<div class="line"><a id="l00536" name="l00536"></a><span class="lineno">  536</span>            <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l00537" name="l00537"></a><span class="lineno">  537</span>         }</div>
<div class="line"><a id="l00538" name="l00538"></a><span class="lineno">  538</span> </div>
<div class="line"><a id="l00539" name="l00539"></a><span class="lineno">  539</span>         <span class="comment">// Get the number of the highest layer with non-zero thickness</span></div>
<div class="line"><a id="l00540" name="l00540"></a><span class="lineno">  540</span>         <span class="keywordtype">int</span> <span class="keyword">const</span> nTopLayer = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nXPar][nYPar].nGetTopNonZeroLayerAboveBasement();</div>
<div class="line"><a id="l00541" name="l00541"></a><span class="lineno">  541</span> </div>
<div class="line"><a id="l00542" name="l00542"></a><span class="lineno">  542</span>         <span class="comment">// Safety check</span></div>
<div class="line"><a id="l00543" name="l00543"></a><span class="lineno">  543</span>         <span class="keywordflow">if</span> (nTopLayer == <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a01aa8b423260b337ddff2016107b51a0">INT_NODATA</a>)</div>
<div class="line"><a id="l00544" name="l00544"></a><span class="lineno">  544</span>            <span class="keywordflow">return</span> <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a0af2b64c1c33dbf4d223944b0bf234e6">RTN_ERR_NO_TOP_LAYER</a>;</div>
<div class="line"><a id="l00545" name="l00545"></a><span class="lineno">  545</span> </div>
<div class="line"><a id="l00546" name="l00546"></a><span class="lineno">  546</span>         <span class="keywordflow">if</span> (nTopLayer == <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a01522c1e8423c6586193dd5ca0c76171">NO_NONZERO_THICKNESS_LAYERS</a>)</div>
<div class="line"><a id="l00547" name="l00547"></a><span class="lineno">  547</span>            <span class="comment">// TODO 025 We are down to basement</span></div>
<div class="line"><a id="l00548" name="l00548"></a><span class="lineno">  548</span>            <span class="keywordflow">return</span> <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#aa768cb14b5c6123ee95e6e4ebd9fe331">RTN_OK</a>;</div>
<div class="line"><a id="l00549" name="l00549"></a><span class="lineno">  549</span> </div>
<div class="line"><a id="l00550" name="l00550"></a><span class="lineno">  550</span>         <span class="comment">// Get the elevation for consolidated sediment only on this cell</span></div>
<div class="line"><a id="l00551" name="l00551"></a><span class="lineno">  551</span>         dVParConsProfileZ[i] = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nXPar][nYPar].dGetConsSedTopForLayerAboveBasement(nTopLayer);</div>
<div class="line"><a id="l00552" name="l00552"></a><span class="lineno">  552</span> </div>
<div class="line"><a id="l00553" name="l00553"></a><span class="lineno">  553</span>         <span class="comment">// Get the elevation for both consolidated and unconsolidated sediment on this cell</span></div>
<div class="line"><a id="l00554" name="l00554"></a><span class="lineno">  554</span>         dVParProfileZ[i] = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nXPar][nYPar].dGetSedimentTopElev();</div>
<div class="line"><a id="l00555" name="l00555"></a><span class="lineno">  555</span> </div>
<div class="line"><a id="l00556" name="l00556"></a><span class="lineno">  556</span>         <span class="comment">// And store the X-Y plane distance from the start of the profile</span></div>
<div class="line"><a id="l00557" name="l00557"></a><span class="lineno">  557</span>         dVParProfileDistXY[i] = i * dParSpacingXY;</div>
<div class="line"><a id="l00558" name="l00558"></a><span class="lineno">  558</span>      }</div>
<div class="line"><a id="l00559" name="l00559"></a><span class="lineno">  559</span> </div>
<div class="line"><a id="l00560" name="l00560"></a><span class="lineno">  560</span>      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; nParProfSize - 1; i++)</div>
<div class="line"><a id="l00561" name="l00561"></a><span class="lineno">  561</span>      {</div>
<div class="line"><a id="l00562" name="l00562"></a><span class="lineno">  562</span>         <span class="comment">// For the consolidated-only profile, get the Z differences (already in external CRS units)</span></div>
<div class="line"><a id="l00563" name="l00563"></a><span class="lineno">  563</span>         dVParConsZDiff[i] = dVParConsProfileZ[i] - dVParConsProfileZ[i + 1];</div>
<div class="line"><a id="l00564" name="l00564"></a><span class="lineno">  564</span> </div>
<div class="line"><a id="l00565" name="l00565"></a><span class="lineno">  565</span>         <span class="comment">// Calculate dZ/dXY, the Z slope (i.e. rise over run) in the XY direction. Note that we use the elevation difference on the seaward side of &#39;this&#39; point</span></div>
<div class="line"><a id="l00566" name="l00566"></a><span class="lineno">  566</span>         dVParConsSlope[i] = dVParConsZDiff[i] / dParSpacingXY;</div>
<div class="line"><a id="l00567" name="l00567"></a><span class="lineno">  567</span>      }</div>
<div class="line"><a id="l00568" name="l00568"></a><span class="lineno">  568</span> </div>
<div class="line"><a id="l00569" name="l00569"></a><span class="lineno">  569</span>      <span class="comment">// Sort out the final slope value</span></div>
<div class="line"><a id="l00570" name="l00570"></a><span class="lineno">  570</span>      dVParConsSlope[nParProfSize - 1] = dVParConsSlope[nParProfSize - 2];</div>
<div class="line"><a id="l00571" name="l00571"></a><span class="lineno">  571</span> </div>
<div class="line"><a id="l00572" name="l00572"></a><span class="lineno">  572</span>      <span class="keywordflow">if</span> (<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#aeb78392a5380da7a2caca22bae4cfcc8">m_nProfileSmoothWindow</a> &gt; 0)</div>
<div class="line"><a id="l00573" name="l00573"></a><span class="lineno">  573</span>      {</div>
<div class="line"><a id="l00574" name="l00574"></a><span class="lineno">  574</span>         <span class="comment">// Smooth the vector of slopes for the consolidated-only profile</span></div>
<div class="line"><a id="l00575" name="l00575"></a><span class="lineno">  575</span>         dVParConsSlope = <a class="code hl_function" href="../../d1/d98/classCSimulation.html#a67daaf20e2c3f0d684df910b6b5353ad">dVSmoothProfileSlope</a>(&amp;dVParConsSlope);</div>
<div class="line"><a id="l00576" name="l00576"></a><span class="lineno">  576</span>      }</div>
<div class="line"><a id="l00577" name="l00577"></a><span class="lineno">  577</span> </div>
<div class="line"><a id="l00578" name="l00578"></a><span class="lineno">  578</span>      <span class="comment">// Initialize the parallel profile vector with depth / m_dWaveBreakingDepth</span></div>
<div class="line"><a id="l00579" name="l00579"></a><span class="lineno">  579</span>      vector&lt;double&gt; dVParProfileDepthOverDB(nParProfSize, 0);      <span class="comment">// Depth / wave breaking depth at the parallel profile sample points</span></div>
<div class="line"><a id="l00580" name="l00580"></a><span class="lineno">  580</span>      vector&lt;double&gt; dVParProfileErosionPotential(nParProfSize, 0); <span class="comment">// Erosion potential at the parallel profile sample points</span></div>
<div class="line"><a id="l00581" name="l00581"></a><span class="lineno">  581</span> </div>
<div class="line"><a id="l00582" name="l00582"></a><span class="lineno">  582</span>      <span class="comment">// Calculate the erosion potential along this profile using the shape function which we read in earlier</span></div>
<div class="line"><a id="l00583" name="l00583"></a><span class="lineno">  583</span>      <span class="keywordtype">double</span> dTotalErosionPotential = 0;</div>
<div class="line"><a id="l00584" name="l00584"></a><span class="lineno">  584</span> </div>
<div class="line"><a id="l00585" name="l00585"></a><span class="lineno">  585</span>      <span class="comment">// Safety check TODO 061 Is this safety check to depth of breaking a reasonable thing to do?</span></div>
<div class="line"><a id="l00586" name="l00586"></a><span class="lineno">  586</span>      <span class="keywordflow">if</span> (dDepthOfBreaking &lt;= 0.0)</div>
<div class="line"><a id="l00587" name="l00587"></a><span class="lineno">  587</span>         dDepthOfBreaking = 1e-10;</div>
<div class="line"><a id="l00588" name="l00588"></a><span class="lineno">  588</span> </div>
<div class="line"><a id="l00589" name="l00589"></a><span class="lineno">  589</span>      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; nParProfSize; i++)</div>
<div class="line"><a id="l00590" name="l00590"></a><span class="lineno">  590</span>      {</div>
<div class="line"><a id="l00591" name="l00591"></a><span class="lineno">  591</span>         <span class="comment">// Use the actual depth of water here (i.e. the depth to the top of the unconsolidated sediment, including the thickness of consolidated sediment beneath it)</span></div>
<div class="line"><a id="l00592" name="l00592"></a><span class="lineno">  592</span>         dVParProfileDepthOverDB[i] = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a115ab27bae37ce2d0de57cbdaeaba852">m_dThisIterSWL</a> - dVParProfileZ[i];</div>
<div class="line"><a id="l00593" name="l00593"></a><span class="lineno">  593</span>         dVParProfileDepthOverDB[i] /= dDepthOfBreaking;</div>
<div class="line"><a id="l00594" name="l00594"></a><span class="lineno">  594</span> </div>
<div class="line"><a id="l00595" name="l00595"></a><span class="lineno">  595</span>         <span class="comment">// Constrain dDepthOverDB[i] to be between 0 (can get small -ve due to rounding errors) and m_dDepthOverDBMax</span></div>
<div class="line"><a id="l00596" name="l00596"></a><span class="lineno">  596</span>         dVParProfileDepthOverDB[i] = <a class="code hl_function" href="../../d6/d2a/cme_8h.html#a7e895b460cef877dec4d12ead0c74f15">tMax</a>(dVParProfileDepthOverDB[i], 0.0);</div>
<div class="line"><a id="l00597" name="l00597"></a><span class="lineno">  597</span>         dVParProfileDepthOverDB[i] = <a class="code hl_function" href="../../d6/d2a/cme_8h.html#a068017859403c0629d89f8d348f6c224">tMin</a>(dVParProfileDepthOverDB[i], <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a6cab4d9561ad835328f1df42d03edf97">m_dDepthOverDBMax</a>);</div>
<div class="line"><a id="l00598" name="l00598"></a><span class="lineno">  598</span> </div>
<div class="line"><a id="l00599" name="l00599"></a><span class="lineno">  599</span>         <span class="comment">// And then use the look-up table to find the value of erosion potential at this point on the profile</span></div>
<div class="line"><a id="l00600" name="l00600"></a><span class="lineno">  600</span>         dVParProfileErosionPotential[i] = <a class="code hl_function" href="../../d1/d98/classCSimulation.html#a0998fa493e91a4e27c79dadb568e7abe">dLookUpErosionPotential</a>(dVParProfileDepthOverDB[i]);</div>
<div class="line"><a id="l00601" name="l00601"></a><span class="lineno">  601</span> </div>
<div class="line"><a id="l00602" name="l00602"></a><span class="lineno">  602</span>         <span class="comment">// If erosion potential (a -ve value) is tiny, set it to zero</span></div>
<div class="line"><a id="l00603" name="l00603"></a><span class="lineno">  603</span>         <span class="keywordflow">if</span> (dVParProfileErosionPotential[i] &gt; -<a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a992c7916632c97c6c1fa25fd5a788282">SEDIMENT_ELEV_TOLERANCE</a>)</div>
<div class="line"><a id="l00604" name="l00604"></a><span class="lineno">  604</span>            dVParProfileErosionPotential[i] = 0;</div>
<div class="line"><a id="l00605" name="l00605"></a><span class="lineno">  605</span> </div>
<div class="line"><a id="l00606" name="l00606"></a><span class="lineno">  606</span>         <span class="comment">// Keep track of the total erosion potential for this profile</span></div>
<div class="line"><a id="l00607" name="l00607"></a><span class="lineno">  607</span>         dTotalErosionPotential += dVParProfileErosionPotential[i];</div>
<div class="line"><a id="l00608" name="l00608"></a><span class="lineno">  608</span>      }</div>
<div class="line"><a id="l00609" name="l00609"></a><span class="lineno">  609</span> </div>
<div class="line"><a id="l00610" name="l00610"></a><span class="lineno">  610</span>      <span class="comment">// Constrain erosion potential at every point on the profile, so that the integral of erosion potential on the whole profile is unity (Walkden and Hall 2005). Note that here, erosion potential is -ve so we must constrain to -1</span></div>
<div class="line"><a id="l00611" name="l00611"></a><span class="lineno">  611</span>      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; nParProfSize; i++)</div>
<div class="line"><a id="l00612" name="l00612"></a><span class="lineno">  612</span>      {</div>
<div class="line"><a id="l00613" name="l00613"></a><span class="lineno">  613</span>         <span class="keywordflow">if</span> (dTotalErosionPotential &lt; 0)</div>
<div class="line"><a id="l00614" name="l00614"></a><span class="lineno">  614</span>            dVParProfileErosionPotential[i] /= (-dTotalErosionPotential);</div>
<div class="line"><a id="l00615" name="l00615"></a><span class="lineno">  615</span>      }</div>
<div class="line"><a id="l00616" name="l00616"></a><span class="lineno">  616</span> </div>
<div class="line"><a id="l00617" name="l00617"></a><span class="lineno">  617</span>      vector&lt;double&gt; dVParRecessionXY(nParProfSize, 0);</div>
<div class="line"><a id="l00618" name="l00618"></a><span class="lineno">  618</span>      vector&lt;double&gt; dVParSCAPEXY(nParProfSize, 0);</div>
<div class="line"><a id="l00619" name="l00619"></a><span class="lineno">  619</span> </div>
<div class="line"><a id="l00620" name="l00620"></a><span class="lineno">  620</span>      <span class="comment">// Calculate recession at every point on the parallel profile</span></div>
<div class="line"><a id="l00621" name="l00621"></a><span class="lineno">  621</span>      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; nParProfSize; i++)</div>
<div class="line"><a id="l00622" name="l00622"></a><span class="lineno">  622</span>      {</div>
<div class="line"><a id="l00623" name="l00623"></a><span class="lineno">  623</span>         <span class="comment">// dRecession = dForce * (dBeachProtection / dR) * dErosionPotential * dSlope * dTime</span></div>
<div class="line"><a id="l00624" name="l00624"></a><span class="lineno">  624</span>         <span class="comment">// where:</span></div>
<div class="line"><a id="l00625" name="l00625"></a><span class="lineno">  625</span>         <span class="comment">//     dVRecession [m] is the landward migration distance defined in the profile relative (XY) CRS</span></div>
<div class="line"><a id="l00626" name="l00626"></a><span class="lineno">  626</span>         <span class="comment">//     dForce is given by Equation 4 in Walkden &amp; Hall, 2005</span></div>
<div class="line"><a id="l00627" name="l00627"></a><span class="lineno">  627</span>         <span class="comment">//     dVBeachProtection [1] is beach protection factor [1, 0] = [no protection, fully protected] (This is calculated later, see dCalcBeachProtectionFactor())</span></div>
<div class="line"><a id="l00628" name="l00628"></a><span class="lineno">  628</span>         <span class="comment">//     dVR  [m^(9/4)s^(2/3)] is the material strength and some hydrodynamic constant</span></div>
<div class="line"><a id="l00629" name="l00629"></a><span class="lineno">  629</span>         <span class="comment">//     dVProfileErosionPotential [?] is the erosion potential at each point along the profile</span></div>
<div class="line"><a id="l00630" name="l00630"></a><span class="lineno">  630</span>         <span class="comment">//     dVSlope [1] is the along-profile slope</span></div>
<div class="line"><a id="l00631" name="l00631"></a><span class="lineno">  631</span>         <span class="comment">//     m_dTimeStep * 3600 [s] is the time interval in seconds</span></div>
<div class="line"><a id="l00632" name="l00632"></a><span class="lineno">  632</span>         <span class="comment">//</span></div>
<div class="line"><a id="l00633" name="l00633"></a><span class="lineno">  633</span>         <span class="comment">// dRecession is horizontal recession (along the XY direction):</span></div>
<div class="line"><a id="l00634" name="l00634"></a><span class="lineno">  634</span>         <span class="comment">//</span></div>
<div class="line"><a id="l00635" name="l00635"></a><span class="lineno">  635</span>         <span class="comment">// dVRecessionXY[i] = (dForce * dVBeachProtection[i] * dVErosionPotentialFunc[i] * dVSlope[i] * m_dTimeStep * 3600) / dVR[i]</span></div>
<div class="line"><a id="l00636" name="l00636"></a><span class="lineno">  636</span>         <span class="comment">//</span></div>
<div class="line"><a id="l00637" name="l00637"></a><span class="lineno">  637</span>         <span class="comment">//</span></div>
<div class="line"><a id="l00638" name="l00638"></a><span class="lineno">  638</span>         <span class="comment">// XY recession must be -ve or zero. If it is +ve then it represents accretion not erosion, which must be described by a different set of equations. So we also need to constrain XY recession to be &lt;= 0</span></div>
<div class="line"><a id="l00639" name="l00639"></a><span class="lineno">  639</span>         dVParRecessionXY[i] = <a class="code hl_function" href="../../d6/d2a/cme_8h.html#a068017859403c0629d89f8d348f6c224">tMin</a>(<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].dGetWaveEnergyAtBreaking(nThisPointOnCoast) * dVParProfileErosionPotential[i] * dVParConsSlope[i] / <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a73e84e0701260f3729b25018aa6d8059">m_dR</a>, 0.0);</div>
<div class="line"><a id="l00640" name="l00640"></a><span class="lineno">  640</span>         dVParSCAPEXY[i] = dVParProfileDistXY[i] - dVParRecessionXY[i];</div>
<div class="line"><a id="l00641" name="l00641"></a><span class="lineno">  641</span> </div>
<div class="line"><a id="l00642" name="l00642"></a><span class="lineno">  642</span>         <span class="comment">//         LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: [&quot; &lt;&lt; nXPar &lt;&lt; &quot;][&quot; &lt;&lt; nYPar &lt;&lt; &quot;] = {&quot; &lt;&lt; dGridCentroidXToExtCRSX(nXPar) &lt;&lt; &quot;, &quot; &lt;&lt;  dGridCentroidYToExtCRSY(nYPar) &lt;&lt; &quot;} wave energy = &quot; &lt;&lt; m_VCoast[nCoast].dGetWaveEnergyAtBreaking(nThisPointOnCoast) &lt;&lt; &quot; erosion potential = &quot; &lt;&lt; dVParProfileErosionPotential[i] &lt;&lt; &quot; slope = &quot; &lt;&lt; dVParProfileSlope[i] &lt;&lt; &quot; dVParZDiff[i] = &quot; &lt;&lt; dVParZDiff[i] &lt;&lt; &quot; nParProfSize = &quot; &lt;&lt; nParProfSize &lt;&lt; endl;</span></div>
<div class="line"><a id="l00643" name="l00643"></a><span class="lineno">  643</span>      }</div>
<div class="line"><a id="l00644" name="l00644"></a><span class="lineno">  644</span> </div>
<div class="line"><a id="l00645" name="l00645"></a><span class="lineno">  645</span>      vector&lt;double&gt; dVParDeltaZ(nParProfSize, 0);</div>
<div class="line"><a id="l00646" name="l00646"></a><span class="lineno">  646</span> </div>
<div class="line"><a id="l00647" name="l00647"></a><span class="lineno">  647</span>      <span class="comment">// We have calculated the XY-plane recession at every point on the profile, so now convert this to a change in Z-plane elevation at every inundated point on the profile (not the coast point). Again we use the elevation difference on the seaward side of &#39;this&#39; point</span></div>
<div class="line"><a id="l00648" name="l00648"></a><span class="lineno">  648</span>      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 1; i &lt; nParProfSize - 1; i++)</div>
<div class="line"><a id="l00649" name="l00649"></a><span class="lineno">  649</span>      {</div>
<div class="line"><a id="l00650" name="l00650"></a><span class="lineno">  650</span>         <span class="comment">// Vertical lowering dZ = dXY * tan(a), where tan(a) is the slope of the SCAPE profile in the XY direction</span></div>
<div class="line"><a id="l00651" name="l00651"></a><span class="lineno">  651</span>         <span class="keywordtype">double</span> dSCAPEHorizDist = dVParSCAPEXY[i + 1] - dVParSCAPEXY[i];</div>
<div class="line"><a id="l00652" name="l00652"></a><span class="lineno">  652</span>         </div>
<div class="line"><a id="l00653" name="l00653"></a><span class="lineno">  653</span>         <span class="comment">// Safety check</span></div>
<div class="line"><a id="l00654" name="l00654"></a><span class="lineno">  654</span>         <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d6/d2a/cme_8h.html#a61afa8560a3b39c80657661a1d8f76ab">bFPIsEqual</a>(dSCAPEHorizDist, 0.0, <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a08b1623863ee3bd4300a8892de323722">TOLERANCE</a>))</div>
<div class="line"><a id="l00655" name="l00655"></a><span class="lineno">  655</span>            <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l00656" name="l00656"></a><span class="lineno">  656</span>             </div>
<div class="line"><a id="l00657" name="l00657"></a><span class="lineno">  657</span>         <span class="keywordtype">double</span> dSCAPEVertDist = dVParConsProfileZ[i] - dVParConsProfileZ[i + 1];</div>
<div class="line"><a id="l00658" name="l00658"></a><span class="lineno">  658</span>         <span class="keywordtype">double</span> dSCAPESlope = dSCAPEVertDist / dSCAPEHorizDist;</div>
<div class="line"><a id="l00659" name="l00659"></a><span class="lineno">  659</span>         <span class="keywordtype">double</span> dDeltaZ = dVParRecessionXY[i] * dSCAPESlope;</div>
<div class="line"><a id="l00660" name="l00660"></a><span class="lineno">  660</span>             <span class="comment">// Safety check: if thickness model has some jumps, dVConsProfileZ might be very high, limiting dSCAPESlope to 0 because all time erode a high fix quantity</span></div>
<div class="line"><a id="l00661" name="l00661"></a><span class="lineno">  661</span>         <span class="keywordflow">if</span> (dSCAPESlope &gt; 1)</div>
<div class="line"><a id="l00662" name="l00662"></a><span class="lineno">  662</span>         {</div>
<div class="line"><a id="l00663" name="l00663"></a><span class="lineno">  663</span>            dDeltaZ = 0;</div>
<div class="line"><a id="l00664" name="l00664"></a><span class="lineno">  664</span>         }</div>
<div class="line"><a id="l00665" name="l00665"></a><span class="lineno">  665</span> </div>
<div class="line"><a id="l00666" name="l00666"></a><span class="lineno">  666</span>         <span class="keywordtype">int</span> <span class="keyword">const</span> nXPar = PtiVGridParProfile[i].nGetX();</div>
<div class="line"><a id="l00667" name="l00667"></a><span class="lineno">  667</span>         <span class="keywordtype">int</span> <span class="keyword">const</span> nYPar = PtiVGridParProfile[i].nGetY();</div>
<div class="line"><a id="l00668" name="l00668"></a><span class="lineno">  668</span> </div>
<div class="line"><a id="l00669" name="l00669"></a><span class="lineno">  669</span>         <span class="comment">// Store the local slope of the consolidated sediment, this is just for output display purposes</span></div>
<div class="line"><a id="l00670" name="l00670"></a><span class="lineno">  670</span>         <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nXPar][nYPar].SetLocalConsSlope(dVParConsSlope[i]);</div>
<div class="line"><a id="l00671" name="l00671"></a><span class="lineno">  671</span> </div>
<div class="line"><a id="l00672" name="l00672"></a><span class="lineno">  672</span>         <span class="comment">// dDeltaZ is zero or -ve: if dDeltaZ is zero then do nothing, if -ve then remove some sediment from this cell</span></div>
<div class="line"><a id="l00673" name="l00673"></a><span class="lineno">  673</span>         <span class="keywordflow">if</span> (dDeltaZ &lt; 0)</div>
<div class="line"><a id="l00674" name="l00674"></a><span class="lineno">  674</span>         {</div>
<div class="line"><a id="l00675" name="l00675"></a><span class="lineno">  675</span>            <span class="comment">// Has this cell already been eroded during this timestep?</span></div>
<div class="line"><a id="l00676" name="l00676"></a><span class="lineno">  676</span>            <span class="keywordflow">if</span> (<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nXPar][nYPar].bPotentialPlatformErosion())</div>
<div class="line"><a id="l00677" name="l00677"></a><span class="lineno">  677</span>            {</div>
<div class="line"><a id="l00678" name="l00678"></a><span class="lineno">  678</span>               <span class="comment">// It has</span></div>
<div class="line"><a id="l00679" name="l00679"></a><span class="lineno">  679</span>               <span class="keywordtype">double</span> <span class="keyword">const</span> dPrevPotentialErosion = -<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nXPar][nYPar].dGetPotentialPlatformErosion();</div>
<div class="line"><a id="l00680" name="l00680"></a><span class="lineno">  680</span> </div>
<div class="line"><a id="l00681" name="l00681"></a><span class="lineno">  681</span>               <span class="comment">//                  LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: [&quot; &lt;&lt; nXPar &lt;&lt; &quot;][&quot; &lt;&lt; nYPar &lt;&lt; &quot;] parallel profile &quot; &lt;&lt; nDistFromProfile &lt;&lt; &quot; coast points &quot; &lt;&lt; (nDirection == DIRECTION_DOWNCOAST ? &quot;down&quot; : &quot;up&quot;) &lt;&lt; &quot;-coast from profile &quot; &lt;&lt; nProfile &lt;&lt; &quot; has previous potential platform erosion = &quot; &lt;&lt; dPrevPotentialErosion &lt;&lt; &quot;, current potential platform erosion = &quot; &lt;&lt; dDeltaZ &lt;&lt; &quot;, max value = &quot; &lt;&lt; tMin(dPrevPotentialErosion, dDeltaZ) &lt;&lt; endl;</span></div>
<div class="line"><a id="l00682" name="l00682"></a><span class="lineno">  682</span> </div>
<div class="line"><a id="l00683" name="l00683"></a><span class="lineno">  683</span>               <span class="comment">// Use the larger of the two -ve values</span></div>
<div class="line"><a id="l00684" name="l00684"></a><span class="lineno">  684</span>               dDeltaZ = <a class="code hl_function" href="../../d6/d2a/cme_8h.html#a068017859403c0629d89f8d348f6c224">tMin</a>(dPrevPotentialErosion, dDeltaZ);</div>
<div class="line"><a id="l00685" name="l00685"></a><span class="lineno">  685</span> </div>
<div class="line"><a id="l00686" name="l00686"></a><span class="lineno">  686</span>               <span class="comment">// Adjust this-timestep totals, since this cell has already been eroded</span></div>
<div class="line"><a id="l00687" name="l00687"></a><span class="lineno">  687</span>               <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#aa86b50dc1f1dd9fb62827667aadfb542">m_ulThisIterNumPotentialPlatformErosionCells</a>--;</div>
<div class="line"><a id="l00688" name="l00688"></a><span class="lineno">  688</span>               <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a6478fd59a34c3fb4891f570d32a22ddb">m_dThisIterPotentialPlatformErosion</a> += dPrevPotentialErosion; <span class="comment">// Since dPrevPotentialErosion is +ve</span></div>
<div class="line"><a id="l00689" name="l00689"></a><span class="lineno">  689</span>                                                                             <span class="comment">//                assert(isfinite(m_dThisIterPotentialPlatformErosion));</span></div>
<div class="line"><a id="l00690" name="l00690"></a><span class="lineno">  690</span>                                                                             <span class="comment">//                assert(m_dThisIterPotentialPlatformErosion &gt;= 0);</span></div>
<div class="line"><a id="l00691" name="l00691"></a><span class="lineno">  691</span> </div>
<div class="line"><a id="l00692" name="l00692"></a><span class="lineno">  692</span>               <span class="comment">// And also adjust the check values</span></div>
<div class="line"><a id="l00693" name="l00693"></a><span class="lineno">  693</span>               <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#ac2937805b3fc0bb1b75201ea16870936">m_ulTotPotentialPlatformErosionBetweenProfiles</a>--;</div>
<div class="line"><a id="l00694" name="l00694"></a><span class="lineno">  694</span>               <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a46df9f5bbc643a6884c18ebe097bdb79">m_dTotPotentialPlatformErosionBetweenProfiles</a> += dPrevPotentialErosion; <span class="comment">// Since -ve</span></div>
<div class="line"><a id="l00695" name="l00695"></a><span class="lineno">  695</span>            }</div>
<div class="line"><a id="l00696" name="l00696"></a><span class="lineno">  696</span> </div>
<div class="line"><a id="l00697" name="l00697"></a><span class="lineno">  697</span>            <span class="comment">// Constrain the lowering so we don&#39;t get negative slopes or +ve erosion amounts (dDeltaZ must be -ve), this is implicit in SCAPE</span></div>
<div class="line"><a id="l00698" name="l00698"></a><span class="lineno">  698</span>            dDeltaZ = <a class="code hl_function" href="../../d6/d2a/cme_8h.html#a7e895b460cef877dec4d12ead0c74f15">tMax</a>(dDeltaZ, -dVParConsZDiff[i]);</div>
<div class="line"><a id="l00699" name="l00699"></a><span class="lineno">  699</span>            dDeltaZ = <a class="code hl_function" href="../../d6/d2a/cme_8h.html#a068017859403c0629d89f8d348f6c224">tMin</a>(dDeltaZ, 0.0);</div>
<div class="line"><a id="l00700" name="l00700"></a><span class="lineno">  700</span>            dVParDeltaZ[i] = dDeltaZ;</div>
<div class="line"><a id="l00701" name="l00701"></a><span class="lineno">  701</span> </div>
<div class="line"><a id="l00702" name="l00702"></a><span class="lineno">  702</span>            <span class="comment">// Set the potential (unconstrained) erosion for this cell, it is a +ve value</span></div>
<div class="line"><a id="l00703" name="l00703"></a><span class="lineno">  703</span>            <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nXPar][nYPar].SetPotentialPlatformErosion(-dDeltaZ);</div>
<div class="line"><a id="l00704" name="l00704"></a><span class="lineno">  704</span><span class="comment">//               LogStream &lt;&lt; &quot;[&quot; &lt;&lt; nXPar &lt;&lt; &quot;][&quot; &lt;&lt; nYPar &lt;&lt; &quot;] = {&quot; &lt;&lt; dGridCentroidXToExtCRSX(nXPar) &lt;&lt; &quot;, &quot; &lt;&lt;  dGridCentroidYToExtCRSY(nYPar) &lt;&lt; &quot;} has potential platform erosion = &quot; &lt;&lt; -dDeltaZ &lt;&lt; endl;</span></div>
<div class="line"><a id="l00705" name="l00705"></a><span class="lineno">  705</span> </div>
<div class="line"><a id="l00706" name="l00706"></a><span class="lineno">  706</span>            <span class="comment">// Update this-timestep totals</span></div>
<div class="line"><a id="l00707" name="l00707"></a><span class="lineno">  707</span>            <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#aa86b50dc1f1dd9fb62827667aadfb542">m_ulThisIterNumPotentialPlatformErosionCells</a>++;</div>
<div class="line"><a id="l00708" name="l00708"></a><span class="lineno">  708</span>            <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a6478fd59a34c3fb4891f570d32a22ddb">m_dThisIterPotentialPlatformErosion</a> -= dDeltaZ; <span class="comment">// Since dDeltaZ is a -ve value</span></div>
<div class="line"><a id="l00709" name="l00709"></a><span class="lineno">  709</span><span class="comment">//             assert(isfinite(m_dThisIterPotentialPlatformErosion));</span></div>
<div class="line"><a id="l00710" name="l00710"></a><span class="lineno">  710</span><span class="comment">//             assert(m_dThisIterPotentialPlatformErosion &gt;= 0);</span></div>
<div class="line"><a id="l00711" name="l00711"></a><span class="lineno">  711</span> </div>
<div class="line"><a id="l00712" name="l00712"></a><span class="lineno">  712</span>            <span class="comment">// Increment the check values</span></div>
<div class="line"><a id="l00713" name="l00713"></a><span class="lineno">  713</span>            <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#ac2937805b3fc0bb1b75201ea16870936">m_ulTotPotentialPlatformErosionBetweenProfiles</a>++;</div>
<div class="line"><a id="l00714" name="l00714"></a><span class="lineno">  714</span>            <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a46df9f5bbc643a6884c18ebe097bdb79">m_dTotPotentialPlatformErosionBetweenProfiles</a> -= dDeltaZ; <span class="comment">// Since -ve</span></div>
<div class="line"><a id="l00715" name="l00715"></a><span class="lineno">  715</span>         }</div>
<div class="line"><a id="l00716" name="l00716"></a><span class="lineno">  716</span> </div>
<div class="line"><a id="l00717" name="l00717"></a><span class="lineno">  717</span>         <span class="comment">// Finally, calculate the beach protection factor, this will be used in estimating actual (supply-limited) erosion</span></div>
<div class="line"><a id="l00718" name="l00718"></a><span class="lineno">  718</span>         <span class="keywordtype">double</span> <span class="keyword">const</span> dBeachProtectionFactor = <a class="code hl_function" href="../../d1/d98/classCSimulation.html#addce7ee7de6383e6cf4b074db90f012e">dCalcBeachProtectionFactor</a>(nXPar, nYPar, dBreakingWaveHeight);</div>
<div class="line"><a id="l00719" name="l00719"></a><span class="lineno">  719</span>         <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nXPar][nYPar].SetBeachProtectionFactor(dBeachProtectionFactor);</div>
<div class="line"><a id="l00720" name="l00720"></a><span class="lineno">  720</span>      }</div>
<div class="line"><a id="l00721" name="l00721"></a><span class="lineno">  721</span> </div>
<div class="line"><a id="l00722" name="l00722"></a><span class="lineno">  722</span>      <span class="comment">// If desired, save this parallel coastline-normal profile for checking purposes</span></div>
<div class="line"><a id="l00723" name="l00723"></a><span class="lineno">  723</span>      <span class="keywordflow">if</span> (<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#af9cc39225a10048022a5321022bc16c8">m_bOutputParallelProfileData</a>)</div>
<div class="line"><a id="l00724" name="l00724"></a><span class="lineno">  724</span>      {</div>
<div class="line"><a id="l00725" name="l00725"></a><span class="lineno">  725</span>         <span class="keywordtype">int</span> <span class="keyword">const</span> nRet = <a class="code hl_function" href="../../d1/d98/classCSimulation.html#a3b7163f1f1ca4965591fd6a7e2b53d2b">nSaveParProfile</a>(nCoast, pProfile, nParProfSize, nDirection, nDistFromProfile, &amp;dVParProfileDistXY, &amp;dVParConsProfileZ, &amp;dVParProfileDepthOverDB, &amp;dVParProfileErosionPotential, &amp;dVParConsSlope, &amp;dVParRecessionXY, &amp;dVParDeltaZ, pProfile-&gt;<a class="code hl_function" href="../../da/dae/classCGeomProfile.html#ada96aa991d179ac71f4523de7a4be560">pPtiVGetCellsInProfile</a>(), &amp;dVParSCAPEXY);</div>
<div class="line"><a id="l00726" name="l00726"></a><span class="lineno">  726</span>         <span class="keywordflow">if</span> (nRet != <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#aa768cb14b5c6123ee95e6e4ebd9fe331">RTN_OK</a>)</div>
<div class="line"><a id="l00727" name="l00727"></a><span class="lineno">  727</span>            <span class="keywordflow">return</span> nRet;</div>
<div class="line"><a id="l00728" name="l00728"></a><span class="lineno">  728</span>      }</div>
<div class="line"><a id="l00729" name="l00729"></a><span class="lineno">  729</span> </div>
<div class="line"><a id="l00730" name="l00730"></a><span class="lineno">  730</span>      <span class="comment">// Update for next time round the loop</span></div>
<div class="line"><a id="l00731" name="l00731"></a><span class="lineno">  731</span>      nParCoastXLast = nParCoastX;</div>
<div class="line"><a id="l00732" name="l00732"></a><span class="lineno">  732</span>      nParCoastYLast = nParCoastY;</div>
<div class="line"><a id="l00733" name="l00733"></a><span class="lineno">  733</span>   }</div>
<div class="line"><a id="l00734" name="l00734"></a><span class="lineno">  734</span> </div>
<div class="line"><a id="l00735" name="l00735"></a><span class="lineno">  735</span>   <span class="keywordflow">return</span> <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#aa768cb14b5c6123ee95e6e4ebd9fe331">RTN_OK</a>;</div>
<div class="line"><a id="l00736" name="l00736"></a><span class="lineno">  736</span>}</div>
</div>
<div class="line"><a id="l00737" name="l00737"></a><span class="lineno">  737</span> </div>
<div class="line"><a id="l00738" name="l00738"></a><span class="lineno">  738</span><span class="comment">//===============================================================================================================================</span></div>
<div class="line"><a id="l00740" name="l00740"></a><span class="lineno">  740</span><span class="comment">//===============================================================================================================================</span></div>
<div class="foldopen" id="foldopen00741" data-start="{" data-end="}">
<div class="line"><a id="l00741" name="l00741"></a><span class="lineno"><a class="line" href="../../d1/d98/classCSimulation.html#a9f6cbe5853ed2e733f85a88419341950">  741</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../d1/d98/classCSimulation.html#a9f6cbe5853ed2e733f85a88419341950">CSimulation::DoActualPlatformErosionOnCell</a>(<span class="keywordtype">int</span> <span class="keyword">const</span> nX, <span class="keywordtype">int</span> <span class="keyword">const</span> nY)</div>
<div class="line"><a id="l00742" name="l00742"></a><span class="lineno">  742</span>{</div>
<div class="line"><a id="l00743" name="l00743"></a><span class="lineno">  743</span><span class="comment">//    LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: doing platform erosion on cell [&quot; &lt;&lt; nX &lt;&lt; &quot;][&quot; &lt;&lt; nY &lt;&lt; &quot;] = {&quot; &lt;&lt; dGridCentroidXToExtCRSX(nX) &lt;&lt; &quot;, &quot; &lt;&lt; dGridCentroidYToExtCRSY(nY) &lt;&lt; &quot;}&quot; &lt;&lt; endl;</span></div>
<div class="line"><a id="l00744" name="l00744"></a><span class="lineno">  744</span> </div>
<div class="line"><a id="l00745" name="l00745"></a><span class="lineno">  745</span>   <span class="comment">// Get the beach protection factor, which quantifies the extent to which unconsolidated sediment on the shore platform (beach) protects the shore platform</span></div>
<div class="line"><a id="l00746" name="l00746"></a><span class="lineno">  746</span>   <span class="keywordtype">double</span> <span class="keyword">const</span> dBeachProtectionFactor = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nX][nY].dGetBeachProtectionFactor();</div>
<div class="line"><a id="l00747" name="l00747"></a><span class="lineno">  747</span>   <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d6/d2a/cme_8h.html#a61afa8560a3b39c80657661a1d8f76ab">bFPIsEqual</a>(dBeachProtectionFactor, 0.0, <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a08b1623863ee3bd4300a8892de323722">TOLERANCE</a>))</div>
<div class="line"><a id="l00748" name="l00748"></a><span class="lineno">  748</span>      <span class="comment">// The beach is sufficiently thick to prevent any platform erosion (or we are down to basement)</span></div>
<div class="line"><a id="l00749" name="l00749"></a><span class="lineno">  749</span>      <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00750" name="l00750"></a><span class="lineno">  750</span> </div>
<div class="line"><a id="l00751" name="l00751"></a><span class="lineno">  751</span>   <span class="comment">// Get the potential depth of potential erosion, considering beach protection</span></div>
<div class="line"><a id="l00752" name="l00752"></a><span class="lineno">  752</span>   <span class="keywordtype">double</span> dThisPotentialErosion = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nX][nY].dGetPotentialPlatformErosion() * dBeachProtectionFactor;</div>
<div class="line"><a id="l00753" name="l00753"></a><span class="lineno">  753</span> </div>
<div class="line"><a id="l00754" name="l00754"></a><span class="lineno">  754</span>   <span class="comment">// We will be eroding the topmost layer that has non-zero thickness</span></div>
<div class="line"><a id="l00755" name="l00755"></a><span class="lineno">  755</span>   <span class="keywordtype">int</span> nThisLayer = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nX][nY].nGetTopNonZeroLayerAboveBasement();</div>
<div class="line"><a id="l00756" name="l00756"></a><span class="lineno">  756</span> </div>
<div class="line"><a id="l00757" name="l00757"></a><span class="lineno">  757</span>   <span class="comment">// Safety check</span></div>
<div class="line"><a id="l00758" name="l00758"></a><span class="lineno">  758</span>   <span class="keywordflow">if</span> (nThisLayer == <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a01aa8b423260b337ddff2016107b51a0">INT_NODATA</a>)</div>
<div class="line"><a id="l00759" name="l00759"></a><span class="lineno">  759</span>   {</div>
<div class="line"><a id="l00760" name="l00760"></a><span class="lineno">  760</span>      cerr &lt;&lt; <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a292fc90846543ca4814daa9f759feb05">ERR</a> &lt;&lt; <span class="stringliteral">&quot;no sediment layer in DoActualPlatformErosionOnCell()&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a id="l00761" name="l00761"></a><span class="lineno">  761</span>      <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00762" name="l00762"></a><span class="lineno">  762</span>   }</div>
<div class="line"><a id="l00763" name="l00763"></a><span class="lineno">  763</span> </div>
<div class="line"><a id="l00764" name="l00764"></a><span class="lineno">  764</span>   <span class="keywordflow">if</span> (nThisLayer == <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a01522c1e8423c6586193dd5ca0c76171">NO_NONZERO_THICKNESS_LAYERS</a>)</div>
<div class="line"><a id="l00765" name="l00765"></a><span class="lineno">  765</span>      <span class="comment">// No layer with non-zero thickness left, we are down to basement</span></div>
<div class="line"><a id="l00766" name="l00766"></a><span class="lineno">  766</span>      <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00767" name="l00767"></a><span class="lineno">  767</span> </div>
<div class="line"><a id="l00768" name="l00768"></a><span class="lineno">  768</span>   <span class="comment">// OK, we have a layer that can be eroded so find out how much consolidated sediment we have available on this cell</span></div>
<div class="line"><a id="l00769" name="l00769"></a><span class="lineno">  769</span>   <span class="keywordtype">double</span> dExistingAvailableFine = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nX][nY].pGetLayerAboveBasement(nThisLayer)-&gt;pGetConsolidatedSediment()-&gt;dGetFineDepth();</div>
<div class="line"><a id="l00770" name="l00770"></a><span class="lineno">  770</span>   <span class="keywordtype">double</span> dExistingAvailableSand = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nX][nY].pGetLayerAboveBasement(nThisLayer)-&gt;pGetConsolidatedSediment()-&gt;dGetSandDepth();</div>
<div class="line"><a id="l00771" name="l00771"></a><span class="lineno">  771</span>   <span class="keywordtype">double</span> dExistingAvailableCoarse = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nX][nY].pGetLayerAboveBasement(nThisLayer)-&gt;pGetConsolidatedSediment()-&gt;dGetCoarseDepth();</div>
<div class="line"><a id="l00772" name="l00772"></a><span class="lineno">  772</span> </div>
<div class="line"><a id="l00773" name="l00773"></a><span class="lineno">  773</span>   <span class="comment">// Now partition the total lowering for this cell between the three size fractions: do this by relative erodibility</span></div>
<div class="line"><a id="l00774" name="l00774"></a><span class="lineno">  774</span>   <span class="keywordtype">int</span> nFineWeight = (dExistingAvailableFine &gt; 0 ? 1 : 0);</div>
<div class="line"><a id="l00775" name="l00775"></a><span class="lineno">  775</span>   <span class="keywordtype">int</span> nSandWeight = (dExistingAvailableSand &gt; 0 ? 1 : 0);</div>
<div class="line"><a id="l00776" name="l00776"></a><span class="lineno">  776</span>   <span class="keywordtype">int</span> nCoarseWeight = (dExistingAvailableCoarse &gt; 0 ? 1 : 0);</div>
<div class="line"><a id="l00777" name="l00777"></a><span class="lineno">  777</span> </div>
<div class="line"><a id="l00778" name="l00778"></a><span class="lineno">  778</span>   <span class="keywordtype">double</span> dTotErodibility = (nFineWeight * <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a2fc00e8bedd7b2f6f2d7d6fedf54821d">m_dFineErodibilityNormalized</a>) + (nSandWeight * <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a73cad40fa795d80bb48bb360df2c47e9">m_dSandErodibilityNormalized</a>) + (nCoarseWeight * <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a41d2967d84cbcf1799123f3d51aac287">m_dCoarseErodibilityNormalized</a>);</div>
<div class="line"><a id="l00779" name="l00779"></a><span class="lineno">  779</span>   <span class="keywordtype">double</span> dTotActualErosion = 0;</div>
<div class="line"><a id="l00780" name="l00780"></a><span class="lineno">  780</span>   <span class="keywordtype">double</span> dSandEroded = 0;</div>
<div class="line"><a id="l00781" name="l00781"></a><span class="lineno">  781</span>   <span class="keywordtype">double</span> dCoarseEroded = 0;</div>
<div class="line"><a id="l00782" name="l00782"></a><span class="lineno">  782</span> </div>
<div class="line"><a id="l00783" name="l00783"></a><span class="lineno">  783</span>   <span class="keywordflow">if</span> (nFineWeight)</div>
<div class="line"><a id="l00784" name="l00784"></a><span class="lineno">  784</span>   {</div>
<div class="line"><a id="l00785" name="l00785"></a><span class="lineno">  785</span>      <span class="comment">// Erode some fine-sized consolidated sediment</span></div>
<div class="line"><a id="l00786" name="l00786"></a><span class="lineno">  786</span>      <span class="keywordtype">double</span> dFineLowering = (<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a2fc00e8bedd7b2f6f2d7d6fedf54821d">m_dFineErodibilityNormalized</a> * dThisPotentialErosion) / dTotErodibility;</div>
<div class="line"><a id="l00787" name="l00787"></a><span class="lineno">  787</span> </div>
<div class="line"><a id="l00788" name="l00788"></a><span class="lineno">  788</span>      <span class="comment">// Make sure we don&#39;t get -ve amounts left on the cell</span></div>
<div class="line"><a id="l00789" name="l00789"></a><span class="lineno">  789</span>      <span class="keywordtype">double</span> dFineEroded = <a class="code hl_function" href="../../d6/d2a/cme_8h.html#a068017859403c0629d89f8d348f6c224">tMin</a>(dExistingAvailableFine, dFineLowering);</div>
<div class="line"><a id="l00790" name="l00790"></a><span class="lineno">  790</span>      <span class="keywordtype">double</span> dRemaining = dExistingAvailableFine - dFineEroded;</div>
<div class="line"><a id="l00791" name="l00791"></a><span class="lineno">  791</span> </div>
<div class="line"><a id="l00792" name="l00792"></a><span class="lineno">  792</span>      dTotActualErosion += dFineEroded;</div>
<div class="line"><a id="l00793" name="l00793"></a><span class="lineno">  793</span> </div>
<div class="line"><a id="l00794" name="l00794"></a><span class="lineno">  794</span>      <span class="comment">// Set the value for this layer</span></div>
<div class="line"><a id="l00795" name="l00795"></a><span class="lineno">  795</span>      <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nX][nY].pGetLayerAboveBasement(nThisLayer)-&gt;pGetConsolidatedSediment()-&gt;SetFineDepth(dRemaining);</div>
<div class="line"><a id="l00796" name="l00796"></a><span class="lineno">  796</span> </div>
<div class="line"><a id="l00797" name="l00797"></a><span class="lineno">  797</span>      <span class="comment">// And set the changed-this-timestep switch</span></div>
<div class="line"><a id="l00798" name="l00798"></a><span class="lineno">  798</span>      <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#aee72433983f1b26c0b734ee7b0d26014">m_bConsChangedThisIter</a>[nThisLayer] = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00799" name="l00799"></a><span class="lineno">  799</span> </div>
<div class="line"><a id="l00800" name="l00800"></a><span class="lineno">  800</span>      <span class="comment">// And increment the per-timestep total, also add to the suspended sediment load</span></div>
<div class="line"><a id="l00801" name="l00801"></a><span class="lineno">  801</span>      <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#aeafa6e4b5ab61733094effce380cff63">m_dThisIterActualPlatformErosionFineCons</a> += dFineEroded;</div>
<div class="line"><a id="l00802" name="l00802"></a><span class="lineno">  802</span>      <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a9ff982b02c96da7af9df717158907d43">m_dThisIterFineSedimentToSuspension</a> += dFineEroded;</div>
<div class="line"><a id="l00803" name="l00803"></a><span class="lineno">  803</span>   }</div>
<div class="line"><a id="l00804" name="l00804"></a><span class="lineno">  804</span> </div>
<div class="line"><a id="l00805" name="l00805"></a><span class="lineno">  805</span>   <span class="keywordflow">if</span> (nSandWeight)</div>
<div class="line"><a id="l00806" name="l00806"></a><span class="lineno">  806</span>   {</div>
<div class="line"><a id="l00807" name="l00807"></a><span class="lineno">  807</span>      <span class="comment">// Erode some sand-sized consolidated sediment</span></div>
<div class="line"><a id="l00808" name="l00808"></a><span class="lineno">  808</span>      <span class="keywordtype">double</span> dSandLowering = (<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a73cad40fa795d80bb48bb360df2c47e9">m_dSandErodibilityNormalized</a> * dThisPotentialErosion) / dTotErodibility;</div>
<div class="line"><a id="l00809" name="l00809"></a><span class="lineno">  809</span> </div>
<div class="line"><a id="l00810" name="l00810"></a><span class="lineno">  810</span>      <span class="comment">// Make sure we don&#39;t get -ve amounts left on the source cell</span></div>
<div class="line"><a id="l00811" name="l00811"></a><span class="lineno">  811</span>      dSandEroded = <a class="code hl_function" href="../../d6/d2a/cme_8h.html#a068017859403c0629d89f8d348f6c224">tMin</a>(dExistingAvailableSand, dSandLowering);</div>
<div class="line"><a id="l00812" name="l00812"></a><span class="lineno">  812</span>      <span class="keywordtype">double</span> dRemaining = dExistingAvailableSand - dSandEroded;</div>
<div class="line"><a id="l00813" name="l00813"></a><span class="lineno">  813</span> </div>
<div class="line"><a id="l00814" name="l00814"></a><span class="lineno">  814</span>      dTotActualErosion += dSandEroded;</div>
<div class="line"><a id="l00815" name="l00815"></a><span class="lineno">  815</span> </div>
<div class="line"><a id="l00816" name="l00816"></a><span class="lineno">  816</span>      <span class="comment">// Set the new value of sand consolidated sediment depth for this layer</span></div>
<div class="line"><a id="l00817" name="l00817"></a><span class="lineno">  817</span>      <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nX][nY].pGetLayerAboveBasement(nThisLayer)-&gt;pGetConsolidatedSediment()-&gt;SetSandDepth(dRemaining);</div>
<div class="line"><a id="l00818" name="l00818"></a><span class="lineno">  818</span>      </div>
<div class="line"><a id="l00819" name="l00819"></a><span class="lineno">  819</span>      <span class="comment">// And add this to the depth of sand unconsolidated sediment for this layer</span></div>
<div class="line"><a id="l00820" name="l00820"></a><span class="lineno">  820</span>      <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nX][nY].pGetLayerAboveBasement(nThisLayer)-&gt;pGetUnconsolidatedSediment()-&gt;AddSandDepth(dSandEroded);      </div>
<div class="line"><a id="l00821" name="l00821"></a><span class="lineno">  821</span> </div>
<div class="line"><a id="l00822" name="l00822"></a><span class="lineno">  822</span>      <span class="comment">// Set the changed-this-timestep switch</span></div>
<div class="line"><a id="l00823" name="l00823"></a><span class="lineno">  823</span>      <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#aee72433983f1b26c0b734ee7b0d26014">m_bConsChangedThisIter</a>[nThisLayer] = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00824" name="l00824"></a><span class="lineno">  824</span> </div>
<div class="line"><a id="l00825" name="l00825"></a><span class="lineno">  825</span>      <span class="comment">// And increment the per-timestep total</span></div>
<div class="line"><a id="l00826" name="l00826"></a><span class="lineno">  826</span>      <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a7848fdd8286f9734860955b855be74be">m_dThisIterActualPlatformErosionSandCons</a> += dSandEroded;</div>
<div class="line"><a id="l00827" name="l00827"></a><span class="lineno">  827</span>   }</div>
<div class="line"><a id="l00828" name="l00828"></a><span class="lineno">  828</span> </div>
<div class="line"><a id="l00829" name="l00829"></a><span class="lineno">  829</span>   <span class="keywordflow">if</span> (nCoarseWeight)</div>
<div class="line"><a id="l00830" name="l00830"></a><span class="lineno">  830</span>   {</div>
<div class="line"><a id="l00831" name="l00831"></a><span class="lineno">  831</span>      <span class="comment">// Erode some coarse-sized consolidated sediment</span></div>
<div class="line"><a id="l00832" name="l00832"></a><span class="lineno">  832</span>      <span class="keywordtype">double</span> dCoarseLowering = (<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a41d2967d84cbcf1799123f3d51aac287">m_dCoarseErodibilityNormalized</a> * dThisPotentialErosion) / dTotErodibility;</div>
<div class="line"><a id="l00833" name="l00833"></a><span class="lineno">  833</span> </div>
<div class="line"><a id="l00834" name="l00834"></a><span class="lineno">  834</span>      <span class="comment">// Make sure we don&#39;t get -ve amounts left on the source cell</span></div>
<div class="line"><a id="l00835" name="l00835"></a><span class="lineno">  835</span>      dCoarseEroded = <a class="code hl_function" href="../../d6/d2a/cme_8h.html#a068017859403c0629d89f8d348f6c224">tMin</a>(dExistingAvailableCoarse, dCoarseLowering);</div>
<div class="line"><a id="l00836" name="l00836"></a><span class="lineno">  836</span>      <span class="keywordtype">double</span> dRemaining = dExistingAvailableCoarse - dCoarseEroded;</div>
<div class="line"><a id="l00837" name="l00837"></a><span class="lineno">  837</span> </div>
<div class="line"><a id="l00838" name="l00838"></a><span class="lineno">  838</span>      dTotActualErosion += dCoarseEroded;</div>
<div class="line"><a id="l00839" name="l00839"></a><span class="lineno">  839</span> </div>
<div class="line"><a id="l00840" name="l00840"></a><span class="lineno">  840</span>      <span class="comment">// Set the new value of coarse consolidated sediment depth for this layer</span></div>
<div class="line"><a id="l00841" name="l00841"></a><span class="lineno">  841</span>      <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nX][nY].pGetLayerAboveBasement(nThisLayer)-&gt;pGetConsolidatedSediment()-&gt;SetCoarseDepth(dRemaining);</div>
<div class="line"><a id="l00842" name="l00842"></a><span class="lineno">  842</span>      </div>
<div class="line"><a id="l00843" name="l00843"></a><span class="lineno">  843</span>      <span class="comment">// And add this to the depth of coarse unconsolidated sediment for this layer</span></div>
<div class="line"><a id="l00844" name="l00844"></a><span class="lineno">  844</span>      <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nX][nY].pGetLayerAboveBasement(nThisLayer)-&gt;pGetUnconsolidatedSediment()-&gt;AddCoarseDepth(dCoarseEroded);</div>
<div class="line"><a id="l00845" name="l00845"></a><span class="lineno">  845</span> </div>
<div class="line"><a id="l00846" name="l00846"></a><span class="lineno">  846</span>      <span class="comment">// Set the changed-this-timestep switch</span></div>
<div class="line"><a id="l00847" name="l00847"></a><span class="lineno">  847</span>      <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#aee72433983f1b26c0b734ee7b0d26014">m_bConsChangedThisIter</a>[nThisLayer] = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00848" name="l00848"></a><span class="lineno">  848</span> </div>
<div class="line"><a id="l00849" name="l00849"></a><span class="lineno">  849</span>      <span class="comment">// And increment the per-timestep total</span></div>
<div class="line"><a id="l00850" name="l00850"></a><span class="lineno">  850</span>      <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a351c28119561e99ad17a539274dbea27">m_dThisIterActualPlatformErosionCoarseCons</a> += dCoarseEroded;</div>
<div class="line"><a id="l00851" name="l00851"></a><span class="lineno">  851</span>   }</div>
<div class="line"><a id="l00852" name="l00852"></a><span class="lineno">  852</span> </div>
<div class="line"><a id="l00853" name="l00853"></a><span class="lineno">  853</span>   <span class="comment">// Did we erode anything?</span></div>
<div class="line"><a id="l00854" name="l00854"></a><span class="lineno">  854</span>   <span class="keywordflow">if</span> (dTotActualErosion &gt; 0)</div>
<div class="line"><a id="l00855" name="l00855"></a><span class="lineno">  855</span>   {</div>
<div class="line"><a id="l00856" name="l00856"></a><span class="lineno">  856</span>      <span class="comment">// We did, so set the actual erosion value for this cell</span></div>
<div class="line"><a id="l00857" name="l00857"></a><span class="lineno">  857</span>      <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nX][nY].SetActualPlatformErosion(dTotActualErosion);</div>
<div class="line"><a id="l00858" name="l00858"></a><span class="lineno">  858</span> </div>
<div class="line"><a id="l00859" name="l00859"></a><span class="lineno">  859</span>      <span class="comment">// Recalculate the elevation of every layer</span></div>
<div class="line"><a id="l00860" name="l00860"></a><span class="lineno">  860</span>      <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nX][nY].CalcAllLayerElevsAndD50();</div>
<div class="line"><a id="l00861" name="l00861"></a><span class="lineno">  861</span> </div>
<div class="line"><a id="l00862" name="l00862"></a><span class="lineno">  862</span>      <span class="comment">// And update the cell&#39;s sea depth</span></div>
<div class="line"><a id="l00863" name="l00863"></a><span class="lineno">  863</span>      <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nX][nY].SetSeaDepth();</div>
<div class="line"><a id="l00864" name="l00864"></a><span class="lineno">  864</span> </div>
<div class="line"><a id="l00865" name="l00865"></a><span class="lineno">  865</span>      <span class="comment">// Update per-timestep totals</span></div>
<div class="line"><a id="l00866" name="l00866"></a><span class="lineno">  866</span>      <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a4fc351e671b433439a44cbdcea15d494">m_ulThisIterNumActualPlatformErosionCells</a>++;</div>
<div class="line"><a id="l00867" name="l00867"></a><span class="lineno">  867</span> </div>
<div class="line"><a id="l00868" name="l00868"></a><span class="lineno">  868</span>      <span class="comment">// Add eroded sand/coarse sediment for this cell to the polygon that contains the cell, ready for redistribution during beach erosion/deposition (fine sediment has already been dealt with)</span></div>
<div class="line"><a id="l00869" name="l00869"></a><span class="lineno">  869</span>      <span class="keywordtype">int</span> nPolyID = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nX][nY].nGetPolygonID();</div>
<div class="line"><a id="l00870" name="l00870"></a><span class="lineno">  870</span>      <span class="keywordflow">if</span> (nPolyID == <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a01aa8b423260b337ddff2016107b51a0">INT_NODATA</a>)</div>
<div class="line"><a id="l00871" name="l00871"></a><span class="lineno">  871</span>      {</div>
<div class="line"><a id="l00872" name="l00872"></a><span class="lineno">  872</span>         <span class="comment">// Can get occasional problems with polygon rasterization near the coastline, so also search the eight adjacent cells</span></div>
<div class="line"><a id="l00873" name="l00873"></a><span class="lineno">  873</span>         array&lt;int, 8&gt; nDirection = {<a class="code hl_variable" href="../../d6/d2a/cme_8h.html#af8f1a513adfc4d40f536ff45f704e654">NORTH</a>, <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#ab497d689de01cab8340289dad621722b">NORTH_EAST</a>, <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#aa5fa4b2d0efc2ff0f4e02e27ea50208a">EAST</a>, <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a49682bb35bb6bb78bb43e19147f62eca">SOUTH_EAST</a>, <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#aa0ace1cae356bfb79245b65c0ae979d0">SOUTH</a>, <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a7a3b237ac891f748a20b4614bf7fc437">SOUTH_WEST</a>, <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#afeb3cef570a9344c7074258f3601b582">WEST</a>, <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a8203a0b525538b7ade9e5409ebc59981">NORTH_WEST</a>};</div>
<div class="line"><a id="l00874" name="l00874"></a><span class="lineno">  874</span>         shuffle(nDirection.begin(), nDirection.end(), <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#aab026ce32dae1272a2633b41dd9217d5">m_Rand</a>[0]);</div>
<div class="line"><a id="l00875" name="l00875"></a><span class="lineno">  875</span> </div>
<div class="line"><a id="l00876" name="l00876"></a><span class="lineno">  876</span>         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> n = 0; n &lt; 8; n++)</div>
<div class="line"><a id="l00877" name="l00877"></a><span class="lineno">  877</span>         {</div>
<div class="line"><a id="l00878" name="l00878"></a><span class="lineno">  878</span>            <span class="keywordtype">int</span> nXAdj;</div>
<div class="line"><a id="l00879" name="l00879"></a><span class="lineno">  879</span>            <span class="keywordtype">int</span> nYAdj;</div>
<div class="line"><a id="l00880" name="l00880"></a><span class="lineno">  880</span> </div>
<div class="line"><a id="l00881" name="l00881"></a><span class="lineno">  881</span>            <span class="keywordflow">if</span> (nDirection[n] == <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#af8f1a513adfc4d40f536ff45f704e654">NORTH</a>)</div>
<div class="line"><a id="l00882" name="l00882"></a><span class="lineno">  882</span>            {</div>
<div class="line"><a id="l00883" name="l00883"></a><span class="lineno">  883</span>               nXAdj = nX;</div>
<div class="line"><a id="l00884" name="l00884"></a><span class="lineno">  884</span>               nYAdj = nY - 1;</div>
<div class="line"><a id="l00885" name="l00885"></a><span class="lineno">  885</span>               <span class="keywordflow">if</span> (nYAdj &gt;= 0)</div>
<div class="line"><a id="l00886" name="l00886"></a><span class="lineno">  886</span>               {</div>
<div class="line"><a id="l00887" name="l00887"></a><span class="lineno">  887</span>                  nPolyID = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nXAdj][nYAdj].nGetPolygonID();</div>
<div class="line"><a id="l00888" name="l00888"></a><span class="lineno">  888</span>                  <span class="keywordflow">if</span> (nPolyID != <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a01aa8b423260b337ddff2016107b51a0">INT_NODATA</a>)</div>
<div class="line"><a id="l00889" name="l00889"></a><span class="lineno">  889</span>                     <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00890" name="l00890"></a><span class="lineno">  890</span>               }</div>
<div class="line"><a id="l00891" name="l00891"></a><span class="lineno">  891</span>            }</div>
<div class="line"><a id="l00892" name="l00892"></a><span class="lineno">  892</span>            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (nDirection[n] == <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#ab497d689de01cab8340289dad621722b">NORTH_EAST</a>)</div>
<div class="line"><a id="l00893" name="l00893"></a><span class="lineno">  893</span>            {</div>
<div class="line"><a id="l00894" name="l00894"></a><span class="lineno">  894</span>               nXAdj = nX + 1;</div>
<div class="line"><a id="l00895" name="l00895"></a><span class="lineno">  895</span>               nYAdj = nY - 1;</div>
<div class="line"><a id="l00896" name="l00896"></a><span class="lineno">  896</span>               <span class="keywordflow">if</span> ((nXAdj &lt; <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1652253500dab35e6f6f9f734207e20b">m_nXGridSize</a>) &amp;&amp; (nYAdj &gt;= 0))</div>
<div class="line"><a id="l00897" name="l00897"></a><span class="lineno">  897</span>               {</div>
<div class="line"><a id="l00898" name="l00898"></a><span class="lineno">  898</span>                  nPolyID = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nXAdj][nYAdj].nGetPolygonID();</div>
<div class="line"><a id="l00899" name="l00899"></a><span class="lineno">  899</span>                  <span class="keywordflow">if</span> (nPolyID != <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a01aa8b423260b337ddff2016107b51a0">INT_NODATA</a>)</div>
<div class="line"><a id="l00900" name="l00900"></a><span class="lineno">  900</span>                     <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00901" name="l00901"></a><span class="lineno">  901</span>               }</div>
<div class="line"><a id="l00902" name="l00902"></a><span class="lineno">  902</span>            }</div>
<div class="line"><a id="l00903" name="l00903"></a><span class="lineno">  903</span>            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (nDirection[n] == <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#aa5fa4b2d0efc2ff0f4e02e27ea50208a">EAST</a>)</div>
<div class="line"><a id="l00904" name="l00904"></a><span class="lineno">  904</span>            {</div>
<div class="line"><a id="l00905" name="l00905"></a><span class="lineno">  905</span>               nXAdj = nX + 1;</div>
<div class="line"><a id="l00906" name="l00906"></a><span class="lineno">  906</span>               nYAdj = nY;</div>
<div class="line"><a id="l00907" name="l00907"></a><span class="lineno">  907</span>               <span class="keywordflow">if</span> (nXAdj &lt; <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1652253500dab35e6f6f9f734207e20b">m_nXGridSize</a>)</div>
<div class="line"><a id="l00908" name="l00908"></a><span class="lineno">  908</span>               {</div>
<div class="line"><a id="l00909" name="l00909"></a><span class="lineno">  909</span>                  nPolyID = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nXAdj][nYAdj].nGetPolygonID();</div>
<div class="line"><a id="l00910" name="l00910"></a><span class="lineno">  910</span>                  <span class="keywordflow">if</span> (nPolyID != <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a01aa8b423260b337ddff2016107b51a0">INT_NODATA</a>)</div>
<div class="line"><a id="l00911" name="l00911"></a><span class="lineno">  911</span>                     <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00912" name="l00912"></a><span class="lineno">  912</span>               }</div>
<div class="line"><a id="l00913" name="l00913"></a><span class="lineno">  913</span>            }</div>
<div class="line"><a id="l00914" name="l00914"></a><span class="lineno">  914</span>            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (nDirection[n] == <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a49682bb35bb6bb78bb43e19147f62eca">SOUTH_EAST</a>)</div>
<div class="line"><a id="l00915" name="l00915"></a><span class="lineno">  915</span>            {</div>
<div class="line"><a id="l00916" name="l00916"></a><span class="lineno">  916</span>               nXAdj = nX + 1;</div>
<div class="line"><a id="l00917" name="l00917"></a><span class="lineno">  917</span>               nYAdj = nY + 1;</div>
<div class="line"><a id="l00918" name="l00918"></a><span class="lineno">  918</span>               <span class="keywordflow">if</span> ((nXAdj &lt; <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1652253500dab35e6f6f9f734207e20b">m_nXGridSize</a>) &amp;&amp; (nYAdj &lt; <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a3755fdc07c0ac9f2ce6c2237cfef50ce">m_nYGridSize</a>))</div>
<div class="line"><a id="l00919" name="l00919"></a><span class="lineno">  919</span>               {</div>
<div class="line"><a id="l00920" name="l00920"></a><span class="lineno">  920</span>                  nPolyID = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nXAdj][nYAdj].nGetPolygonID();</div>
<div class="line"><a id="l00921" name="l00921"></a><span class="lineno">  921</span>                  <span class="keywordflow">if</span> (nPolyID != <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a01aa8b423260b337ddff2016107b51a0">INT_NODATA</a>)</div>
<div class="line"><a id="l00922" name="l00922"></a><span class="lineno">  922</span>                     <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00923" name="l00923"></a><span class="lineno">  923</span>               }</div>
<div class="line"><a id="l00924" name="l00924"></a><span class="lineno">  924</span>            }</div>
<div class="line"><a id="l00925" name="l00925"></a><span class="lineno">  925</span>            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (nDirection[n] == <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#aa0ace1cae356bfb79245b65c0ae979d0">SOUTH</a>)</div>
<div class="line"><a id="l00926" name="l00926"></a><span class="lineno">  926</span>            {</div>
<div class="line"><a id="l00927" name="l00927"></a><span class="lineno">  927</span>               nXAdj = nX;</div>
<div class="line"><a id="l00928" name="l00928"></a><span class="lineno">  928</span>               nYAdj = nY + 1;</div>
<div class="line"><a id="l00929" name="l00929"></a><span class="lineno">  929</span>               <span class="keywordflow">if</span> (nYAdj &lt; <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a3755fdc07c0ac9f2ce6c2237cfef50ce">m_nYGridSize</a>)</div>
<div class="line"><a id="l00930" name="l00930"></a><span class="lineno">  930</span>               {</div>
<div class="line"><a id="l00931" name="l00931"></a><span class="lineno">  931</span>                  nPolyID = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nXAdj][nYAdj].nGetPolygonID();</div>
<div class="line"><a id="l00932" name="l00932"></a><span class="lineno">  932</span>                  <span class="keywordflow">if</span> (nPolyID != <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a01aa8b423260b337ddff2016107b51a0">INT_NODATA</a>)</div>
<div class="line"><a id="l00933" name="l00933"></a><span class="lineno">  933</span>                     <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00934" name="l00934"></a><span class="lineno">  934</span>               }</div>
<div class="line"><a id="l00935" name="l00935"></a><span class="lineno">  935</span>            }</div>
<div class="line"><a id="l00936" name="l00936"></a><span class="lineno">  936</span>            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (nDirection[n] == <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a7a3b237ac891f748a20b4614bf7fc437">SOUTH_WEST</a>)</div>
<div class="line"><a id="l00937" name="l00937"></a><span class="lineno">  937</span>            {</div>
<div class="line"><a id="l00938" name="l00938"></a><span class="lineno">  938</span>               nXAdj = nX - 1;</div>
<div class="line"><a id="l00939" name="l00939"></a><span class="lineno">  939</span>               nYAdj = nY + 1;</div>
<div class="line"><a id="l00940" name="l00940"></a><span class="lineno">  940</span>               <span class="keywordflow">if</span> ((nXAdj &gt;= 0) &amp;&amp; (nXAdj &lt; <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1652253500dab35e6f6f9f734207e20b">m_nXGridSize</a>))</div>
<div class="line"><a id="l00941" name="l00941"></a><span class="lineno">  941</span>               {</div>
<div class="line"><a id="l00942" name="l00942"></a><span class="lineno">  942</span>                  nPolyID = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nXAdj][nYAdj].nGetPolygonID();</div>
<div class="line"><a id="l00943" name="l00943"></a><span class="lineno">  943</span>                  <span class="keywordflow">if</span> (nPolyID != <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a01aa8b423260b337ddff2016107b51a0">INT_NODATA</a>)</div>
<div class="line"><a id="l00944" name="l00944"></a><span class="lineno">  944</span>                     <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00945" name="l00945"></a><span class="lineno">  945</span>               }</div>
<div class="line"><a id="l00946" name="l00946"></a><span class="lineno">  946</span>            }</div>
<div class="line"><a id="l00947" name="l00947"></a><span class="lineno">  947</span>            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (nDirection[n] == <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#afeb3cef570a9344c7074258f3601b582">WEST</a>)</div>
<div class="line"><a id="l00948" name="l00948"></a><span class="lineno">  948</span>            {</div>
<div class="line"><a id="l00949" name="l00949"></a><span class="lineno">  949</span>               nXAdj = nX - 1;</div>
<div class="line"><a id="l00950" name="l00950"></a><span class="lineno">  950</span>               nYAdj = nY;</div>
<div class="line"><a id="l00951" name="l00951"></a><span class="lineno">  951</span>               <span class="keywordflow">if</span> (nXAdj &gt;= 0)</div>
<div class="line"><a id="l00952" name="l00952"></a><span class="lineno">  952</span>               {</div>
<div class="line"><a id="l00953" name="l00953"></a><span class="lineno">  953</span>                  nPolyID = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nXAdj][nYAdj].nGetPolygonID();</div>
<div class="line"><a id="l00954" name="l00954"></a><span class="lineno">  954</span>                  <span class="keywordflow">if</span> (nPolyID != <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a01aa8b423260b337ddff2016107b51a0">INT_NODATA</a>)</div>
<div class="line"><a id="l00955" name="l00955"></a><span class="lineno">  955</span>                     <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00956" name="l00956"></a><span class="lineno">  956</span>               }</div>
<div class="line"><a id="l00957" name="l00957"></a><span class="lineno">  957</span>            }</div>
<div class="line"><a id="l00958" name="l00958"></a><span class="lineno">  958</span>            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (nDirection[n] == <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a8203a0b525538b7ade9e5409ebc59981">NORTH_WEST</a>)</div>
<div class="line"><a id="l00959" name="l00959"></a><span class="lineno">  959</span>            {</div>
<div class="line"><a id="l00960" name="l00960"></a><span class="lineno">  960</span>               nXAdj = nX - 1;</div>
<div class="line"><a id="l00961" name="l00961"></a><span class="lineno">  961</span>               nYAdj = nY - 1;</div>
<div class="line"><a id="l00962" name="l00962"></a><span class="lineno">  962</span>               <span class="keywordflow">if</span> ((nXAdj &gt;= 0) &amp;&amp; (nYAdj &gt;= 0))</div>
<div class="line"><a id="l00963" name="l00963"></a><span class="lineno">  963</span>               {</div>
<div class="line"><a id="l00964" name="l00964"></a><span class="lineno">  964</span>                  nPolyID = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nXAdj][nYAdj].nGetPolygonID();</div>
<div class="line"><a id="l00965" name="l00965"></a><span class="lineno">  965</span>                  <span class="keywordflow">if</span> (nPolyID != <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a01aa8b423260b337ddff2016107b51a0">INT_NODATA</a>)</div>
<div class="line"><a id="l00966" name="l00966"></a><span class="lineno">  966</span>                     <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00967" name="l00967"></a><span class="lineno">  967</span>               }</div>
<div class="line"><a id="l00968" name="l00968"></a><span class="lineno">  968</span>            }</div>
<div class="line"><a id="l00969" name="l00969"></a><span class="lineno">  969</span>         }</div>
<div class="line"><a id="l00970" name="l00970"></a><span class="lineno">  970</span>      }</div>
<div class="line"><a id="l00971" name="l00971"></a><span class="lineno">  971</span> </div>
<div class="line"><a id="l00972" name="l00972"></a><span class="lineno">  972</span>      <span class="keywordflow">if</span> (nPolyID != <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a01aa8b423260b337ddff2016107b51a0">INT_NODATA</a>)</div>
<div class="line"><a id="l00973" name="l00973"></a><span class="lineno">  973</span>      {</div>
<div class="line"><a id="l00974" name="l00974"></a><span class="lineno">  974</span>         <span class="comment">// Add this to the polygon&#39;s total of unconsolidated sand/coarse sediment, to be deposited or moved later. These values are +ve (deposition)</span></div>
<div class="line"><a id="l00975" name="l00975"></a><span class="lineno">  975</span>         <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#afdf9931c6687dab00b0f48c0709d6c8a">m_pVCoastPolygon</a>[nPolyID]-&gt;AddPlatformErosionUnconsSand(dSandEroded);</div>
<div class="line"><a id="l00976" name="l00976"></a><span class="lineno">  976</span>         <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#afdf9931c6687dab00b0f48c0709d6c8a">m_pVCoastPolygon</a>[nPolyID]-&gt;AddPlatformErosionUnconsCoarse(dCoarseEroded);</div>
<div class="line"><a id="l00977" name="l00977"></a><span class="lineno">  977</span>      }</div>
<div class="line"><a id="l00978" name="l00978"></a><span class="lineno">  978</span>      <span class="keywordflow">else</span></div>
<div class="line"><a id="l00979" name="l00979"></a><span class="lineno">  979</span>      {</div>
<div class="line"><a id="l00980" name="l00980"></a><span class="lineno">  980</span>         <span class="comment">// Uh-oh, we have a problem</span></div>
<div class="line"><a id="l00981" name="l00981"></a><span class="lineno">  981</span>         <span class="keywordflow">if</span> (<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a0245d3cbdd603fbeced6ca1465eb3f16">m_nLogFileDetail</a> &gt;= <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a540d8a94fc09b0b14fd8ab657445b67a">LOG_FILE_MIDDLE_DETAIL</a>)</div>
<div class="line"><a id="l00982" name="l00982"></a><span class="lineno">  982</span>            <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a222962121613613a48f518e0c2110f21">LogStream</a> &lt;&lt; <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#ad67e8c5b30a0572f64ecfb5c062c2edc">m_ulIter</a> &lt;&lt; <span class="stringliteral">&quot;: &quot;</span> &lt;&lt; <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a957ca99e98618160534cafb0929f743d">WARN</a> &lt;&lt; <span class="stringliteral">&quot;platform erosion on cell [&quot;</span> &lt;&lt; nX &lt;&lt; <span class="stringliteral">&quot;][&quot;</span> &lt;&lt; nY &lt;&lt; <span class="stringliteral">&quot;] = {&quot;</span> &lt;&lt; <a class="code hl_function" href="../../d1/d98/classCSimulation.html#ad79b925ac5f358c6f867b6e47dad74bd">dGridCentroidXToExtCRSX</a>(nX) &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; <a class="code hl_function" href="../../d1/d98/classCSimulation.html#a7e2a4bd69ce79377fee86aa5598903f8">dGridCentroidYToExtCRSY</a>(nY) &lt;&lt; <span class="stringliteral">&quot;} but this is not in a polygon&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a id="l00983" name="l00983"></a><span class="lineno">  983</span> </div>
<div class="line"><a id="l00984" name="l00984"></a><span class="lineno">  984</span>         <span class="comment">// m_dDepositionSandDiff and m_dDepositionCoarseDiff are both +ve</span></div>
<div class="line"><a id="l00985" name="l00985"></a><span class="lineno">  985</span>         <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a5f90b759d60bf3e53f881fd2dad3b944">m_dDepositionSandDiff</a> += dSandEroded;</div>
<div class="line"><a id="l00986" name="l00986"></a><span class="lineno">  986</span>         <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a4d9fe85e0e30c85d0751608b90aeb253">m_dDepositionCoarseDiff</a> += dCoarseEroded;</div>
<div class="line"><a id="l00987" name="l00987"></a><span class="lineno">  987</span>      }</div>
<div class="line"><a id="l00988" name="l00988"></a><span class="lineno">  988</span>   }</div>
<div class="line"><a id="l00989" name="l00989"></a><span class="lineno">  989</span>}</div>
</div>
<div class="line"><a id="l00990" name="l00990"></a><span class="lineno">  990</span> </div>
<div class="line"><a id="l00991" name="l00991"></a><span class="lineno">  991</span><span class="comment">//===============================================================================================================================</span></div>
<div class="line"><a id="l00993" name="l00993"></a><span class="lineno">  993</span><span class="comment">//===============================================================================================================================</span></div>
<div class="foldopen" id="foldopen00994" data-start="{" data-end="}">
<div class="line"><a id="l00994" name="l00994"></a><span class="lineno"><a class="line" href="../../d1/d98/classCSimulation.html#ae7a8e20ea5a852f69bee1296ea3db020">  994</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="../../d1/d98/classCSimulation.html#ae7a8e20ea5a852f69bee1296ea3db020">CSimulation::bCreateErosionPotentialLookUp</a>(vector&lt;double&gt;* VdDepthOverDBIn, vector&lt;double&gt;* VdErosionPotentialIn, vector&lt;double&gt;* VdErosionPotentialFirstDerivIn)</div>
<div class="line"><a id="l00995" name="l00995"></a><span class="lineno">  995</span>{</div>
<div class="line"><a id="l00996" name="l00996"></a><span class="lineno">  996</span>   <span class="comment">// Set up a temporary vector to hold the incremental DepthOverDB values</span></div>
<div class="line"><a id="l00997" name="l00997"></a><span class="lineno">  997</span>   vector&lt;double&gt; VdDepthOverDB;</div>
<div class="line"><a id="l00998" name="l00998"></a><span class="lineno">  998</span>   <span class="keywordtype">double</span> dTempDOverDB = 0;</div>
<div class="line"><a id="l00999" name="l00999"></a><span class="lineno">  999</span> </div>
<div class="line"><a id="l01000" name="l01000"></a><span class="lineno"> 1000</span>   <span class="keywordflow">while</span> (dTempDOverDB &lt;= 1.1)                     <span class="comment">// Arbitrary max value, we will adjust this later</span></div>
<div class="line"><a id="l01001" name="l01001"></a><span class="lineno"> 1001</span>   {</div>
<div class="line"><a id="l01002" name="l01002"></a><span class="lineno"> 1002</span>      VdDepthOverDB.push_back(dTempDOverDB);       <span class="comment">// These are the incremental sample values of DepthOverDB</span></div>
<div class="line"><a id="l01003" name="l01003"></a><span class="lineno"> 1003</span>      dTempDOverDB += <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a4a0172f22f9ee43c7168c4ccfb531b1a">DEPTH_OVER_DB_INCREMENT</a>;</div>
<div class="line"><a id="l01004" name="l01004"></a><span class="lineno"> 1004</span> </div>
<div class="line"><a id="l01005" name="l01005"></a><span class="lineno"> 1005</span>      <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a37c2a2c0a5c040e6d1b5ddf3d1bf2437">m_VdErosionPotential</a>.push_back(0);           <span class="comment">// This will hold the corresponding value of erosion potential for each sample point</span></div>
<div class="line"><a id="l01006" name="l01006"></a><span class="lineno"> 1006</span>   }</div>
<div class="line"><a id="l01007" name="l01007"></a><span class="lineno"> 1007</span> </div>
<div class="line"><a id="l01008" name="l01008"></a><span class="lineno"> 1008</span>   <span class="keywordtype">int</span> nSize = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(VdDepthOverDB.size());</div>
<div class="line"><a id="l01009" name="l01009"></a><span class="lineno"> 1009</span>   vector&lt;double&gt; VdDeriv(nSize, 0);               <span class="comment">// First derivative at the sample points: calculated by the spline function but not subsequently used</span></div>
<div class="line"><a id="l01010" name="l01010"></a><span class="lineno"> 1010</span>   vector&lt;double&gt; VdDeriv2(nSize, 0.);             <span class="comment">// Second derivative at the sample points, ditto</span></div>
<div class="line"><a id="l01011" name="l01011"></a><span class="lineno"> 1011</span>   vector&lt;double&gt; VdDeriv3(nSize, 0.);             <span class="comment">// Third derivative at the sample points, ditto</span></div>
<div class="line"><a id="l01012" name="l01012"></a><span class="lineno"> 1012</span> </div>
<div class="line"><a id="l01013" name="l01013"></a><span class="lineno"> 1013</span>   <span class="comment">// Calculate the value of erosion potential (is a -ve value) for each of the sample values of DepthOverDB, and store it for use in the look-up function</span></div>
<div class="line"><a id="l01014" name="l01014"></a><span class="lineno"> 1014</span>   <a class="code hl_function" href="../../dd/dfc/hermite__cubic_8cpp.html#ad696aa5baaf487b32cc0c3afdecd2b4b">hermite_cubic_spline_value</a>(<span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(VdDepthOverDBIn-&gt;size()), &amp;(VdDepthOverDBIn-&gt;at(0)), &amp;(VdErosionPotentialIn-&gt;at(0)), &amp;(VdErosionPotentialFirstDerivIn-&gt;at(0)), nSize, &amp;(VdDepthOverDB[0]), &amp;(<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a37c2a2c0a5c040e6d1b5ddf3d1bf2437">m_VdErosionPotential</a>[0]), &amp;(VdDeriv[0]), &amp;(VdDeriv2[0]), &amp;(VdDeriv3[0]));</div>
<div class="line"><a id="l01015" name="l01015"></a><span class="lineno"> 1015</span> </div>
<div class="line"><a id="l01016" name="l01016"></a><span class="lineno"> 1016</span>   <span class="comment">// Tidy the erosion potential look-up data: cut off values (after the first) for which erosion potential is no longer -ve</span></div>
<div class="line"><a id="l01017" name="l01017"></a><span class="lineno"> 1017</span>   <span class="keywordtype">int</span> nLastVal = -1;</div>
<div class="line"><a id="l01018" name="l01018"></a><span class="lineno"> 1018</span> </div>
<div class="line"><a id="l01019" name="l01019"></a><span class="lineno"> 1019</span>   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> n = 1; n &lt; nSize - 1; n++)</div>
<div class="line"><a id="l01020" name="l01020"></a><span class="lineno"> 1020</span>      <span class="keywordflow">if</span> (<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a37c2a2c0a5c040e6d1b5ddf3d1bf2437">m_VdErosionPotential</a>[n] &gt; 0)</div>
<div class="line"><a id="l01021" name="l01021"></a><span class="lineno"> 1021</span>      {</div>
<div class="line"><a id="l01022" name="l01022"></a><span class="lineno"> 1022</span>         nLastVal = n;</div>
<div class="line"><a id="l01023" name="l01023"></a><span class="lineno"> 1023</span>         <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01024" name="l01024"></a><span class="lineno"> 1024</span>      }</div>
<div class="line"><a id="l01025" name="l01025"></a><span class="lineno"> 1025</span> </div>
<div class="line"><a id="l01026" name="l01026"></a><span class="lineno"> 1026</span>   <span class="keywordflow">if</span> (nLastVal &gt; 0)</div>
<div class="line"><a id="l01027" name="l01027"></a><span class="lineno"> 1027</span>   {</div>
<div class="line"><a id="l01028" name="l01028"></a><span class="lineno"> 1028</span>      <span class="comment">// Erosion potential is no longer -ve at this value of DepthOverDB, so set the maximum value of DepthOverDB that will be used in the simulation (any DepthOverDB value greater than this produces zero erosion potential)</span></div>
<div class="line"><a id="l01029" name="l01029"></a><span class="lineno"> 1029</span>      <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a6cab4d9561ad835328f1df42d03edf97">m_dDepthOverDBMax</a> = VdDepthOverDB[nLastVal];</div>
<div class="line"><a id="l01030" name="l01030"></a><span class="lineno"> 1030</span>      <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a37c2a2c0a5c040e6d1b5ddf3d1bf2437">m_VdErosionPotential</a>.erase(<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a37c2a2c0a5c040e6d1b5ddf3d1bf2437">m_VdErosionPotential</a>.begin() + nLastVal + 1, <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a37c2a2c0a5c040e6d1b5ddf3d1bf2437">m_VdErosionPotential</a>.end());</div>
<div class="line"><a id="l01031" name="l01031"></a><span class="lineno"> 1031</span>      <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a37c2a2c0a5c040e6d1b5ddf3d1bf2437">m_VdErosionPotential</a>.back() = 0;</div>
<div class="line"><a id="l01032" name="l01032"></a><span class="lineno"> 1032</span>   }</div>
<div class="line"><a id="l01033" name="l01033"></a><span class="lineno"> 1033</span> </div>
<div class="line"><a id="l01034" name="l01034"></a><span class="lineno"> 1034</span>   <span class="keywordflow">else</span></div>
<div class="line"><a id="l01035" name="l01035"></a><span class="lineno"> 1035</span>      <span class="comment">// Erosion potential is unbounded, i.e. it is still -ve when we have reached the end of the look-up vector</span></div>
<div class="line"><a id="l01036" name="l01036"></a><span class="lineno"> 1036</span>      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01037" name="l01037"></a><span class="lineno"> 1037</span> </div>
<div class="line"><a id="l01038" name="l01038"></a><span class="lineno"> 1038</span>   <span class="comment">// All OK</span></div>
<div class="line"><a id="l01039" name="l01039"></a><span class="lineno"> 1039</span>   <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l01040" name="l01040"></a><span class="lineno"> 1040</span>}</div>
</div>
<div class="line"><a id="l01041" name="l01041"></a><span class="lineno"> 1041</span> </div>
<div class="line"><a id="l01042" name="l01042"></a><span class="lineno"> 1042</span><span class="comment">//===============================================================================================================================</span></div>
<div class="line"><a id="l01044" name="l01044"></a><span class="lineno"> 1044</span><span class="comment">//===============================================================================================================================</span></div>
<div class="foldopen" id="foldopen01045" data-start="{" data-end="}">
<div class="line"><a id="l01045" name="l01045"></a><span class="lineno"><a class="line" href="../../d1/d98/classCSimulation.html#a0998fa493e91a4e27c79dadb568e7abe"> 1045</a></span><span class="keywordtype">double</span> <a class="code hl_function" href="../../d1/d98/classCSimulation.html#a0998fa493e91a4e27c79dadb568e7abe">CSimulation::dLookUpErosionPotential</a>(<span class="keywordtype">double</span> <span class="keyword">const</span> dDepthOverDB)<span class="keyword"> const</span></div>
<div class="line"><a id="l01046" name="l01046"></a><span class="lineno"> 1046</span><span class="keyword"></span>{</div>
<div class="line"><a id="l01047" name="l01047"></a><span class="lineno"> 1047</span>   <span class="comment">// If dDepthOverDB exceeds the maximum value which we calculated earlier, erosion potential is zero</span></div>
<div class="line"><a id="l01048" name="l01048"></a><span class="lineno"> 1048</span>   <span class="keywordflow">if</span> (dDepthOverDB &gt; <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a6cab4d9561ad835328f1df42d03edf97">m_dDepthOverDBMax</a>)</div>
<div class="line"><a id="l01049" name="l01049"></a><span class="lineno"> 1049</span>      <span class="keywordflow">return</span> 0;</div>
<div class="line"><a id="l01050" name="l01050"></a><span class="lineno"> 1050</span> </div>
<div class="line"><a id="l01051" name="l01051"></a><span class="lineno"> 1051</span>   <span class="comment">// OK, dDepthOverDB is less than the maximum so look up a corresponding value for erosion potential. The look-up index is dDepthOverDB divided by (the Depth Over DB increment used when creating the look-up vector). But since this look-up index may not be an integer, split the look-up index into integer and fractional parts and deal with each separately</span></div>
<div class="line"><a id="l01052" name="l01052"></a><span class="lineno"> 1052</span>   <span class="keywordtype">double</span> dErosionPotential = <a class="code hl_function" href="../../d7/d62/interpolate_8cpp.html#aec8942141bf8fa2a69bacd12ee72cbd2">dGetInterpolatedValue</a>(&amp;<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a449cba5df2232226b1fe32ce61c354ab">m_VdDepthOverDB</a>, &amp;<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a37c2a2c0a5c040e6d1b5ddf3d1bf2437">m_VdErosionPotential</a>, dDepthOverDB, <span class="keyword">false</span>);</div>
<div class="line"><a id="l01053" name="l01053"></a><span class="lineno"> 1053</span> </div>
<div class="line"><a id="l01054" name="l01054"></a><span class="lineno"> 1054</span>   <span class="keywordflow">return</span> dErosionPotential;</div>
<div class="line"><a id="l01055" name="l01055"></a><span class="lineno"> 1055</span>}</div>
</div>
<div class="line"><a id="l01056" name="l01056"></a><span class="lineno"> 1056</span> </div>
<div class="line"><a id="l01057" name="l01057"></a><span class="lineno"> 1057</span><span class="comment">//===============================================================================================================================</span></div>
<div class="line"><a id="l01059" name="l01059"></a><span class="lineno"> 1059</span><span class="comment">//===============================================================================================================================</span></div>
<div class="foldopen" id="foldopen01060" data-start="{" data-end="}">
<div class="line"><a id="l01060" name="l01060"></a><span class="lineno"><a class="line" href="../../d1/d98/classCSimulation.html#addce7ee7de6383e6cf4b074db90f012e"> 1060</a></span><span class="keywordtype">double</span> <a class="code hl_function" href="../../d1/d98/classCSimulation.html#addce7ee7de6383e6cf4b074db90f012e">CSimulation::dCalcBeachProtectionFactor</a>(<span class="keywordtype">int</span> <span class="keyword">const</span> nX, <span class="keywordtype">int</span> <span class="keyword">const</span> nY, <span class="keywordtype">double</span> <span class="keyword">const</span> dBreakingWaveHeight)</div>
<div class="line"><a id="l01061" name="l01061"></a><span class="lineno"> 1061</span>{</div>
<div class="line"><a id="l01062" name="l01062"></a><span class="lineno"> 1062</span>   <span class="comment">// Safety check</span></div>
<div class="line"><a id="l01063" name="l01063"></a><span class="lineno"> 1063</span>   <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d6/d2a/cme_8h.html#a61afa8560a3b39c80657661a1d8f76ab">bFPIsEqual</a>(dBreakingWaveHeight, <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#ac003bdff958dca839f5d274f15786e07">DBL_NODATA</a>, <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a08b1623863ee3bd4300a8892de323722">TOLERANCE</a>))</div>
<div class="line"><a id="l01064" name="l01064"></a><span class="lineno"> 1064</span>      <span class="keywordflow">return</span> 0;</div>
<div class="line"><a id="l01065" name="l01065"></a><span class="lineno"> 1065</span> </div>
<div class="line"><a id="l01066" name="l01066"></a><span class="lineno"> 1066</span>   <span class="comment">// We are considering the unconsolidated sediment (beach) of the topmost layer that has non-zero thickness</span></div>
<div class="line"><a id="l01067" name="l01067"></a><span class="lineno"> 1067</span>   <span class="keywordtype">int</span> nThisLayer = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nX][nY].nGetTopNonZeroLayerAboveBasement();</div>
<div class="line"><a id="l01068" name="l01068"></a><span class="lineno"> 1068</span> </div>
<div class="line"><a id="l01069" name="l01069"></a><span class="lineno"> 1069</span>   <span class="comment">// Safety check</span></div>
<div class="line"><a id="l01070" name="l01070"></a><span class="lineno"> 1070</span>   <span class="keywordflow">if</span> (nThisLayer == <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a01aa8b423260b337ddff2016107b51a0">INT_NODATA</a>)</div>
<div class="line"><a id="l01071" name="l01071"></a><span class="lineno"> 1071</span>   {</div>
<div class="line"><a id="l01072" name="l01072"></a><span class="lineno"> 1072</span>      cerr &lt;&lt; <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a292fc90846543ca4814daa9f759feb05">ERR</a> &lt;&lt; <span class="stringliteral">&quot;no sediment layer in dCalcBeachProtectionFactor()&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a id="l01073" name="l01073"></a><span class="lineno"> 1073</span>      <span class="keywordflow">return</span> 0;</div>
<div class="line"><a id="l01074" name="l01074"></a><span class="lineno"> 1074</span>   }</div>
<div class="line"><a id="l01075" name="l01075"></a><span class="lineno"> 1075</span> </div>
<div class="line"><a id="l01076" name="l01076"></a><span class="lineno"> 1076</span>   <span class="keywordflow">if</span> (nThisLayer == <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a01522c1e8423c6586193dd5ca0c76171">NO_NONZERO_THICKNESS_LAYERS</a>)</div>
<div class="line"><a id="l01077" name="l01077"></a><span class="lineno"> 1077</span>      <span class="comment">// There are no layers with non-zero thickness left (i.e. we are down to basement) so no beach protection</span></div>
<div class="line"><a id="l01078" name="l01078"></a><span class="lineno"> 1078</span>      <span class="keywordflow">return</span> 0;</div>
<div class="line"><a id="l01079" name="l01079"></a><span class="lineno"> 1079</span> </div>
<div class="line"><a id="l01080" name="l01080"></a><span class="lineno"> 1080</span>   <span class="comment">// In SCAPE, 0.23 * the significant breaking wave height is assumed to be the maximum depth of beach that waves can penetrate to erode a platform. For depths less than this, the beach protective ability is assumed to vary linearly</span></div>
<div class="line"><a id="l01081" name="l01081"></a><span class="lineno"> 1081</span>   <span class="keywordtype">double</span> dBeachDepth = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nX][nY].pGetLayerAboveBasement(nThisLayer)-&gt;dGetUnconsolidatedThickness();</div>
<div class="line"><a id="l01082" name="l01082"></a><span class="lineno"> 1082</span>   <span class="keywordtype">double</span> dMaxPenetrationDepth = <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#ad85dd413295e84546b22590de7eee7cb">BEACH_PROTECTION_HB_RATIO</a> * dBreakingWaveHeight;</div>
<div class="line"><a id="l01083" name="l01083"></a><span class="lineno"> 1083</span>   <span class="keywordtype">double</span> dFactor = 0;</div>
<div class="line"><a id="l01084" name="l01084"></a><span class="lineno"> 1084</span> </div>
<div class="line"><a id="l01085" name="l01085"></a><span class="lineno"> 1085</span>   <span class="keywordflow">if</span> (dMaxPenetrationDepth &gt; 0)</div>
<div class="line"><a id="l01086" name="l01086"></a><span class="lineno"> 1086</span>      dFactor = <a class="code hl_function" href="../../d6/d2a/cme_8h.html#a7e895b460cef877dec4d12ead0c74f15">tMax</a>(1 - (dBeachDepth / dMaxPenetrationDepth), 0.0);</div>
<div class="line"><a id="l01087" name="l01087"></a><span class="lineno"> 1087</span> </div>
<div class="line"><a id="l01088" name="l01088"></a><span class="lineno"> 1088</span>   <span class="comment">//    LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: cell[&quot; &lt;&lt; nX &lt;&lt; &quot;][&quot; &lt;&lt; nY &lt;&lt; &quot;] has beach protection factor = &quot; &lt;&lt; dFactor &lt;&lt; endl;</span></div>
<div class="line"><a id="l01089" name="l01089"></a><span class="lineno"> 1089</span> </div>
<div class="line"><a id="l01090" name="l01090"></a><span class="lineno"> 1090</span>   <span class="keywordflow">return</span> dFactor;</div>
<div class="line"><a id="l01091" name="l01091"></a><span class="lineno"> 1091</span>}</div>
</div>
<div class="line"><a id="l01092" name="l01092"></a><span class="lineno"> 1092</span> </div>
<div class="line"><a id="l01093" name="l01093"></a><span class="lineno"> 1093</span><span class="comment">//===============================================================================================================================</span></div>
<div class="line"><a id="l01095" name="l01095"></a><span class="lineno"> 1095</span><span class="comment">//===============================================================================================================================</span></div>
<div class="foldopen" id="foldopen01096" data-start="{" data-end="}">
<div class="line"><a id="l01096" name="l01096"></a><span class="lineno"><a class="line" href="../../d1/d98/classCSimulation.html#a45b070d19448816f0a4345981d81239e"> 1096</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../d1/d98/classCSimulation.html#a45b070d19448816f0a4345981d81239e">CSimulation::FillInBeachProtectionHoles</a>(<span class="keywordtype">void</span>)</div>
<div class="line"><a id="l01097" name="l01097"></a><span class="lineno"> 1097</span>{</div>
<div class="line"><a id="l01098" name="l01098"></a><span class="lineno"> 1098</span>   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> nX = 0; nX &lt; <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1652253500dab35e6f6f9f734207e20b">m_nXGridSize</a>; nX++)</div>
<div class="line"><a id="l01099" name="l01099"></a><span class="lineno"> 1099</span>   {</div>
<div class="line"><a id="l01100" name="l01100"></a><span class="lineno"> 1100</span>      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> nY = 0; nY &lt; <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a3755fdc07c0ac9f2ce6c2237cfef50ce">m_nYGridSize</a>; nY++)</div>
<div class="line"><a id="l01101" name="l01101"></a><span class="lineno"> 1101</span>      {</div>
<div class="line"><a id="l01102" name="l01102"></a><span class="lineno"> 1102</span>         <span class="keywordflow">if</span> ((<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nX][nY].bIsInContiguousSea()) &amp;&amp; (<a class="code hl_function" href="../../d6/d2a/cme_8h.html#a61afa8560a3b39c80657661a1d8f76ab">bFPIsEqual</a>(<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nX][nY].dGetBeachProtectionFactor(), <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#ac003bdff958dca839f5d274f15786e07">DBL_NODATA</a>, <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a08b1623863ee3bd4300a8892de323722">TOLERANCE</a>)))</div>
<div class="line"><a id="l01103" name="l01103"></a><span class="lineno"> 1103</span>         {</div>
<div class="line"><a id="l01104" name="l01104"></a><span class="lineno"> 1104</span>            <span class="comment">// This is a sea cell, and it has an initialized beach protection value. So look at its N-S and W-E neighbours</span></div>
<div class="line"><a id="l01105" name="l01105"></a><span class="lineno"> 1105</span>            <span class="keywordtype">int</span> nXTmp;</div>
<div class="line"><a id="l01106" name="l01106"></a><span class="lineno"> 1106</span>            <span class="keywordtype">int</span> nYTmp;</div>
<div class="line"><a id="l01107" name="l01107"></a><span class="lineno"> 1107</span>            <span class="keywordtype">int</span> nAdjacent = 0;</div>
<div class="line"><a id="l01108" name="l01108"></a><span class="lineno"> 1108</span>            <span class="keywordtype">double</span> dBeachProtection = 0;</div>
<div class="line"><a id="l01109" name="l01109"></a><span class="lineno"> 1109</span> </div>
<div class="line"><a id="l01110" name="l01110"></a><span class="lineno"> 1110</span>            <span class="comment">// North</span></div>
<div class="line"><a id="l01111" name="l01111"></a><span class="lineno"> 1111</span>            nXTmp = nX;</div>
<div class="line"><a id="l01112" name="l01112"></a><span class="lineno"> 1112</span>            nYTmp = nY - 1;</div>
<div class="line"><a id="l01113" name="l01113"></a><span class="lineno"> 1113</span>            <span class="keywordflow">if</span> ((<a class="code hl_function" href="../../d1/d98/classCSimulation.html#ac900a5701df97da22278fae928951f50">bIsWithinValidGrid</a>(nXTmp, nYTmp)) &amp;&amp; (! <a class="code hl_function" href="../../d6/d2a/cme_8h.html#a61afa8560a3b39c80657661a1d8f76ab">bFPIsEqual</a>(<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nXTmp][nYTmp].dGetBeachProtectionFactor(), <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#ac003bdff958dca839f5d274f15786e07">DBL_NODATA</a>, <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a08b1623863ee3bd4300a8892de323722">TOLERANCE</a>)))</div>
<div class="line"><a id="l01114" name="l01114"></a><span class="lineno"> 1114</span>            {</div>
<div class="line"><a id="l01115" name="l01115"></a><span class="lineno"> 1115</span>               nAdjacent++;</div>
<div class="line"><a id="l01116" name="l01116"></a><span class="lineno"> 1116</span>               dBeachProtection += <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nXTmp][nYTmp].dGetBeachProtectionFactor();</div>
<div class="line"><a id="l01117" name="l01117"></a><span class="lineno"> 1117</span>            }</div>
<div class="line"><a id="l01118" name="l01118"></a><span class="lineno"> 1118</span> </div>
<div class="line"><a id="l01119" name="l01119"></a><span class="lineno"> 1119</span>            <span class="comment">// East</span></div>
<div class="line"><a id="l01120" name="l01120"></a><span class="lineno"> 1120</span>            nXTmp = nX + 1;</div>
<div class="line"><a id="l01121" name="l01121"></a><span class="lineno"> 1121</span>            nYTmp = nY;</div>
<div class="line"><a id="l01122" name="l01122"></a><span class="lineno"> 1122</span>            <span class="keywordflow">if</span> ((<a class="code hl_function" href="../../d1/d98/classCSimulation.html#ac900a5701df97da22278fae928951f50">bIsWithinValidGrid</a>(nXTmp, nYTmp)) &amp;&amp; (! <a class="code hl_function" href="../../d6/d2a/cme_8h.html#a61afa8560a3b39c80657661a1d8f76ab">bFPIsEqual</a>(<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nXTmp][nYTmp].dGetBeachProtectionFactor(), <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#ac003bdff958dca839f5d274f15786e07">DBL_NODATA</a>, <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a08b1623863ee3bd4300a8892de323722">TOLERANCE</a>)))</div>
<div class="line"><a id="l01123" name="l01123"></a><span class="lineno"> 1123</span>            {</div>
<div class="line"><a id="l01124" name="l01124"></a><span class="lineno"> 1124</span>               nAdjacent++;</div>
<div class="line"><a id="l01125" name="l01125"></a><span class="lineno"> 1125</span>               dBeachProtection += <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nXTmp][nYTmp].dGetBeachProtectionFactor();</div>
<div class="line"><a id="l01126" name="l01126"></a><span class="lineno"> 1126</span>            }</div>
<div class="line"><a id="l01127" name="l01127"></a><span class="lineno"> 1127</span> </div>
<div class="line"><a id="l01128" name="l01128"></a><span class="lineno"> 1128</span>            <span class="comment">// South</span></div>
<div class="line"><a id="l01129" name="l01129"></a><span class="lineno"> 1129</span>            nXTmp = nX;</div>
<div class="line"><a id="l01130" name="l01130"></a><span class="lineno"> 1130</span>            nYTmp = nY + 1;</div>
<div class="line"><a id="l01131" name="l01131"></a><span class="lineno"> 1131</span>            <span class="keywordflow">if</span> ((<a class="code hl_function" href="../../d1/d98/classCSimulation.html#ac900a5701df97da22278fae928951f50">bIsWithinValidGrid</a>(nXTmp, nYTmp)) &amp;&amp; (! <a class="code hl_function" href="../../d6/d2a/cme_8h.html#a61afa8560a3b39c80657661a1d8f76ab">bFPIsEqual</a>(<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nXTmp][nYTmp].dGetBeachProtectionFactor(), <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#ac003bdff958dca839f5d274f15786e07">DBL_NODATA</a>, <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a08b1623863ee3bd4300a8892de323722">TOLERANCE</a>)))</div>
<div class="line"><a id="l01132" name="l01132"></a><span class="lineno"> 1132</span>            {</div>
<div class="line"><a id="l01133" name="l01133"></a><span class="lineno"> 1133</span>               nAdjacent++;</div>
<div class="line"><a id="l01134" name="l01134"></a><span class="lineno"> 1134</span>               dBeachProtection += <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nXTmp][nYTmp].dGetBeachProtectionFactor();</div>
<div class="line"><a id="l01135" name="l01135"></a><span class="lineno"> 1135</span>            }</div>
<div class="line"><a id="l01136" name="l01136"></a><span class="lineno"> 1136</span> </div>
<div class="line"><a id="l01137" name="l01137"></a><span class="lineno"> 1137</span>            <span class="comment">// West</span></div>
<div class="line"><a id="l01138" name="l01138"></a><span class="lineno"> 1138</span>            nXTmp = nX - 1;</div>
<div class="line"><a id="l01139" name="l01139"></a><span class="lineno"> 1139</span>            nYTmp = nY;</div>
<div class="line"><a id="l01140" name="l01140"></a><span class="lineno"> 1140</span>            <span class="keywordflow">if</span> ((<a class="code hl_function" href="../../d1/d98/classCSimulation.html#ac900a5701df97da22278fae928951f50">bIsWithinValidGrid</a>(nXTmp, nYTmp)) &amp;&amp; (! <a class="code hl_function" href="../../d6/d2a/cme_8h.html#a61afa8560a3b39c80657661a1d8f76ab">bFPIsEqual</a>(<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nXTmp][nYTmp].dGetBeachProtectionFactor(), <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#ac003bdff958dca839f5d274f15786e07">DBL_NODATA</a>, <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a08b1623863ee3bd4300a8892de323722">TOLERANCE</a>)))</div>
<div class="line"><a id="l01141" name="l01141"></a><span class="lineno"> 1141</span>            {</div>
<div class="line"><a id="l01142" name="l01142"></a><span class="lineno"> 1142</span>               nAdjacent++;</div>
<div class="line"><a id="l01143" name="l01143"></a><span class="lineno"> 1143</span>               dBeachProtection += <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nXTmp][nYTmp].dGetBeachProtectionFactor();</div>
<div class="line"><a id="l01144" name="l01144"></a><span class="lineno"> 1144</span>            }</div>
<div class="line"><a id="l01145" name="l01145"></a><span class="lineno"> 1145</span> </div>
<div class="line"><a id="l01146" name="l01146"></a><span class="lineno"> 1146</span>            <span class="comment">// If this sea cell has four neighbours with initialized beach protection values, then assume that it should not have an uninitialized beach protection value. Set it to the average of its neighbours</span></div>
<div class="line"><a id="l01147" name="l01147"></a><span class="lineno"> 1147</span>            <span class="keywordflow">if</span> (nAdjacent == 4)</div>
<div class="line"><a id="l01148" name="l01148"></a><span class="lineno"> 1148</span>            {</div>
<div class="line"><a id="l01149" name="l01149"></a><span class="lineno"> 1149</span>               <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nX][nY].SetBeachProtectionFactor(dBeachProtection / 4);</div>
<div class="line"><a id="l01150" name="l01150"></a><span class="lineno"> 1150</span>            }</div>
<div class="line"><a id="l01151" name="l01151"></a><span class="lineno"> 1151</span>         }</div>
<div class="line"><a id="l01152" name="l01152"></a><span class="lineno"> 1152</span>      }</div>
<div class="line"><a id="l01153" name="l01153"></a><span class="lineno"> 1153</span>   }</div>
<div class="line"><a id="l01154" name="l01154"></a><span class="lineno"> 1154</span>}</div>
</div>
<div class="line"><a id="l01155" name="l01155"></a><span class="lineno"> 1155</span> </div>
<div class="line"><a id="l01156" name="l01156"></a><span class="lineno"> 1156</span><span class="comment">//===============================================================================================================================</span></div>
<div class="line"><a id="l01158" name="l01158"></a><span class="lineno"> 1158</span><span class="comment">//===============================================================================================================================</span></div>
<div class="foldopen" id="foldopen01159" data-start="{" data-end="}">
<div class="line"><a id="l01159" name="l01159"></a><span class="lineno"><a class="line" href="../../d1/d98/classCSimulation.html#aa1822cd0877dd757ed449591018be8d4"> 1159</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../d1/d98/classCSimulation.html#aa1822cd0877dd757ed449591018be8d4">CSimulation::FillPotentialPlatformErosionHoles</a>(<span class="keywordtype">void</span>)</div>
<div class="line"><a id="l01160" name="l01160"></a><span class="lineno"> 1160</span>{</div>
<div class="line"><a id="l01161" name="l01161"></a><span class="lineno"> 1161</span>   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> nX = 0; nX &lt; <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1652253500dab35e6f6f9f734207e20b">m_nXGridSize</a>; nX++)</div>
<div class="line"><a id="l01162" name="l01162"></a><span class="lineno"> 1162</span>   {</div>
<div class="line"><a id="l01163" name="l01163"></a><span class="lineno"> 1163</span>      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> nY = 0; nY &lt; <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a3755fdc07c0ac9f2ce6c2237cfef50ce">m_nYGridSize</a>; nY++)</div>
<div class="line"><a id="l01164" name="l01164"></a><span class="lineno"> 1164</span>      {</div>
<div class="line"><a id="l01165" name="l01165"></a><span class="lineno"> 1165</span>         <span class="keywordflow">if</span> ((<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nX][nY].bIsInContiguousSea()) &amp;&amp; (<a class="code hl_function" href="../../d6/d2a/cme_8h.html#a61afa8560a3b39c80657661a1d8f76ab">bFPIsEqual</a>(<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nX][nY].dGetPotentialPlatformErosion(), 0.0, <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a08b1623863ee3bd4300a8892de323722">TOLERANCE</a>)))</div>
<div class="line"><a id="l01166" name="l01166"></a><span class="lineno"> 1166</span>         {</div>
<div class="line"><a id="l01167" name="l01167"></a><span class="lineno"> 1167</span>            <span class="comment">// This is a sea cell, it has a zero potential platform erosion value. So look at its N-S and W-E neighbours</span></div>
<div class="line"><a id="l01168" name="l01168"></a><span class="lineno"> 1168</span>            <span class="keywordtype">int</span> nXTmp;</div>
<div class="line"><a id="l01169" name="l01169"></a><span class="lineno"> 1169</span>            <span class="keywordtype">int</span> nYTmp;</div>
<div class="line"><a id="l01170" name="l01170"></a><span class="lineno"> 1170</span>            <span class="keywordtype">int</span> nAdjacent = 0;</div>
<div class="line"><a id="l01171" name="l01171"></a><span class="lineno"> 1171</span>            <span class="keywordtype">double</span> dPotentialPlatformErosion = 0;</div>
<div class="line"><a id="l01172" name="l01172"></a><span class="lineno"> 1172</span> </div>
<div class="line"><a id="l01173" name="l01173"></a><span class="lineno"> 1173</span>            <span class="comment">// North</span></div>
<div class="line"><a id="l01174" name="l01174"></a><span class="lineno"> 1174</span>            nXTmp = nX;</div>
<div class="line"><a id="l01175" name="l01175"></a><span class="lineno"> 1175</span>            nYTmp = nY - 1;</div>
<div class="line"><a id="l01176" name="l01176"></a><span class="lineno"> 1176</span>            <span class="keywordflow">if</span> ((<a class="code hl_function" href="../../d1/d98/classCSimulation.html#ac900a5701df97da22278fae928951f50">bIsWithinValidGrid</a>(nXTmp, nYTmp)) &amp;&amp; (! <a class="code hl_function" href="../../d6/d2a/cme_8h.html#a61afa8560a3b39c80657661a1d8f76ab">bFPIsEqual</a>(<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nXTmp][nYTmp].dGetPotentialPlatformErosion(), 0.0, <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a08b1623863ee3bd4300a8892de323722">TOLERANCE</a>)))</div>
<div class="line"><a id="l01177" name="l01177"></a><span class="lineno"> 1177</span>            {</div>
<div class="line"><a id="l01178" name="l01178"></a><span class="lineno"> 1178</span>               nAdjacent++;</div>
<div class="line"><a id="l01179" name="l01179"></a><span class="lineno"> 1179</span>               dPotentialPlatformErosion += <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nXTmp][nYTmp].dGetPotentialPlatformErosion();</div>
<div class="line"><a id="l01180" name="l01180"></a><span class="lineno"> 1180</span>            }</div>
<div class="line"><a id="l01181" name="l01181"></a><span class="lineno"> 1181</span> </div>
<div class="line"><a id="l01182" name="l01182"></a><span class="lineno"> 1182</span>            <span class="comment">// East</span></div>
<div class="line"><a id="l01183" name="l01183"></a><span class="lineno"> 1183</span>            nXTmp = nX + 1;</div>
<div class="line"><a id="l01184" name="l01184"></a><span class="lineno"> 1184</span>            nYTmp = nY;</div>
<div class="line"><a id="l01185" name="l01185"></a><span class="lineno"> 1185</span>            <span class="keywordflow">if</span> ((<a class="code hl_function" href="../../d1/d98/classCSimulation.html#ac900a5701df97da22278fae928951f50">bIsWithinValidGrid</a>(nXTmp, nYTmp)) &amp;&amp; (! <a class="code hl_function" href="../../d6/d2a/cme_8h.html#a61afa8560a3b39c80657661a1d8f76ab">bFPIsEqual</a>(<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nXTmp][nYTmp].dGetPotentialPlatformErosion(), 0.0, <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a08b1623863ee3bd4300a8892de323722">TOLERANCE</a>)))</div>
<div class="line"><a id="l01186" name="l01186"></a><span class="lineno"> 1186</span>            {</div>
<div class="line"><a id="l01187" name="l01187"></a><span class="lineno"> 1187</span>               nAdjacent++;</div>
<div class="line"><a id="l01188" name="l01188"></a><span class="lineno"> 1188</span>               dPotentialPlatformErosion += <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nXTmp][nYTmp].dGetPotentialPlatformErosion();</div>
<div class="line"><a id="l01189" name="l01189"></a><span class="lineno"> 1189</span>            }</div>
<div class="line"><a id="l01190" name="l01190"></a><span class="lineno"> 1190</span> </div>
<div class="line"><a id="l01191" name="l01191"></a><span class="lineno"> 1191</span>            <span class="comment">// South</span></div>
<div class="line"><a id="l01192" name="l01192"></a><span class="lineno"> 1192</span>            nXTmp = nX;</div>
<div class="line"><a id="l01193" name="l01193"></a><span class="lineno"> 1193</span>            nYTmp = nY + 1;</div>
<div class="line"><a id="l01194" name="l01194"></a><span class="lineno"> 1194</span>            <span class="keywordflow">if</span> ((<a class="code hl_function" href="../../d1/d98/classCSimulation.html#ac900a5701df97da22278fae928951f50">bIsWithinValidGrid</a>(nXTmp, nYTmp)) &amp;&amp; (! <a class="code hl_function" href="../../d6/d2a/cme_8h.html#a61afa8560a3b39c80657661a1d8f76ab">bFPIsEqual</a>(<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nXTmp][nYTmp].dGetPotentialPlatformErosion(), 0.0, <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a08b1623863ee3bd4300a8892de323722">TOLERANCE</a>)))</div>
<div class="line"><a id="l01195" name="l01195"></a><span class="lineno"> 1195</span>            {</div>
<div class="line"><a id="l01196" name="l01196"></a><span class="lineno"> 1196</span>               nAdjacent++;</div>
<div class="line"><a id="l01197" name="l01197"></a><span class="lineno"> 1197</span>               dPotentialPlatformErosion += <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nXTmp][nYTmp].dGetPotentialPlatformErosion();</div>
<div class="line"><a id="l01198" name="l01198"></a><span class="lineno"> 1198</span>            }</div>
<div class="line"><a id="l01199" name="l01199"></a><span class="lineno"> 1199</span> </div>
<div class="line"><a id="l01200" name="l01200"></a><span class="lineno"> 1200</span>            <span class="comment">// West</span></div>
<div class="line"><a id="l01201" name="l01201"></a><span class="lineno"> 1201</span>            nXTmp = nX - 1;</div>
<div class="line"><a id="l01202" name="l01202"></a><span class="lineno"> 1202</span>            nYTmp = nY;</div>
<div class="line"><a id="l01203" name="l01203"></a><span class="lineno"> 1203</span>            <span class="keywordflow">if</span> ((<a class="code hl_function" href="../../d1/d98/classCSimulation.html#ac900a5701df97da22278fae928951f50">bIsWithinValidGrid</a>(nXTmp, nYTmp)) &amp;&amp; (! <a class="code hl_function" href="../../d6/d2a/cme_8h.html#a61afa8560a3b39c80657661a1d8f76ab">bFPIsEqual</a>(<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nXTmp][nYTmp].dGetPotentialPlatformErosion(), 0.0, <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a08b1623863ee3bd4300a8892de323722">TOLERANCE</a>)))</div>
<div class="line"><a id="l01204" name="l01204"></a><span class="lineno"> 1204</span>            {</div>
<div class="line"><a id="l01205" name="l01205"></a><span class="lineno"> 1205</span>               nAdjacent++;</div>
<div class="line"><a id="l01206" name="l01206"></a><span class="lineno"> 1206</span>               dPotentialPlatformErosion += <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nXTmp][nYTmp].dGetPotentialPlatformErosion();</div>
<div class="line"><a id="l01207" name="l01207"></a><span class="lineno"> 1207</span>            }</div>
<div class="line"><a id="l01208" name="l01208"></a><span class="lineno"> 1208</span> </div>
<div class="line"><a id="l01209" name="l01209"></a><span class="lineno"> 1209</span>            <span class="comment">// If this sea cell has four neighbours with non-zero potential platform erosion values, then assume that it should not have a zero potential platform erosion value. Set it to the average of its neighbours</span></div>
<div class="line"><a id="l01210" name="l01210"></a><span class="lineno"> 1210</span>            <span class="keywordflow">if</span> (nAdjacent == 4)</div>
<div class="line"><a id="l01211" name="l01211"></a><span class="lineno"> 1211</span>            {</div>
<div class="line"><a id="l01212" name="l01212"></a><span class="lineno"> 1212</span>               <span class="keywordtype">double</span> dThisPotentialPlatformErosion = dPotentialPlatformErosion / 4;</div>
<div class="line"><a id="l01213" name="l01213"></a><span class="lineno"> 1213</span> </div>
<div class="line"><a id="l01214" name="l01214"></a><span class="lineno"> 1214</span>               <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nX][nY].SetPotentialPlatformErosion(dThisPotentialPlatformErosion);</div>
<div class="line"><a id="l01215" name="l01215"></a><span class="lineno"> 1215</span> </div>
<div class="line"><a id="l01216" name="l01216"></a><span class="lineno"> 1216</span>               <span class="comment">// Update this-timestep totals</span></div>
<div class="line"><a id="l01217" name="l01217"></a><span class="lineno"> 1217</span>               <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#aa86b50dc1f1dd9fb62827667aadfb542">m_ulThisIterNumPotentialPlatformErosionCells</a>++;</div>
<div class="line"><a id="l01218" name="l01218"></a><span class="lineno"> 1218</span>               <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a6478fd59a34c3fb4891f570d32a22ddb">m_dThisIterPotentialPlatformErosion</a> += dThisPotentialPlatformErosion;</div>
<div class="line"><a id="l01219" name="l01219"></a><span class="lineno"> 1219</span>               <span class="comment">//                assert(isfinite(m_dThisIterPotentialPlatformErosion));</span></div>
<div class="line"><a id="l01220" name="l01220"></a><span class="lineno"> 1220</span> </div>
<div class="line"><a id="l01221" name="l01221"></a><span class="lineno"> 1221</span>               <span class="comment">// Increment the check values</span></div>
<div class="line"><a id="l01222" name="l01222"></a><span class="lineno"> 1222</span>               <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#ac2937805b3fc0bb1b75201ea16870936">m_ulTotPotentialPlatformErosionBetweenProfiles</a>++;</div>
<div class="line"><a id="l01223" name="l01223"></a><span class="lineno"> 1223</span>               <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a46df9f5bbc643a6884c18ebe097bdb79">m_dTotPotentialPlatformErosionBetweenProfiles</a> += dThisPotentialPlatformErosion;</div>
<div class="line"><a id="l01224" name="l01224"></a><span class="lineno"> 1224</span>            }</div>
<div class="line"><a id="l01225" name="l01225"></a><span class="lineno"> 1225</span>         }</div>
<div class="line"><a id="l01226" name="l01226"></a><span class="lineno"> 1226</span>      }</div>
<div class="line"><a id="l01227" name="l01227"></a><span class="lineno"> 1227</span>   }</div>
<div class="line"><a id="l01228" name="l01228"></a><span class="lineno"> 1228</span>}</div>
</div>
<div class="line"><a id="l01229" name="l01229"></a><span class="lineno"> 1229</span> </div>
<div class="line"><a id="l01230" name="l01230"></a><span class="lineno"> 1230</span><span class="comment">//===============================================================================================================================</span></div>
<div class="line"><a id="l01232" name="l01232"></a><span class="lineno"> 1232</span><span class="comment">//===============================================================================================================================</span></div>
<div class="foldopen" id="foldopen01233" data-start="{" data-end="}">
<div class="line"><a id="l01233" name="l01233"></a><span class="lineno"><a class="line" href="../../d1/d98/classCSimulation.html#a39a93413881b60c7fa43dc992c5520d0"> 1233</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../d1/d98/classCSimulation.html#a39a93413881b60c7fa43dc992c5520d0">CSimulation::ConstructParallelProfile</a>(<span class="keywordtype">int</span> <span class="keyword">const</span> nProfileStartX, <span class="keywordtype">int</span> <span class="keyword">const</span> nProfileStartY, <span class="keywordtype">int</span> <span class="keyword">const</span> nParCoastX, <span class="keywordtype">int</span> <span class="keyword">const</span> nParCoastY, <span class="keywordtype">int</span> <span class="keyword">const</span> nProfSize, vector&lt;CGeom2DIPoint&gt;* <span class="keyword">const</span> pPtViGridProfile, vector&lt;CGeom2DIPoint&gt;* pPtiVGridParProfile, vector&lt;CGeom2DPoint&gt;* pPtVExtCRSParProfile)</div>
<div class="line"><a id="l01234" name="l01234"></a><span class="lineno"> 1234</span>{</div>
<div class="line"><a id="l01235" name="l01235"></a><span class="lineno"> 1235</span>   <span class="comment">// OK, we have the coastline start point for the parallel profile. Now construct a temporary profile, parallel to the coastline-normal profile, starting from this point</span></div>
<div class="line"><a id="l01236" name="l01236"></a><span class="lineno"> 1236</span>   <span class="keywordtype">int</span> nXOffset = nParCoastX - nProfileStartX;</div>
<div class="line"><a id="l01237" name="l01237"></a><span class="lineno"> 1237</span>   <span class="keywordtype">int</span> nYOffset = nParCoastY - nProfileStartY;</div>
<div class="line"><a id="l01238" name="l01238"></a><span class="lineno"> 1238</span> </div>
<div class="line"><a id="l01239" name="l01239"></a><span class="lineno"> 1239</span>   <span class="comment">// Append co-ord values for the temporary profile</span></div>
<div class="line"><a id="l01240" name="l01240"></a><span class="lineno"> 1240</span>   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> nProfileStartPoint = 0; nProfileStartPoint &lt; nProfSize; nProfileStartPoint++)</div>
<div class="line"><a id="l01241" name="l01241"></a><span class="lineno"> 1241</span>   {</div>
<div class="line"><a id="l01242" name="l01242"></a><span class="lineno"> 1242</span>      <span class="comment">// Get the grid coordinates of the cell which is this distance seaward, from the coastline-normal profile</span></div>
<div class="line"><a id="l01243" name="l01243"></a><span class="lineno"> 1243</span>      <span class="keywordtype">int</span> nXProf = pPtViGridProfile-&gt;at(nProfileStartPoint).nGetX();</div>
<div class="line"><a id="l01244" name="l01244"></a><span class="lineno"> 1244</span>      <span class="keywordtype">int</span> nYProf = pPtViGridProfile-&gt;at(nProfileStartPoint).nGetY();</div>
<div class="line"><a id="l01245" name="l01245"></a><span class="lineno"> 1245</span> </div>
<div class="line"><a id="l01246" name="l01246"></a><span class="lineno"> 1246</span>      <span class="comment">// Now calculate the grid coordinates of this cell, which is potentially in the parallel profile</span></div>
<div class="line"><a id="l01247" name="l01247"></a><span class="lineno"> 1247</span>      <span class="keywordtype">int</span> nXPar = nXProf + nXOffset;</div>
<div class="line"><a id="l01248" name="l01248"></a><span class="lineno"> 1248</span>      <span class="keywordtype">int</span> nYPar = nYProf + nYOffset;</div>
<div class="line"><a id="l01249" name="l01249"></a><span class="lineno"> 1249</span> </div>
<div class="line"><a id="l01250" name="l01250"></a><span class="lineno"> 1250</span>      <span class="comment">// Is this cell within the grid? If not, cut short the profile</span></div>
<div class="line"><a id="l01251" name="l01251"></a><span class="lineno"> 1251</span>      <span class="keywordflow">if</span> (! <a class="code hl_function" href="../../d1/d98/classCSimulation.html#ac900a5701df97da22278fae928951f50">bIsWithinValidGrid</a>(nXPar, nYPar))</div>
<div class="line"><a id="l01252" name="l01252"></a><span class="lineno"> 1252</span>      {</div>
<div class="line"><a id="l01253" name="l01253"></a><span class="lineno"> 1253</span>         <span class="comment">//         LogStream &lt;&lt; &quot;NOT WITHIN GRID [&quot; &lt;&lt; nXPar &lt;&lt; &quot;][&quot; &lt;&lt; nYPar &lt;&lt; &quot;]&quot; &lt;&lt; endl;</span></div>
<div class="line"><a id="l01254" name="l01254"></a><span class="lineno"> 1254</span>         <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l01255" name="l01255"></a><span class="lineno"> 1255</span>      }</div>
<div class="line"><a id="l01256" name="l01256"></a><span class="lineno"> 1256</span> </div>
<div class="line"><a id="l01257" name="l01257"></a><span class="lineno"> 1257</span>      <span class="comment">// Have we hit an adjacent coastline-normal profile? If so, cut short</span></div>
<div class="line"><a id="l01258" name="l01258"></a><span class="lineno"> 1258</span>      <span class="keywordflow">if</span> (<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nXPar][nYPar].bIsProfile())</div>
<div class="line"><a id="l01259" name="l01259"></a><span class="lineno"> 1259</span>      {</div>
<div class="line"><a id="l01260" name="l01260"></a><span class="lineno"> 1260</span>         <span class="comment">//         LogStream &lt;&lt; &quot;HIT PROFILE &quot; &lt;&lt; m_pRasterGrid-&gt;m_Cell[nXPar][nYPar].nGetProfileID() &lt;&lt; &quot; at [&quot; &lt;&lt; nXPar &lt;&lt; &quot;][&quot; &lt;&lt; nYPar &lt;&lt; &quot;] = {&quot; &lt;&lt; dGridCentroidXToExtCRSX(nXPar) &lt;&lt; &quot;, &quot; &lt;&lt;  dGridCentroidYToExtCRSY(nYPar) &lt;&lt; &quot;}&quot; &lt;&lt; endl;</span></div>
<div class="line"><a id="l01261" name="l01261"></a><span class="lineno"> 1261</span>         <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l01262" name="l01262"></a><span class="lineno"> 1262</span>      }</div>
<div class="line"><a id="l01263" name="l01263"></a><span class="lineno"> 1263</span> </div>
<div class="line"><a id="l01264" name="l01264"></a><span class="lineno"> 1264</span>      <span class="comment">// OK, append the cell details</span></div>
<div class="line"><a id="l01265" name="l01265"></a><span class="lineno"> 1265</span>      pPtiVGridParProfile-&gt;push_back(<a class="code hl_class" href="../../d6/d0d/classCGeom2DIPoint.html">CGeom2DIPoint</a>(nXPar, nYPar));</div>
<div class="line"><a id="l01266" name="l01266"></a><span class="lineno"> 1266</span>      pPtVExtCRSParProfile-&gt;push_back(<a class="code hl_class" href="../../d5/d4e/classCGeom2DPoint.html">CGeom2DPoint</a>(<a class="code hl_function" href="../../d1/d98/classCSimulation.html#ad79b925ac5f358c6f867b6e47dad74bd">dGridCentroidXToExtCRSX</a>(nXPar), <a class="code hl_function" href="../../d1/d98/classCSimulation.html#a7e2a4bd69ce79377fee86aa5598903f8">dGridCentroidYToExtCRSY</a>(nYPar)));</div>
<div class="line"><a id="l01267" name="l01267"></a><span class="lineno"> 1267</span>   }</div>
<div class="line"><a id="l01268" name="l01268"></a><span class="lineno"> 1268</span>}</div>
</div>
<div class="ttc" id="aclassCGeom2DIPoint_html"><div class="ttname"><a href="../../d6/d0d/classCGeom2DIPoint.html">CGeom2DIPoint</a></div><div class="ttdoc">Geometry class used to represent 2D point objects with integer coordinates.</div><div class="ttdef"><b>Definition</b> <a href="../../d2/d66/2di__point_8h_source.html#l00028">2di_point.h:29</a></div></div>
<div class="ttc" id="aclassCGeom2DPoint_html"><div class="ttname"><a href="../../d5/d4e/classCGeom2DPoint.html">CGeom2DPoint</a></div><div class="ttdoc">Geometry class used to represent 2D point objects with floating-point coordinates.</div><div class="ttdef"><b>Definition</b> <a href="../../d0/dee/2d__point_8h_source.html#l00026">2d_point.h:27</a></div></div>
<div class="ttc" id="aclassCGeom2DPoint_html_a216921dc2c592d9468e6430fee7c7719"><div class="ttname"><a href="../../d5/d4e/classCGeom2DPoint.html#a216921dc2c592d9468e6430fee7c7719">CGeom2DPoint::dGetY</a></div><div class="ttdeci">double dGetY(void) const</div><div class="ttdoc">Returns the CGeom2DPoint object&#39;s double Y coordinate.</div><div class="ttdef"><b>Definition</b> <a href="../../d2/d81/2d__point_8cpp_source.html#l00046">2d_point.cpp:46</a></div></div>
<div class="ttc" id="aclassCGeom2DPoint_html_a250f937d03cfdf6e0244b74ad2bf96a4"><div class="ttname"><a href="../../d5/d4e/classCGeom2DPoint.html#a250f937d03cfdf6e0244b74ad2bf96a4">CGeom2DPoint::dGetX</a></div><div class="ttdeci">double dGetX(void) const</div><div class="ttdoc">Returns the CGeom2DPoint object&#39;s double X coordinate.</div><div class="ttdef"><b>Definition</b> <a href="../../d2/d81/2d__point_8cpp_source.html#l00040">2d_point.cpp:40</a></div></div>
<div class="ttc" id="aclassCGeomProfile_html"><div class="ttname"><a href="../../da/dae/classCGeomProfile.html">CGeomProfile</a></div><div class="ttdoc">Geometry class used to represent coast profile objects.</div><div class="ttdef"><b>Definition</b> <a href="../../de/d45/profile_8h_source.html#l00034">profile.h:35</a></div></div>
<div class="ttc" id="aclassCGeomProfile_html_a343fd2b73e3a87cf425572860e79ebd6"><div class="ttname"><a href="../../da/dae/classCGeomProfile.html#a343fd2b73e3a87cf425572860e79ebd6">CGeomProfile::nGetCoastPoint</a></div><div class="ttdeci">int nGetCoastPoint(void) const</div><div class="ttdoc">Returns the coast point at which the profile starts.</div><div class="ttdef"><b>Definition</b> <a href="../../db/dfa/profile_8cpp_source.html#l00078">profile.cpp:78</a></div></div>
<div class="ttc" id="aclassCGeomProfile_html_a8a29c3fa364ab1f7b3930b7a9c83f45f"><div class="ttname"><a href="../../da/dae/classCGeomProfile.html#a8a29c3fa364ab1f7b3930b7a9c83f45f">CGeomProfile::nGetNumCellsInProfile</a></div><div class="ttdeci">int nGetNumCellsInProfile(void) const</div><div class="ttdoc">Returns the number of cells in the profile.</div><div class="ttdef"><b>Definition</b> <a href="../../db/dfa/profile_8cpp_source.html#l00496">profile.cpp:496</a></div></div>
<div class="ttc" id="aclassCGeomProfile_html_aaa8ddb9c775927bdb7940f7826f90a74"><div class="ttname"><a href="../../da/dae/classCGeomProfile.html#aaa8ddb9c775927bdb7940f7826f90a74">CGeomProfile::pPtGetPointInProfile</a></div><div class="ttdeci">CGeom2DPoint * pPtGetPointInProfile(int const)</div><div class="ttdoc">Returns a single point in the profile.</div><div class="ttdef"><b>Definition</b> <a href="../../db/dfa/profile_8cpp_source.html#l00332">profile.cpp:332</a></div></div>
<div class="ttc" id="aclassCGeomProfile_html_aac223e2610d50ca2c7eadaf8542e9498"><div class="ttname"><a href="../../da/dae/classCGeomProfile.html#aac223e2610d50ca2c7eadaf8542e9498">CGeomProfile::bOKIncStartAndEndOfCoast</a></div><div class="ttdeci">bool bOKIncStartAndEndOfCoast(void) const</div><div class="ttdoc">Returns true if this is a problem-free profile (however it could be a start-of-coast or an end-of-coa...</div><div class="ttdef"><b>Definition</b> <a href="../../db/dfa/profile_8cpp_source.html#l00231">profile.cpp:231</a></div></div>
<div class="ttc" id="aclassCGeomProfile_html_aacd98f9837c3c7cf7414764b73275fba"><div class="ttname"><a href="../../da/dae/classCGeomProfile.html#aacd98f9837c3c7cf7414764b73275fba">CGeomProfile::nGetCoastID</a></div><div class="ttdeci">int nGetCoastID(void) const</div><div class="ttdoc">Returns the profile&#39;s coast ID.</div><div class="ttdef"><b>Definition</b> <a href="../../db/dfa/profile_8cpp_source.html#l00066">profile.cpp:66</a></div></div>
<div class="ttc" id="aclassCGeomProfile_html_abaf88697019588a2b0901bd19044aee4"><div class="ttname"><a href="../../da/dae/classCGeomProfile.html#abaf88697019588a2b0901bd19044aee4">CGeomProfile::nGetProfileSize</a></div><div class="ttdeci">int nGetProfileSize(void) const</div><div class="ttdoc">Returns the number of points in the profile.</div><div class="ttdef"><b>Definition</b> <a href="../../db/dfa/profile_8cpp_source.html#l00325">profile.cpp:325</a></div></div>
<div class="ttc" id="aclassCGeomProfile_html_ada96aa991d179ac71f4523de7a4be560"><div class="ttname"><a href="../../da/dae/classCGeomProfile.html#ada96aa991d179ac71f4523de7a4be560">CGeomProfile::pPtiVGetCellsInProfile</a></div><div class="ttdeci">vector&lt; CGeom2DIPoint &gt; * pPtiVGetCellsInProfile(void)</div><div class="ttdoc">Returns all cells in the profile.</div><div class="ttdef"><b>Definition</b> <a href="../../db/dfa/profile_8cpp_source.html#l00475">profile.cpp:475</a></div></div>
<div class="ttc" id="aclassCSimulation_html_a0245d3cbdd603fbeced6ca1465eb3f16"><div class="ttname"><a href="../../d1/d98/classCSimulation.html#a0245d3cbdd603fbeced6ca1465eb3f16">CSimulation::m_nLogFileDetail</a></div><div class="ttdeci">int m_nLogFileDetail</div><div class="ttdoc">The level of detail in the log file output. Can be LOG_FILE_LOW_DETAIL, LOG_FILE_MIDDLE_DETAIL,...</div><div class="ttdef"><b>Definition</b> <a href="../../dd/d6a/simulation_8h_source.html#l00528">simulation.h:528</a></div></div>
<div class="ttc" id="aclassCSimulation_html_a0998fa493e91a4e27c79dadb568e7abe"><div class="ttname"><a href="../../d1/d98/classCSimulation.html#a0998fa493e91a4e27c79dadb568e7abe">CSimulation::dLookUpErosionPotential</a></div><div class="ttdeci">double dLookUpErosionPotential(double const) const</div><div class="ttdoc">The erosion potential lookup: it returns a value for erosion potential given a value of Depth Over DB...</div><div class="ttdef"><b>Definition</b> <a href="#l01045">do_shore_platform_erosion.cpp:1045</a></div></div>
<div class="ttc" id="aclassCSimulation_html_a115ab27bae37ce2d0de57cbdaeaba852"><div class="ttname"><a href="../../d1/d98/classCSimulation.html#a115ab27bae37ce2d0de57cbdaeaba852">CSimulation::m_dThisIterSWL</a></div><div class="ttdeci">double m_dThisIterSWL</div><div class="ttdoc">The still water level for this timestep (this includes tidal changes and any long-term SWL change)</div><div class="ttdef"><b>Definition</b> <a href="../../dd/d6a/simulation_8h_source.html#l00665">simulation.h:665</a></div></div>
<div class="ttc" id="aclassCSimulation_html_a1312f0ac2c93a6cb2bc41c23eb01c293"><div class="ttname"><a href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">CSimulation::m_pRasterGrid</a></div><div class="ttdeci">CGeomRasterGrid * m_pRasterGrid</div><div class="ttdoc">Pointer to the raster grid object.</div><div class="ttdef"><b>Definition</b> <a href="../../dd/d6a/simulation_8h_source.html#l01476">simulation.h:1476</a></div></div>
<div class="ttc" id="aclassCSimulation_html_a1652253500dab35e6f6f9f734207e20b"><div class="ttname"><a href="../../d1/d98/classCSimulation.html#a1652253500dab35e6f6f9f734207e20b">CSimulation::m_nXGridSize</a></div><div class="ttdeci">int m_nXGridSize</div><div class="ttdoc">The size of the grid in the x direction.</div><div class="ttdef"><b>Definition</b> <a href="../../dd/d6a/simulation_8h_source.html#l00429">simulation.h:429</a></div></div>
<div class="ttc" id="aclassCSimulation_html_a222962121613613a48f518e0c2110f21"><div class="ttname"><a href="../../d1/d98/classCSimulation.html#a222962121613613a48f518e0c2110f21">CSimulation::LogStream</a></div><div class="ttdeci">ofstream LogStream</div><div class="ttdef"><b>Definition</b> <a href="../../dd/d6a/simulation_8h_source.html#l01766">simulation.h:1766</a></div></div>
<div class="ttc" id="aclassCSimulation_html_a25ada8139c82ca7beab3f279cff83184"><div class="ttname"><a href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">CSimulation::m_VCoast</a></div><div class="ttdeci">vector&lt; CRWCoast &gt; m_VCoast</div><div class="ttdoc">The coastline objects.</div><div class="ttdef"><b>Definition</b> <a href="../../dd/d6a/simulation_8h_source.html#l01479">simulation.h:1479</a></div></div>
<div class="ttc" id="aclassCSimulation_html_a2fc00e8bedd7b2f6f2d7d6fedf54821d"><div class="ttname"><a href="../../d1/d98/classCSimulation.html#a2fc00e8bedd7b2f6f2d7d6fedf54821d">CSimulation::m_dFineErodibilityNormalized</a></div><div class="ttdeci">double m_dFineErodibilityNormalized</div><div class="ttdoc">Relative erodibility of fine unconsolidated beach sediment, normalized.</div><div class="ttdef"><b>Definition</b> <a href="../../dd/d6a/simulation_8h_source.html#l00749">simulation.h:749</a></div></div>
<div class="ttc" id="aclassCSimulation_html_a351c28119561e99ad17a539274dbea27"><div class="ttname"><a href="../../d1/d98/classCSimulation.html#a351c28119561e99ad17a539274dbea27">CSimulation::m_dThisIterActualPlatformErosionCoarseCons</a></div><div class="ttdeci">double m_dThisIterActualPlatformErosionCoarseCons</div><div class="ttdoc">Total actual platform erosion (coarse consolidated sediment) for this iteration (depth in m)</div><div class="ttdef"><b>Definition</b> <a href="../../dd/d6a/simulation_8h_source.html#l00791">simulation.h:791</a></div></div>
<div class="ttc" id="aclassCSimulation_html_a3710924bc49104a656245ffbd76e8ea3"><div class="ttname"><a href="../../d1/d98/classCSimulation.html#a3710924bc49104a656245ffbd76e8ea3">CSimulation::nDoAllShorePlatFormErosion</a></div><div class="ttdeci">int nDoAllShorePlatFormErosion(void)</div><div class="ttdoc">Does platform erosion on all coastlines by first calculating platform erosion on coastline-normal pro...</div><div class="ttdef"><b>Definition</b> <a href="#l00052">do_shore_platform_erosion.cpp:52</a></div></div>
<div class="ttc" id="aclassCSimulation_html_a3755fdc07c0ac9f2ce6c2237cfef50ce"><div class="ttname"><a href="../../d1/d98/classCSimulation.html#a3755fdc07c0ac9f2ce6c2237cfef50ce">CSimulation::m_nYGridSize</a></div><div class="ttdeci">int m_nYGridSize</div><div class="ttdoc">The size of the grid in the y direction.</div><div class="ttdef"><b>Definition</b> <a href="../../dd/d6a/simulation_8h_source.html#l00432">simulation.h:432</a></div></div>
<div class="ttc" id="aclassCSimulation_html_a37c2a2c0a5c040e6d1b5ddf3d1bf2437"><div class="ttname"><a href="../../d1/d98/classCSimulation.html#a37c2a2c0a5c040e6d1b5ddf3d1bf2437">CSimulation::m_VdErosionPotential</a></div><div class="ttdeci">vector&lt; double &gt; m_VdErosionPotential</div><div class="ttdoc">For erosion potential lookup.</div><div class="ttdef"><b>Definition</b> <a href="../../dd/d6a/simulation_8h_source.html#l01335">simulation.h:1335</a></div></div>
<div class="ttc" id="aclassCSimulation_html_a39a93413881b60c7fa43dc992c5520d0"><div class="ttname"><a href="../../d1/d98/classCSimulation.html#a39a93413881b60c7fa43dc992c5520d0">CSimulation::ConstructParallelProfile</a></div><div class="ttdeci">void ConstructParallelProfile(int const, int const, int const, int const, int const, vector&lt; CGeom2DIPoint &gt; *const, vector&lt; CGeom2DIPoint &gt; *, vector&lt; CGeom2DPoint &gt; *)</div><div class="ttdoc">Constructs a parallel coastline-normal profile.</div><div class="ttdef"><b>Definition</b> <a href="#l01233">do_shore_platform_erosion.cpp:1233</a></div></div>
<div class="ttc" id="aclassCSimulation_html_a3b7163f1f1ca4965591fd6a7e2b53d2b"><div class="ttname"><a href="../../d1/d98/classCSimulation.html#a3b7163f1f1ca4965591fd6a7e2b53d2b">CSimulation::nSaveParProfile</a></div><div class="ttdeci">int nSaveParProfile(int const, CGeomProfile const *, int const, int const, int const, vector&lt; double &gt; const *, vector&lt; double &gt; const *, vector&lt; double &gt; const *, vector&lt; double &gt; const *, vector&lt; double &gt; const *, vector&lt; double &gt; const *, vector&lt; double &gt; const *, vector&lt; CGeom2DIPoint &gt; *const, vector&lt; double &gt; const *) const</div><div class="ttdoc">Save a coastline-normal parallel profile.</div><div class="ttdef"><b>Definition</b> <a href="../../d4/d6c/write__output_8cpp_source.html#l01059">write_output.cpp:1059</a></div></div>
<div class="ttc" id="aclassCSimulation_html_a407e01ecfd7c564c74f4474216ce2e16"><div class="ttname"><a href="../../d1/d98/classCSimulation.html#a407e01ecfd7c564c74f4474216ce2e16">CSimulation::dGetDistanceBetween</a></div><div class="ttdeci">static double dGetDistanceBetween(CGeom2DPoint const *, CGeom2DPoint const *)</div><div class="ttdoc">Returns the distance (in external CRS) between two points.</div><div class="ttdef"><b>Definition</b> <a href="../../db/df7/gis__utils_8cpp_source.html#l00140">gis_utils.cpp:140</a></div></div>
<div class="ttc" id="aclassCSimulation_html_a41d2967d84cbcf1799123f3d51aac287"><div class="ttname"><a href="../../d1/d98/classCSimulation.html#a41d2967d84cbcf1799123f3d51aac287">CSimulation::m_dCoarseErodibilityNormalized</a></div><div class="ttdeci">double m_dCoarseErodibilityNormalized</div><div class="ttdoc">Relative erodibility of coarse unconsolidated beach sediment, normalized.</div><div class="ttdef"><b>Definition</b> <a href="../../dd/d6a/simulation_8h_source.html#l00755">simulation.h:755</a></div></div>
<div class="ttc" id="aclassCSimulation_html_a449cba5df2232226b1fe32ce61c354ab"><div class="ttname"><a href="../../d1/d98/classCSimulation.html#a449cba5df2232226b1fe32ce61c354ab">CSimulation::m_VdDepthOverDB</a></div><div class="ttdeci">vector&lt; double &gt; m_VdDepthOverDB</div><div class="ttdoc">For erosion potential lookup.</div><div class="ttdef"><b>Definition</b> <a href="../../dd/d6a/simulation_8h_source.html#l01338">simulation.h:1338</a></div></div>
<div class="ttc" id="aclassCSimulation_html_a45b070d19448816f0a4345981d81239e"><div class="ttname"><a href="../../d1/d98/classCSimulation.html#a45b070d19448816f0a4345981d81239e">CSimulation::FillInBeachProtectionHoles</a></div><div class="ttdeci">void FillInBeachProtectionHoles(void)</div><div class="ttdoc">Fills in &#39;holes&#39; in the beach protection i.e. orphan cells which get omitted because of rounding prob...</div><div class="ttdef"><b>Definition</b> <a href="#l01096">do_shore_platform_erosion.cpp:1096</a></div></div>
<div class="ttc" id="aclassCSimulation_html_a46df9f5bbc643a6884c18ebe097bdb79"><div class="ttname"><a href="../../d1/d98/classCSimulation.html#a46df9f5bbc643a6884c18ebe097bdb79">CSimulation::m_dTotPotentialPlatformErosionBetweenProfiles</a></div><div class="ttdeci">double m_dTotPotentialPlatformErosionBetweenProfiles</div><div class="ttdoc">Total potential platform erosion between profiles.</div><div class="ttdef"><b>Definition</b> <a href="../../dd/d6a/simulation_8h_source.html#l00848">simulation.h:848</a></div></div>
<div class="ttc" id="aclassCSimulation_html_a4d9fe85e0e30c85d0751608b90aeb253"><div class="ttname"><a href="../../d1/d98/classCSimulation.html#a4d9fe85e0e30c85d0751608b90aeb253">CSimulation::m_dDepositionCoarseDiff</a></div><div class="ttdeci">double m_dDepositionCoarseDiff</div><div class="ttdoc">Error term: if we are unable to deposit enough unconslidated coarse on polygon(s),...</div><div class="ttdef"><b>Definition</b> <a href="../../dd/d6a/simulation_8h_source.html#l00839">simulation.h:839</a></div></div>
<div class="ttc" id="aclassCSimulation_html_a4fc351e671b433439a44cbdcea15d494"><div class="ttname"><a href="../../d1/d98/classCSimulation.html#a4fc351e671b433439a44cbdcea15d494">CSimulation::m_ulThisIterNumActualPlatformErosionCells</a></div><div class="ttdeci">unsigned long m_ulThisIterNumActualPlatformErosionCells</div><div class="ttdoc">The number of grid cells on which actual platform erosion occurs, for this iteration.</div><div class="ttdef"><b>Definition</b> <a href="../../dd/d6a/simulation_8h_source.html#l00572">simulation.h:572</a></div></div>
<div class="ttc" id="aclassCSimulation_html_a5ecb98fb61c4e0ae63cc6c7786c7a0bf"><div class="ttname"><a href="../../d1/d98/classCSimulation.html#a5ecb98fb61c4e0ae63cc6c7786c7a0bf">CSimulation::nCalcPotentialPlatformErosionBetweenProfiles</a></div><div class="ttdeci">int nCalcPotentialPlatformErosionBetweenProfiles(int const, CGeomProfile *, int const)</div><div class="ttdoc">Calculates potential platform erosion on cells to one side of a given coastline-normal profile,...</div><div class="ttdef"><b>Definition</b> <a href="#l00401">do_shore_platform_erosion.cpp:401</a></div></div>
<div class="ttc" id="aclassCSimulation_html_a5f90b759d60bf3e53f881fd2dad3b944"><div class="ttname"><a href="../../d1/d98/classCSimulation.html#a5f90b759d60bf3e53f881fd2dad3b944">CSimulation::m_dDepositionSandDiff</a></div><div class="ttdeci">double m_dDepositionSandDiff</div><div class="ttdoc">Error term: if we are unable to deposit enough unconslidated sand on polygon(s), this is held over to...</div><div class="ttdef"><b>Definition</b> <a href="../../dd/d6a/simulation_8h_source.html#l00836">simulation.h:836</a></div></div>
<div class="ttc" id="aclassCSimulation_html_a62a7753e37f9e236df3a6213b07585ec"><div class="ttname"><a href="../../d1/d98/classCSimulation.html#a62a7753e37f9e236df3a6213b07585ec">CSimulation::nSaveProfile</a></div><div class="ttdeci">int nSaveProfile(int const, CGeomProfile const *, int const, vector&lt; double &gt; const *, vector&lt; double &gt; const *, vector&lt; double &gt; const *, vector&lt; double &gt; const *, vector&lt; double &gt; const *, vector&lt; double &gt; const *, vector&lt; double &gt; const *, vector&lt; CGeom2DIPoint &gt; *const, vector&lt; double &gt; const *) const</div><div class="ttdoc">Save a coastline-normal profile.</div><div class="ttdef"><b>Definition</b> <a href="../../d4/d6c/write__output_8cpp_source.html#l00991">write_output.cpp:991</a></div></div>
<div class="ttc" id="aclassCSimulation_html_a6478fd59a34c3fb4891f570d32a22ddb"><div class="ttname"><a href="../../d1/d98/classCSimulation.html#a6478fd59a34c3fb4891f570d32a22ddb">CSimulation::m_dThisIterPotentialPlatformErosion</a></div><div class="ttdeci">double m_dThisIterPotentialPlatformErosion</div><div class="ttdoc">Total potential platform erosion (all size classes of consolidated sediment) for this iteration (dept...</div><div class="ttdef"><b>Definition</b> <a href="../../dd/d6a/simulation_8h_source.html#l00782">simulation.h:782</a></div></div>
<div class="ttc" id="aclassCSimulation_html_a67daaf20e2c3f0d684df910b6b5353ad"><div class="ttname"><a href="../../d1/d98/classCSimulation.html#a67daaf20e2c3f0d684df910b6b5353ad">CSimulation::dVSmoothProfileSlope</a></div><div class="ttdeci">vector&lt; double &gt; dVSmoothProfileSlope(vector&lt; double &gt; *) const</div><div class="ttdoc">Does running-mean smoothing of the slope of a coastline-normal profile.</div><div class="ttdef"><b>Definition</b> <a href="../../db/d94/smooth__line_8cpp_source.html#l00339">smooth_line.cpp:339</a></div></div>
<div class="ttc" id="aclassCSimulation_html_a6cab4d9561ad835328f1df42d03edf97"><div class="ttname"><a href="../../d1/d98/classCSimulation.html#a6cab4d9561ad835328f1df42d03edf97">CSimulation::m_dDepthOverDBMax</a></div><div class="ttdeci">double m_dDepthOverDBMax</div><div class="ttdoc">Maximum value of deoth over DB, is used in erosion potential look-up function.</div><div class="ttdef"><b>Definition</b> <a href="../../dd/d6a/simulation_8h_source.html#l00842">simulation.h:842</a></div></div>
<div class="ttc" id="aclassCSimulation_html_a73cad40fa795d80bb48bb360df2c47e9"><div class="ttname"><a href="../../d1/d98/classCSimulation.html#a73cad40fa795d80bb48bb360df2c47e9">CSimulation::m_dSandErodibilityNormalized</a></div><div class="ttdeci">double m_dSandErodibilityNormalized</div><div class="ttdoc">Relative erodibility of sand unconsolidated beach sediment, normalized.</div><div class="ttdef"><b>Definition</b> <a href="../../dd/d6a/simulation_8h_source.html#l00752">simulation.h:752</a></div></div>
<div class="ttc" id="aclassCSimulation_html_a73e84e0701260f3729b25018aa6d8059"><div class="ttname"><a href="../../d1/d98/classCSimulation.html#a73e84e0701260f3729b25018aa6d8059">CSimulation::m_dR</a></div><div class="ttdeci">double m_dR</div><div class="ttdoc">Coast platform resistance to erosion R, see Walkden &amp; Hall, 2011.</div><div class="ttdef"><b>Definition</b> <a href="../../dd/d6a/simulation_8h_source.html#l00722">simulation.h:722</a></div></div>
<div class="ttc" id="aclassCSimulation_html_a7848fdd8286f9734860955b855be74be"><div class="ttname"><a href="../../d1/d98/classCSimulation.html#a7848fdd8286f9734860955b855be74be">CSimulation::m_dThisIterActualPlatformErosionSandCons</a></div><div class="ttdeci">double m_dThisIterActualPlatformErosionSandCons</div><div class="ttdoc">Total actual platform erosion (sand consolidated sediment) for this iteration (depth in m)</div><div class="ttdef"><b>Definition</b> <a href="../../dd/d6a/simulation_8h_source.html#l00788">simulation.h:788</a></div></div>
<div class="ttc" id="aclassCSimulation_html_a7e2a4bd69ce79377fee86aa5598903f8"><div class="ttname"><a href="../../d1/d98/classCSimulation.html#a7e2a4bd69ce79377fee86aa5598903f8">CSimulation::dGridCentroidYToExtCRSY</a></div><div class="ttdeci">double dGridCentroidYToExtCRSY(int const) const</div><div class="ttdoc">Given the integer Y-axis ordinate of a cell in the raster grid CRS, returns the external CRS Y-axis o...</div><div class="ttdef"><b>Definition</b> <a href="../../db/df7/gis__utils_8cpp_source.html#l00071">gis_utils.cpp:71</a></div></div>
<div class="ttc" id="aclassCSimulation_html_a8cc291f5951942ece85859272e871fa1"><div class="ttname"><a href="../../d1/d98/classCSimulation.html#a8cc291f5951942ece85859272e871fa1">CSimulation::m_dTotPotentialPlatformErosionOnProfiles</a></div><div class="ttdeci">double m_dTotPotentialPlatformErosionOnProfiles</div><div class="ttdoc">Total potential platform erosion on profiles.</div><div class="ttdef"><b>Definition</b> <a href="../../dd/d6a/simulation_8h_source.html#l00845">simulation.h:845</a></div></div>
<div class="ttc" id="aclassCSimulation_html_a94021023e2af53e0b800dc821108ee2c"><div class="ttname"><a href="../../d1/d98/classCSimulation.html#a94021023e2af53e0b800dc821108ee2c">CSimulation::nCalcPotentialPlatformErosionOnProfile</a></div><div class="ttdeci">int nCalcPotentialPlatformErosionOnProfile(int const, CGeomProfile *)</div><div class="ttdoc">Calculates potential (i.e. unconstrained by available sediment) erosional lowering of the shore platf...</div><div class="ttdef"><b>Definition</b> <a href="#l00171">do_shore_platform_erosion.cpp:171</a></div></div>
<div class="ttc" id="aclassCSimulation_html_a9f6cbe5853ed2e733f85a88419341950"><div class="ttname"><a href="../../d1/d98/classCSimulation.html#a9f6cbe5853ed2e733f85a88419341950">CSimulation::DoActualPlatformErosionOnCell</a></div><div class="ttdeci">void DoActualPlatformErosionOnCell(int const, int const)</div><div class="ttdoc">Calculates actual (constrained by available sediment) erosion of the consolidated shore platform on a...</div><div class="ttdef"><b>Definition</b> <a href="#l00741">do_shore_platform_erosion.cpp:741</a></div></div>
<div class="ttc" id="aclassCSimulation_html_a9ff982b02c96da7af9df717158907d43"><div class="ttname"><a href="../../d1/d98/classCSimulation.html#a9ff982b02c96da7af9df717158907d43">CSimulation::m_dThisIterFineSedimentToSuspension</a></div><div class="ttdeci">double m_dThisIterFineSedimentToSuspension</div><div class="ttdoc">Total fine unconsolidated sediment in suspension for this iteration (depth in m)</div><div class="ttdef"><b>Definition</b> <a href="../../dd/d6a/simulation_8h_source.html#l00812">simulation.h:812</a></div></div>
<div class="ttc" id="aclassCSimulation_html_aa1822cd0877dd757ed449591018be8d4"><div class="ttname"><a href="../../d1/d98/classCSimulation.html#aa1822cd0877dd757ed449591018be8d4">CSimulation::FillPotentialPlatformErosionHoles</a></div><div class="ttdeci">void FillPotentialPlatformErosionHoles(void)</div><div class="ttdoc">Fills in &#39;holes&#39; in the potential platform erosion i.e. orphan cells which get omitted because of rou...</div><div class="ttdef"><b>Definition</b> <a href="#l01159">do_shore_platform_erosion.cpp:1159</a></div></div>
<div class="ttc" id="aclassCSimulation_html_aa86b50dc1f1dd9fb62827667aadfb542"><div class="ttname"><a href="../../d1/d98/classCSimulation.html#aa86b50dc1f1dd9fb62827667aadfb542">CSimulation::m_ulThisIterNumPotentialPlatformErosionCells</a></div><div class="ttdeci">unsigned long m_ulThisIterNumPotentialPlatformErosionCells</div><div class="ttdoc">The number of grid cells on which potential platform erosion occurs, for this iteration.</div><div class="ttdef"><b>Definition</b> <a href="../../dd/d6a/simulation_8h_source.html#l00569">simulation.h:569</a></div></div>
<div class="ttc" id="aclassCSimulation_html_aab026ce32dae1272a2633b41dd9217d5"><div class="ttname"><a href="../../d1/d98/classCSimulation.html#aab026ce32dae1272a2633b41dd9217d5">CSimulation::m_Rand</a></div><div class="ttdeci">default_random_engine m_Rand[NUMBER_OF_RNGS]</div><div class="ttdoc">The c++11 random number generators.</div><div class="ttdef"><b>Definition</b> <a href="../../dd/d6a/simulation_8h_source.html#l01503">simulation.h:1503</a></div></div>
<div class="ttc" id="aclassCSimulation_html_abef67c0ac30d52706bdf5e57f44380df"><div class="ttname"><a href="../../d1/d98/classCSimulation.html#abef67c0ac30d52706bdf5e57f44380df">CSimulation::m_ulTotPotentialPlatformErosionOnProfiles</a></div><div class="ttdeci">unsigned long m_ulTotPotentialPlatformErosionOnProfiles</div><div class="ttdoc">The number of cells on which on-profile average potential shore platform erosion occurs.</div><div class="ttdef"><b>Definition</b> <a href="../../dd/d6a/simulation_8h_source.html#l00584">simulation.h:584</a></div></div>
<div class="ttc" id="aclassCSimulation_html_ac26ef813bdee563625a9a7be573a3741"><div class="ttname"><a href="../../d1/d98/classCSimulation.html#ac26ef813bdee563625a9a7be573a3741">CSimulation::m_dCellArea</a></div><div class="ttdeci">double m_dCellArea</div><div class="ttdoc">Area of a cell (in external CRS units)</div><div class="ttdef"><b>Definition</b> <a href="../../dd/d6a/simulation_8h_source.html#l00614">simulation.h:614</a></div></div>
<div class="ttc" id="aclassCSimulation_html_ac2937805b3fc0bb1b75201ea16870936"><div class="ttname"><a href="../../d1/d98/classCSimulation.html#ac2937805b3fc0bb1b75201ea16870936">CSimulation::m_ulTotPotentialPlatformErosionBetweenProfiles</a></div><div class="ttdeci">unsigned long m_ulTotPotentialPlatformErosionBetweenProfiles</div><div class="ttdoc">The number of cells on which between-profile average potential shore platform erosion occurs.</div><div class="ttdef"><b>Definition</b> <a href="../../dd/d6a/simulation_8h_source.html#l00587">simulation.h:587</a></div></div>
<div class="ttc" id="aclassCSimulation_html_ac900a5701df97da22278fae928951f50"><div class="ttname"><a href="../../d1/d98/classCSimulation.html#ac900a5701df97da22278fae928951f50">CSimulation::bIsWithinValidGrid</a></div><div class="ttdeci">bool bIsWithinValidGrid(int const, int const) const</div><div class="ttdoc">Checks whether the supplied point (an x-y pair, in the grid CRS) is within the raster grid,...</div><div class="ttdef"><b>Definition</b> <a href="../../db/df7/gis__utils_8cpp_source.html#l00170">gis_utils.cpp:170</a></div></div>
<div class="ttc" id="aclassCSimulation_html_ad67e8c5b30a0572f64ecfb5c062c2edc"><div class="ttname"><a href="../../d1/d98/classCSimulation.html#ad67e8c5b30a0572f64ecfb5c062c2edc">CSimulation::m_ulIter</a></div><div class="ttdeci">unsigned long m_ulIter</div><div class="ttdoc">The number of the current iteration (time step)</div><div class="ttdef"><b>Definition</b> <a href="../../dd/d6a/simulation_8h_source.html#l00551">simulation.h:551</a></div></div>
<div class="ttc" id="aclassCSimulation_html_ad79b925ac5f358c6f867b6e47dad74bd"><div class="ttname"><a href="../../d1/d98/classCSimulation.html#ad79b925ac5f358c6f867b6e47dad74bd">CSimulation::dGridCentroidXToExtCRSX</a></div><div class="ttdeci">double dGridCentroidXToExtCRSX(int const) const</div><div class="ttdoc">Given the integer X-axis ordinate of a cell in the raster grid CRS, returns the external CRS X-axis o...</div><div class="ttdef"><b>Definition</b> <a href="../../db/df7/gis__utils_8cpp_source.html#l00062">gis_utils.cpp:62</a></div></div>
<div class="ttc" id="aclassCSimulation_html_addce7ee7de6383e6cf4b074db90f012e"><div class="ttname"><a href="../../d1/d98/classCSimulation.html#addce7ee7de6383e6cf4b074db90f012e">CSimulation::dCalcBeachProtectionFactor</a></div><div class="ttdeci">double dCalcBeachProtectionFactor(int const, int const, double const)</div><div class="ttdoc">Calculates the (inverse) beach protection factor as in SCAPE: 0 is fully protected,...</div><div class="ttdef"><b>Definition</b> <a href="#l01060">do_shore_platform_erosion.cpp:1060</a></div></div>
<div class="ttc" id="aclassCSimulation_html_ae059490cc0533a19928e70214e21036b"><div class="ttname"><a href="../../d1/d98/classCSimulation.html#ae059490cc0533a19928e70214e21036b">CSimulation::m_bOutputProfileData</a></div><div class="ttdeci">bool m_bOutputProfileData</div><div class="ttdoc">Output profile data?</div><div class="ttdef"><b>Definition</b> <a href="../../dd/d6a/simulation_8h_source.html#l00315">simulation.h:315</a></div></div>
<div class="ttc" id="aclassCSimulation_html_ae7a8e20ea5a852f69bee1296ea3db020"><div class="ttname"><a href="../../d1/d98/classCSimulation.html#ae7a8e20ea5a852f69bee1296ea3db020">CSimulation::bCreateErosionPotentialLookUp</a></div><div class="ttdeci">bool bCreateErosionPotentialLookUp(vector&lt; double &gt; *, vector&lt; double &gt; *, vector&lt; double &gt; *)</div><div class="ttdoc">Creates a look-up table for erosion potential, given depth over DB.</div><div class="ttdef"><b>Definition</b> <a href="#l00994">do_shore_platform_erosion.cpp:994</a></div></div>
<div class="ttc" id="aclassCSimulation_html_aeafa6e4b5ab61733094effce380cff63"><div class="ttname"><a href="../../d1/d98/classCSimulation.html#aeafa6e4b5ab61733094effce380cff63">CSimulation::m_dThisIterActualPlatformErosionFineCons</a></div><div class="ttdeci">double m_dThisIterActualPlatformErosionFineCons</div><div class="ttdoc">Total actual platform erosion (fine consolidated sediment) for this iteration (depth in m)</div><div class="ttdef"><b>Definition</b> <a href="../../dd/d6a/simulation_8h_source.html#l00785">simulation.h:785</a></div></div>
<div class="ttc" id="aclassCSimulation_html_aeb78392a5380da7a2caca22bae4cfcc8"><div class="ttname"><a href="../../d1/d98/classCSimulation.html#aeb78392a5380da7a2caca22bae4cfcc8">CSimulation::m_nProfileSmoothWindow</a></div><div class="ttdeci">int m_nProfileSmoothWindow</div><div class="ttdoc">The size of the window used for running-mean coast-normal profile smoothing (must be odd)</div><div class="ttdef"><b>Definition</b> <a href="../../dd/d6a/simulation_8h_source.html#l00447">simulation.h:447</a></div></div>
<div class="ttc" id="aclassCSimulation_html_aee72433983f1b26c0b734ee7b0d26014"><div class="ttname"><a href="../../d1/d98/classCSimulation.html#aee72433983f1b26c0b734ee7b0d26014">CSimulation::m_bConsChangedThisIter</a></div><div class="ttdeci">vector&lt; bool &gt; m_bConsChangedThisIter</div><div class="ttdoc">One element per layer: has the consolidated sediment of this layer been changed during this iteration...</div><div class="ttdef"><b>Definition</b> <a href="../../dd/d6a/simulation_8h_source.html#l01305">simulation.h:1305</a></div></div>
<div class="ttc" id="aclassCSimulation_html_af9cc39225a10048022a5321022bc16c8"><div class="ttname"><a href="../../d1/d98/classCSimulation.html#af9cc39225a10048022a5321022bc16c8">CSimulation::m_bOutputParallelProfileData</a></div><div class="ttdeci">bool m_bOutputParallelProfileData</div><div class="ttdoc">Output parallel profile data?</div><div class="ttdef"><b>Definition</b> <a href="../../dd/d6a/simulation_8h_source.html#l00318">simulation.h:318</a></div></div>
<div class="ttc" id="aclassCSimulation_html_afdf9931c6687dab00b0f48c0709d6c8a"><div class="ttname"><a href="../../d1/d98/classCSimulation.html#afdf9931c6687dab00b0f48c0709d6c8a">CSimulation::m_pVCoastPolygon</a></div><div class="ttdeci">vector&lt; CGeomCoastPolygon * &gt; m_pVCoastPolygon</div><div class="ttdoc">Pointers to coast polygon objects, in down-coast sequence TODO 044 Will need to use global polygon ID...</div><div class="ttdef"><b>Definition</b> <a href="../../dd/d6a/simulation_8h_source.html#l01488">simulation.h:1488</a></div></div>
<div class="ttc" id="acme_8h_html"><div class="ttname"><a href="../../d6/d2a/cme_8h.html">cme.h</a></div><div class="ttdoc">This file contains global definitions for CoastalME.</div></div>
<div class="ttc" id="acme_8h_html_a01522c1e8423c6586193dd5ca0c76171"><div class="ttname"><a href="../../d6/d2a/cme_8h.html#a01522c1e8423c6586193dd5ca0c76171">NO_NONZERO_THICKNESS_LAYERS</a></div><div class="ttdeci">int const NO_NONZERO_THICKNESS_LAYERS</div><div class="ttdef"><b>Definition</b> <a href="../../d6/d2a/cme_8h_source.html#l00655">cme.h:655</a></div></div>
<div class="ttc" id="acme_8h_html_a01aa8b423260b337ddff2016107b51a0"><div class="ttname"><a href="../../d6/d2a/cme_8h.html#a01aa8b423260b337ddff2016107b51a0">INT_NODATA</a></div><div class="ttdeci">int const INT_NODATA</div><div class="ttdef"><b>Definition</b> <a href="../../d6/d2a/cme_8h_source.html#l00365">cme.h:365</a></div></div>
<div class="ttc" id="acme_8h_html_a068017859403c0629d89f8d348f6c224"><div class="ttname"><a href="../../d6/d2a/cme_8h.html#a068017859403c0629d89f8d348f6c224">tMin</a></div><div class="ttdeci">T tMin(T a, T b)</div><div class="ttdef"><b>Definition</b> <a href="../../d6/d2a/cme_8h_source.html#l01139">cme.h:1139</a></div></div>
<div class="ttc" id="acme_8h_html_a08b1623863ee3bd4300a8892de323722"><div class="ttname"><a href="../../d6/d2a/cme_8h.html#a08b1623863ee3bd4300a8892de323722">TOLERANCE</a></div><div class="ttdeci">double const TOLERANCE</div><div class="ttdef"><b>Definition</b> <a href="../../d6/d2a/cme_8h_source.html#l00701">cme.h:701</a></div></div>
<div class="ttc" id="acme_8h_html_a0af2b64c1c33dbf4d223944b0bf234e6"><div class="ttname"><a href="../../d6/d2a/cme_8h.html#a0af2b64c1c33dbf4d223944b0bf234e6">RTN_ERR_NO_TOP_LAYER</a></div><div class="ttdeci">int const RTN_ERR_NO_TOP_LAYER</div><div class="ttdef"><b>Definition</b> <a href="../../d6/d2a/cme_8h_source.html#l00626">cme.h:626</a></div></div>
<div class="ttc" id="acme_8h_html_a292fc90846543ca4814daa9f759feb05"><div class="ttname"><a href="../../d6/d2a/cme_8h.html#a292fc90846543ca4814daa9f759feb05">ERR</a></div><div class="ttdeci">string const ERR</div><div class="ttdef"><b>Definition</b> <a href="../../d6/d2a/cme_8h_source.html#l00778">cme.h:778</a></div></div>
<div class="ttc" id="acme_8h_html_a29fcc12f725cf70f82b391b4fd46d171"><div class="ttname"><a href="../../d6/d2a/cme_8h.html#a29fcc12f725cf70f82b391b4fd46d171">DIRECTION_DOWNCOAST</a></div><div class="ttdeci">int const DIRECTION_DOWNCOAST</div><div class="ttdef"><b>Definition</b> <a href="../../d6/d2a/cme_8h_source.html#l00395">cme.h:395</a></div></div>
<div class="ttc" id="acme_8h_html_a49682bb35bb6bb78bb43e19147f62eca"><div class="ttname"><a href="../../d6/d2a/cme_8h.html#a49682bb35bb6bb78bb43e19147f62eca">SOUTH_EAST</a></div><div class="ttdeci">int const SOUTH_EAST</div><div class="ttdef"><b>Definition</b> <a href="../../d6/d2a/cme_8h_source.html#l00389">cme.h:389</a></div></div>
<div class="ttc" id="acme_8h_html_a4a0172f22f9ee43c7168c4ccfb531b1a"><div class="ttname"><a href="../../d6/d2a/cme_8h.html#a4a0172f22f9ee43c7168c4ccfb531b1a">DEPTH_OVER_DB_INCREMENT</a></div><div class="ttdeci">double const DEPTH_OVER_DB_INCREMENT</div><div class="ttdef"><b>Definition</b> <a href="../../d6/d2a/cme_8h_source.html#l00693">cme.h:693</a></div></div>
<div class="ttc" id="acme_8h_html_a540d8a94fc09b0b14fd8ab657445b67a"><div class="ttname"><a href="../../d6/d2a/cme_8h.html#a540d8a94fc09b0b14fd8ab657445b67a">LOG_FILE_MIDDLE_DETAIL</a></div><div class="ttdeci">int const LOG_FILE_MIDDLE_DETAIL</div><div class="ttdef"><b>Definition</b> <a href="../../d6/d2a/cme_8h_source.html#l00380">cme.h:380</a></div></div>
<div class="ttc" id="acme_8h_html_a61afa8560a3b39c80657661a1d8f76ab"><div class="ttname"><a href="../../d6/d2a/cme_8h.html#a61afa8560a3b39c80657661a1d8f76ab">bFPIsEqual</a></div><div class="ttdeci">bool bFPIsEqual(const T d1, const T d2, const T dEpsilon)</div><div class="ttdef"><b>Definition</b> <a href="../../d6/d2a/cme_8h_source.html#l01179">cme.h:1179</a></div></div>
<div class="ttc" id="acme_8h_html_a7a3b237ac891f748a20b4614bf7fc437"><div class="ttname"><a href="../../d6/d2a/cme_8h.html#a7a3b237ac891f748a20b4614bf7fc437">SOUTH_WEST</a></div><div class="ttdeci">int const SOUTH_WEST</div><div class="ttdef"><b>Definition</b> <a href="../../d6/d2a/cme_8h_source.html#l00391">cme.h:391</a></div></div>
<div class="ttc" id="acme_8h_html_a7e895b460cef877dec4d12ead0c74f15"><div class="ttname"><a href="../../d6/d2a/cme_8h.html#a7e895b460cef877dec4d12ead0c74f15">tMax</a></div><div class="ttdeci">T tMax(T a, T b)</div><div class="ttdef"><b>Definition</b> <a href="../../d6/d2a/cme_8h_source.html#l01126">cme.h:1126</a></div></div>
<div class="ttc" id="acme_8h_html_a8203a0b525538b7ade9e5409ebc59981"><div class="ttname"><a href="../../d6/d2a/cme_8h.html#a8203a0b525538b7ade9e5409ebc59981">NORTH_WEST</a></div><div class="ttdeci">int const NORTH_WEST</div><div class="ttdef"><b>Definition</b> <a href="../../d6/d2a/cme_8h_source.html#l00393">cme.h:393</a></div></div>
<div class="ttc" id="acme_8h_html_a85da1142fa4655ec66f1e391444a6d9a"><div class="ttname"><a href="../../d6/d2a/cme_8h.html#a85da1142fa4655ec66f1e391444a6d9a">LOG_FILE_HIGH_DETAIL</a></div><div class="ttdeci">int const LOG_FILE_HIGH_DETAIL</div><div class="ttdef"><b>Definition</b> <a href="../../d6/d2a/cme_8h_source.html#l00381">cme.h:381</a></div></div>
<div class="ttc" id="acme_8h_html_a957ca99e98618160534cafb0929f743d"><div class="ttname"><a href="../../d6/d2a/cme_8h.html#a957ca99e98618160534cafb0929f743d">WARN</a></div><div class="ttdeci">string const WARN</div><div class="ttdef"><b>Definition</b> <a href="../../d6/d2a/cme_8h_source.html#l00779">cme.h:779</a></div></div>
<div class="ttc" id="acme_8h_html_a992c7916632c97c6c1fa25fd5a788282"><div class="ttname"><a href="../../d6/d2a/cme_8h.html#a992c7916632c97c6c1fa25fd5a788282">SEDIMENT_ELEV_TOLERANCE</a></div><div class="ttdeci">double const SEDIMENT_ELEV_TOLERANCE</div><div class="ttdef"><b>Definition</b> <a href="../../d6/d2a/cme_8h_source.html#l00702">cme.h:702</a></div></div>
<div class="ttc" id="acme_8h_html_aa0ace1cae356bfb79245b65c0ae979d0"><div class="ttname"><a href="../../d6/d2a/cme_8h.html#aa0ace1cae356bfb79245b65c0ae979d0">SOUTH</a></div><div class="ttdeci">int const SOUTH</div><div class="ttdef"><b>Definition</b> <a href="../../d6/d2a/cme_8h_source.html#l00390">cme.h:390</a></div></div>
<div class="ttc" id="acme_8h_html_aa58b13ad2e88aaa20449bfea242396a4"><div class="ttname"><a href="../../d6/d2a/cme_8h.html#aa58b13ad2e88aaa20449bfea242396a4">LOG_FILE_ALL</a></div><div class="ttdeci">int const LOG_FILE_ALL</div><div class="ttdef"><b>Definition</b> <a href="../../d6/d2a/cme_8h_source.html#l00382">cme.h:382</a></div></div>
<div class="ttc" id="acme_8h_html_aa5fa4b2d0efc2ff0f4e02e27ea50208a"><div class="ttname"><a href="../../d6/d2a/cme_8h.html#aa5fa4b2d0efc2ff0f4e02e27ea50208a">EAST</a></div><div class="ttdeci">int const EAST</div><div class="ttdef"><b>Definition</b> <a href="../../d6/d2a/cme_8h_source.html#l00388">cme.h:388</a></div></div>
<div class="ttc" id="acme_8h_html_aa768cb14b5c6123ee95e6e4ebd9fe331"><div class="ttname"><a href="../../d6/d2a/cme_8h.html#aa768cb14b5c6123ee95e6e4ebd9fe331">RTN_OK</a></div><div class="ttdeci">int const RTN_OK</div><div class="ttdef"><b>Definition</b> <a href="../../d6/d2a/cme_8h_source.html#l00580">cme.h:580</a></div></div>
<div class="ttc" id="acme_8h_html_ab497d689de01cab8340289dad621722b"><div class="ttname"><a href="../../d6/d2a/cme_8h.html#ab497d689de01cab8340289dad621722b">NORTH_EAST</a></div><div class="ttdeci">int const NORTH_EAST</div><div class="ttdef"><b>Definition</b> <a href="../../d6/d2a/cme_8h_source.html#l00387">cme.h:387</a></div></div>
<div class="ttc" id="acme_8h_html_abe5cabe81fdbe153e73fd894b3794e50"><div class="ttname"><a href="../../d6/d2a/cme_8h.html#abe5cabe81fdbe153e73fd894b3794e50">DIRECTION_UPCOAST</a></div><div class="ttdeci">int const DIRECTION_UPCOAST</div><div class="ttdef"><b>Definition</b> <a href="../../d6/d2a/cme_8h_source.html#l00396">cme.h:396</a></div></div>
<div class="ttc" id="acme_8h_html_ac003bdff958dca839f5d274f15786e07"><div class="ttname"><a href="../../d6/d2a/cme_8h.html#ac003bdff958dca839f5d274f15786e07">DBL_NODATA</a></div><div class="ttdeci">double const DBL_NODATA</div><div class="ttdef"><b>Definition</b> <a href="../../d6/d2a/cme_8h_source.html#l00710">cme.h:710</a></div></div>
<div class="ttc" id="acme_8h_html_ad85dd413295e84546b22590de7eee7cb"><div class="ttname"><a href="../../d6/d2a/cme_8h.html#ad85dd413295e84546b22590de7eee7cb">BEACH_PROTECTION_HB_RATIO</a></div><div class="ttdeci">double const BEACH_PROTECTION_HB_RATIO</div><div class="ttdef"><b>Definition</b> <a href="../../d6/d2a/cme_8h_source.html#l00689">cme.h:689</a></div></div>
<div class="ttc" id="acme_8h_html_af8f1a513adfc4d40f536ff45f704e654"><div class="ttname"><a href="../../d6/d2a/cme_8h.html#af8f1a513adfc4d40f536ff45f704e654">NORTH</a></div><div class="ttdeci">int const NORTH</div><div class="ttdef"><b>Definition</b> <a href="../../d6/d2a/cme_8h_source.html#l00386">cme.h:386</a></div></div>
<div class="ttc" id="acme_8h_html_afeb3cef570a9344c7074258f3601b582"><div class="ttname"><a href="../../d6/d2a/cme_8h.html#afeb3cef570a9344c7074258f3601b582">WEST</a></div><div class="ttdeci">int const WEST</div><div class="ttdef"><b>Definition</b> <a href="../../d6/d2a/cme_8h_source.html#l00392">cme.h:392</a></div></div>
<div class="ttc" id="acoast_8h_html"><div class="ttname"><a href="../../de/d65/coast_8h.html">coast.h</a></div><div class="ttdoc">Contains CRWCoast definitions.</div></div>
<div class="ttc" id="ahermite__cubic_8cpp_html_ad696aa5baaf487b32cc0c3afdecd2b4b"><div class="ttname"><a href="../../dd/dfc/hermite__cubic_8cpp.html#ad696aa5baaf487b32cc0c3afdecd2b4b">hermite_cubic_spline_value</a></div><div class="ttdeci">void hermite_cubic_spline_value(int const nn, double *const xn, double *const fn, double *const dn, int const n, double *const x, double *f, double *d, double *s, double *t)</div><div class="ttdoc">This is part of a C++ library from http://people.sc.fsu.edu/~jburkardt/cpp_src/hermite_cubic/hermite_...</div><div class="ttdef"><b>Definition</b> <a href="../../dd/dfc/hermite__cubic_8cpp_source.html#l00343">hermite_cubic.cpp:343</a></div></div>
<div class="ttc" id="ahermite__cubic_8h_html"><div class="ttname"><a href="../../d7/d47/hermite__cubic_8h.html">hermite_cubic.h</a></div><div class="ttdoc">Definitions of some routines from the hermite_cubic library.</div></div>
<div class="ttc" id="ainterpolate_8cpp_html_aec8942141bf8fa2a69bacd12ee72cbd2"><div class="ttname"><a href="../../d7/d62/interpolate_8cpp.html#aec8942141bf8fa2a69bacd12ee72cbd2">dGetInterpolatedValue</a></div><div class="ttdeci">double dGetInterpolatedValue(vector&lt; double &gt; const *pVdXdata, vector&lt; double &gt; const *pVdYdata, double dX, bool bExtrapolate)</div><div class="ttdef"><b>Definition</b> <a href="../../d7/d62/interpolate_8cpp_source.html#l00036">interpolate.cpp:36</a></div></div>
<div class="ttc" id="ainterpolate_8h_html"><div class="ttname"><a href="../../df/dd3/interpolate_8h.html">interpolate.h</a></div><div class="ttdoc">Definitions of routines which return interpolated value at x from parallel arrays.</div></div>
<div class="ttc" id="asimulation_8h_html"><div class="ttname"><a href="../../dd/d6a/simulation_8h.html">simulation.h</a></div><div class="ttdoc">Contains CSimulation definitions.</div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="../../d6/db6/do__shore__platform__erosion_8cpp.html">do_shore_platform_erosion.cpp</a></li>
    <li class="footer">Generated on Tue Mar 25 2025 20:42:38 for CoastalME (Coastal Modelling Environment) by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.13.2 </li>
  </ul>
</div>
</body>
</html>
