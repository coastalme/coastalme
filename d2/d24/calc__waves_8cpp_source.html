<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.13.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>CoastalME (Coastal Modelling Environment): calc_waves.cpp Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<script type="text/javascript" src="../../clipboard.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../cookie.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">CoastalME (Coastal Modelling Environment)
   </div>
   <div id="projectbrief">Simulates the long-term behaviour of complex coastlines</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(1); });
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('d2/d24/calc__waves_8cpp_source.html','../../'); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">calc_waves.cpp</div></div>
</div><!--header-->
<div class="contents">
<a href="../../d2/d24/calc__waves_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a id="l00001" name="l00001"></a><span class="lineno">    1</span></div>
<div class="line"><a id="l00012" name="l00012"></a><span class="lineno">   12</span> </div>
<div class="line"><a id="l00013" name="l00013"></a><span class="lineno">   13</span><span class="comment">/*==============================================================================================================================</span></div>
<div class="line"><a id="l00014" name="l00014"></a><span class="lineno">   14</span><span class="comment"></span> </div>
<div class="line"><a id="l00015" name="l00015"></a><span class="lineno">   15</span><span class="comment">This file is part of CoastalME, the Coastal Modelling Environment.</span></div>
<div class="line"><a id="l00016" name="l00016"></a><span class="lineno">   16</span><span class="comment"></span> </div>
<div class="line"><a id="l00017" name="l00017"></a><span class="lineno">   17</span><span class="comment">CoastalME is free software; you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation; either version 3 of the License, or (at your option) any later version.</span></div>
<div class="line"><a id="l00018" name="l00018"></a><span class="lineno">   18</span><span class="comment"></span> </div>
<div class="line"><a id="l00019" name="l00019"></a><span class="lineno">   19</span><span class="comment">This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for more details.</span></div>
<div class="line"><a id="l00020" name="l00020"></a><span class="lineno">   20</span><span class="comment"></span> </div>
<div class="line"><a id="l00021" name="l00021"></a><span class="lineno">   21</span><span class="comment">You should have received a copy of the GNU General Public License along with this program; if not, write to the Free Software Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.</span></div>
<div class="line"><a id="l00022" name="l00022"></a><span class="lineno">   22</span><span class="comment"></span> </div>
<div class="line"><a id="l00023" name="l00023"></a><span class="lineno">   23</span><span class="comment">==============================================================================================================================*/</span></div>
<div class="line"><a id="l00024" name="l00024"></a><span class="lineno">   24</span><span class="preprocessor">#include &lt;assert.h&gt;</span></div>
<div class="line"><a id="l00025" name="l00025"></a><span class="lineno">   25</span> </div>
<div class="line"><a id="l00026" name="l00026"></a><span class="lineno">   26</span><span class="preprocessor">#include &lt;cmath&gt;</span></div>
<div class="line"><a id="l00027" name="l00027"></a><span class="lineno">   27</span><span class="keyword">using </span>std::isfinite;</div>
<div class="line"><a id="l00028" name="l00028"></a><span class="lineno">   28</span> </div>
<div class="line"><a id="l00029" name="l00029"></a><span class="lineno">   29</span><span class="preprocessor">#include &lt;unistd.h&gt;</span></div>
<div class="line"><a id="l00030" name="l00030"></a><span class="lineno">   30</span> </div>
<div class="line"><a id="l00031" name="l00031"></a><span class="lineno">   31</span><span class="preprocessor">#include &lt;string&gt;</span></div>
<div class="line"><a id="l00032" name="l00032"></a><span class="lineno">   32</span><span class="keyword">using </span>std::stoi;</div>
<div class="line"><a id="l00033" name="l00033"></a><span class="lineno">   33</span><span class="keyword">using </span>std::to_string;</div>
<div class="line"><a id="l00034" name="l00034"></a><span class="lineno">   34</span> </div>
<div class="line"><a id="l00035" name="l00035"></a><span class="lineno">   35</span><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"><a id="l00036" name="l00036"></a><span class="lineno">   36</span><span class="keyword">using </span>std::cerr;</div>
<div class="line"><a id="l00037" name="l00037"></a><span class="lineno">   37</span><span class="keyword">using </span>std::cout;</div>
<div class="line"><a id="l00038" name="l00038"></a><span class="lineno">   38</span><span class="keyword">using </span>std::endl;</div>
<div class="line"><a id="l00039" name="l00039"></a><span class="lineno">   39</span><span class="keyword">using </span>std::ifstream;</div>
<div class="line"><a id="l00040" name="l00040"></a><span class="lineno">   40</span><span class="keyword">using </span>std::ios;</div>
<div class="line"><a id="l00041" name="l00041"></a><span class="lineno">   41</span> </div>
<div class="line"><a id="l00042" name="l00042"></a><span class="lineno">   42</span><span class="preprocessor">#include &lt;iomanip&gt;</span></div>
<div class="line"><a id="l00043" name="l00043"></a><span class="lineno">   43</span><span class="keyword">using </span>std::resetiosflags;</div>
<div class="line"><a id="l00044" name="l00044"></a><span class="lineno">   44</span><span class="keyword">using </span>std::setiosflags;</div>
<div class="line"><a id="l00045" name="l00045"></a><span class="lineno">   45</span><span class="keyword">using </span>std::setprecision;</div>
<div class="line"><a id="l00046" name="l00046"></a><span class="lineno">   46</span><span class="keyword">using </span>std::setw;</div>
<div class="line"><a id="l00047" name="l00047"></a><span class="lineno">   47</span> </div>
<div class="line"><a id="l00048" name="l00048"></a><span class="lineno">   48</span><span class="preprocessor">#include &lt;algorithm&gt;</span></div>
<div class="line"><a id="l00049" name="l00049"></a><span class="lineno">   49</span><span class="keyword">using </span>std::remove;</div>
<div class="line"><a id="l00050" name="l00050"></a><span class="lineno">   50</span><span class="keyword">using </span>std::reverse_copy;</div>
<div class="line"><a id="l00051" name="l00051"></a><span class="lineno">   51</span><span class="keyword">using </span>std::sort;</div>
<div class="line"><a id="l00052" name="l00052"></a><span class="lineno">   52</span> </div>
<div class="line"><a id="l00053" name="l00053"></a><span class="lineno">   53</span><span class="preprocessor">#include &quot;<a class="code" href="../../d6/d2a/cme_8h.html">cme.h</a>&quot;</span></div>
<div class="line"><a id="l00054" name="l00054"></a><span class="lineno">   54</span><span class="preprocessor">#include &quot;<a class="code" href="../../de/d65/coast_8h.html">coast.h</a>&quot;</span></div>
<div class="line"><a id="l00055" name="l00055"></a><span class="lineno">   55</span><span class="preprocessor">#include &quot;<a class="code" href="../../dd/d6a/simulation_8h.html">simulation.h</a>&quot;</span></div>
<div class="line"><a id="l00056" name="l00056"></a><span class="lineno">   56</span> </div>
<div class="line"><a id="l00057" name="l00057"></a><span class="lineno">   57</span><span class="preprocessor">#include &quot;<a class="code" href="../../df/dd3/interpolate_8h.html">interpolate.h</a>&quot;</span></div>
<div class="line"><a id="l00058" name="l00058"></a><span class="lineno">   58</span> </div>
<div class="line"><a id="l00059" name="l00059"></a><span class="lineno">   59</span><span class="comment">//===============================================================================================================================</span></div>
<div class="line"><a id="l00061" name="l00061"></a><span class="lineno">   61</span><span class="comment">//===============================================================================================================================</span></div>
<div class="foldopen" id="foldopen00062" data-start="{" data-end="}">
<div class="line"><a id="l00062" name="l00062"></a><span class="lineno"><a class="line" href="../../d1/d98/classCSimulation.html#a97046956fb2a262a0c5d493715067527">   62</a></span><span class="keywordtype">int</span> <a class="code hl_function" href="../../d1/d98/classCSimulation.html#a97046956fb2a262a0c5d493715067527">CSimulation::nSetAllCoastpointDeepWaterWaveValues</a>(<span class="keywordtype">void</span>)</div>
<div class="line"><a id="l00063" name="l00063"></a><span class="lineno">   63</span>{</div>
<div class="line"><a id="l00064" name="l00064"></a><span class="lineno">   64</span>   <span class="comment">// For each coastline, put a value for deep water wave height and direction at each coastline point</span></div>
<div class="line"><a id="l00065" name="l00065"></a><span class="lineno">   65</span>   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> nCoast = 0; nCoast &lt; static_cast&lt;int&gt;(<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>.size()); nCoast++)</div>
<div class="line"><a id="l00066" name="l00066"></a><span class="lineno">   66</span>   {</div>
<div class="line"><a id="l00067" name="l00067"></a><span class="lineno">   67</span>      <span class="keywordtype">int</span> nDistFromPrevProfile = 0;</div>
<div class="line"><a id="l00068" name="l00068"></a><span class="lineno">   68</span>      <span class="keywordtype">int</span> nDistToNextProfile = 0;</div>
<div class="line"><a id="l00069" name="l00069"></a><span class="lineno">   69</span> </div>
<div class="line"><a id="l00070" name="l00070"></a><span class="lineno">   70</span>      <span class="keywordtype">double</span> dPrevProfileDeepWaterWaveHeight = 0;</div>
<div class="line"><a id="l00071" name="l00071"></a><span class="lineno">   71</span>      <span class="keywordtype">double</span> dPrevProfileDeepWaterWaveAngle = 0;</div>
<div class="line"><a id="l00072" name="l00072"></a><span class="lineno">   72</span>      <span class="keywordtype">double</span> dPrevProfileDeepWaterWavePeriod = 0;</div>
<div class="line"><a id="l00073" name="l00073"></a><span class="lineno">   73</span>      <span class="keywordtype">double</span> dNextProfileDeepWaterWaveHeight = 0;</div>
<div class="line"><a id="l00074" name="l00074"></a><span class="lineno">   74</span>      <span class="keywordtype">double</span> dNextProfileDeepWaterWaveAngle = 0;</div>
<div class="line"><a id="l00075" name="l00075"></a><span class="lineno">   75</span>      <span class="keywordtype">double</span> dNextProfileDeepWaterWavePeriod = 0;</div>
<div class="line"><a id="l00076" name="l00076"></a><span class="lineno">   76</span>      <span class="keywordtype">double</span> dDist = 0;</div>
<div class="line"><a id="l00077" name="l00077"></a><span class="lineno">   77</span> </div>
<div class="line"><a id="l00078" name="l00078"></a><span class="lineno">   78</span>      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> nPoint = 0; nPoint &lt; <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].nGetCoastlineSize(); nPoint++)</div>
<div class="line"><a id="l00079" name="l00079"></a><span class="lineno">   79</span>      {</div>
<div class="line"><a id="l00080" name="l00080"></a><span class="lineno">   80</span>         <span class="comment">// We are going down-coast</span></div>
<div class="line"><a id="l00081" name="l00081"></a><span class="lineno">   81</span>         <span class="keywordflow">if</span> (<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].bIsProfileAtCoastPoint(nPoint))</div>
<div class="line"><a id="l00082" name="l00082"></a><span class="lineno">   82</span>         {</div>
<div class="line"><a id="l00083" name="l00083"></a><span class="lineno">   83</span>            <span class="comment">// OK, a coastline-normal profile begins at this coastline point, so set the deep water wave values at this coastline point to be the values at the seaward end of the coastline normal</span></div>
<div class="line"><a id="l00084" name="l00084"></a><span class="lineno">   84</span>            <a class="code hl_class" href="../../da/dae/classCGeomProfile.html">CGeomProfile</a> <span class="keyword">const</span>* pProfile = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].pGetProfileAtCoastPoint(nPoint);</div>
<div class="line"><a id="l00085" name="l00085"></a><span class="lineno">   85</span>            <span class="comment">// int nProfile = pProfile-&gt;nGetCoastID();</span></div>
<div class="line"><a id="l00086" name="l00086"></a><span class="lineno">   86</span> </div>
<div class="line"><a id="l00087" name="l00087"></a><span class="lineno">   87</span>            <span class="keywordtype">double</span> dThisDeepWaterWaveHeight = pProfile-&gt;<a class="code hl_function" href="../../da/dae/classCGeomProfile.html#a25efa8fb09d83f8e50b82e90eb6c9a59">dGetProfileDeepWaterWaveHeight</a>();</div>
<div class="line"><a id="l00088" name="l00088"></a><span class="lineno">   88</span>            <span class="keywordtype">double</span> dThisDeepWaterWaveAngle = pProfile-&gt;<a class="code hl_function" href="../../da/dae/classCGeomProfile.html#a1efc4d74a49196572e58433ab05b5d86">dGetProfileDeepWaterWaveAngle</a>();</div>
<div class="line"><a id="l00089" name="l00089"></a><span class="lineno">   89</span>            <span class="keywordtype">double</span> dThisDeepWaterWavePeriod = pProfile-&gt;<a class="code hl_function" href="../../da/dae/classCGeomProfile.html#af21ee378022208ccdfdfa56178c3ee1b">dGetProfileDeepWaterWavePeriod</a>();</div>
<div class="line"><a id="l00090" name="l00090"></a><span class="lineno">   90</span> </div>
<div class="line"><a id="l00091" name="l00091"></a><span class="lineno">   91</span>            <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].SetCoastDeepWaterWaveHeight(nPoint, dThisDeepWaterWaveHeight);</div>
<div class="line"><a id="l00092" name="l00092"></a><span class="lineno">   92</span>            <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].SetCoastDeepWaterWaveAngle(nPoint, dThisDeepWaterWaveAngle);</div>
<div class="line"><a id="l00093" name="l00093"></a><span class="lineno">   93</span>            <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].SetCoastDeepWaterWavePeriod(nPoint, dThisDeepWaterWavePeriod);</div>
<div class="line"><a id="l00094" name="l00094"></a><span class="lineno">   94</span> </div>
<div class="line"><a id="l00095" name="l00095"></a><span class="lineno">   95</span>            <span class="comment">// Reset for next time</span></div>
<div class="line"><a id="l00096" name="l00096"></a><span class="lineno">   96</span>            nDistFromPrevProfile = 0;</div>
<div class="line"><a id="l00097" name="l00097"></a><span class="lineno">   97</span>            dPrevProfileDeepWaterWaveHeight = dThisDeepWaterWaveHeight;</div>
<div class="line"><a id="l00098" name="l00098"></a><span class="lineno">   98</span>            dPrevProfileDeepWaterWaveAngle = dThisDeepWaterWaveAngle;</div>
<div class="line"><a id="l00099" name="l00099"></a><span class="lineno">   99</span>            dPrevProfileDeepWaterWavePeriod = dThisDeepWaterWavePeriod;</div>
<div class="line"><a id="l00100" name="l00100"></a><span class="lineno">  100</span> </div>
<div class="line"><a id="l00101" name="l00101"></a><span class="lineno">  101</span>            <span class="comment">// Find the next profile</span></div>
<div class="line"><a id="l00102" name="l00102"></a><span class="lineno">  102</span>            <a class="code hl_class" href="../../da/dae/classCGeomProfile.html">CGeomProfile</a> <span class="keyword">const</span>* pNextProfile = pProfile-&gt;<a class="code hl_function" href="../../da/dae/classCGeomProfile.html#a60a83e788c19cfee1f79e44253e09fca">pGetDownCoastAdjacentProfile</a>();</div>
<div class="line"><a id="l00103" name="l00103"></a><span class="lineno">  103</span>            <span class="keywordflow">if</span> (pNextProfile == NULL)</div>
<div class="line"><a id="l00104" name="l00104"></a><span class="lineno">  104</span>            {</div>
<div class="line"><a id="l00105" name="l00105"></a><span class="lineno">  105</span>               <span class="comment">// We are at the end of the coast</span></div>
<div class="line"><a id="l00106" name="l00106"></a><span class="lineno">  106</span>               <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00107" name="l00107"></a><span class="lineno">  107</span>            }</div>
<div class="line"><a id="l00108" name="l00108"></a><span class="lineno">  108</span> </div>
<div class="line"><a id="l00109" name="l00109"></a><span class="lineno">  109</span>            <span class="comment">// And the distance (in along-coast points) to the next profile</span></div>
<div class="line"><a id="l00110" name="l00110"></a><span class="lineno">  110</span>            nDistToNextProfile = pNextProfile-&gt;<a class="code hl_function" href="../../da/dae/classCGeomProfile.html#a343fd2b73e3a87cf425572860e79ebd6">nGetCoastPoint</a>() - nPoint;</div>
<div class="line"><a id="l00111" name="l00111"></a><span class="lineno">  111</span>            dDist = nDistToNextProfile;</div>
<div class="line"><a id="l00112" name="l00112"></a><span class="lineno">  112</span> </div>
<div class="line"><a id="l00113" name="l00113"></a><span class="lineno">  113</span>            <span class="comment">// And the next profile&#39;s deep water wave values</span></div>
<div class="line"><a id="l00114" name="l00114"></a><span class="lineno">  114</span>            dNextProfileDeepWaterWaveHeight = pNextProfile-&gt;<a class="code hl_function" href="../../da/dae/classCGeomProfile.html#a25efa8fb09d83f8e50b82e90eb6c9a59">dGetProfileDeepWaterWaveHeight</a>();</div>
<div class="line"><a id="l00115" name="l00115"></a><span class="lineno">  115</span>            dNextProfileDeepWaterWaveAngle = pNextProfile-&gt;<a class="code hl_function" href="../../da/dae/classCGeomProfile.html#a1efc4d74a49196572e58433ab05b5d86">dGetProfileDeepWaterWaveAngle</a>();</div>
<div class="line"><a id="l00116" name="l00116"></a><span class="lineno">  116</span>            dNextProfileDeepWaterWavePeriod = pNextProfile-&gt;<a class="code hl_function" href="../../da/dae/classCGeomProfile.html#af21ee378022208ccdfdfa56178c3ee1b">dGetProfileDeepWaterWavePeriod</a>();</div>
<div class="line"><a id="l00117" name="l00117"></a><span class="lineno">  117</span> </div>
<div class="line"><a id="l00118" name="l00118"></a><span class="lineno">  118</span>            <span class="comment">// LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: coast point = &quot; &lt;&lt; nPoint &lt;&lt; &quot; is start of profile &quot; &lt;&lt; pProfile-&gt;nGetCoastID() &lt;&lt; &quot;, next profile is &quot; &lt;&lt; pNextProfile-&gt;nGetCoastID() &lt;&lt; &quot;, which starts at coast piint &quot; &lt;&lt; pNextProfile-&gt;nGetCoastPoint() &lt;&lt; &quot;, dThisDeepWaterWaveHeight = &quot; &lt;&lt; dThisDeepWaterWaveHeight &lt;&lt; &quot;, dThisDeepWaterWaveAngle = &quot; &lt;&lt; dThisDeepWaterWaveAngle &lt;&lt; &quot; nDistToNextProfile = &quot; &lt;&lt; nDistToNextProfile &lt;&lt; endl;</span></div>
<div class="line"><a id="l00119" name="l00119"></a><span class="lineno">  119</span>         }</div>
<div class="line"><a id="l00120" name="l00120"></a><span class="lineno">  120</span> </div>
<div class="line"><a id="l00121" name="l00121"></a><span class="lineno">  121</span>         <span class="keywordflow">else</span></div>
<div class="line"><a id="l00122" name="l00122"></a><span class="lineno">  122</span>         {</div>
<div class="line"><a id="l00123" name="l00123"></a><span class="lineno">  123</span>            <span class="comment">// This coast point is not the start of a coastline normal, so set the deep water wave values at this coastline point to be a weighted average of those from the up-coast and down-coast profiles</span></div>
<div class="line"><a id="l00124" name="l00124"></a><span class="lineno">  124</span>            nDistFromPrevProfile++;</div>
<div class="line"><a id="l00125" name="l00125"></a><span class="lineno">  125</span>            nDistToNextProfile--;</div>
<div class="line"><a id="l00126" name="l00126"></a><span class="lineno">  126</span> </div>
<div class="line"><a id="l00127" name="l00127"></a><span class="lineno">  127</span>            <span class="keywordtype">double</span> dPrevWeight = (dDist - nDistFromPrevProfile) / dDist;</div>
<div class="line"><a id="l00128" name="l00128"></a><span class="lineno">  128</span>            <span class="keywordtype">double</span> dNextWeight = (dDist - nDistToNextProfile) / dDist;</div>
<div class="line"><a id="l00129" name="l00129"></a><span class="lineno">  129</span>            <span class="keywordtype">double</span> dThisDeepWaterWaveHeight = (dPrevWeight * dPrevProfileDeepWaterWaveHeight) + (dNextWeight * dNextProfileDeepWaterWaveHeight);</div>
<div class="line"><a id="l00130" name="l00130"></a><span class="lineno">  130</span>            <span class="keywordtype">double</span> dThisDeepWaterWaveAngle = <a class="code hl_function" href="../../d1/d98/classCSimulation.html#a425803ba4110668094dba54c0f9b91c8">dKeepWithin360</a>((dPrevWeight * dPrevProfileDeepWaterWaveAngle) + (dNextWeight * dNextProfileDeepWaterWaveAngle));</div>
<div class="line"><a id="l00131" name="l00131"></a><span class="lineno">  131</span>            <span class="keywordtype">double</span> dThisDeepWaterWavePeriod = (dPrevWeight * dPrevProfileDeepWaterWavePeriod) + (dNextWeight * dNextProfileDeepWaterWavePeriod);</div>
<div class="line"><a id="l00132" name="l00132"></a><span class="lineno">  132</span> </div>
<div class="line"><a id="l00133" name="l00133"></a><span class="lineno">  133</span>            <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].SetCoastDeepWaterWaveHeight(nPoint, dThisDeepWaterWaveHeight);</div>
<div class="line"><a id="l00134" name="l00134"></a><span class="lineno">  134</span>            <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].SetCoastDeepWaterWaveAngle(nPoint, dThisDeepWaterWaveAngle);</div>
<div class="line"><a id="l00135" name="l00135"></a><span class="lineno">  135</span>            <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].SetCoastDeepWaterWavePeriod(nPoint, dThisDeepWaterWavePeriod);</div>
<div class="line"><a id="l00136" name="l00136"></a><span class="lineno">  136</span> </div>
<div class="line"><a id="l00137" name="l00137"></a><span class="lineno">  137</span>            <span class="comment">// LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: coast point = &quot; &lt;&lt; nPoint &lt;&lt; &quot; dThisDeepWaterWaveHeight = &quot; &lt;&lt; dThisDeepWaterWaveHeight &lt;&lt; &quot; dThisDeepWaterWaveAngle = &quot; &lt;&lt; dThisDeepWaterWaveAngle &lt;&lt; &quot; nDistFromPrevProfile = &quot; &lt;&lt; nDistFromPrevProfile &lt;&lt; &quot; nDistToNextProfile = &quot; &lt;&lt; nDistToNextProfile &lt;&lt; endl;</span></div>
<div class="line"><a id="l00138" name="l00138"></a><span class="lineno">  138</span>         }</div>
<div class="line"><a id="l00139" name="l00139"></a><span class="lineno">  139</span>      }</div>
<div class="line"><a id="l00140" name="l00140"></a><span class="lineno">  140</span>   }</div>
<div class="line"><a id="l00141" name="l00141"></a><span class="lineno">  141</span> </div>
<div class="line"><a id="l00142" name="l00142"></a><span class="lineno">  142</span>   <span class="keywordflow">return</span> <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#aa768cb14b5c6123ee95e6e4ebd9fe331">RTN_OK</a>;</div>
<div class="line"><a id="l00143" name="l00143"></a><span class="lineno">  143</span>}</div>
</div>
<div class="line"><a id="l00144" name="l00144"></a><span class="lineno">  144</span> </div>
<div class="line"><a id="l00145" name="l00145"></a><span class="lineno">  145</span><span class="comment">//===============================================================================================================================</span></div>
<div class="line"><a id="l00147" name="l00147"></a><span class="lineno">  147</span><span class="comment">//===============================================================================================================================</span></div>
<div class="foldopen" id="foldopen00148" data-start="{" data-end="}">
<div class="line"><a id="l00148" name="l00148"></a><span class="lineno"><a class="line" href="../../d1/d98/classCSimulation.html#ae04e84f9461df12f7ee89764aad2ebcf">  148</a></span><span class="keywordtype">int</span> <a class="code hl_function" href="../../d1/d98/classCSimulation.html#ae04e84f9461df12f7ee89764aad2ebcf">CSimulation::nDoAllPropagateWaves</a>(<span class="keywordtype">void</span>)</div>
<div class="line"><a id="l00149" name="l00149"></a><span class="lineno">  149</span>{</div>
<div class="line"><a id="l00150" name="l00150"></a><span class="lineno">  150</span>   <span class="comment">// Set up all-profile vectors to hold the wave attribute data at every profile point on all profiles</span></div>
<div class="line"><a id="l00151" name="l00151"></a><span class="lineno">  151</span>   vector&lt;bool&gt; VbBreakingAll;</div>
<div class="line"><a id="l00152" name="l00152"></a><span class="lineno">  152</span> </div>
<div class="line"><a id="l00153" name="l00153"></a><span class="lineno">  153</span>   vector&lt;double&gt; VdXAll;</div>
<div class="line"><a id="l00154" name="l00154"></a><span class="lineno">  154</span>   vector&lt;double&gt; VdYAll;</div>
<div class="line"><a id="l00155" name="l00155"></a><span class="lineno">  155</span>   vector&lt;double&gt; VdHeightXAll;</div>
<div class="line"><a id="l00156" name="l00156"></a><span class="lineno">  156</span>   vector&lt;double&gt; VdHeightYAll;</div>
<div class="line"><a id="l00157" name="l00157"></a><span class="lineno">  157</span> </div>
<div class="line"><a id="l00158" name="l00158"></a><span class="lineno">  158</span>   <span class="comment">// Calculate wave properties for every coast</span></div>
<div class="line"><a id="l00159" name="l00159"></a><span class="lineno">  159</span>   <span class="keywordtype">bool</span> bSomeNonStartOrEndOfCoastProfiles = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00160" name="l00160"></a><span class="lineno">  160</span>   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> nCoast = 0; nCoast &lt; static_cast&lt;int&gt;(<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>.size()); nCoast++)</div>
<div class="line"><a id="l00161" name="l00161"></a><span class="lineno">  161</span>   {</div>
<div class="line"><a id="l00162" name="l00162"></a><span class="lineno">  162</span>      <span class="keywordtype">int</span> nCoastSize = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].nGetCoastlineSize();</div>
<div class="line"><a id="l00163" name="l00163"></a><span class="lineno">  163</span>      <span class="keywordtype">int</span> nNumProfiles = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].nGetNumProfiles();</div>
<div class="line"><a id="l00164" name="l00164"></a><span class="lineno">  164</span> </div>
<div class="line"><a id="l00165" name="l00165"></a><span class="lineno">  165</span>      <span class="keyword">static</span> <span class="keywordtype">bool</span> bDownCoast = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00166" name="l00166"></a><span class="lineno">  166</span> </div>
<div class="line"><a id="l00167" name="l00167"></a><span class="lineno">  167</span>      <span class="comment">// Calculate wave properties at every point along each valid profile, and for the cells under the profiles. Do this alternately in up-coast and down-coast sequence</span></div>
<div class="line"><a id="l00168" name="l00168"></a><span class="lineno">  168</span>      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> nn = 0; nn &lt; nNumProfiles; nn++)</div>
<div class="line"><a id="l00169" name="l00169"></a><span class="lineno">  169</span>      {</div>
<div class="line"><a id="l00170" name="l00170"></a><span class="lineno">  170</span>         vector&lt;bool&gt; VbBreaking;</div>
<div class="line"><a id="l00171" name="l00171"></a><span class="lineno">  171</span>         vector&lt;double&gt; VdX;</div>
<div class="line"><a id="l00172" name="l00172"></a><span class="lineno">  172</span>         vector&lt;double&gt; VdY;</div>
<div class="line"><a id="l00173" name="l00173"></a><span class="lineno">  173</span>         vector&lt;double&gt; VdHeightX;</div>
<div class="line"><a id="l00174" name="l00174"></a><span class="lineno">  174</span>         vector&lt;double&gt; VdHeightY;</div>
<div class="line"><a id="l00175" name="l00175"></a><span class="lineno">  175</span> </div>
<div class="line"><a id="l00176" name="l00176"></a><span class="lineno">  176</span>         <a class="code hl_class" href="../../da/dae/classCGeomProfile.html">CGeomProfile</a>* pProfile;</div>
<div class="line"><a id="l00177" name="l00177"></a><span class="lineno">  177</span> </div>
<div class="line"><a id="l00178" name="l00178"></a><span class="lineno">  178</span>         <span class="keywordflow">if</span> (bDownCoast)</div>
<div class="line"><a id="l00179" name="l00179"></a><span class="lineno">  179</span>            pProfile = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].pGetProfileWithDownCoastSeq(nn);</div>
<div class="line"><a id="l00180" name="l00180"></a><span class="lineno">  180</span>         <span class="keywordflow">else</span></div>
<div class="line"><a id="l00181" name="l00181"></a><span class="lineno">  181</span>            pProfile = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].pGetProfileWithUpCoastSeq(nn);</div>
<div class="line"><a id="l00182" name="l00182"></a><span class="lineno">  182</span> </div>
<div class="line"><a id="l00183" name="l00183"></a><span class="lineno">  183</span>         <span class="keywordtype">int</span> nRet = <a class="code hl_function" href="../../d1/d98/classCSimulation.html#a1467ae7c46f92c9cd09dd8bcb683a485">nCalcWavePropertiesOnProfile</a>(nCoast, nCoastSize, pProfile, &amp;VdX, &amp;VdY, &amp;VdHeightX, &amp;VdHeightY, &amp;VbBreaking);</div>
<div class="line"><a id="l00184" name="l00184"></a><span class="lineno">  184</span>         <span class="keywordflow">if</span> (nRet != <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#aa768cb14b5c6123ee95e6e4ebd9fe331">RTN_OK</a>)</div>
<div class="line"><a id="l00185" name="l00185"></a><span class="lineno">  185</span>         {</div>
<div class="line"><a id="l00186" name="l00186"></a><span class="lineno">  186</span>            <span class="keywordflow">if</span> (nRet == <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a60017818ee26e96bf8826ef74a3cf324">RTN_ERR_CSHORE_ERROR</a>)</div>
<div class="line"><a id="l00187" name="l00187"></a><span class="lineno">  187</span>            {</div>
<div class="line"><a id="l00188" name="l00188"></a><span class="lineno">  188</span>               <span class="comment">// Abandon calculations on this profile, and flag the profile</span></div>
<div class="line"><a id="l00189" name="l00189"></a><span class="lineno">  189</span>               pProfile-&gt;<a class="code hl_function" href="../../da/dae/classCGeomProfile.html#aa7a610faab536f4f0c30ca2cbc8abebb">SetCShoreProblem</a>(<span class="keyword">true</span>);</div>
<div class="line"><a id="l00190" name="l00190"></a><span class="lineno">  190</span> </div>
<div class="line"><a id="l00191" name="l00191"></a><span class="lineno">  191</span>               <span class="comment">// Move on to next profile</span></div>
<div class="line"><a id="l00192" name="l00192"></a><span class="lineno">  192</span>               <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l00193" name="l00193"></a><span class="lineno">  193</span>            }</div>
<div class="line"><a id="l00194" name="l00194"></a><span class="lineno">  194</span>            <span class="keywordflow">else</span></div>
<div class="line"><a id="l00195" name="l00195"></a><span class="lineno">  195</span>            {</div>
<div class="line"><a id="l00196" name="l00196"></a><span class="lineno">  196</span>               <span class="comment">// A serious CShore error, so abort the run</span></div>
<div class="line"><a id="l00197" name="l00197"></a><span class="lineno">  197</span>               <span class="keywordflow">return</span> nRet;</div>
<div class="line"><a id="l00198" name="l00198"></a><span class="lineno">  198</span>            }</div>
<div class="line"><a id="l00199" name="l00199"></a><span class="lineno">  199</span>         }</div>
<div class="line"><a id="l00200" name="l00200"></a><span class="lineno">  200</span> </div>
<div class="line"><a id="l00201" name="l00201"></a><span class="lineno">  201</span>         <span class="comment">// Are the waves off-shore? If so, do nothing more with this profile. The wave values for cells have already been given the off-shore value</span></div>
<div class="line"><a id="l00202" name="l00202"></a><span class="lineno">  202</span>         <span class="keywordflow">if</span> (VbBreaking.empty())</div>
<div class="line"><a id="l00203" name="l00203"></a><span class="lineno">  203</span>            <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l00204" name="l00204"></a><span class="lineno">  204</span> </div>
<div class="line"><a id="l00205" name="l00205"></a><span class="lineno">  205</span>         <span class="comment">// Is this a start of coast or end of coast profile?</span></div>
<div class="line"><a id="l00206" name="l00206"></a><span class="lineno">  206</span>         <span class="keywordflow">if</span> ((! pProfile-&gt;<a class="code hl_function" href="../../da/dae/classCGeomProfile.html#ac591314b290b032ffc8a70d22df64ec0">bStartOfCoast</a>()) &amp;&amp; (! pProfile-&gt;<a class="code hl_function" href="../../da/dae/classCGeomProfile.html#aec35bc03fc47a65349def96364c99bbd">bEndOfCoast</a>()))</div>
<div class="line"><a id="l00207" name="l00207"></a><span class="lineno">  207</span>         {</div>
<div class="line"><a id="l00208" name="l00208"></a><span class="lineno">  208</span>            <span class="comment">// It is neither a start of coast or an end of coast profile, so set switch</span></div>
<div class="line"><a id="l00209" name="l00209"></a><span class="lineno">  209</span>            bSomeNonStartOrEndOfCoastProfiles = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00210" name="l00210"></a><span class="lineno">  210</span>         }</div>
<div class="line"><a id="l00211" name="l00211"></a><span class="lineno">  211</span> </div>
<div class="line"><a id="l00212" name="l00212"></a><span class="lineno">  212</span>         <span class="comment">// // DEBUG CODE ===============================================================================================</span></div>
<div class="line"><a id="l00213" name="l00213"></a><span class="lineno">  213</span>         <span class="comment">// for (int nn = 0; nn &lt; VdX.size(); nn++)</span></div>
<div class="line"><a id="l00214" name="l00214"></a><span class="lineno">  214</span>         <span class="comment">// {</span></div>
<div class="line"><a id="l00215" name="l00215"></a><span class="lineno">  215</span>         <span class="comment">//    LogStream &lt;&lt; &quot;nProfile = &quot; &lt;&lt; nProfile &lt;&lt; &quot; nn = &quot; &lt;&lt; nn &lt;&lt; &quot; VdX[nn] = &quot; &lt;&lt; VdX[nn] &lt;&lt; &quot; VdY[nn] = &quot; &lt;&lt; VdY[nn] &lt;&lt; &quot; VdHeightX[nn] = &quot; &lt;&lt; VdHeightX[nn] &lt;&lt; &quot; VdHeightY[nn] = &quot; &lt;&lt; VdHeightY[nn] &lt;&lt; &quot; VbBreaking[nn] = &quot; &lt;&lt; VbBreaking[nn] &lt;&lt; endl;</span></div>
<div class="line"><a id="l00216" name="l00216"></a><span class="lineno">  216</span>         <span class="comment">// }</span></div>
<div class="line"><a id="l00217" name="l00217"></a><span class="lineno">  217</span>         <span class="comment">// LogStream &lt;&lt; endl;</span></div>
<div class="line"><a id="l00218" name="l00218"></a><span class="lineno">  218</span>         <span class="comment">// // DEBUG CODE ===============================================================================================</span></div>
<div class="line"><a id="l00219" name="l00219"></a><span class="lineno">  219</span> </div>
<div class="line"><a id="l00220" name="l00220"></a><span class="lineno">  220</span>         <span class="comment">// Append to the all-profile vectors</span></div>
<div class="line"><a id="l00221" name="l00221"></a><span class="lineno">  221</span>         VdXAll.insert(VdXAll.end(), VdX.begin(), VdX.end());</div>
<div class="line"><a id="l00222" name="l00222"></a><span class="lineno">  222</span>         VdYAll.insert(VdYAll.end(), VdY.begin(), VdY.end());</div>
<div class="line"><a id="l00223" name="l00223"></a><span class="lineno">  223</span>         VdHeightXAll.insert(VdHeightXAll.end(), VdHeightX.begin(), VdHeightX.end());</div>
<div class="line"><a id="l00224" name="l00224"></a><span class="lineno">  224</span>         VdHeightYAll.insert(VdHeightYAll.end(), VdHeightY.begin(), VdHeightY.end());</div>
<div class="line"><a id="l00225" name="l00225"></a><span class="lineno">  225</span>         VbBreakingAll.insert(VbBreakingAll.end(), VbBreaking.begin(), VbBreaking.end());</div>
<div class="line"><a id="l00226" name="l00226"></a><span class="lineno">  226</span>      }</div>
<div class="line"><a id="l00227" name="l00227"></a><span class="lineno">  227</span> </div>
<div class="line"><a id="l00228" name="l00228"></a><span class="lineno">  228</span>      bDownCoast = ! bDownCoast;</div>
<div class="line"><a id="l00229" name="l00229"></a><span class="lineno">  229</span>   }</div>
<div class="line"><a id="l00230" name="l00230"></a><span class="lineno">  230</span> </div>
<div class="line"><a id="l00231" name="l00231"></a><span class="lineno">  231</span>   <span class="comment">// OK, do we have some profiles other than start of coast or end of coast profiles in the all-profile vectors? We need to check this, because GDALGridCreate() in nInterpolateWavePropertiesToWithinPolygonCells() does not work if we give it only a start-of-coast or an end-of-coast profile to work with TODO 006 Is this still true?</span></div>
<div class="line"><a id="l00232" name="l00232"></a><span class="lineno">  232</span>   <span class="keywordflow">if</span> (! bSomeNonStartOrEndOfCoastProfiles)</div>
<div class="line"><a id="l00233" name="l00233"></a><span class="lineno">  233</span>   {</div>
<div class="line"><a id="l00234" name="l00234"></a><span class="lineno">  234</span>      <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a222962121613613a48f518e0c2110f21">LogStream</a> &lt;&lt; <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#ad67e8c5b30a0572f64ecfb5c062c2edc">m_ulIter</a> &lt;&lt; <span class="stringliteral">&quot;: waves are on-shore only, for start and/or end of coast profiles&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a id="l00235" name="l00235"></a><span class="lineno">  235</span> </div>
<div class="line"><a id="l00236" name="l00236"></a><span class="lineno">  236</span>      <span class="keywordflow">return</span> <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#aa768cb14b5c6123ee95e6e4ebd9fe331">RTN_OK</a>;</div>
<div class="line"><a id="l00237" name="l00237"></a><span class="lineno">  237</span>   }</div>
<div class="line"><a id="l00238" name="l00238"></a><span class="lineno">  238</span> </div>
<div class="line"><a id="l00239" name="l00239"></a><span class="lineno">  239</span>   <span class="comment">// We need to also send the deepwater points from the edge of the grid to nInterpolateWavePropertiesToWithinPolygonCells(), this is necessary to prevent GDALGridCreate() leaving holes in the interpolated grid when the polygons are far from regular</span></div>
<div class="line"><a id="l00240" name="l00240"></a><span class="lineno">  240</span>   <span class="keywordtype">double</span> dDeepWaterWaveX;</div>
<div class="line"><a id="l00241" name="l00241"></a><span class="lineno">  241</span>   <span class="keywordtype">double</span> dDeepWaterWaveY;</div>
<div class="line"><a id="l00242" name="l00242"></a><span class="lineno">  242</span> </div>
<div class="line"><a id="l00243" name="l00243"></a><span class="lineno">  243</span>   <span class="keywordflow">if</span> (<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a2963505fabb1d12ef0d3e9de2efd35dc">m_bSingleDeepWaterWaveValues</a>)</div>
<div class="line"><a id="l00244" name="l00244"></a><span class="lineno">  244</span>   {</div>
<div class="line"><a id="l00245" name="l00245"></a><span class="lineno">  245</span>      <span class="comment">// Just using the same value of deep water wave hehght and angle for all cells</span></div>
<div class="line"><a id="l00246" name="l00246"></a><span class="lineno">  246</span>      dDeepWaterWaveX = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a045629fd82b44f7aa4544f95d4500831">m_dAllCellsDeepWaterWaveHeight</a> * sin(<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a8483ca176ba8397ba19f763e8406bf21">m_dAllCellsDeepWaterWaveAngle</a> * <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a5d502a06fdd71825be49e07c95496b16">PI</a> / 180),</div>
<div class="line"><a id="l00247" name="l00247"></a><span class="lineno">  247</span>      dDeepWaterWaveY = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a045629fd82b44f7aa4544f95d4500831">m_dAllCellsDeepWaterWaveHeight</a> * cos(<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a8483ca176ba8397ba19f763e8406bf21">m_dAllCellsDeepWaterWaveAngle</a> * <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a5d502a06fdd71825be49e07c95496b16">PI</a> / 180);</div>
<div class="line"><a id="l00248" name="l00248"></a><span class="lineno">  248</span>   }</div>
<div class="line"><a id="l00249" name="l00249"></a><span class="lineno">  249</span> </div>
<div class="line"><a id="l00250" name="l00250"></a><span class="lineno">  250</span>   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> nX = 0; nX &lt; <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1652253500dab35e6f6f9f734207e20b">m_nXGridSize</a>; nX++)</div>
<div class="line"><a id="l00251" name="l00251"></a><span class="lineno">  251</span>   {</div>
<div class="line"><a id="l00252" name="l00252"></a><span class="lineno">  252</span>      <span class="keywordflow">if</span> (<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nX][0].bIsInContiguousSea())</div>
<div class="line"><a id="l00253" name="l00253"></a><span class="lineno">  253</span>      {</div>
<div class="line"><a id="l00254" name="l00254"></a><span class="lineno">  254</span>         <span class="keywordtype">int</span> nID = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nX][0].nGetPolygonID();</div>
<div class="line"><a id="l00255" name="l00255"></a><span class="lineno">  255</span>         <span class="keywordflow">if</span> (nID == <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a01aa8b423260b337ddff2016107b51a0">INT_NODATA</a>)</div>
<div class="line"><a id="l00256" name="l00256"></a><span class="lineno">  256</span>         {</div>
<div class="line"><a id="l00257" name="l00257"></a><span class="lineno">  257</span>            <span class="comment">// Not in a polygon</span></div>
<div class="line"><a id="l00258" name="l00258"></a><span class="lineno">  258</span>            VdXAll.push_back(nX);</div>
<div class="line"><a id="l00259" name="l00259"></a><span class="lineno">  259</span>            VdYAll.push_back(0);</div>
<div class="line"><a id="l00260" name="l00260"></a><span class="lineno">  260</span> </div>
<div class="line"><a id="l00261" name="l00261"></a><span class="lineno">  261</span>            <span class="keywordflow">if</span> (! <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a2963505fabb1d12ef0d3e9de2efd35dc">m_bSingleDeepWaterWaveValues</a>)</div>
<div class="line"><a id="l00262" name="l00262"></a><span class="lineno">  262</span>            {</div>
<div class="line"><a id="l00263" name="l00263"></a><span class="lineno">  263</span>               <span class="comment">// Not using the same value of deep water height and angle for all cells, so get this cell&#39;s deep water height and angle values</span></div>
<div class="line"><a id="l00264" name="l00264"></a><span class="lineno">  264</span>               dDeepWaterWaveX = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nX][0].dGetCellDeepWaterWaveHeight() * sin(<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nX][0].dGetCellDeepWaterWaveAngle() * <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a5d502a06fdd71825be49e07c95496b16">PI</a> / 180);</div>
<div class="line"><a id="l00265" name="l00265"></a><span class="lineno">  265</span>               dDeepWaterWaveY = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nX][0].dGetCellDeepWaterWaveHeight() * cos(<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nX][0].dGetCellDeepWaterWaveAngle() * <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a5d502a06fdd71825be49e07c95496b16">PI</a> / 180);</div>
<div class="line"><a id="l00266" name="l00266"></a><span class="lineno">  266</span>            }</div>
<div class="line"><a id="l00267" name="l00267"></a><span class="lineno">  267</span> </div>
<div class="line"><a id="l00268" name="l00268"></a><span class="lineno">  268</span>            VdHeightXAll.push_back(dDeepWaterWaveX);</div>
<div class="line"><a id="l00269" name="l00269"></a><span class="lineno">  269</span>            VdHeightYAll.push_back(dDeepWaterWaveY);</div>
<div class="line"><a id="l00270" name="l00270"></a><span class="lineno">  270</span>         }</div>
<div class="line"><a id="l00271" name="l00271"></a><span class="lineno">  271</span>      }</div>
<div class="line"><a id="l00272" name="l00272"></a><span class="lineno">  272</span> </div>
<div class="line"><a id="l00273" name="l00273"></a><span class="lineno">  273</span>      <span class="keywordflow">if</span> (<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nX][<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a3755fdc07c0ac9f2ce6c2237cfef50ce">m_nYGridSize</a> - 1].bIsInContiguousSea())</div>
<div class="line"><a id="l00274" name="l00274"></a><span class="lineno">  274</span>      {</div>
<div class="line"><a id="l00275" name="l00275"></a><span class="lineno">  275</span>         <span class="keywordtype">int</span> nID = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nX][<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a3755fdc07c0ac9f2ce6c2237cfef50ce">m_nYGridSize</a> - 1].nGetPolygonID();</div>
<div class="line"><a id="l00276" name="l00276"></a><span class="lineno">  276</span>         <span class="keywordflow">if</span> (nID == <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a01aa8b423260b337ddff2016107b51a0">INT_NODATA</a>)</div>
<div class="line"><a id="l00277" name="l00277"></a><span class="lineno">  277</span>         {</div>
<div class="line"><a id="l00278" name="l00278"></a><span class="lineno">  278</span>            <span class="comment">// Not in a polygon</span></div>
<div class="line"><a id="l00279" name="l00279"></a><span class="lineno">  279</span>            VdXAll.push_back(nX);</div>
<div class="line"><a id="l00280" name="l00280"></a><span class="lineno">  280</span>            VdYAll.push_back(<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a3755fdc07c0ac9f2ce6c2237cfef50ce">m_nYGridSize</a> - 1);</div>
<div class="line"><a id="l00281" name="l00281"></a><span class="lineno">  281</span> </div>
<div class="line"><a id="l00282" name="l00282"></a><span class="lineno">  282</span>            <span class="keywordflow">if</span> (! <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a2963505fabb1d12ef0d3e9de2efd35dc">m_bSingleDeepWaterWaveValues</a>)</div>
<div class="line"><a id="l00283" name="l00283"></a><span class="lineno">  283</span>            {</div>
<div class="line"><a id="l00284" name="l00284"></a><span class="lineno">  284</span>               <span class="comment">// Not using the same value of deep water height and angle for all cells, so get this cell&#39;s deep water height and angle values</span></div>
<div class="line"><a id="l00285" name="l00285"></a><span class="lineno">  285</span>               dDeepWaterWaveX = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nX][<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a3755fdc07c0ac9f2ce6c2237cfef50ce">m_nYGridSize</a> - 1].dGetCellDeepWaterWaveHeight() * sin(<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nX][<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a3755fdc07c0ac9f2ce6c2237cfef50ce">m_nYGridSize</a> - 1].dGetCellDeepWaterWaveAngle() * <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a5d502a06fdd71825be49e07c95496b16">PI</a> / 180);</div>
<div class="line"><a id="l00286" name="l00286"></a><span class="lineno">  286</span>               dDeepWaterWaveY = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nX][<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a3755fdc07c0ac9f2ce6c2237cfef50ce">m_nYGridSize</a> - 1].dGetCellDeepWaterWaveHeight() * cos(<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nX][<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a3755fdc07c0ac9f2ce6c2237cfef50ce">m_nYGridSize</a> - 1].dGetCellDeepWaterWaveAngle() * <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a5d502a06fdd71825be49e07c95496b16">PI</a> / 180);</div>
<div class="line"><a id="l00287" name="l00287"></a><span class="lineno">  287</span>            }</div>
<div class="line"><a id="l00288" name="l00288"></a><span class="lineno">  288</span> </div>
<div class="line"><a id="l00289" name="l00289"></a><span class="lineno">  289</span>            VdHeightXAll.push_back(dDeepWaterWaveX);</div>
<div class="line"><a id="l00290" name="l00290"></a><span class="lineno">  290</span>            VdHeightYAll.push_back(dDeepWaterWaveY);</div>
<div class="line"><a id="l00291" name="l00291"></a><span class="lineno">  291</span>         }</div>
<div class="line"><a id="l00292" name="l00292"></a><span class="lineno">  292</span>      }</div>
<div class="line"><a id="l00293" name="l00293"></a><span class="lineno">  293</span>   }</div>
<div class="line"><a id="l00294" name="l00294"></a><span class="lineno">  294</span> </div>
<div class="line"><a id="l00295" name="l00295"></a><span class="lineno">  295</span>   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> nY = 0; nY &lt; <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a3755fdc07c0ac9f2ce6c2237cfef50ce">m_nYGridSize</a>; nY++)</div>
<div class="line"><a id="l00296" name="l00296"></a><span class="lineno">  296</span>   {</div>
<div class="line"><a id="l00297" name="l00297"></a><span class="lineno">  297</span>      <span class="keywordflow">if</span> (<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[0][nY].bIsInContiguousSea())</div>
<div class="line"><a id="l00298" name="l00298"></a><span class="lineno">  298</span>      {</div>
<div class="line"><a id="l00299" name="l00299"></a><span class="lineno">  299</span>         <span class="keywordtype">int</span> nID = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[0][nY].nGetPolygonID();</div>
<div class="line"><a id="l00300" name="l00300"></a><span class="lineno">  300</span>         <span class="keywordflow">if</span> (nID == <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a01aa8b423260b337ddff2016107b51a0">INT_NODATA</a>)</div>
<div class="line"><a id="l00301" name="l00301"></a><span class="lineno">  301</span>         {</div>
<div class="line"><a id="l00302" name="l00302"></a><span class="lineno">  302</span>            <span class="comment">// Not in a polygon</span></div>
<div class="line"><a id="l00303" name="l00303"></a><span class="lineno">  303</span>            VdXAll.push_back(0);</div>
<div class="line"><a id="l00304" name="l00304"></a><span class="lineno">  304</span>            VdYAll.push_back(nY);</div>
<div class="line"><a id="l00305" name="l00305"></a><span class="lineno">  305</span> </div>
<div class="line"><a id="l00306" name="l00306"></a><span class="lineno">  306</span>            <span class="keywordflow">if</span> (! <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a2963505fabb1d12ef0d3e9de2efd35dc">m_bSingleDeepWaterWaveValues</a>)</div>
<div class="line"><a id="l00307" name="l00307"></a><span class="lineno">  307</span>            {</div>
<div class="line"><a id="l00308" name="l00308"></a><span class="lineno">  308</span>               <span class="comment">// Not using the same value of deep water height and angle for all cells, so get this cell&#39;s deep water height and angle values</span></div>
<div class="line"><a id="l00309" name="l00309"></a><span class="lineno">  309</span>               dDeepWaterWaveX = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[0][nY].dGetCellDeepWaterWaveHeight() * sin(<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[0][nY].dGetCellDeepWaterWaveAngle() * <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a5d502a06fdd71825be49e07c95496b16">PI</a> / 180);</div>
<div class="line"><a id="l00310" name="l00310"></a><span class="lineno">  310</span>               dDeepWaterWaveY = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[0][nY].dGetCellDeepWaterWaveHeight() * cos(<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[0][nY].dGetCellDeepWaterWaveAngle() * <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a5d502a06fdd71825be49e07c95496b16">PI</a> / 180);</div>
<div class="line"><a id="l00311" name="l00311"></a><span class="lineno">  311</span>            }</div>
<div class="line"><a id="l00312" name="l00312"></a><span class="lineno">  312</span> </div>
<div class="line"><a id="l00313" name="l00313"></a><span class="lineno">  313</span>            VdHeightXAll.push_back(dDeepWaterWaveX);</div>
<div class="line"><a id="l00314" name="l00314"></a><span class="lineno">  314</span>            VdHeightYAll.push_back(dDeepWaterWaveY);</div>
<div class="line"><a id="l00315" name="l00315"></a><span class="lineno">  315</span>         }</div>
<div class="line"><a id="l00316" name="l00316"></a><span class="lineno">  316</span>      }</div>
<div class="line"><a id="l00317" name="l00317"></a><span class="lineno">  317</span> </div>
<div class="line"><a id="l00318" name="l00318"></a><span class="lineno">  318</span>      <span class="keywordflow">if</span> (<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1652253500dab35e6f6f9f734207e20b">m_nXGridSize</a> - 1][nY].bIsInContiguousSea())</div>
<div class="line"><a id="l00319" name="l00319"></a><span class="lineno">  319</span>      {</div>
<div class="line"><a id="l00320" name="l00320"></a><span class="lineno">  320</span>         <span class="keywordtype">int</span> nID = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1652253500dab35e6f6f9f734207e20b">m_nXGridSize</a> - 1][nY].nGetPolygonID();</div>
<div class="line"><a id="l00321" name="l00321"></a><span class="lineno">  321</span>         <span class="keywordflow">if</span> (nID == <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a01aa8b423260b337ddff2016107b51a0">INT_NODATA</a>)</div>
<div class="line"><a id="l00322" name="l00322"></a><span class="lineno">  322</span>         {</div>
<div class="line"><a id="l00323" name="l00323"></a><span class="lineno">  323</span>            <span class="comment">// Not in a polygon</span></div>
<div class="line"><a id="l00324" name="l00324"></a><span class="lineno">  324</span>            VdXAll.push_back(<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1652253500dab35e6f6f9f734207e20b">m_nXGridSize</a> - 1);</div>
<div class="line"><a id="l00325" name="l00325"></a><span class="lineno">  325</span>            VdYAll.push_back(nY);</div>
<div class="line"><a id="l00326" name="l00326"></a><span class="lineno">  326</span> </div>
<div class="line"><a id="l00327" name="l00327"></a><span class="lineno">  327</span>            <span class="keywordflow">if</span> (! <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a2963505fabb1d12ef0d3e9de2efd35dc">m_bSingleDeepWaterWaveValues</a>)</div>
<div class="line"><a id="l00328" name="l00328"></a><span class="lineno">  328</span>            {</div>
<div class="line"><a id="l00329" name="l00329"></a><span class="lineno">  329</span>               <span class="comment">// Not using the same value of deep water height and angle for all cells, so get this cell&#39;s deep water height and angle values</span></div>
<div class="line"><a id="l00330" name="l00330"></a><span class="lineno">  330</span>               dDeepWaterWaveX = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1652253500dab35e6f6f9f734207e20b">m_nXGridSize</a> - 1][nY].dGetCellDeepWaterWaveHeight() * sin(<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1652253500dab35e6f6f9f734207e20b">m_nXGridSize</a> - 1][nY].dGetCellDeepWaterWaveAngle() * <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a5d502a06fdd71825be49e07c95496b16">PI</a> / 180);</div>
<div class="line"><a id="l00331" name="l00331"></a><span class="lineno">  331</span>               dDeepWaterWaveY = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1652253500dab35e6f6f9f734207e20b">m_nXGridSize</a> - 1][nY].dGetCellDeepWaterWaveHeight() * cos(<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1652253500dab35e6f6f9f734207e20b">m_nXGridSize</a> - 1][nY].dGetCellDeepWaterWaveAngle() * <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a5d502a06fdd71825be49e07c95496b16">PI</a> / 180);</div>
<div class="line"><a id="l00332" name="l00332"></a><span class="lineno">  332</span>            }</div>
<div class="line"><a id="l00333" name="l00333"></a><span class="lineno">  333</span> </div>
<div class="line"><a id="l00334" name="l00334"></a><span class="lineno">  334</span>            VdHeightXAll.push_back(dDeepWaterWaveX);</div>
<div class="line"><a id="l00335" name="l00335"></a><span class="lineno">  335</span>            VdHeightYAll.push_back(dDeepWaterWaveY);</div>
<div class="line"><a id="l00336" name="l00336"></a><span class="lineno">  336</span>         }</div>
<div class="line"><a id="l00337" name="l00337"></a><span class="lineno">  337</span>      }</div>
<div class="line"><a id="l00338" name="l00338"></a><span class="lineno">  338</span>   }</div>
<div class="line"><a id="l00339" name="l00339"></a><span class="lineno">  339</span> </div>
<div class="line"><a id="l00340" name="l00340"></a><span class="lineno">  340</span>   <span class="comment">//    // DEBUG CODE ============================================================================================================</span></div>
<div class="line"><a id="l00341" name="l00341"></a><span class="lineno">  341</span>   <span class="comment">//    LogStream &lt;&lt; &quot;Out of loop&quot; &lt;&lt; endl;</span></div>
<div class="line"><a id="l00342" name="l00342"></a><span class="lineno">  342</span>   <span class="comment">//    for (int nn = 0; nn &lt; VdXAll.size(); nn++)</span></div>
<div class="line"><a id="l00343" name="l00343"></a><span class="lineno">  343</span>   <span class="comment">//    {</span></div>
<div class="line"><a id="l00344" name="l00344"></a><span class="lineno">  344</span>   <span class="comment">//       LogStream &lt;&lt; &quot;nn = &quot; &lt;&lt; nn &lt;&lt; &quot; VdXAll[nn] = &quot; &lt;&lt; VdXAll[nn] &lt;&lt; &quot; VdYAll[nn] = &quot; &lt;&lt; VdYAll[nn] &lt;&lt; &quot; VdHeightXAll[nn] = &quot; &lt;&lt; VdHeightXAll[nn] &lt;&lt; &quot; VdHeightYAll[nn] = &quot; &lt;&lt; VdHeightYAll[nn] &lt;&lt; &quot; VbBreakingAll[nn] = &quot; &lt;&lt; VbBreakingAll[nn] &lt;&lt; endl;</span></div>
<div class="line"><a id="l00345" name="l00345"></a><span class="lineno">  345</span>   <span class="comment">//    }</span></div>
<div class="line"><a id="l00346" name="l00346"></a><span class="lineno">  346</span>   <span class="comment">//    LogStream &lt;&lt; endl;</span></div>
<div class="line"><a id="l00347" name="l00347"></a><span class="lineno">  347</span>   <span class="comment">//    // DEBUG CODE ============================================================================================================</span></div>
<div class="line"><a id="l00348" name="l00348"></a><span class="lineno">  348</span> </div>
<div class="line"><a id="l00349" name="l00349"></a><span class="lineno">  349</span>   <span class="comment">// Are the waves off-shore for every profile? If so, do nothing more</span></div>
<div class="line"><a id="l00350" name="l00350"></a><span class="lineno">  350</span>   <span class="keywordflow">if</span> (VbBreakingAll.empty())</div>
<div class="line"><a id="l00351" name="l00351"></a><span class="lineno">  351</span>   {</div>
<div class="line"><a id="l00352" name="l00352"></a><span class="lineno">  352</span>      <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a222962121613613a48f518e0c2110f21">LogStream</a> &lt;&lt; <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#ad67e8c5b30a0572f64ecfb5c062c2edc">m_ulIter</a> &lt;&lt; <span class="stringliteral">&quot;: waves off-shore for all profiles&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a id="l00353" name="l00353"></a><span class="lineno">  353</span> </div>
<div class="line"><a id="l00354" name="l00354"></a><span class="lineno">  354</span>      <span class="keywordflow">return</span> <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#aa768cb14b5c6123ee95e6e4ebd9fe331">RTN_OK</a>;</div>
<div class="line"><a id="l00355" name="l00355"></a><span class="lineno">  355</span>   }</div>
<div class="line"><a id="l00356" name="l00356"></a><span class="lineno">  356</span> </div>
<div class="line"><a id="l00357" name="l00357"></a><span class="lineno">  357</span>   <span class="comment">// Some waves are on-shore, so interpolate the wave attributes from all profile points to all within-polygon sea cells, also update the active zone status for each cell</span></div>
<div class="line"><a id="l00358" name="l00358"></a><span class="lineno">  358</span>   <span class="keywordtype">int</span> nRet = <a class="code hl_function" href="../../d1/d98/classCSimulation.html#a5e3b5134f2c34bdb81312ab8f3a0faf1">nInterpolateWavesToPolygonCells</a>(&amp;VdXAll, &amp;VdYAll, &amp;VdHeightXAll, &amp;VdHeightYAll);</div>
<div class="line"><a id="l00359" name="l00359"></a><span class="lineno">  359</span>   <span class="keywordflow">if</span> (nRet != <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#aa768cb14b5c6123ee95e6e4ebd9fe331">RTN_OK</a>)</div>
<div class="line"><a id="l00360" name="l00360"></a><span class="lineno">  360</span>      <span class="keywordflow">return</span> nRet;</div>
<div class="line"><a id="l00361" name="l00361"></a><span class="lineno">  361</span> </div>
<div class="line"><a id="l00362" name="l00362"></a><span class="lineno">  362</span>   <span class="comment">// // DEBUG CODE ===========================================================================================================</span></div>
<div class="line"><a id="l00363" name="l00363"></a><span class="lineno">  363</span>   <span class="comment">// string strOutFile = m_strOutPath;</span></div>
<div class="line"><a id="l00364" name="l00364"></a><span class="lineno">  364</span>   <span class="comment">// strOutFile += &quot;sea_wave_height_CHECKPOINT_1_&quot;;</span></div>
<div class="line"><a id="l00365" name="l00365"></a><span class="lineno">  365</span>   <span class="comment">// strOutFile += to_string(m_ulIter);</span></div>
<div class="line"><a id="l00366" name="l00366"></a><span class="lineno">  366</span>   <span class="comment">// strOutFile += &quot;.tif&quot;;</span></div>
<div class="line"><a id="l00367" name="l00367"></a><span class="lineno">  367</span>   <span class="comment">//</span></div>
<div class="line"><a id="l00368" name="l00368"></a><span class="lineno">  368</span>   <span class="comment">// GDALDriver* pDriver = GetGDALDriverManager()-&gt;GetDriverByName(&quot;gtiff&quot;);</span></div>
<div class="line"><a id="l00369" name="l00369"></a><span class="lineno">  369</span>   <span class="comment">// GDALDataset* pDataSet = pDriver-&gt;Create(strOutFile.c_str(), m_nXGridSize, m_nYGridSize, 1, GDT_Float64, m_papszGDALRasterOptions);</span></div>
<div class="line"><a id="l00370" name="l00370"></a><span class="lineno">  370</span>   <span class="comment">// pDataSet-&gt;SetProjection(m_strGDALBasementDEMProjection.c_str());</span></div>
<div class="line"><a id="l00371" name="l00371"></a><span class="lineno">  371</span>   <span class="comment">// pDataSet-&gt;SetGeoTransform(m_dGeoTransform);</span></div>
<div class="line"><a id="l00372" name="l00372"></a><span class="lineno">  372</span>   <span class="comment">//</span></div>
<div class="line"><a id="l00373" name="l00373"></a><span class="lineno">  373</span>   <span class="comment">// int nn = 0;</span></div>
<div class="line"><a id="l00374" name="l00374"></a><span class="lineno">  374</span>   <span class="comment">// double* pdRaster = new double[m_nXGridSize * m_nYGridSize];</span></div>
<div class="line"><a id="l00375" name="l00375"></a><span class="lineno">  375</span>   <span class="comment">// for (int nY = 0; nY &lt; m_nYGridSize; nY++)</span></div>
<div class="line"><a id="l00376" name="l00376"></a><span class="lineno">  376</span>   <span class="comment">// {</span></div>
<div class="line"><a id="l00377" name="l00377"></a><span class="lineno">  377</span>   <span class="comment">//    for (int nX = 0; nX &lt; m_nXGridSize; nX++)</span></div>
<div class="line"><a id="l00378" name="l00378"></a><span class="lineno">  378</span>   <span class="comment">//    {</span></div>
<div class="line"><a id="l00379" name="l00379"></a><span class="lineno">  379</span>   <span class="comment">//       pdRaster[nn++] = m_pRasterGrid-&gt;m_Cell[nX][nY].dGetWaveHeight();</span></div>
<div class="line"><a id="l00380" name="l00380"></a><span class="lineno">  380</span>   <span class="comment">//    }</span></div>
<div class="line"><a id="l00381" name="l00381"></a><span class="lineno">  381</span>   <span class="comment">// }</span></div>
<div class="line"><a id="l00382" name="l00382"></a><span class="lineno">  382</span>   <span class="comment">//</span></div>
<div class="line"><a id="l00383" name="l00383"></a><span class="lineno">  383</span>   <span class="comment">// GDALRasterBand* pBand = pDataSet-&gt;GetRasterBand(1);</span></div>
<div class="line"><a id="l00384" name="l00384"></a><span class="lineno">  384</span>   <span class="comment">// pBand-&gt;SetNoDataValue(m_dMissingValue);</span></div>
<div class="line"><a id="l00385" name="l00385"></a><span class="lineno">  385</span>   <span class="comment">// nRet = pBand-&gt;RasterIO(GF_Write, 0, 0, m_nXGridSize, m_nYGridSize, pdRaster, m_nXGridSize, m_nYGridSize, GDT_Float64, 0, 0, NULL);</span></div>
<div class="line"><a id="l00386" name="l00386"></a><span class="lineno">  386</span>   <span class="comment">//</span></div>
<div class="line"><a id="l00387" name="l00387"></a><span class="lineno">  387</span>   <span class="comment">// if (nRet == CE_Failure)</span></div>
<div class="line"><a id="l00388" name="l00388"></a><span class="lineno">  388</span>   <span class="comment">//    return RTN_ERR_GRIDCREATE;</span></div>
<div class="line"><a id="l00389" name="l00389"></a><span class="lineno">  389</span>   <span class="comment">//</span></div>
<div class="line"><a id="l00390" name="l00390"></a><span class="lineno">  390</span>   <span class="comment">// GDALClose(pDataSet);</span></div>
<div class="line"><a id="l00391" name="l00391"></a><span class="lineno">  391</span>   <span class="comment">// delete[] pdRaster;</span></div>
<div class="line"><a id="l00392" name="l00392"></a><span class="lineno">  392</span>   <span class="comment">// // DEBUG CODE ===========================================================================================================</span></div>
<div class="line"><a id="l00393" name="l00393"></a><span class="lineno">  393</span> </div>
<div class="line"><a id="l00394" name="l00394"></a><span class="lineno">  394</span>   <span class="comment">// // DEBUG CODE ===========================================================================================================</span></div>
<div class="line"><a id="l00395" name="l00395"></a><span class="lineno">  395</span>   <span class="comment">// strOutFile = m_strOutPath;</span></div>
<div class="line"><a id="l00396" name="l00396"></a><span class="lineno">  396</span>   <span class="comment">// strOutFile += &quot;sea_wave_angle_CHECKPOINT_1_&quot;;</span></div>
<div class="line"><a id="l00397" name="l00397"></a><span class="lineno">  397</span>   <span class="comment">// strOutFile += to_string(m_ulIter);</span></div>
<div class="line"><a id="l00398" name="l00398"></a><span class="lineno">  398</span>   <span class="comment">// strOutFile += &quot;.tif&quot;;</span></div>
<div class="line"><a id="l00399" name="l00399"></a><span class="lineno">  399</span>   <span class="comment">//</span></div>
<div class="line"><a id="l00400" name="l00400"></a><span class="lineno">  400</span>   <span class="comment">// pDriver = GetGDALDriverManager()-&gt;GetDriverByName(&quot;gtiff&quot;);</span></div>
<div class="line"><a id="l00401" name="l00401"></a><span class="lineno">  401</span>   <span class="comment">// pDataSet = pDriver-&gt;Create(strOutFile.c_str(), m_nXGridSize, m_nYGridSize, 1, GDT_Float64, m_papszGDALRasterOptions);</span></div>
<div class="line"><a id="l00402" name="l00402"></a><span class="lineno">  402</span>   <span class="comment">// pDataSet-&gt;SetProjection(m_strGDALBasementDEMProjection.c_str());</span></div>
<div class="line"><a id="l00403" name="l00403"></a><span class="lineno">  403</span>   <span class="comment">// pDataSet-&gt;SetGeoTransform(m_dGeoTransform);</span></div>
<div class="line"><a id="l00404" name="l00404"></a><span class="lineno">  404</span>   <span class="comment">//</span></div>
<div class="line"><a id="l00405" name="l00405"></a><span class="lineno">  405</span>   <span class="comment">// nn = 0;</span></div>
<div class="line"><a id="l00406" name="l00406"></a><span class="lineno">  406</span>   <span class="comment">// pdRaster = new double[m_nXGridSize * m_nYGridSize];</span></div>
<div class="line"><a id="l00407" name="l00407"></a><span class="lineno">  407</span>   <span class="comment">// for (int nY = 0; nY &lt; m_nYGridSize; nY++)</span></div>
<div class="line"><a id="l00408" name="l00408"></a><span class="lineno">  408</span>   <span class="comment">// {</span></div>
<div class="line"><a id="l00409" name="l00409"></a><span class="lineno">  409</span>   <span class="comment">//    for (int nX = 0; nX &lt; m_nXGridSize; nX++)</span></div>
<div class="line"><a id="l00410" name="l00410"></a><span class="lineno">  410</span>   <span class="comment">//    {</span></div>
<div class="line"><a id="l00411" name="l00411"></a><span class="lineno">  411</span>   <span class="comment">//       pdRaster[nn++] = m_pRasterGrid-&gt;m_Cell[nX][nY].dGetWaveAngle();</span></div>
<div class="line"><a id="l00412" name="l00412"></a><span class="lineno">  412</span>   <span class="comment">//    }</span></div>
<div class="line"><a id="l00413" name="l00413"></a><span class="lineno">  413</span>   <span class="comment">// }</span></div>
<div class="line"><a id="l00414" name="l00414"></a><span class="lineno">  414</span>   <span class="comment">//</span></div>
<div class="line"><a id="l00415" name="l00415"></a><span class="lineno">  415</span>   <span class="comment">// pBand = pDataSet-&gt;GetRasterBand(1);</span></div>
<div class="line"><a id="l00416" name="l00416"></a><span class="lineno">  416</span>   <span class="comment">// pBand-&gt;SetNoDataValue(m_dMissingValue);</span></div>
<div class="line"><a id="l00417" name="l00417"></a><span class="lineno">  417</span>   <span class="comment">// nRet = pBand-&gt;RasterIO(GF_Write, 0, 0, m_nXGridSize, m_nYGridSize, pdRaster, m_nXGridSize, m_nYGridSize, GDT_Float64, 0, 0, NULL);</span></div>
<div class="line"><a id="l00418" name="l00418"></a><span class="lineno">  418</span>   <span class="comment">//</span></div>
<div class="line"><a id="l00419" name="l00419"></a><span class="lineno">  419</span>   <span class="comment">// if (nRet == CE_Failure)</span></div>
<div class="line"><a id="l00420" name="l00420"></a><span class="lineno">  420</span>   <span class="comment">//    return RTN_ERR_GRIDCREATE;</span></div>
<div class="line"><a id="l00421" name="l00421"></a><span class="lineno">  421</span>   <span class="comment">//</span></div>
<div class="line"><a id="l00422" name="l00422"></a><span class="lineno">  422</span>   <span class="comment">// GDALClose(pDataSet);</span></div>
<div class="line"><a id="l00423" name="l00423"></a><span class="lineno">  423</span>   <span class="comment">// delete[] pdRaster;</span></div>
<div class="line"><a id="l00424" name="l00424"></a><span class="lineno">  424</span>   <span class="comment">// // DEBUG CODE ===========================================================================================================</span></div>
<div class="line"><a id="l00425" name="l00425"></a><span class="lineno">  425</span> </div>
<div class="line"><a id="l00426" name="l00426"></a><span class="lineno">  426</span>   <span class="comment">// Find any shadow zones and then modify waves in and adjacent to them</span></div>
<div class="line"><a id="l00427" name="l00427"></a><span class="lineno">  427</span>   nRet = <a class="code hl_function" href="../../d1/d98/classCSimulation.html#a4183ba0c6f5e8376ead62d0ded3e4c73">nDoAllShadowZones</a>();</div>
<div class="line"><a id="l00428" name="l00428"></a><span class="lineno">  428</span>   <span class="keywordflow">if</span> (nRet != <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#aa768cb14b5c6123ee95e6e4ebd9fe331">RTN_OK</a>)</div>
<div class="line"><a id="l00429" name="l00429"></a><span class="lineno">  429</span>      <span class="keywordflow">return</span> nRet;</div>
<div class="line"><a id="l00430" name="l00430"></a><span class="lineno">  430</span> </div>
<div class="line"><a id="l00431" name="l00431"></a><span class="lineno">  431</span>   <span class="comment">// Calculate the D50 for each polygon. Also fill in any artefactual &#39;holes&#39; in active zone and wave property patterns</span></div>
<div class="line"><a id="l00432" name="l00432"></a><span class="lineno">  432</span>   <a class="code hl_function" href="../../d1/d98/classCSimulation.html#a7e6ba198fd9083eca4c5985c5fd564df">CalcD50AndFillWaveCalcHoles</a>();</div>
<div class="line"><a id="l00433" name="l00433"></a><span class="lineno">  433</span> </div>
<div class="line"><a id="l00434" name="l00434"></a><span class="lineno">  434</span>   <span class="comment">// // DEBUG CODE ===========================================================================================================</span></div>
<div class="line"><a id="l00435" name="l00435"></a><span class="lineno">  435</span>   <span class="comment">// strOutFile = m_strOutPath;</span></div>
<div class="line"><a id="l00436" name="l00436"></a><span class="lineno">  436</span>   <span class="comment">// strOutFile += &quot;sea_wave_height_CHECKPOINT_2_&quot;;</span></div>
<div class="line"><a id="l00437" name="l00437"></a><span class="lineno">  437</span>   <span class="comment">// strOutFile += to_string(m_ulIter);</span></div>
<div class="line"><a id="l00438" name="l00438"></a><span class="lineno">  438</span>   <span class="comment">// strOutFile += &quot;.tif&quot;;</span></div>
<div class="line"><a id="l00439" name="l00439"></a><span class="lineno">  439</span>   <span class="comment">//</span></div>
<div class="line"><a id="l00440" name="l00440"></a><span class="lineno">  440</span>   <span class="comment">// pDriver = GetGDALDriverManager()-&gt;GetDriverByName(&quot;gtiff&quot;);</span></div>
<div class="line"><a id="l00441" name="l00441"></a><span class="lineno">  441</span>   <span class="comment">// pDataSet = pDriver-&gt;Create(strOutFile.c_str(), m_nXGridSize, m_nYGridSize, 1, GDT_Float64, m_papszGDALRasterOptions);</span></div>
<div class="line"><a id="l00442" name="l00442"></a><span class="lineno">  442</span>   <span class="comment">// pDataSet-&gt;SetProjection(m_strGDALBasementDEMProjection.c_str());</span></div>
<div class="line"><a id="l00443" name="l00443"></a><span class="lineno">  443</span>   <span class="comment">// pDataSet-&gt;SetGeoTransform(m_dGeoTransform);</span></div>
<div class="line"><a id="l00444" name="l00444"></a><span class="lineno">  444</span>   <span class="comment">//</span></div>
<div class="line"><a id="l00445" name="l00445"></a><span class="lineno">  445</span>   <span class="comment">// nn = 0;</span></div>
<div class="line"><a id="l00446" name="l00446"></a><span class="lineno">  446</span>   <span class="comment">// pdRaster = new double[m_nXGridSize * m_nYGridSize];</span></div>
<div class="line"><a id="l00447" name="l00447"></a><span class="lineno">  447</span>   <span class="comment">// for (int nY = 0; nY &lt; m_nYGridSize; nY++)</span></div>
<div class="line"><a id="l00448" name="l00448"></a><span class="lineno">  448</span>   <span class="comment">// {</span></div>
<div class="line"><a id="l00449" name="l00449"></a><span class="lineno">  449</span>   <span class="comment">//    for (int nX = 0; nX &lt; m_nXGridSize; nX++)</span></div>
<div class="line"><a id="l00450" name="l00450"></a><span class="lineno">  450</span>   <span class="comment">//    {</span></div>
<div class="line"><a id="l00451" name="l00451"></a><span class="lineno">  451</span>   <span class="comment">//       pdRaster[nn++] = m_pRasterGrid-&gt;m_Cell[nX][nY].dGetWaveHeight();</span></div>
<div class="line"><a id="l00452" name="l00452"></a><span class="lineno">  452</span>   <span class="comment">//    }</span></div>
<div class="line"><a id="l00453" name="l00453"></a><span class="lineno">  453</span>   <span class="comment">// }</span></div>
<div class="line"><a id="l00454" name="l00454"></a><span class="lineno">  454</span>   <span class="comment">//</span></div>
<div class="line"><a id="l00455" name="l00455"></a><span class="lineno">  455</span>   <span class="comment">// pBand = pDataSet-&gt;GetRasterBand(1);</span></div>
<div class="line"><a id="l00456" name="l00456"></a><span class="lineno">  456</span>   <span class="comment">// pBand-&gt;SetNoDataValue(m_dMissingValue);</span></div>
<div class="line"><a id="l00457" name="l00457"></a><span class="lineno">  457</span>   <span class="comment">// nRet = pBand-&gt;RasterIO(GF_Write, 0, 0, m_nXGridSize, m_nYGridSize, pdRaster, m_nXGridSize, m_nYGridSize, GDT_Float64, 0, 0, NULL);</span></div>
<div class="line"><a id="l00458" name="l00458"></a><span class="lineno">  458</span>   <span class="comment">//</span></div>
<div class="line"><a id="l00459" name="l00459"></a><span class="lineno">  459</span>   <span class="comment">// if (nRet == CE_Failure)</span></div>
<div class="line"><a id="l00460" name="l00460"></a><span class="lineno">  460</span>   <span class="comment">//    return RTN_ERR_GRIDCREATE;</span></div>
<div class="line"><a id="l00461" name="l00461"></a><span class="lineno">  461</span>   <span class="comment">//</span></div>
<div class="line"><a id="l00462" name="l00462"></a><span class="lineno">  462</span>   <span class="comment">// GDALClose(pDataSet);</span></div>
<div class="line"><a id="l00463" name="l00463"></a><span class="lineno">  463</span>   <span class="comment">// delete[] pdRaster;</span></div>
<div class="line"><a id="l00464" name="l00464"></a><span class="lineno">  464</span>   <span class="comment">// // DEBUG CODE ===========================================================================================================</span></div>
<div class="line"><a id="l00465" name="l00465"></a><span class="lineno">  465</span> </div>
<div class="line"><a id="l00466" name="l00466"></a><span class="lineno">  466</span>   <span class="comment">// // DEBUG CODE ===========================================================================================================</span></div>
<div class="line"><a id="l00467" name="l00467"></a><span class="lineno">  467</span>   <span class="comment">// strOutFile = m_strOutPath;</span></div>
<div class="line"><a id="l00468" name="l00468"></a><span class="lineno">  468</span>   <span class="comment">// strOutFile += &quot;sea_wave_angle_CHECKPOINT_2_&quot;;</span></div>
<div class="line"><a id="l00469" name="l00469"></a><span class="lineno">  469</span>   <span class="comment">// strOutFile += to_string(m_ulIter);</span></div>
<div class="line"><a id="l00470" name="l00470"></a><span class="lineno">  470</span>   <span class="comment">// strOutFile += &quot;.tif&quot;;</span></div>
<div class="line"><a id="l00471" name="l00471"></a><span class="lineno">  471</span>   <span class="comment">//</span></div>
<div class="line"><a id="l00472" name="l00472"></a><span class="lineno">  472</span>   <span class="comment">// pDriver = GetGDALDriverManager()-&gt;GetDriverByName(&quot;gtiff&quot;);</span></div>
<div class="line"><a id="l00473" name="l00473"></a><span class="lineno">  473</span>   <span class="comment">// pDataSet = pDriver-&gt;Create(strOutFile.c_str(), m_nXGridSize, m_nYGridSize, 1, GDT_Float64, m_papszGDALRasterOptions);</span></div>
<div class="line"><a id="l00474" name="l00474"></a><span class="lineno">  474</span>   <span class="comment">// pDataSet-&gt;SetProjection(m_strGDALBasementDEMProjection.c_str());</span></div>
<div class="line"><a id="l00475" name="l00475"></a><span class="lineno">  475</span>   <span class="comment">// pDataSet-&gt;SetGeoTransform(m_dGeoTransform);</span></div>
<div class="line"><a id="l00476" name="l00476"></a><span class="lineno">  476</span>   <span class="comment">//</span></div>
<div class="line"><a id="l00477" name="l00477"></a><span class="lineno">  477</span>   <span class="comment">// nn = 0;</span></div>
<div class="line"><a id="l00478" name="l00478"></a><span class="lineno">  478</span>   <span class="comment">// pdRaster = new double[m_nXGridSize * m_nYGridSize];</span></div>
<div class="line"><a id="l00479" name="l00479"></a><span class="lineno">  479</span>   <span class="comment">// for (int nY = 0; nY &lt; m_nYGridSize; nY++)</span></div>
<div class="line"><a id="l00480" name="l00480"></a><span class="lineno">  480</span>   <span class="comment">// {</span></div>
<div class="line"><a id="l00481" name="l00481"></a><span class="lineno">  481</span>   <span class="comment">//    for (int nX = 0; nX &lt; m_nXGridSize; nX++)</span></div>
<div class="line"><a id="l00482" name="l00482"></a><span class="lineno">  482</span>   <span class="comment">//    {</span></div>
<div class="line"><a id="l00483" name="l00483"></a><span class="lineno">  483</span>   <span class="comment">//       pdRaster[nn++] = m_pRasterGrid-&gt;m_Cell[nX][nY].dGetWaveAngle();</span></div>
<div class="line"><a id="l00484" name="l00484"></a><span class="lineno">  484</span>   <span class="comment">//    }</span></div>
<div class="line"><a id="l00485" name="l00485"></a><span class="lineno">  485</span>   <span class="comment">// }</span></div>
<div class="line"><a id="l00486" name="l00486"></a><span class="lineno">  486</span>   <span class="comment">//</span></div>
<div class="line"><a id="l00487" name="l00487"></a><span class="lineno">  487</span>   <span class="comment">// pBand = pDataSet-&gt;GetRasterBand(1);</span></div>
<div class="line"><a id="l00488" name="l00488"></a><span class="lineno">  488</span>   <span class="comment">// pBand-&gt;SetNoDataValue(m_dMissingValue);</span></div>
<div class="line"><a id="l00489" name="l00489"></a><span class="lineno">  489</span>   <span class="comment">// nRet = pBand-&gt;RasterIO(GF_Write, 0, 0, m_nXGridSize, m_nYGridSize, pdRaster, m_nXGridSize, m_nYGridSize, GDT_Float64, 0, 0, NULL);</span></div>
<div class="line"><a id="l00490" name="l00490"></a><span class="lineno">  490</span>   <span class="comment">//</span></div>
<div class="line"><a id="l00491" name="l00491"></a><span class="lineno">  491</span>   <span class="comment">// if (nRet == CE_Failure)</span></div>
<div class="line"><a id="l00492" name="l00492"></a><span class="lineno">  492</span>   <span class="comment">//    return RTN_ERR_GRIDCREATE;</span></div>
<div class="line"><a id="l00493" name="l00493"></a><span class="lineno">  493</span>   <span class="comment">//</span></div>
<div class="line"><a id="l00494" name="l00494"></a><span class="lineno">  494</span>   <span class="comment">// GDALClose(pDataSet);</span></div>
<div class="line"><a id="l00495" name="l00495"></a><span class="lineno">  495</span>   <span class="comment">// delete[] pdRaster;</span></div>
<div class="line"><a id="l00496" name="l00496"></a><span class="lineno">  496</span>   <span class="comment">// // DEBUG CODE ===========================================================================================================</span></div>
<div class="line"><a id="l00497" name="l00497"></a><span class="lineno">  497</span> </div>
<div class="line"><a id="l00498" name="l00498"></a><span class="lineno">  498</span>   <span class="comment">// Modify the wave breaking properties (wave height, wave dir, breaking depth, breaking distance) for coastline points within the shadow zone</span></div>
<div class="line"><a id="l00499" name="l00499"></a><span class="lineno">  499</span>   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> nCoast = 0; nCoast &lt; static_cast&lt;int&gt;(<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>.size()); nCoast++)</div>
<div class="line"><a id="l00500" name="l00500"></a><span class="lineno">  500</span>   {</div>
<div class="line"><a id="l00501" name="l00501"></a><span class="lineno">  501</span>      <span class="keywordtype">int</span> nNumProfiles = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].nGetNumProfiles();</div>
<div class="line"><a id="l00502" name="l00502"></a><span class="lineno">  502</span> </div>
<div class="line"><a id="l00503" name="l00503"></a><span class="lineno">  503</span>      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> nProfile = 0; nProfile &lt; nNumProfiles; nProfile++)</div>
<div class="line"><a id="l00504" name="l00504"></a><span class="lineno">  504</span>         <a class="code hl_function" href="../../d1/d98/classCSimulation.html#aca89a5d1f76e900ce10acc73294aa279">ModifyBreakingWavePropertiesWithinShadowZoneToCoastline</a>(nCoast, nProfile);</div>
<div class="line"><a id="l00505" name="l00505"></a><span class="lineno">  505</span>   }</div>
<div class="line"><a id="l00506" name="l00506"></a><span class="lineno">  506</span> </div>
<div class="line"><a id="l00507" name="l00507"></a><span class="lineno">  507</span>   <span class="comment">// // DEBUG CODE ===========================================================================================================</span></div>
<div class="line"><a id="l00508" name="l00508"></a><span class="lineno">  508</span>   <span class="comment">// strOutFile = m_strOutPath;</span></div>
<div class="line"><a id="l00509" name="l00509"></a><span class="lineno">  509</span>   <span class="comment">// strOutFile += &quot;sea_wave_height_CHECKPOINT_3_&quot;;</span></div>
<div class="line"><a id="l00510" name="l00510"></a><span class="lineno">  510</span>   <span class="comment">// strOutFile += to_string(m_ulIter);</span></div>
<div class="line"><a id="l00511" name="l00511"></a><span class="lineno">  511</span>   <span class="comment">// strOutFile += &quot;.tif&quot;;</span></div>
<div class="line"><a id="l00512" name="l00512"></a><span class="lineno">  512</span>   <span class="comment">//</span></div>
<div class="line"><a id="l00513" name="l00513"></a><span class="lineno">  513</span>   <span class="comment">// pDriver = GetGDALDriverManager()-&gt;GetDriverByName(&quot;gtiff&quot;);</span></div>
<div class="line"><a id="l00514" name="l00514"></a><span class="lineno">  514</span>   <span class="comment">// pDataSet = pDriver-&gt;Create(strOutFile.c_str(), m_nXGridSize, m_nYGridSize, 1, GDT_Float64, m_papszGDALRasterOptions);</span></div>
<div class="line"><a id="l00515" name="l00515"></a><span class="lineno">  515</span>   <span class="comment">// pDataSet-&gt;SetProjection(m_strGDALBasementDEMProjection.c_str());</span></div>
<div class="line"><a id="l00516" name="l00516"></a><span class="lineno">  516</span>   <span class="comment">// pDataSet-&gt;SetGeoTransform(m_dGeoTransform);</span></div>
<div class="line"><a id="l00517" name="l00517"></a><span class="lineno">  517</span>   <span class="comment">//</span></div>
<div class="line"><a id="l00518" name="l00518"></a><span class="lineno">  518</span>   <span class="comment">// nn = 0;</span></div>
<div class="line"><a id="l00519" name="l00519"></a><span class="lineno">  519</span>   <span class="comment">// pdRaster = new double[m_nXGridSize * m_nYGridSize];</span></div>
<div class="line"><a id="l00520" name="l00520"></a><span class="lineno">  520</span>   <span class="comment">// for (int nY = 0; nY &lt; m_nYGridSize; nY++)</span></div>
<div class="line"><a id="l00521" name="l00521"></a><span class="lineno">  521</span>   <span class="comment">// {</span></div>
<div class="line"><a id="l00522" name="l00522"></a><span class="lineno">  522</span>   <span class="comment">//    for (int nX = 0; nX &lt; m_nXGridSize; nX++)</span></div>
<div class="line"><a id="l00523" name="l00523"></a><span class="lineno">  523</span>   <span class="comment">//    {</span></div>
<div class="line"><a id="l00524" name="l00524"></a><span class="lineno">  524</span>   <span class="comment">//       pdRaster[nn++] = m_pRasterGrid-&gt;m_Cell[nX][nY].dGetWaveHeight();</span></div>
<div class="line"><a id="l00525" name="l00525"></a><span class="lineno">  525</span>   <span class="comment">//    }</span></div>
<div class="line"><a id="l00526" name="l00526"></a><span class="lineno">  526</span>   <span class="comment">// }</span></div>
<div class="line"><a id="l00527" name="l00527"></a><span class="lineno">  527</span>   <span class="comment">//</span></div>
<div class="line"><a id="l00528" name="l00528"></a><span class="lineno">  528</span>   <span class="comment">// pBand = pDataSet-&gt;GetRasterBand(1);</span></div>
<div class="line"><a id="l00529" name="l00529"></a><span class="lineno">  529</span>   <span class="comment">// pBand-&gt;SetNoDataValue(m_dMissingValue);</span></div>
<div class="line"><a id="l00530" name="l00530"></a><span class="lineno">  530</span>   <span class="comment">// nRet = pBand-&gt;RasterIO(GF_Write, 0, 0, m_nXGridSize, m_nYGridSize, pdRaster, m_nXGridSize, m_nYGridSize, GDT_Float64, 0, 0, NULL);</span></div>
<div class="line"><a id="l00531" name="l00531"></a><span class="lineno">  531</span>   <span class="comment">//</span></div>
<div class="line"><a id="l00532" name="l00532"></a><span class="lineno">  532</span>   <span class="comment">// if (nRet == CE_Failure)</span></div>
<div class="line"><a id="l00533" name="l00533"></a><span class="lineno">  533</span>   <span class="comment">//    return RTN_ERR_GRIDCREATE;</span></div>
<div class="line"><a id="l00534" name="l00534"></a><span class="lineno">  534</span>   <span class="comment">//</span></div>
<div class="line"><a id="l00535" name="l00535"></a><span class="lineno">  535</span>   <span class="comment">// GDALClose(pDataSet);</span></div>
<div class="line"><a id="l00536" name="l00536"></a><span class="lineno">  536</span>   <span class="comment">// delete[] pdRaster;</span></div>
<div class="line"><a id="l00537" name="l00537"></a><span class="lineno">  537</span>   <span class="comment">// // DEBUG CODE ===========================================================================================================</span></div>
<div class="line"><a id="l00538" name="l00538"></a><span class="lineno">  538</span> </div>
<div class="line"><a id="l00539" name="l00539"></a><span class="lineno">  539</span>   <span class="comment">// // DEBUG CODE ===========================================================================================================</span></div>
<div class="line"><a id="l00540" name="l00540"></a><span class="lineno">  540</span>   <span class="comment">// strOutFile = m_strOutPath;</span></div>
<div class="line"><a id="l00541" name="l00541"></a><span class="lineno">  541</span>   <span class="comment">// strOutFile += &quot;sea_wave_angle_CHECKPOINT_3_&quot;;</span></div>
<div class="line"><a id="l00542" name="l00542"></a><span class="lineno">  542</span>   <span class="comment">// strOutFile += to_string(m_ulIter);</span></div>
<div class="line"><a id="l00543" name="l00543"></a><span class="lineno">  543</span>   <span class="comment">// strOutFile += &quot;.tif&quot;;</span></div>
<div class="line"><a id="l00544" name="l00544"></a><span class="lineno">  544</span>   <span class="comment">//</span></div>
<div class="line"><a id="l00545" name="l00545"></a><span class="lineno">  545</span>   <span class="comment">// pDriver = GetGDALDriverManager()-&gt;GetDriverByName(&quot;gtiff&quot;);</span></div>
<div class="line"><a id="l00546" name="l00546"></a><span class="lineno">  546</span>   <span class="comment">// pDataSet = pDriver-&gt;Create(strOutFile.c_str(), m_nXGridSize, m_nYGridSize, 1, GDT_Float64, m_papszGDALRasterOptions);</span></div>
<div class="line"><a id="l00547" name="l00547"></a><span class="lineno">  547</span>   <span class="comment">// pDataSet-&gt;SetProjection(m_strGDALBasementDEMProjection.c_str());</span></div>
<div class="line"><a id="l00548" name="l00548"></a><span class="lineno">  548</span>   <span class="comment">// pDataSet-&gt;SetGeoTransform(m_dGeoTransform);</span></div>
<div class="line"><a id="l00549" name="l00549"></a><span class="lineno">  549</span>   <span class="comment">//</span></div>
<div class="line"><a id="l00550" name="l00550"></a><span class="lineno">  550</span>   <span class="comment">// nn = 0;</span></div>
<div class="line"><a id="l00551" name="l00551"></a><span class="lineno">  551</span>   <span class="comment">// pdRaster = new double[m_nXGridSize * m_nYGridSize];</span></div>
<div class="line"><a id="l00552" name="l00552"></a><span class="lineno">  552</span>   <span class="comment">// for (int nY = 0; nY &lt; m_nYGridSize; nY++)</span></div>
<div class="line"><a id="l00553" name="l00553"></a><span class="lineno">  553</span>   <span class="comment">// {</span></div>
<div class="line"><a id="l00554" name="l00554"></a><span class="lineno">  554</span>   <span class="comment">//    for (int nX = 0; nX &lt; m_nXGridSize; nX++)</span></div>
<div class="line"><a id="l00555" name="l00555"></a><span class="lineno">  555</span>   <span class="comment">//    {</span></div>
<div class="line"><a id="l00556" name="l00556"></a><span class="lineno">  556</span>   <span class="comment">//       pdRaster[nn++] = m_pRasterGrid-&gt;m_Cell[nX][nY].dGetWaveAngle();</span></div>
<div class="line"><a id="l00557" name="l00557"></a><span class="lineno">  557</span>   <span class="comment">//    }</span></div>
<div class="line"><a id="l00558" name="l00558"></a><span class="lineno">  558</span>   <span class="comment">// }</span></div>
<div class="line"><a id="l00559" name="l00559"></a><span class="lineno">  559</span>   <span class="comment">//</span></div>
<div class="line"><a id="l00560" name="l00560"></a><span class="lineno">  560</span>   <span class="comment">// pBand = pDataSet-&gt;GetRasterBand(1);</span></div>
<div class="line"><a id="l00561" name="l00561"></a><span class="lineno">  561</span>   <span class="comment">// pBand-&gt;SetNoDataValue(m_dMissingValue);</span></div>
<div class="line"><a id="l00562" name="l00562"></a><span class="lineno">  562</span>   <span class="comment">// nRet = pBand-&gt;RasterIO(GF_Write, 0, 0, m_nXGridSize, m_nYGridSize, pdRaster, m_nXGridSize, m_nYGridSize, GDT_Float64, 0, 0, NULL);</span></div>
<div class="line"><a id="l00563" name="l00563"></a><span class="lineno">  563</span>   <span class="comment">//</span></div>
<div class="line"><a id="l00564" name="l00564"></a><span class="lineno">  564</span>   <span class="comment">// if (nRet == CE_Failure)</span></div>
<div class="line"><a id="l00565" name="l00565"></a><span class="lineno">  565</span>   <span class="comment">//    return RTN_ERR_GRIDCREATE;</span></div>
<div class="line"><a id="l00566" name="l00566"></a><span class="lineno">  566</span>   <span class="comment">//</span></div>
<div class="line"><a id="l00567" name="l00567"></a><span class="lineno">  567</span>   <span class="comment">// GDALClose(pDataSet);</span></div>
<div class="line"><a id="l00568" name="l00568"></a><span class="lineno">  568</span>   <span class="comment">// delete[] pdRaster;</span></div>
<div class="line"><a id="l00569" name="l00569"></a><span class="lineno">  569</span>   <span class="comment">// // DEBUG CODE ===========================================================================================================</span></div>
<div class="line"><a id="l00570" name="l00570"></a><span class="lineno">  570</span> </div>
<div class="line"><a id="l00571" name="l00571"></a><span class="lineno">  571</span>   <span class="comment">// Interpolate these wave properties for all remaining coastline points. Do this in along-coastline sequence</span></div>
<div class="line"><a id="l00572" name="l00572"></a><span class="lineno">  572</span>   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> nCoast = 0; nCoast &lt; static_cast&lt;int&gt;(<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>.size()); nCoast++)</div>
<div class="line"><a id="l00573" name="l00573"></a><span class="lineno">  573</span>   {</div>
<div class="line"><a id="l00574" name="l00574"></a><span class="lineno">  574</span>      <span class="keywordtype">int</span> nCoastSize = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].nGetCoastlineSize();</div>
<div class="line"><a id="l00575" name="l00575"></a><span class="lineno">  575</span>      <span class="keywordtype">int</span> nNumProfiles = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].nGetNumProfiles();</div>
<div class="line"><a id="l00576" name="l00576"></a><span class="lineno">  576</span> </div>
<div class="line"><a id="l00577" name="l00577"></a><span class="lineno">  577</span>      <span class="comment">// Interpolate these wave properties for all remaining coastline points. Do this in along-coastline sequence, but do not do this for the end-of-coastline profile (which is the final one)</span></div>
<div class="line"><a id="l00578" name="l00578"></a><span class="lineno">  578</span>      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> n = 0; n &lt; nNumProfiles - 1; n++)</div>
<div class="line"><a id="l00579" name="l00579"></a><span class="lineno">  579</span>         <a class="code hl_function" href="../../d1/d98/classCSimulation.html#a5c5b3c6af9aaf01e7bf236e88d397e2d">InterpolateWavePropertiesBetweenProfiles</a>(nCoast, n);</div>
<div class="line"><a id="l00580" name="l00580"></a><span class="lineno">  580</span> </div>
<div class="line"><a id="l00581" name="l00581"></a><span class="lineno">  581</span>      <span class="comment">// And do the same for the coastline cells</span></div>
<div class="line"><a id="l00582" name="l00582"></a><span class="lineno">  582</span>      <a class="code hl_function" href="../../d1/d98/classCSimulation.html#af4c1d4172cbc1ef26d5cae02ffe03409">InterpolateWaveHeightToCoastPoints</a>(nCoast);</div>
<div class="line"><a id="l00583" name="l00583"></a><span class="lineno">  583</span> </div>
<div class="line"><a id="l00584" name="l00584"></a><span class="lineno">  584</span>      <span class="comment">// Calculate wave energy at breaking for every point on the coastline</span></div>
<div class="line"><a id="l00585" name="l00585"></a><span class="lineno">  585</span>      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> nCoastPoint = 0; nCoastPoint &lt; nCoastSize; nCoastPoint++)</div>
<div class="line"><a id="l00586" name="l00586"></a><span class="lineno">  586</span>      {</div>
<div class="line"><a id="l00587" name="l00587"></a><span class="lineno">  587</span>         <span class="comment">// Equation 4 from Walkden &amp; Hall, 2005</span></div>
<div class="line"><a id="l00588" name="l00588"></a><span class="lineno">  588</span>         <span class="keywordtype">double</span> dBreakingWaveHeight = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].dGetBreakingWaveHeight(nCoastPoint);</div>
<div class="line"><a id="l00589" name="l00589"></a><span class="lineno">  589</span>         <span class="keywordtype">double</span> dCoastPointWavePeriod = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].dGetCoastDeepWaterWavePeriod(nCoastPoint);</div>
<div class="line"><a id="l00590" name="l00590"></a><span class="lineno">  590</span>         </div>
<div class="line"><a id="l00591" name="l00591"></a><span class="lineno">  591</span>         <span class="comment">// TODO 080 Why do we get -ve dBreakingWaveHeight here?</span></div>
<div class="line"><a id="l00592" name="l00592"></a><span class="lineno">  592</span>         <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d6/d2a/cme_8h.html#a61afa8560a3b39c80657661a1d8f76ab">bFPIsEqual</a>(dBreakingWaveHeight, <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#ac003bdff958dca839f5d274f15786e07">DBL_NODATA</a>, <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a08b1623863ee3bd4300a8892de323722">TOLERANCE</a>))</div>
<div class="line"><a id="l00593" name="l00593"></a><span class="lineno">  593</span>         {</div>
<div class="line"><a id="l00594" name="l00594"></a><span class="lineno">  594</span>            <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].SetBreakingWaveHeight(nCoastPoint, 0);</div>
<div class="line"><a id="l00595" name="l00595"></a><span class="lineno">  595</span>         }</div>
<div class="line"><a id="l00596" name="l00596"></a><span class="lineno">  596</span>         <span class="keywordflow">else</span></div>
<div class="line"><a id="l00597" name="l00597"></a><span class="lineno">  597</span>         {</div>
<div class="line"><a id="l00598" name="l00598"></a><span class="lineno">  598</span>            <span class="keywordtype">double</span> dErosiveWaveForce = pow(dBreakingWaveHeight, <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#add30b59022abb07bc55b76b57f1a60fb">WALKDEN_HALL_PARAM_1</a>) * pow(dCoastPointWavePeriod, <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a65a71870b31deafaa61220aa9b6fc9cb">WALKDEN_HALL_PARAM_2</a>);</div>
<div class="line"><a id="l00599" name="l00599"></a><span class="lineno">  599</span> </div>
<div class="line"><a id="l00600" name="l00600"></a><span class="lineno">  600</span>            <span class="comment">// Calculate total wave energy at this coast point during this timestep</span></div>
<div class="line"><a id="l00601" name="l00601"></a><span class="lineno">  601</span>            <span class="keywordtype">double</span> dWaveEnergy = dErosiveWaveForce * <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#abe93c25b27be66724952ffa6da7301fc">m_dTimeStep</a> * 3600;</div>
<div class="line"><a id="l00602" name="l00602"></a><span class="lineno">  602</span>            <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].SetWaveEnergyAtBreaking(nCoastPoint, dWaveEnergy);</div>
<div class="line"><a id="l00603" name="l00603"></a><span class="lineno">  603</span>         }</div>
<div class="line"><a id="l00604" name="l00604"></a><span class="lineno">  604</span>      }</div>
<div class="line"><a id="l00605" name="l00605"></a><span class="lineno">  605</span>   }</div>
<div class="line"><a id="l00606" name="l00606"></a><span class="lineno">  606</span>   <span class="keywordflow">return</span> <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#aa768cb14b5c6123ee95e6e4ebd9fe331">RTN_OK</a>;</div>
<div class="line"><a id="l00607" name="l00607"></a><span class="lineno">  607</span>}</div>
</div>
<div class="line"><a id="l00608" name="l00608"></a><span class="lineno">  608</span> </div>
<div class="line"><a id="l00609" name="l00609"></a><span class="lineno">  609</span><span class="comment">//===============================================================================================================================</span></div>
<div class="line"><a id="l00611" name="l00611"></a><span class="lineno">  611</span><span class="comment">//===============================================================================================================================</span></div>
<div class="foldopen" id="foldopen00612" data-start="{" data-end="}">
<div class="line"><a id="l00612" name="l00612"></a><span class="lineno"><a class="line" href="../../d1/d98/classCSimulation.html#afc35aaa515595540ebadb58795abf4a2">  612</a></span><span class="keywordtype">double</span> <a class="code hl_function" href="../../d1/d98/classCSimulation.html#afc35aaa515595540ebadb58795abf4a2">CSimulation::dCalcWaveAngleToCoastNormal</a>(<span class="keywordtype">double</span> <span class="keyword">const</span> dCoastAngle, <span class="keywordtype">double</span> <span class="keyword">const</span> dWaveAngle, <span class="keywordtype">int</span> <span class="keyword">const</span> nSeaHand)</div>
<div class="line"><a id="l00613" name="l00613"></a><span class="lineno">  613</span>{</div>
<div class="line"><a id="l00614" name="l00614"></a><span class="lineno">  614</span>   <span class="keywordtype">double</span> dWaveToNormalAngle = 0;</div>
<div class="line"><a id="l00615" name="l00615"></a><span class="lineno">  615</span> </div>
<div class="line"><a id="l00616" name="l00616"></a><span class="lineno">  616</span>   <span class="keywordflow">if</span> (nSeaHand == <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#afdd3411d0fa60c62522af14ea2a90570">LEFT_HANDED</a>)</div>
<div class="line"><a id="l00617" name="l00617"></a><span class="lineno">  617</span>      <span class="comment">// Left-handed coast</span></div>
<div class="line"><a id="l00618" name="l00618"></a><span class="lineno">  618</span>      dWaveToNormalAngle = fmod((dWaveAngle - dCoastAngle + 360), 360) - 90;</div>
<div class="line"><a id="l00619" name="l00619"></a><span class="lineno">  619</span>   <span class="keywordflow">else</span></div>
<div class="line"><a id="l00620" name="l00620"></a><span class="lineno">  620</span>      <span class="comment">// Right-handed coast</span></div>
<div class="line"><a id="l00621" name="l00621"></a><span class="lineno">  621</span>      dWaveToNormalAngle = fmod((dWaveAngle - dCoastAngle + 360), 360) - 270;</div>
<div class="line"><a id="l00622" name="l00622"></a><span class="lineno">  622</span> </div>
<div class="line"><a id="l00623" name="l00623"></a><span class="lineno">  623</span>   <span class="keywordflow">if</span> ((dWaveToNormalAngle &gt;= 90) || (dWaveToNormalAngle &lt;= -90))</div>
<div class="line"><a id="l00624" name="l00624"></a><span class="lineno">  624</span>      dWaveToNormalAngle = <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#ac003bdff958dca839f5d274f15786e07">DBL_NODATA</a>;</div>
<div class="line"><a id="l00625" name="l00625"></a><span class="lineno">  625</span> </div>
<div class="line"><a id="l00626" name="l00626"></a><span class="lineno">  626</span>   <span class="keywordflow">return</span> dWaveToNormalAngle;</div>
<div class="line"><a id="l00627" name="l00627"></a><span class="lineno">  627</span>}</div>
</div>
<div class="line"><a id="l00628" name="l00628"></a><span class="lineno">  628</span> </div>
<div class="line"><a id="l00629" name="l00629"></a><span class="lineno">  629</span><span class="comment">//===============================================================================================================================</span></div>
<div class="line"><a id="l00631" name="l00631"></a><span class="lineno">  631</span><span class="comment">//===============================================================================================================================</span></div>
<div class="foldopen" id="foldopen00632" data-start="{" data-end="}">
<div class="line"><a id="l00632" name="l00632"></a><span class="lineno"><a class="line" href="../../d1/d98/classCSimulation.html#a1467ae7c46f92c9cd09dd8bcb683a485">  632</a></span><span class="keywordtype">int</span> <a class="code hl_function" href="../../d1/d98/classCSimulation.html#a1467ae7c46f92c9cd09dd8bcb683a485">CSimulation::nCalcWavePropertiesOnProfile</a>(<span class="keywordtype">int</span> <span class="keyword">const</span> nCoast, <span class="keywordtype">int</span> <span class="keyword">const</span> nCoastSize, <a class="code hl_class" href="../../da/dae/classCGeomProfile.html">CGeomProfile</a>* pProfile, vector&lt;double&gt;* pVdX, vector&lt;double&gt;* pVdY, vector&lt;double&gt;* pVdHeightX, vector&lt;double&gt;* pVdHeightY, vector&lt;bool&gt;* pVbBreaking)</div>
<div class="line"><a id="l00633" name="l00633"></a><span class="lineno">  633</span>{</div>
<div class="line"><a id="l00634" name="l00634"></a><span class="lineno">  634</span>   <span class="comment">// Only do this for profiles without problems. Still do start- and end-of-coast profiles however</span></div>
<div class="line"><a id="l00635" name="l00635"></a><span class="lineno">  635</span>   <span class="keywordflow">if</span> (! pProfile-&gt;<a class="code hl_function" href="../../da/dae/classCGeomProfile.html#aac223e2610d50ca2c7eadaf8542e9498">bOKIncStartAndEndOfCoast</a>())</div>
<div class="line"><a id="l00636" name="l00636"></a><span class="lineno">  636</span>   {</div>
<div class="line"><a id="l00637" name="l00637"></a><span class="lineno">  637</span>      <span class="comment">// if (m_nLogFileDetail &gt;= LOG_FILE_ALL)</span></div>
<div class="line"><a id="l00638" name="l00638"></a><span class="lineno">  638</span>      <span class="comment">//    LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: Coast &quot; &lt;&lt; nCoast &lt;&lt; &quot;, profile &quot; &lt;&lt; nProfile &lt;&lt; &quot; has been marked invalid, will not calc wave properties on this profile&quot; &lt;&lt; endl;</span></div>
<div class="line"><a id="l00639" name="l00639"></a><span class="lineno">  639</span> </div>
<div class="line"><a id="l00640" name="l00640"></a><span class="lineno">  640</span>      <span class="keywordflow">return</span> <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#aa768cb14b5c6123ee95e6e4ebd9fe331">RTN_OK</a>;</div>
<div class="line"><a id="l00641" name="l00641"></a><span class="lineno">  641</span>   }</div>
<div class="line"><a id="l00642" name="l00642"></a><span class="lineno">  642</span> </div>
<div class="line"><a id="l00643" name="l00643"></a><span class="lineno">  643</span>   <span class="comment">// Calculate some wave properties based on the wave period following Airy wave theory</span></div>
<div class="line"><a id="l00644" name="l00644"></a><span class="lineno">  644</span>   <span class="keywordtype">double</span> dDeepWaterWavePeriod = pProfile-&gt;<a class="code hl_function" href="../../da/dae/classCGeomProfile.html#af21ee378022208ccdfdfa56178c3ee1b">dGetProfileDeepWaterWavePeriod</a>();</div>
<div class="line"><a id="l00645" name="l00645"></a><span class="lineno">  645</span> </div>
<div class="line"><a id="l00646" name="l00646"></a><span class="lineno">  646</span>   <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#acb7418ac5450534bbaa9619554a9b20f">m_dC_0</a> = (<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a109431a5f83244ad4627895e30802b4f">m_dG</a> * dDeepWaterWavePeriod) / (2 * <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a5d502a06fdd71825be49e07c95496b16">PI</a>); <span class="comment">// Deep water (offshore) wave celerity (m/s)</span></div>
<div class="line"><a id="l00647" name="l00647"></a><span class="lineno">  647</span>   <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a19723831442bb99d698366c7194a6f58">m_dL_0</a> = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#acb7418ac5450534bbaa9619554a9b20f">m_dC_0</a> * dDeepWaterWavePeriod;            <span class="comment">// Deep water (offshore) wave length (m)</span></div>
<div class="line"><a id="l00648" name="l00648"></a><span class="lineno">  648</span> </div>
<div class="line"><a id="l00649" name="l00649"></a><span class="lineno">  649</span>   <span class="keywordtype">int</span> nSeaHand = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].nGetSeaHandedness();</div>
<div class="line"><a id="l00650" name="l00650"></a><span class="lineno">  650</span>   <span class="keywordtype">int</span> nCoastPoint = pProfile-&gt;<a class="code hl_function" href="../../da/dae/classCGeomProfile.html#a343fd2b73e3a87cf425572860e79ebd6">nGetCoastPoint</a>();</div>
<div class="line"><a id="l00651" name="l00651"></a><span class="lineno">  651</span> </div>
<div class="line"><a id="l00652" name="l00652"></a><span class="lineno">  652</span>   <span class="comment">// Get the flux orientation (the orientation of a line which is tangential to the coast) at adjacent coastline points. Note special treatment for the coastline end points</span></div>
<div class="line"><a id="l00653" name="l00653"></a><span class="lineno">  653</span>   <span class="keywordtype">double</span> dFluxOrientationThis = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].dGetFluxOrientation(nCoastPoint);</div>
<div class="line"><a id="l00654" name="l00654"></a><span class="lineno">  654</span>   <span class="keywordtype">double</span> dFluxOrientationPrev = 0;</div>
<div class="line"><a id="l00655" name="l00655"></a><span class="lineno">  655</span>   <span class="keywordtype">double</span> dFluxOrientationNext = 0;</div>
<div class="line"><a id="l00656" name="l00656"></a><span class="lineno">  656</span> </div>
<div class="line"><a id="l00657" name="l00657"></a><span class="lineno">  657</span>   <span class="keywordflow">if</span> (nCoastPoint == 0)</div>
<div class="line"><a id="l00658" name="l00658"></a><span class="lineno">  658</span>   {</div>
<div class="line"><a id="l00659" name="l00659"></a><span class="lineno">  659</span>      dFluxOrientationPrev = dFluxOrientationThis;</div>
<div class="line"><a id="l00660" name="l00660"></a><span class="lineno">  660</span>      dFluxOrientationNext = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].dGetFluxOrientation(1);</div>
<div class="line"><a id="l00661" name="l00661"></a><span class="lineno">  661</span>   }</div>
<div class="line"><a id="l00662" name="l00662"></a><span class="lineno">  662</span>   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (nCoastPoint == nCoastSize - 1)</div>
<div class="line"><a id="l00663" name="l00663"></a><span class="lineno">  663</span>   {</div>
<div class="line"><a id="l00664" name="l00664"></a><span class="lineno">  664</span>      dFluxOrientationPrev = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].dGetFluxOrientation(nCoastPoint - 2);</div>
<div class="line"><a id="l00665" name="l00665"></a><span class="lineno">  665</span>      dFluxOrientationNext = dFluxOrientationThis;</div>
<div class="line"><a id="l00666" name="l00666"></a><span class="lineno">  666</span>   }</div>
<div class="line"><a id="l00667" name="l00667"></a><span class="lineno">  667</span>   <span class="keywordflow">else</span></div>
<div class="line"><a id="l00668" name="l00668"></a><span class="lineno">  668</span>   {</div>
<div class="line"><a id="l00669" name="l00669"></a><span class="lineno">  669</span>      dFluxOrientationPrev = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].dGetFluxOrientation(nCoastPoint - 1);</div>
<div class="line"><a id="l00670" name="l00670"></a><span class="lineno">  670</span>      dFluxOrientationNext = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].dGetFluxOrientation(nCoastPoint + 1);</div>
<div class="line"><a id="l00671" name="l00671"></a><span class="lineno">  671</span>   }</div>
<div class="line"><a id="l00672" name="l00672"></a><span class="lineno">  672</span> </div>
<div class="line"><a id="l00673" name="l00673"></a><span class="lineno">  673</span>   <span class="comment">// Get the deep water wave orientation for this profile</span></div>
<div class="line"><a id="l00674" name="l00674"></a><span class="lineno">  674</span>   <span class="keywordtype">double</span> dDeepWaterWaveAngle = pProfile-&gt;<a class="code hl_function" href="../../da/dae/classCGeomProfile.html#a1efc4d74a49196572e58433ab05b5d86">dGetProfileDeepWaterWaveAngle</a>();</div>
<div class="line"><a id="l00675" name="l00675"></a><span class="lineno">  675</span> </div>
<div class="line"><a id="l00676" name="l00676"></a><span class="lineno">  676</span>   <span class="comment">// Calculate the angle between the deep water wave direction and a normal to the coast tangent</span></div>
<div class="line"><a id="l00677" name="l00677"></a><span class="lineno">  677</span>   <span class="keywordtype">double</span> dWaveToNormalAngle = <a class="code hl_function" href="../../d1/d98/classCSimulation.html#afc35aaa515595540ebadb58795abf4a2">dCalcWaveAngleToCoastNormal</a>(dFluxOrientationThis, dDeepWaterWaveAngle, nSeaHand);</div>
<div class="line"><a id="l00678" name="l00678"></a><span class="lineno">  678</span> </div>
<div class="line"><a id="l00679" name="l00679"></a><span class="lineno">  679</span>   <span class="comment">// Are the waves off-shore?</span></div>
<div class="line"><a id="l00680" name="l00680"></a><span class="lineno">  680</span>   <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d6/d2a/cme_8h.html#a61afa8560a3b39c80657661a1d8f76ab">bFPIsEqual</a>(dWaveToNormalAngle, <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#ac003bdff958dca839f5d274f15786e07">DBL_NODATA</a>, <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a08b1623863ee3bd4300a8892de323722">TOLERANCE</a>))</div>
<div class="line"><a id="l00681" name="l00681"></a><span class="lineno">  681</span>   {</div>
<div class="line"><a id="l00682" name="l00682"></a><span class="lineno">  682</span>      <span class="comment">// They are so, do nothing (each cell under the profile has already been initialised with deep water wave height and wave direction)</span></div>
<div class="line"><a id="l00683" name="l00683"></a><span class="lineno">  683</span>      <span class="comment">//       LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: profile &quot; &lt;&lt; nProfile &lt;&lt; &quot; has sea to &quot; &lt;&lt; (m_VCoast[nCoast].nGetSeaHandedness() == RIGHT_HANDED ? &quot;right&quot; : &quot;left&quot;) &lt;&lt; &quot; dWaveToNormalAngle = &quot; &lt;&lt; dWaveToNormalAngle &lt;&lt; &quot; which is off-shore&quot; &lt;&lt; endl;</span></div>
<div class="line"><a id="l00684" name="l00684"></a><span class="lineno">  684</span> </div>
<div class="line"><a id="l00685" name="l00685"></a><span class="lineno">  685</span>      <span class="keywordflow">return</span> <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#aa768cb14b5c6123ee95e6e4ebd9fe331">RTN_OK</a>;</div>
<div class="line"><a id="l00686" name="l00686"></a><span class="lineno">  686</span>   }</div>
<div class="line"><a id="l00687" name="l00687"></a><span class="lineno">  687</span> </div>
<div class="line"><a id="l00688" name="l00688"></a><span class="lineno">  688</span>   <span class="comment">//    LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: profile = &quot; &lt;&lt; nProfile &lt;&lt; &quot; has sea to &quot; &lt;&lt; (m_VCoast[nCoast].nGetSeaHandedness() == RIGHT_HANDED ? &quot;right&quot; : &quot;left&quot;) &lt;&lt; &quot; dWaveToNormalAngle = &quot; &lt;&lt; dWaveToNormalAngle &lt;&lt; &quot; which is &quot; &lt;&lt; (dWaveToNormalAngle &lt; 0 ? &quot;DOWN&quot; : &quot;UP&quot;) &lt;&lt; &quot;-coast&quot; &lt;&lt; endl;</span></div>
<div class="line"><a id="l00689" name="l00689"></a><span class="lineno">  689</span> </div>
<div class="line"><a id="l00690" name="l00690"></a><span class="lineno">  690</span>   <span class="comment">// Calculate the angle between the deep water wave direction and a normal to the coast tangent for the previous coast point</span></div>
<div class="line"><a id="l00691" name="l00691"></a><span class="lineno">  691</span>   <span class="keywordtype">double</span> dWaveToNormalAnglePrev;</div>
<div class="line"><a id="l00692" name="l00692"></a><span class="lineno">  692</span>   <span class="keywordflow">if</span> (nCoastPoint &gt; 0)</div>
<div class="line"><a id="l00693" name="l00693"></a><span class="lineno">  693</span>   {</div>
<div class="line"><a id="l00694" name="l00694"></a><span class="lineno">  694</span>      <span class="comment">// Get the deep water wave orientation for the up-coast point</span></div>
<div class="line"><a id="l00695" name="l00695"></a><span class="lineno">  695</span>      <span class="keywordtype">double</span> dPrevDeepWaterWaveAngle = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].dGetCoastDeepWaterWaveAngle(nCoastPoint - 1);</div>
<div class="line"><a id="l00696" name="l00696"></a><span class="lineno">  696</span> </div>
<div class="line"><a id="l00697" name="l00697"></a><span class="lineno">  697</span>      dWaveToNormalAnglePrev = <a class="code hl_function" href="../../d1/d98/classCSimulation.html#afc35aaa515595540ebadb58795abf4a2">dCalcWaveAngleToCoastNormal</a>(dFluxOrientationPrev, dPrevDeepWaterWaveAngle, nSeaHand);</div>
<div class="line"><a id="l00698" name="l00698"></a><span class="lineno">  698</span>   }</div>
<div class="line"><a id="l00699" name="l00699"></a><span class="lineno">  699</span>   <span class="keywordflow">else</span></div>
<div class="line"><a id="l00700" name="l00700"></a><span class="lineno">  700</span>   {</div>
<div class="line"><a id="l00701" name="l00701"></a><span class="lineno">  701</span>      dWaveToNormalAnglePrev = dWaveToNormalAngle;</div>
<div class="line"><a id="l00702" name="l00702"></a><span class="lineno">  702</span>   }</div>
<div class="line"><a id="l00703" name="l00703"></a><span class="lineno">  703</span> </div>
<div class="line"><a id="l00704" name="l00704"></a><span class="lineno">  704</span>   <span class="comment">//    if (dWaveToNormalAnglePrev == DBL_NODATA)</span></div>
<div class="line"><a id="l00705" name="l00705"></a><span class="lineno">  705</span>   <span class="comment">//       LogStream &lt;&lt; &quot;\tPrevious profile, dWaveToNormalAnglePrev = &quot; &lt;&lt; dWaveToNormalAnglePrev &lt;&lt; &quot; which is off-shore&quot; &lt;&lt; endl;</span></div>
<div class="line"><a id="l00706" name="l00706"></a><span class="lineno">  706</span>   <span class="comment">//    else</span></div>
<div class="line"><a id="l00707" name="l00707"></a><span class="lineno">  707</span>   <span class="comment">//       LogStream &lt;&lt; &quot;\tPrevious profile, dWaveToNormalAnglePrev = &quot; &lt;&lt; dWaveToNormalAnglePrev &lt;&lt; &quot; which is &quot; &lt;&lt; (dWaveToNormalAnglePrev &lt; 0 ? &quot;DOWN&quot; : &quot;UP&quot;) &lt;&lt; &quot;-coast&quot; &lt;&lt; endl;</span></div>
<div class="line"><a id="l00708" name="l00708"></a><span class="lineno">  708</span> </div>
<div class="line"><a id="l00709" name="l00709"></a><span class="lineno">  709</span>   <span class="comment">// Calculate the angle between the deep water wave direction and a normal to the coast tangent for the next coast point</span></div>
<div class="line"><a id="l00710" name="l00710"></a><span class="lineno">  710</span>   <span class="keywordtype">double</span> dWaveToNormalAngleNext;</div>
<div class="line"><a id="l00711" name="l00711"></a><span class="lineno">  711</span>   <span class="keywordflow">if</span> (nCoastPoint &lt; nCoastSize - 1)</div>
<div class="line"><a id="l00712" name="l00712"></a><span class="lineno">  712</span>   {</div>
<div class="line"><a id="l00713" name="l00713"></a><span class="lineno">  713</span>      <span class="comment">// Get the deep water wave orientation for the down-coast point</span></div>
<div class="line"><a id="l00714" name="l00714"></a><span class="lineno">  714</span>      <span class="keywordtype">double</span> dNextDeepWaterWaveAngle = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].dGetCoastDeepWaterWaveAngle(nCoastPoint + 1);</div>
<div class="line"><a id="l00715" name="l00715"></a><span class="lineno">  715</span> </div>
<div class="line"><a id="l00716" name="l00716"></a><span class="lineno">  716</span>      dWaveToNormalAngleNext = <a class="code hl_function" href="../../d1/d98/classCSimulation.html#afc35aaa515595540ebadb58795abf4a2">dCalcWaveAngleToCoastNormal</a>(dFluxOrientationNext, dNextDeepWaterWaveAngle, nSeaHand);</div>
<div class="line"><a id="l00717" name="l00717"></a><span class="lineno">  717</span>   }</div>
<div class="line"><a id="l00718" name="l00718"></a><span class="lineno">  718</span>   <span class="keywordflow">else</span></div>
<div class="line"><a id="l00719" name="l00719"></a><span class="lineno">  719</span>   {</div>
<div class="line"><a id="l00720" name="l00720"></a><span class="lineno">  720</span>      dWaveToNormalAngleNext = dWaveToNormalAngle;</div>
<div class="line"><a id="l00721" name="l00721"></a><span class="lineno">  721</span>   }</div>
<div class="line"><a id="l00722" name="l00722"></a><span class="lineno">  722</span> </div>
<div class="line"><a id="l00723" name="l00723"></a><span class="lineno">  723</span>   <span class="comment">//    if (dWaveToNormalAngleNext == DBL_NODATA)</span></div>
<div class="line"><a id="l00724" name="l00724"></a><span class="lineno">  724</span>   <span class="comment">//       LogStream &lt;&lt; &quot;\tNext profile, dWaveToNormalAngleNext = &quot; &lt;&lt; dWaveToNormalAngleNext &lt;&lt; &quot; which is off-shore&quot; &lt;&lt; endl;</span></div>
<div class="line"><a id="l00725" name="l00725"></a><span class="lineno">  725</span>   <span class="comment">//    else</span></div>
<div class="line"><a id="l00726" name="l00726"></a><span class="lineno">  726</span>   <span class="comment">//       LogStream &lt;&lt; &quot;\tNext profile, dWaveToNormalAngleNext = &quot; &lt;&lt; dWaveToNormalAngleNext &lt;&lt; &quot; which is &quot; &lt;&lt; (dWaveToNormalAngleNext &lt; 0 ? &quot;DOWN&quot; : &quot;UP&quot;) &lt;&lt; &quot;-coast&quot; &lt;&lt; endl;</span></div>
<div class="line"><a id="l00727" name="l00727"></a><span class="lineno">  727</span> </div>
<div class="line"><a id="l00728" name="l00728"></a><span class="lineno">  728</span>   <span class="comment">// Following Ashton and Murray (2006), if we have high-angle waves then use the flux orientation of the previous (up-coast) profile, if transitioning from diffusive to antidiffusive use flux maximizing angle (45 degrees)</span></div>
<div class="line"><a id="l00729" name="l00729"></a><span class="lineno">  729</span>   <span class="keywordflow">if</span> ((dWaveToNormalAngle &gt; 0) &amp;&amp; (! <a class="code hl_function" href="../../d6/d2a/cme_8h.html#a61afa8560a3b39c80657661a1d8f76ab">bFPIsEqual</a>(dWaveToNormalAnglePrev, <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#ac003bdff958dca839f5d274f15786e07">DBL_NODATA</a>, <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a08b1623863ee3bd4300a8892de323722">TOLERANCE</a>)) &amp;&amp; (dWaveToNormalAnglePrev &gt; 0))</div>
<div class="line"><a id="l00730" name="l00730"></a><span class="lineno">  730</span>   {</div>
<div class="line"><a id="l00731" name="l00731"></a><span class="lineno">  731</span>      <span class="keywordflow">if</span> (dWaveToNormalAngle &gt; 45)</div>
<div class="line"><a id="l00732" name="l00732"></a><span class="lineno">  732</span>      {</div>
<div class="line"><a id="l00733" name="l00733"></a><span class="lineno">  733</span>         <span class="keywordflow">if</span> (dWaveToNormalAnglePrev &lt; 45)</div>
<div class="line"><a id="l00734" name="l00734"></a><span class="lineno">  734</span>         {</div>
<div class="line"><a id="l00735" name="l00735"></a><span class="lineno">  735</span>            dWaveToNormalAngle = 45;</div>
<div class="line"><a id="l00736" name="l00736"></a><span class="lineno">  736</span>            <span class="comment">//            LogStream &lt;&lt; &quot;\tA1&quot; &lt;&lt; endl;</span></div>
<div class="line"><a id="l00737" name="l00737"></a><span class="lineno">  737</span>         }</div>
<div class="line"><a id="l00738" name="l00738"></a><span class="lineno">  738</span>         <span class="keywordflow">else</span></div>
<div class="line"><a id="l00739" name="l00739"></a><span class="lineno">  739</span>         {</div>
<div class="line"><a id="l00740" name="l00740"></a><span class="lineno">  740</span>            dWaveToNormalAngle = dWaveToNormalAnglePrev;</div>
<div class="line"><a id="l00741" name="l00741"></a><span class="lineno">  741</span>            <span class="comment">//            LogStream &lt;&lt; &quot;\tA2&quot; &lt;&lt; endl;</span></div>
<div class="line"><a id="l00742" name="l00742"></a><span class="lineno">  742</span>         }</div>
<div class="line"><a id="l00743" name="l00743"></a><span class="lineno">  743</span>      }</div>
<div class="line"><a id="l00744" name="l00744"></a><span class="lineno">  744</span>   }</div>
<div class="line"><a id="l00745" name="l00745"></a><span class="lineno">  745</span>   <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((dWaveToNormalAngle &lt; 0) &amp;&amp; (! <a class="code hl_function" href="../../d6/d2a/cme_8h.html#a61afa8560a3b39c80657661a1d8f76ab">bFPIsEqual</a>(dWaveToNormalAngleNext, <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#ac003bdff958dca839f5d274f15786e07">DBL_NODATA</a>, <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a08b1623863ee3bd4300a8892de323722">TOLERANCE</a>)) &amp;&amp; (dWaveToNormalAngleNext &lt; 0))</div>
<div class="line"><a id="l00746" name="l00746"></a><span class="lineno">  746</span>   {</div>
<div class="line"><a id="l00747" name="l00747"></a><span class="lineno">  747</span>      <span class="keywordflow">if</span> (dWaveToNormalAngle &lt; -45)</div>
<div class="line"><a id="l00748" name="l00748"></a><span class="lineno">  748</span>      {</div>
<div class="line"><a id="l00749" name="l00749"></a><span class="lineno">  749</span>         <span class="keywordflow">if</span> (dWaveToNormalAngleNext &gt; -45)</div>
<div class="line"><a id="l00750" name="l00750"></a><span class="lineno">  750</span>         {</div>
<div class="line"><a id="l00751" name="l00751"></a><span class="lineno">  751</span>            dWaveToNormalAngle = -45;</div>
<div class="line"><a id="l00752" name="l00752"></a><span class="lineno">  752</span>            <span class="comment">//            LogStream &lt;&lt; &quot;\tB1&quot; &lt;&lt; endl;</span></div>
<div class="line"><a id="l00753" name="l00753"></a><span class="lineno">  753</span>         }</div>
<div class="line"><a id="l00754" name="l00754"></a><span class="lineno">  754</span>         <span class="keywordflow">else</span></div>
<div class="line"><a id="l00755" name="l00755"></a><span class="lineno">  755</span>         {</div>
<div class="line"><a id="l00756" name="l00756"></a><span class="lineno">  756</span>            dWaveToNormalAngle = dWaveToNormalAngleNext;</div>
<div class="line"><a id="l00757" name="l00757"></a><span class="lineno">  757</span>            <span class="comment">//            LogStream &lt;&lt; &quot;\tB2&quot; &lt;&lt; endl;</span></div>
<div class="line"><a id="l00758" name="l00758"></a><span class="lineno">  758</span>         }</div>
<div class="line"><a id="l00759" name="l00759"></a><span class="lineno">  759</span>      }</div>
<div class="line"><a id="l00760" name="l00760"></a><span class="lineno">  760</span>   }</div>
<div class="line"><a id="l00761" name="l00761"></a><span class="lineno">  761</span>   <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((dWaveToNormalAngle &gt; 45) &amp;&amp; (! <a class="code hl_function" href="../../d6/d2a/cme_8h.html#a61afa8560a3b39c80657661a1d8f76ab">bFPIsEqual</a>(dWaveToNormalAnglePrev, <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#ac003bdff958dca839f5d274f15786e07">DBL_NODATA</a>, <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a08b1623863ee3bd4300a8892de323722">TOLERANCE</a>)) &amp;&amp; (dWaveToNormalAnglePrev &gt; 0))</div>
<div class="line"><a id="l00762" name="l00762"></a><span class="lineno">  762</span>   {</div>
<div class="line"><a id="l00763" name="l00763"></a><span class="lineno">  763</span>      <span class="comment">// The wave direction here has an up-coast (decreasing indices) component: so for high-angle waves use the orientation from the up-coast (previous) profile</span></div>
<div class="line"><a id="l00764" name="l00764"></a><span class="lineno">  764</span>      <span class="comment">//      LogStream &lt;&lt; &quot;\tCCC&quot; &lt;&lt; endl;</span></div>
<div class="line"><a id="l00765" name="l00765"></a><span class="lineno">  765</span> </div>
<div class="line"><a id="l00766" name="l00766"></a><span class="lineno">  766</span>      dWaveToNormalAngle = dFluxOrientationPrev;</div>
<div class="line"><a id="l00767" name="l00767"></a><span class="lineno">  767</span>   }</div>
<div class="line"><a id="l00768" name="l00768"></a><span class="lineno">  768</span>   <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((dWaveToNormalAngle &lt; -45) &amp;&amp; (! <a class="code hl_function" href="../../d6/d2a/cme_8h.html#a61afa8560a3b39c80657661a1d8f76ab">bFPIsEqual</a>(dWaveToNormalAngleNext, <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#ac003bdff958dca839f5d274f15786e07">DBL_NODATA</a>, <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a08b1623863ee3bd4300a8892de323722">TOLERANCE</a>)) &amp;&amp; (dWaveToNormalAngleNext &lt; 0))</div>
<div class="line"><a id="l00769" name="l00769"></a><span class="lineno">  769</span>   {</div>
<div class="line"><a id="l00770" name="l00770"></a><span class="lineno">  770</span>      <span class="comment">// The wave direction here has a down-coast (increasing indices) component: so for high-angle waves use the orientation from the down-coast (next) profile</span></div>
<div class="line"><a id="l00771" name="l00771"></a><span class="lineno">  771</span>      <span class="comment">//      LogStream &lt;&lt; &quot;\tDDD&quot; &lt;&lt; endl;</span></div>
<div class="line"><a id="l00772" name="l00772"></a><span class="lineno">  772</span> </div>
<div class="line"><a id="l00773" name="l00773"></a><span class="lineno">  773</span>      dWaveToNormalAngle = dFluxOrientationNext;</div>
<div class="line"><a id="l00774" name="l00774"></a><span class="lineno">  774</span>   }</div>
<div class="line"><a id="l00775" name="l00775"></a><span class="lineno">  775</span> </div>
<div class="line"><a id="l00776" name="l00776"></a><span class="lineno">  776</span>   <span class="comment">// Initialize the wave properties at breaking for this profile</span></div>
<div class="line"><a id="l00777" name="l00777"></a><span class="lineno">  777</span>   <span class="keywordtype">bool</span> bBreaking = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00778" name="l00778"></a><span class="lineno">  778</span> </div>
<div class="line"><a id="l00779" name="l00779"></a><span class="lineno">  779</span>   <span class="keywordtype">int</span> nProfileSize = pProfile-&gt;<a class="code hl_function" href="../../da/dae/classCGeomProfile.html#a8a29c3fa364ab1f7b3930b7a9c83f45f">nGetNumCellsInProfile</a>();</div>
<div class="line"><a id="l00780" name="l00780"></a><span class="lineno">  780</span>   <span class="keywordtype">int</span> nProfileBreakingDist = 0;</div>
<div class="line"><a id="l00781" name="l00781"></a><span class="lineno">  781</span> </div>
<div class="line"><a id="l00782" name="l00782"></a><span class="lineno">  782</span>   <span class="keywordtype">double</span> dProfileBreakingWaveHeight = <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#ac003bdff958dca839f5d274f15786e07">DBL_NODATA</a>;</div>
<div class="line"><a id="l00783" name="l00783"></a><span class="lineno">  783</span>   <span class="keywordtype">double</span> dProfileBreakingWaveAngle = 0;</div>
<div class="line"><a id="l00784" name="l00784"></a><span class="lineno">  784</span>   <span class="keywordtype">double</span> dProfileBreakingDepth = 0;</div>
<div class="line"><a id="l00785" name="l00785"></a><span class="lineno">  785</span>   <span class="keywordtype">double</span> dProfileWaveHeight = <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#ac003bdff958dca839f5d274f15786e07">DBL_NODATA</a>;</div>
<div class="line"><a id="l00786" name="l00786"></a><span class="lineno">  786</span>   <span class="keywordtype">double</span> dProfileDeepWaterWaveHeight = pProfile-&gt;<a class="code hl_function" href="../../da/dae/classCGeomProfile.html#a25efa8fb09d83f8e50b82e90eb6c9a59">dGetProfileDeepWaterWaveHeight</a>();</div>
<div class="line"><a id="l00787" name="l00787"></a><span class="lineno">  787</span>   <span class="keywordtype">double</span> dProfileWaveAngle = <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#ac003bdff958dca839f5d274f15786e07">DBL_NODATA</a>;</div>
<div class="line"><a id="l00788" name="l00788"></a><span class="lineno">  788</span>   <span class="keywordtype">double</span> dProfileDeepWaterWaveAngle = pProfile-&gt;<a class="code hl_function" href="../../da/dae/classCGeomProfile.html#a1efc4d74a49196572e58433ab05b5d86">dGetProfileDeepWaterWaveAngle</a>();</div>
<div class="line"><a id="l00789" name="l00789"></a><span class="lineno">  789</span> </div>
<div class="line"><a id="l00790" name="l00790"></a><span class="lineno">  790</span>   vector&lt;bool&gt; VbWaveIsBreaking(nProfileSize, 0);</div>
<div class="line"><a id="l00791" name="l00791"></a><span class="lineno">  791</span> </div>
<div class="line"><a id="l00792" name="l00792"></a><span class="lineno">  792</span>   vector&lt;double&gt; VdWaveHeight(nProfileSize, 0);</div>
<div class="line"><a id="l00793" name="l00793"></a><span class="lineno">  793</span>   vector&lt;double&gt; VdWaveSetupSurge(nProfileSize, 0);</div>
<div class="line"><a id="l00794" name="l00794"></a><span class="lineno">  794</span>   <span class="comment">// vector&lt;double&gt; VdStormSurge(nProfileSize, 0);</span></div>
<div class="line"><a id="l00795" name="l00795"></a><span class="lineno">  795</span>   vector&lt;double&gt; VdWaveSetupRunUp(nProfileSize, 0);</div>
<div class="line"><a id="l00796" name="l00796"></a><span class="lineno">  796</span>   vector&lt;double&gt; VdWaveDirection(nProfileSize, 0);</div>
<div class="line"><a id="l00797" name="l00797"></a><span class="lineno">  797</span> </div>
<div class="line"><a id="l00798" name="l00798"></a><span class="lineno">  798</span>   <span class="keywordflow">if</span> (<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a8339da211b79a1bbac7061604218dd6e">m_nWavePropagationModel</a> == <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a4aa93bef3c450c95fa8d0251dac261e2">WAVE_MODEL_CSHORE</a>)</div>
<div class="line"><a id="l00799" name="l00799"></a><span class="lineno">  799</span>   {</div>
<div class="line"><a id="l00800" name="l00800"></a><span class="lineno">  800</span>      <span class="comment">// We are using CShore to propagate the waves</span></div>
<div class="line"><a id="l00801" name="l00801"></a><span class="lineno">  801</span>      <span class="keywordtype">double</span> dCShoreTimeStep = 3600;   <span class="comment">// In seconds, not important because we are not using CShore to erode the profile, just to get the hydrodynamics</span></div>
<div class="line"><a id="l00802" name="l00802"></a><span class="lineno">  802</span>      <span class="keywordtype">double</span> dSurgeLevel = <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a8d58911dc3dd7eb3bdcf5af4efc9a16d">CSHORE_SURGE_LEVEL</a>;</div>
<div class="line"><a id="l00803" name="l00803"></a><span class="lineno">  803</span> </div>
<div class="line"><a id="l00804" name="l00804"></a><span class="lineno">  804</span>      <span class="comment">// Set up vectors for the coastline-normal profile elevations. The length of this vector line is given by the number of cells &#39;under&#39; the profile. Thus each point on the vector relates to a single cell in the grid. This assumes that all points on the profile vector are equally spaced (not quite true, depends on the orientation of the line segments which comprise the profile)</span></div>
<div class="line"><a id="l00805" name="l00805"></a><span class="lineno">  805</span>      vector&lt;double&gt; VdProfileZ;                   <span class="comment">// Initial (pre-erosion) elevation of both consolidated and unconsolidated sediment for cells &#39;under&#39; the profile, in CShore units</span></div>
<div class="line"><a id="l00806" name="l00806"></a><span class="lineno">  806</span>      vector&lt;double&gt; VdProfileDistXY;              <span class="comment">// Along-profile distance measured from the seaward limit, in CShore units</span></div>
<div class="line"><a id="l00807" name="l00807"></a><span class="lineno">  807</span>      vector&lt;double&gt; VdProfileFrictionFactor;      <span class="comment">// Along-profile friction factor from seaward limit</span></div>
<div class="line"><a id="l00808" name="l00808"></a><span class="lineno">  808</span> </div>
<div class="line"><a id="l00809" name="l00809"></a><span class="lineno">  809</span>      <span class="comment">// The elevation of each of these profile points is the elevation of the centroid of the cell that is &#39;under&#39; the point. However we cannot always be confident that this is the &#39;true&#39; elevation of the point on the vector since (unless the profile runs planview N-S or W-E) the vector does not always run exactly through the centroid of the cell</span></div>
<div class="line"><a id="l00810" name="l00810"></a><span class="lineno">  810</span>      <span class="keywordtype">int</span> nRet = <a class="code hl_function" href="../../d1/d98/classCSimulation.html#ac723b53f5226b435cb6f6a617c531c04">nGetThisProfileElevationsForCShore</a>(nCoast, pProfile, nProfileSize, &amp;VdProfileDistXY, &amp;VdProfileZ, &amp;VdProfileFrictionFactor);</div>
<div class="line"><a id="l00811" name="l00811"></a><span class="lineno">  811</span>      <span class="keywordflow">if</span> (nRet != <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#aa768cb14b5c6123ee95e6e4ebd9fe331">RTN_OK</a>)</div>
<div class="line"><a id="l00812" name="l00812"></a><span class="lineno">  812</span>      {</div>
<div class="line"><a id="l00813" name="l00813"></a><span class="lineno">  813</span>         <span class="comment">// Could not create the profile elevation vectors</span></div>
<div class="line"><a id="l00814" name="l00814"></a><span class="lineno">  814</span>         <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a222962121613613a48f518e0c2110f21">LogStream</a> &lt;&lt; <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#ad67e8c5b30a0572f64ecfb5c062c2edc">m_ulIter</a> &lt;&lt; <span class="stringliteral">&quot;: could not create CShore profile elevation vectors for profile &quot;</span> &lt;&lt; pProfile-&gt;<a class="code hl_function" href="../../da/dae/classCGeomProfile.html#aacd98f9837c3c7cf7414764b73275fba">nGetCoastID</a>() &lt;&lt; endl;</div>
<div class="line"><a id="l00815" name="l00815"></a><span class="lineno">  815</span> </div>
<div class="line"><a id="l00816" name="l00816"></a><span class="lineno">  816</span>         <span class="keywordflow">return</span> nRet;</div>
<div class="line"><a id="l00817" name="l00817"></a><span class="lineno">  817</span>      }</div>
<div class="line"><a id="l00818" name="l00818"></a><span class="lineno">  818</span> </div>
<div class="line"><a id="l00819" name="l00819"></a><span class="lineno">  819</span>      <span class="comment">// assert(static_cast&lt;int&gt;(VdProfileDistXY.size()) == nProfileSize);</span></div>
<div class="line"><a id="l00820" name="l00820"></a><span class="lineno">  820</span>      <span class="comment">// assert(static_cast&lt;int&gt;(VdProfileZ.size()) == nProfileSize);</span></div>
<div class="line"><a id="l00821" name="l00821"></a><span class="lineno">  821</span>      <span class="comment">// assert(static_cast&lt;int&gt;(VdProfileFrictionFactor.size()) == nProfileSize);</span></div>
<div class="line"><a id="l00822" name="l00822"></a><span class="lineno">  822</span> </div>
<div class="line"><a id="l00823" name="l00823"></a><span class="lineno">  823</span>      <span class="keywordflow">if</span> (VdProfileDistXY.empty())</div>
<div class="line"><a id="l00824" name="l00824"></a><span class="lineno">  824</span>      {</div>
<div class="line"><a id="l00825" name="l00825"></a><span class="lineno">  825</span>         <span class="comment">// The profile elevation vector was created, but was not populated</span></div>
<div class="line"><a id="l00826" name="l00826"></a><span class="lineno">  826</span>         <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a222962121613613a48f518e0c2110f21">LogStream</a> &lt;&lt; <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#ad67e8c5b30a0572f64ecfb5c062c2edc">m_ulIter</a> &lt;&lt; <span class="stringliteral">&quot;: could not populate CShore profile elevation vector for profile &quot;</span> &lt;&lt; pProfile-&gt;<a class="code hl_function" href="../../da/dae/classCGeomProfile.html#aacd98f9837c3c7cf7414764b73275fba">nGetCoastID</a>() &lt;&lt; endl;</div>
<div class="line"><a id="l00827" name="l00827"></a><span class="lineno">  827</span> </div>
<div class="line"><a id="l00828" name="l00828"></a><span class="lineno">  828</span>         <span class="keywordflow">return</span> <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#ae511c9d9a1cb65ab8cce83412e51a77f">RTN_ERR_CSHORE_EMPTY_PROFILE</a>;</div>
<div class="line"><a id="l00829" name="l00829"></a><span class="lineno">  829</span>      }</div>
<div class="line"><a id="l00830" name="l00830"></a><span class="lineno">  830</span> </div>
<div class="line"><a id="l00831" name="l00831"></a><span class="lineno">  831</span>      <span class="comment">// Constrain the wave to normal angle to be between -80 and 80 degrees, this is a requirement of CShore</span></div>
<div class="line"><a id="l00832" name="l00832"></a><span class="lineno">  832</span>      dWaveToNormalAngle = <a class="code hl_function" href="../../d6/d2a/cme_8h.html#a7e895b460cef877dec4d12ead0c74f15">tMax</a>(dWaveToNormalAngle, -80.0);</div>
<div class="line"><a id="l00833" name="l00833"></a><span class="lineno">  833</span>      dWaveToNormalAngle = <a class="code hl_function" href="../../d6/d2a/cme_8h.html#a068017859403c0629d89f8d348f6c224">tMin</a>(dWaveToNormalAngle, 80.0);</div>
<div class="line"><a id="l00834" name="l00834"></a><span class="lineno">  834</span> </div>
<div class="line"><a id="l00835" name="l00835"></a><span class="lineno">  835</span>      <span class="keywordtype">int</span> nProfileDistXYSize = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(VdProfileDistXY.size());</div>
<div class="line"><a id="l00836" name="l00836"></a><span class="lineno">  836</span>      vector&lt;double&gt; VdFreeSurfaceStd(nProfileDistXYSize, 0);              <span class="comment">// This is converted to Hrms by Hrms = sqr(8)*FreeSurfaceStd</span></div>
<div class="line"><a id="l00837" name="l00837"></a><span class="lineno">  837</span>      vector&lt;double&gt; VdSinWaveAngleRadians(nProfileDistXYSize, 0);         <span class="comment">// This is converted to deg by asin(VdSinWaveAngleRadians)*(180/pi)</span></div>
<div class="line"><a id="l00838" name="l00838"></a><span class="lineno">  838</span>      vector&lt;double&gt; VdFractionBreakingWaves(nProfileDistXYSize, 0);       <span class="comment">// Is 0 if no wave breaking, and 1 if all waves breaking</span></div>
<div class="line"><a id="l00839" name="l00839"></a><span class="lineno">  839</span> </div>
<div class="line"><a id="l00840" name="l00840"></a><span class="lineno">  840</span>      <span class="comment">// Now define the other values that CShore requires</span></div>
<div class="line"><a id="l00841" name="l00841"></a><span class="lineno">  841</span>      <span class="keywordtype">int</span> nILine = 1;               <span class="comment">// This is the number of cross-shore lines i.e. the number of CoastalME profiles. Only one at a time, at present</span></div>
<div class="line"><a id="l00842" name="l00842"></a><span class="lineno">  842</span>      <span class="keywordtype">int</span> nIProfl = 0;              <span class="comment">// 0 for fixed bottom profile, 1 for profile evolution computation</span></div>
<div class="line"><a id="l00843" name="l00843"></a><span class="lineno">  843</span>      <span class="keywordtype">int</span> nIPerm = 0;               <span class="comment">// 0 for impermeable bottom, 1 for permeable bottom of stone structure</span></div>
<div class="line"><a id="l00844" name="l00844"></a><span class="lineno">  844</span>      <span class="keywordtype">int</span> nIOver = 0;               <span class="comment">// 0 for no wave overtopping and overflow on crest, 1 for wave overtopping and overflow</span></div>
<div class="line"><a id="l00845" name="l00845"></a><span class="lineno">  845</span>      <span class="keywordtype">int</span> nIWCInt = 0;              <span class="comment">// 0 for no wave/current interaction, 1 for wave/current interaction in frequency dispersion, momentum and wave action equations</span></div>
<div class="line"><a id="l00846" name="l00846"></a><span class="lineno">  846</span>      <span class="keywordtype">int</span> nIRoll = 0;               <span class="comment">// 0 for no roller effects, 1 for roller effects in governing equations</span></div>
<div class="line"><a id="l00847" name="l00847"></a><span class="lineno">  847</span>      <span class="keywordtype">int</span> nIWind = 0;               <span class="comment">// 0 for no wind effects, 1 for wind shear stresses on momentum equations</span></div>
<div class="line"><a id="l00848" name="l00848"></a><span class="lineno">  848</span>      <span class="keywordtype">int</span> nITide = 0;               <span class="comment">// 0 for no tidal effect on currents, 1 for longshore and cross-shore tidal currents</span></div>
<div class="line"><a id="l00849" name="l00849"></a><span class="lineno">  849</span>      <span class="keywordtype">int</span> nILab = 0;                <span class="comment">// 0 for field data set, 1 for laboratory data set</span></div>
<div class="line"><a id="l00850" name="l00850"></a><span class="lineno">  850</span>      <span class="keywordtype">int</span> nNWave = 1;               <span class="comment">// Number of waves at x = 0 starting from time = 0</span></div>
<div class="line"><a id="l00851" name="l00851"></a><span class="lineno">  851</span>      <span class="keywordtype">int</span> nNSurge = 1;              <span class="comment">// Number of water levels at x = 0 from time = 0</span></div>
<div class="line"><a id="l00852" name="l00852"></a><span class="lineno">  852</span>      <span class="keywordtype">double</span> dDX = VdProfileDistXY.back() / (<span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>(VdProfileDistXY.size() - 1));</div>
<div class="line"><a id="l00853" name="l00853"></a><span class="lineno">  853</span>      <span class="keywordtype">double</span> dWaveInitTime = 0;     <span class="comment">// CShore wave start time</span></div>
<div class="line"><a id="l00854" name="l00854"></a><span class="lineno">  854</span>      <span class="keywordtype">double</span> dSurgeInitTime = 0;    <span class="comment">// CShore surge start time</span></div>
<div class="line"><a id="l00855" name="l00855"></a><span class="lineno">  855</span> </div>
<div class="line"><a id="l00856" name="l00856"></a><span class="lineno">  856</span><span class="preprocessor">#if defined CSHORE_FILE_INOUT || CSHORE_BOTH</span></div>
<div class="line"><a id="l00857" name="l00857"></a><span class="lineno">  857</span>      <span class="comment">// Move to the CShore folder</span></div>
<div class="line"><a id="l00858" name="l00858"></a><span class="lineno">  858</span>      nRet = chdir(<a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a17918dff623e9b5e2ca1d304c90619c9">CSHORE_DIR</a>.c_str());</div>
<div class="line"><a id="l00859" name="l00859"></a><span class="lineno">  859</span>      <span class="keywordflow">if</span> (nRet != <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#aa768cb14b5c6123ee95e6e4ebd9fe331">RTN_OK</a>)</div>
<div class="line"><a id="l00860" name="l00860"></a><span class="lineno">  860</span>         <span class="keywordflow">return</span> nRet;</div>
<div class="line"><a id="l00861" name="l00861"></a><span class="lineno">  861</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00862" name="l00862"></a><span class="lineno">  862</span> </div>
<div class="line"><a id="l00863" name="l00863"></a><span class="lineno">  863</span><span class="preprocessor">#if defined CSHORE_FILE_INOUT</span></div>
<div class="line"><a id="l00864" name="l00864"></a><span class="lineno">  864</span>      <span class="comment">// We are communicating with CShore using ASCII files, so create an input file for this profile which will be read by CShore</span></div>
<div class="line"><a id="l00865" name="l00865"></a><span class="lineno">  865</span>      nRet = <a class="code hl_function" href="../../d1/d98/classCSimulation.html#a4dd8148f0c1baa096e92c3a0ff2eee2d">nCreateCShoreInfile</a>(nCoast, nProfile, nILine, nIProfl, nIPerm, nIOver, nIWCInt, nIRoll, nIWind, nITide, nILab, nNWave, nNSurge, dDX, dCShoreTimeStep, dWaveInitTime, dDeepWaterWavePeriod, dProfileDeepWaterWaveHeight, dWaveToNormalAngle, dSurgeInitTime, dSurgeLevel, &amp;VdProfileDistXY, &amp;VdProfileZ, &amp;VdProfileFrictionFactor);</div>
<div class="line"><a id="l00866" name="l00866"></a><span class="lineno">  866</span>      <span class="keywordflow">if</span> (nRet != <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#aa768cb14b5c6123ee95e6e4ebd9fe331">RTN_OK</a>)</div>
<div class="line"><a id="l00867" name="l00867"></a><span class="lineno">  867</span>         <span class="keywordflow">return</span> nRet;</div>
<div class="line"><a id="l00868" name="l00868"></a><span class="lineno">  868</span> </div>
<div class="line"><a id="l00869" name="l00869"></a><span class="lineno">  869</span>      <span class="comment">// Set the error flag: this will be changed to 0 within CShore if CShore returns correctly</span></div>
<div class="line"><a id="l00870" name="l00870"></a><span class="lineno">  870</span>      nRet = -1;</div>
<div class="line"><a id="l00871" name="l00871"></a><span class="lineno">  871</span> </div>
<div class="line"><a id="l00872" name="l00872"></a><span class="lineno">  872</span>      <span class="comment">// Run CShore for this profile</span></div>
<div class="line"><a id="l00873" name="l00873"></a><span class="lineno">  873</span>      <a class="code hl_function" href="../../d8/db0/cshore_2cshore_8h.html#a35b5138685d79a9bcdd373699d48e390">CShore</a>(&amp;nRet);</div>
<div class="line"><a id="l00874" name="l00874"></a><span class="lineno">  874</span><span class="comment">//      CShore(&amp;nRet, &amp;m_ulIter, &amp;nProfile, &amp;nProfile);</span></div>
<div class="line"><a id="l00875" name="l00875"></a><span class="lineno">  875</span> </div>
<div class="line"><a id="l00876" name="l00876"></a><span class="lineno">  876</span>      <span class="comment">// Check return code for error</span></div>
<div class="line"><a id="l00877" name="l00877"></a><span class="lineno">  877</span>      <span class="keywordflow">if</span> (nRet != 0)</div>
<div class="line"><a id="l00878" name="l00878"></a><span class="lineno">  878</span>      {</div>
<div class="line"><a id="l00879" name="l00879"></a><span class="lineno">  879</span>         <span class="keywordtype">string</span> strErr;</div>
<div class="line"><a id="l00880" name="l00880"></a><span class="lineno">  880</span> </div>
<div class="line"><a id="l00881" name="l00881"></a><span class="lineno">  881</span>         <span class="keywordflow">switch</span> (nRet)</div>
<div class="line"><a id="l00882" name="l00882"></a><span class="lineno">  882</span>         {</div>
<div class="line"><a id="l00883" name="l00883"></a><span class="lineno">  883</span>            <span class="keywordflow">case</span> -1:</div>
<div class="line"><a id="l00884" name="l00884"></a><span class="lineno">  884</span>               strErr = to_string(<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#ad67e8c5b30a0572f64ecfb5c062c2edc">m_ulIter</a>) + <span class="stringliteral">&quot;: CShore WARNING 1: negative depth at the first node &quot;</span>;</div>
<div class="line"><a id="l00885" name="l00885"></a><span class="lineno">  885</span>               <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00886" name="l00886"></a><span class="lineno">  886</span> </div>
<div class="line"><a id="l00887" name="l00887"></a><span class="lineno">  887</span>            <span class="keywordflow">case</span> 2:</div>
<div class="line"><a id="l00888" name="l00888"></a><span class="lineno">  888</span>               strErr = to_string(<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#ad67e8c5b30a0572f64ecfb5c062c2edc">m_ulIter</a>) + <span class="stringliteral">&quot;: CShore WARNING 2: negative value at end of landward marching computation &quot;</span>;</div>
<div class="line"><a id="l00889" name="l00889"></a><span class="lineno">  889</span>               <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00890" name="l00890"></a><span class="lineno">  890</span> </div>
<div class="line"><a id="l00891" name="l00891"></a><span class="lineno">  891</span>            <span class="keywordflow">case</span> 3:</div>
<div class="line"><a id="l00892" name="l00892"></a><span class="lineno">  892</span>               strErr = to_string(<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#ad67e8c5b30a0572f64ecfb5c062c2edc">m_ulIter</a>) + <span class="stringliteral">&quot;: CShore WARNING 3: large energy gradients at the first node: small waves with short period at sea boundary &quot;</span>;</div>
<div class="line"><a id="l00893" name="l00893"></a><span class="lineno">  893</span>               <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00894" name="l00894"></a><span class="lineno">  894</span> </div>
<div class="line"><a id="l00895" name="l00895"></a><span class="lineno">  895</span>            <span class="keywordflow">case</span> 4:</div>
<div class="line"><a id="l00896" name="l00896"></a><span class="lineno">  896</span>               strErr = to_string(<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#ad67e8c5b30a0572f64ecfb5c062c2edc">m_ulIter</a>) + <span class="stringliteral">&quot;: CShore WARNING 4: zero energy at the first node &quot;</span>;</div>
<div class="line"><a id="l00897" name="l00897"></a><span class="lineno">  897</span>               <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00898" name="l00898"></a><span class="lineno">  898</span> </div>
<div class="line"><a id="l00899" name="l00899"></a><span class="lineno">  899</span>            <span class="keywordflow">case</span> 5:</div>
<div class="line"><a id="l00900" name="l00900"></a><span class="lineno">  900</span>               strErr = to_string(<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#ad67e8c5b30a0572f64ecfb5c062c2edc">m_ulIter</a>) + <span class="stringliteral">&quot;: CShore WARNING 5: at end of landward marching computation, insufficient water depth &quot;</span>;</div>
<div class="line"><a id="l00901" name="l00901"></a><span class="lineno">  901</span>               <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00902" name="l00902"></a><span class="lineno">  902</span> </div>
<div class="line"><a id="l00903" name="l00903"></a><span class="lineno">  903</span>            <span class="keywordflow">case</span> 7:</div>
<div class="line"><a id="l00904" name="l00904"></a><span class="lineno">  904</span>               strErr = to_string(<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#ad67e8c5b30a0572f64ecfb5c062c2edc">m_ulIter</a>) + <span class="stringliteral">&quot;: CShore WARNING 7: did not reach convergence &quot;</span>;</div>
<div class="line"><a id="l00905" name="l00905"></a><span class="lineno">  905</span>               <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00906" name="l00906"></a><span class="lineno">  906</span>         }</div>
<div class="line"><a id="l00907" name="l00907"></a><span class="lineno">  907</span> </div>
<div class="line"><a id="l00908" name="l00908"></a><span class="lineno">  908</span>         strErr += <span class="stringliteral">&quot;(coast &quot;</span> + to_string(nCoast) + <span class="stringliteral">&quot; profile &quot;</span> + to_string(pProfile-&gt;<a class="code hl_function" href="../../da/dae/classCGeomProfile.html#aacd98f9837c3c7cf7414764b73275fba">nGetCoastID</a>()) + <span class="stringliteral">&quot; profile length &quot;</span> + to_string(nOutSize) + <span class="stringliteral">&quot;)\n&quot;</span>;</div>
<div class="line"><a id="l00909" name="l00909"></a><span class="lineno">  909</span> </div>
<div class="line"><a id="l00910" name="l00910"></a><span class="lineno">  910</span>         <span class="comment">// OK, give up for this profile</span></div>
<div class="line"><a id="l00911" name="l00911"></a><span class="lineno">  911</span>         <span class="comment">// LogStream &lt;&lt; strErr;</span></div>
<div class="line"><a id="l00912" name="l00912"></a><span class="lineno">  912</span>         <span class="comment">//</span></div>
<div class="line"><a id="l00913" name="l00913"></a><span class="lineno">  913</span>         <span class="comment">// return RTN_ERR_CSHORE_ERROR;</span></div>
<div class="line"><a id="l00914" name="l00914"></a><span class="lineno">  914</span>      }</div>
<div class="line"><a id="l00915" name="l00915"></a><span class="lineno">  915</span> </div>
<div class="line"><a id="l00916" name="l00916"></a><span class="lineno">  916</span>      <span class="comment">// Fetch the CShore results by reading files written by CShore</span></div>
<div class="line"><a id="l00917" name="l00917"></a><span class="lineno">  917</span>      <span class="keywordtype">string</span> strOSETUP = <span class="stringliteral">&quot;OSETUP&quot;</span>;</div>
<div class="line"><a id="l00918" name="l00918"></a><span class="lineno">  918</span>      <span class="keywordtype">string</span> strOYVELO = <span class="stringliteral">&quot;OYVELO&quot;</span>;</div>
<div class="line"><a id="l00919" name="l00919"></a><span class="lineno">  919</span>      <span class="keywordtype">string</span> strOPARAM = <span class="stringliteral">&quot;OPARAM&quot;</span>;</div>
<div class="line"><a id="l00920" name="l00920"></a><span class="lineno">  920</span> </div>
<div class="line"><a id="l00921" name="l00921"></a><span class="lineno">  921</span>      nRet = <a class="code hl_function" href="../../d1/d98/classCSimulation.html#a7155b1d27079d97e47494e55af03b101">nReadCShoreOutput</a>(nProfile, &amp;strOSETUP, 4, 4, &amp;VdProfileDistXY, &amp;VdFreeSurfaceStd);</div>
<div class="line"><a id="l00922" name="l00922"></a><span class="lineno">  922</span>      <span class="keywordflow">if</span> (nRet != <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#aa768cb14b5c6123ee95e6e4ebd9fe331">RTN_OK</a>)</div>
<div class="line"><a id="l00923" name="l00923"></a><span class="lineno">  923</span>         <span class="keywordflow">return</span> nRet;</div>
<div class="line"><a id="l00924" name="l00924"></a><span class="lineno">  924</span> </div>
<div class="line"><a id="l00925" name="l00925"></a><span class="lineno">  925</span>      nRet = <a class="code hl_function" href="../../d1/d98/classCSimulation.html#a7155b1d27079d97e47494e55af03b101">nReadCShoreOutput</a>(nProfile, &amp;strOYVELO, 4, 2, &amp;VdProfileDistXY, &amp;VdSinWaveAngleRadians);</div>
<div class="line"><a id="l00926" name="l00926"></a><span class="lineno">  926</span>      <span class="keywordflow">if</span> (nRet != <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#aa768cb14b5c6123ee95e6e4ebd9fe331">RTN_OK</a>)</div>
<div class="line"><a id="l00927" name="l00927"></a><span class="lineno">  927</span>         <span class="keywordflow">return</span> nRet;</div>
<div class="line"><a id="l00928" name="l00928"></a><span class="lineno">  928</span> </div>
<div class="line"><a id="l00929" name="l00929"></a><span class="lineno">  929</span>      nRet = <a class="code hl_function" href="../../d1/d98/classCSimulation.html#a7155b1d27079d97e47494e55af03b101">nReadCShoreOutput</a>(nProfile, &amp;strOPARAM, 4, 3, &amp;VdProfileDistXY, &amp;VdFractionBreakingWaves);</div>
<div class="line"><a id="l00930" name="l00930"></a><span class="lineno">  930</span>      <span class="keywordflow">if</span> (nRet != <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#aa768cb14b5c6123ee95e6e4ebd9fe331">RTN_OK</a>)</div>
<div class="line"><a id="l00931" name="l00931"></a><span class="lineno">  931</span>         <span class="keywordflow">return</span> nRet;</div>
<div class="line"><a id="l00932" name="l00932"></a><span class="lineno">  932</span> </div>
<div class="line"><a id="l00933" name="l00933"></a><span class="lineno">  933</span>      <span class="comment">// Read surge outputs</span></div>
<div class="line"><a id="l00934" name="l00934"></a><span class="lineno">  934</span>      <span class="comment">// VdTSurg = {dSurgeInitTime, dCShoreTimeStep},                           // Ditto</span></div>
<div class="line"><a id="l00935" name="l00935"></a><span class="lineno">  935</span>      <span class="comment">// VdSWLin = {dSurgeLevel, dSurgeLevel},                                  // Ditto</span></div>
<div class="line"><a id="l00936" name="l00936"></a><span class="lineno">  936</span> </div>
<div class="line"><a id="l00937" name="l00937"></a><span class="lineno">  937</span>      <span class="comment">// Clean up the CShore outputs</span></div>
<div class="line"><a id="l00938" name="l00938"></a><span class="lineno">  938</span><span class="preprocessor">#ifdef _WIN32</span></div>
<div class="line"><a id="l00939" name="l00939"></a><span class="lineno">  939</span>      nRet = system(<span class="stringliteral">&quot;./clean.bat&quot;</span>);</div>
<div class="line"><a id="l00940" name="l00940"></a><span class="lineno">  940</span><span class="preprocessor">#else</span></div>
<div class="line"><a id="l00941" name="l00941"></a><span class="lineno">  941</span>      <span class="keywordflow">if</span> (<a class="code hl_variable" href="../../d6/d2a/cme_8h.html#aaa9e0f47a8f6eeecd6754881d7e59016">SAVE_CSHORE_OUTPUT</a>)</div>
<div class="line"><a id="l00942" name="l00942"></a><span class="lineno">  942</span>      {</div>
<div class="line"><a id="l00943" name="l00943"></a><span class="lineno">  943</span>         <span class="keywordtype">string</span> strCommand = <span class="stringliteral">&quot;./save_CShore_output.sh &quot;</span>;</div>
<div class="line"><a id="l00944" name="l00944"></a><span class="lineno">  944</span>         strCommand += to_string(<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#ad67e8c5b30a0572f64ecfb5c062c2edc">m_ulIter</a>);</div>
<div class="line"><a id="l00945" name="l00945"></a><span class="lineno">  945</span>         strCommand += <span class="stringliteral">&quot; &quot;</span>;</div>
<div class="line"><a id="l00946" name="l00946"></a><span class="lineno">  946</span>         strCommand += to_string(nCoast);</div>
<div class="line"><a id="l00947" name="l00947"></a><span class="lineno">  947</span>         strCommand += <span class="stringliteral">&quot; &quot;</span>;</div>
<div class="line"><a id="l00948" name="l00948"></a><span class="lineno">  948</span>         strCommand += to_string(nProfile);</div>
<div class="line"><a id="l00949" name="l00949"></a><span class="lineno">  949</span> </div>
<div class="line"><a id="l00950" name="l00950"></a><span class="lineno">  950</span>         nRet = system(strCommand.c_str());</div>
<div class="line"><a id="l00951" name="l00951"></a><span class="lineno">  951</span>         <span class="keywordflow">if</span> (nRet != <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#aa768cb14b5c6123ee95e6e4ebd9fe331">RTN_OK</a>)</div>
<div class="line"><a id="l00952" name="l00952"></a><span class="lineno">  952</span>            <span class="keywordflow">return</span> nRet;</div>
<div class="line"><a id="l00953" name="l00953"></a><span class="lineno">  953</span>      }</div>
<div class="line"><a id="l00954" name="l00954"></a><span class="lineno">  954</span> </div>
<div class="line"><a id="l00955" name="l00955"></a><span class="lineno">  955</span>      nRet = system(<span class="stringliteral">&quot;./clean.sh&quot;</span>);</div>
<div class="line"><a id="l00956" name="l00956"></a><span class="lineno">  956</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00957" name="l00957"></a><span class="lineno">  957</span>      <span class="keywordflow">if</span> (nRet != <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#aa768cb14b5c6123ee95e6e4ebd9fe331">RTN_OK</a>)</div>
<div class="line"><a id="l00958" name="l00958"></a><span class="lineno">  958</span>         <span class="keywordflow">return</span> nRet;</div>
<div class="line"><a id="l00959" name="l00959"></a><span class="lineno">  959</span> </div>
<div class="line"><a id="l00960" name="l00960"></a><span class="lineno">  960</span>      <span class="comment">// And return to the CoastalME folder</span></div>
<div class="line"><a id="l00961" name="l00961"></a><span class="lineno">  961</span>      nRet = chdir(<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a7f8368cae1a6852c1ea7ff99b2d0c035">m_strCMEDir</a>.c_str());</div>
<div class="line"><a id="l00962" name="l00962"></a><span class="lineno">  962</span>      <span class="keywordflow">if</span> (nRet != <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#aa768cb14b5c6123ee95e6e4ebd9fe331">RTN_OK</a>)</div>
<div class="line"><a id="l00963" name="l00963"></a><span class="lineno">  963</span>         <span class="keywordflow">return</span> nRet;</div>
<div class="line"><a id="l00964" name="l00964"></a><span class="lineno">  964</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00965" name="l00965"></a><span class="lineno">  965</span> </div>
<div class="line"><a id="l00966" name="l00966"></a><span class="lineno">  966</span><span class="preprocessor">#if defined CSHORE_ARG_INOUT || CSHORE_BOTH</span></div>
<div class="line"><a id="l00967" name="l00967"></a><span class="lineno">  967</span>      <span class="comment">// We are communicating with CShore by passing arguments</span></div>
<div class="line"><a id="l00968" name="l00968"></a><span class="lineno">  968</span>      <span class="keywordtype">int</span> nOutSize = 0; <span class="comment">// CShore will return the size of the output vectors</span></div>
<div class="line"><a id="l00969" name="l00969"></a><span class="lineno">  969</span> </div>
<div class="line"><a id="l00970" name="l00970"></a><span class="lineno">  970</span>      <span class="comment">// Set the error flag: this will be changed within CShore if there is a problem</span></div>
<div class="line"><a id="l00971" name="l00971"></a><span class="lineno">  971</span>      nRet = 0;</div>
<div class="line"><a id="l00972" name="l00972"></a><span class="lineno">  972</span> </div>
<div class="line"><a id="l00973" name="l00973"></a><span class="lineno">  973</span>      vector&lt;double&gt; VdInitTime = {dWaveInitTime, dCShoreTimeStep};                         <span class="comment">// Size is nNwave+1, value 1 is for the start of the CShore run, value 2 for end of CShore run</span></div>
<div class="line"><a id="l00974" name="l00974"></a><span class="lineno">  974</span>      vector&lt;double&gt; VdTPIn = {dDeepWaterWavePeriod, dDeepWaterWavePeriod};                 <span class="comment">// Ditto</span></div>
<div class="line"><a id="l00975" name="l00975"></a><span class="lineno">  975</span>      vector&lt;double&gt; VdHrmsIn = {dProfileDeepWaterWaveHeight, dProfileDeepWaterWaveHeight}; <span class="comment">// Ditto</span></div>
<div class="line"><a id="l00976" name="l00976"></a><span class="lineno">  976</span>      vector&lt;double&gt; VdWangIn = {dWaveToNormalAngle, dWaveToNormalAngle};                   <span class="comment">// Ditto</span></div>
<div class="line"><a id="l00977" name="l00977"></a><span class="lineno">  977</span>      vector&lt;double&gt; VdTSurg = {dSurgeInitTime, dCShoreTimeStep};                           <span class="comment">// Ditto</span></div>
<div class="line"><a id="l00978" name="l00978"></a><span class="lineno">  978</span>      vector&lt;double&gt; VdSWLin = {dSurgeLevel, dSurgeLevel};                                  <span class="comment">// Ditto</span></div>
<div class="line"><a id="l00979" name="l00979"></a><span class="lineno">  979</span>      vector&lt;double&gt; VdFPInp = VdProfileFrictionFactor;                                     <span class="comment">// Set the value for wave friction at every point of the normal profile</span></div>
<div class="line"><a id="l00980" name="l00980"></a><span class="lineno">  980</span>      vector&lt;double&gt; VdXYDistFromCShoreOut(<a class="code hl_variable" href="../../d6/d2a/cme_8h.html#ad86b7b66cd8d17fc248e90239a3dc4f5">CSHOREARRAYOUTSIZE</a>, 0);                          <span class="comment">// Output from CShore</span></div>
<div class="line"><a id="l00981" name="l00981"></a><span class="lineno">  981</span>      vector&lt;double&gt; VdFreeSurfaceStdOut(<a class="code hl_variable" href="../../d6/d2a/cme_8h.html#ad86b7b66cd8d17fc248e90239a3dc4f5">CSHOREARRAYOUTSIZE</a>, 0);                            <span class="comment">// Ditto</span></div>
<div class="line"><a id="l00982" name="l00982"></a><span class="lineno">  982</span>      vector&lt;double&gt; VdWaveSetupSurgeOut(<a class="code hl_variable" href="../../d6/d2a/cme_8h.html#ad86b7b66cd8d17fc248e90239a3dc4f5">CSHOREARRAYOUTSIZE</a>, 0);                            <span class="comment">// Ditto</span></div>
<div class="line"><a id="l00983" name="l00983"></a><span class="lineno">  983</span>      <span class="comment">// vector&lt;double&gt; VdStormSurgeOut(CSHOREARRAYOUTSIZE, 0);                             // Ditto</span></div>
<div class="line"><a id="l00984" name="l00984"></a><span class="lineno">  984</span>      vector&lt;double&gt; VdWaveSetupRunUpOut(<a class="code hl_variable" href="../../d6/d2a/cme_8h.html#ad86b7b66cd8d17fc248e90239a3dc4f5">CSHOREARRAYOUTSIZE</a>, 0);                            <span class="comment">// Ditto</span></div>
<div class="line"><a id="l00985" name="l00985"></a><span class="lineno">  985</span>      vector&lt;double&gt; VdSinWaveAngleRadiansOut(<a class="code hl_variable" href="../../d6/d2a/cme_8h.html#ad86b7b66cd8d17fc248e90239a3dc4f5">CSHOREARRAYOUTSIZE</a>, 0);                       <span class="comment">// Ditto</span></div>
<div class="line"><a id="l00986" name="l00986"></a><span class="lineno">  986</span>      vector&lt;double&gt; VdFractionBreakingWavesOut(<a class="code hl_variable" href="../../d6/d2a/cme_8h.html#ad86b7b66cd8d17fc248e90239a3dc4f5">CSHOREARRAYOUTSIZE</a>, 0);                     <span class="comment">// Ditto</span></div>
<div class="line"><a id="l00987" name="l00987"></a><span class="lineno">  987</span> </div>
<div class="line"><a id="l00988" name="l00988"></a><span class="lineno">  988</span>      <span class="comment">// Call CShore using the argument-passing wrapper</span></div>
<div class="line"><a id="l00989" name="l00989"></a><span class="lineno">  989</span>      <span class="comment">// long lIter = static_cast&lt;long&gt;(m_ulIter);    // Bodge to get round compiler &#39;invalid conversion&#39; error</span></div>
<div class="line"><a id="l00990" name="l00990"></a><span class="lineno">  990</span>          </div>
<div class="line"><a id="l00991" name="l00991"></a><span class="lineno">  991</span>      <a class="code hl_function" href="../../d8/db0/cshore_2cshore_8h.html#a567f70b9e4f37a2ffe9edac6ad5a498e">CShoreWrapper</a>(&amp;nILine,                          <span class="comment">/* In_ILINE */</span></div>
<div class="line"><a id="l00992" name="l00992"></a><span class="lineno">  992</span>                    &amp;nIProfl,                         <span class="comment">/* In_IPROFL */</span></div>
<div class="line"><a id="l00993" name="l00993"></a><span class="lineno">  993</span>                    &amp;nIPerm,                          <span class="comment">/* In_IPERM */</span></div>
<div class="line"><a id="l00994" name="l00994"></a><span class="lineno">  994</span>                    &amp;nIOver,                          <span class="comment">/* In_IOVER */</span></div>
<div class="line"><a id="l00995" name="l00995"></a><span class="lineno">  995</span>                    &amp;nIWCInt,                         <span class="comment">/* In_IWCINT */</span></div>
<div class="line"><a id="l00996" name="l00996"></a><span class="lineno">  996</span>                    &amp;nIRoll,                          <span class="comment">/* In_IROLL */</span></div>
<div class="line"><a id="l00997" name="l00997"></a><span class="lineno">  997</span>                    &amp;nIWind,                          <span class="comment">/* In_IWIND */</span></div>
<div class="line"><a id="l00998" name="l00998"></a><span class="lineno">  998</span>                    &amp;nITide,                          <span class="comment">/* In_ITIDE */</span></div>
<div class="line"><a id="l00999" name="l00999"></a><span class="lineno">  999</span>                    &amp;nILab,                           <span class="comment">/* In_ILAB */</span></div>
<div class="line"><a id="l01000" name="l01000"></a><span class="lineno"> 1000</span>                    &amp;nNWave,                          <span class="comment">/* In_NWAVE */</span></div>
<div class="line"><a id="l01001" name="l01001"></a><span class="lineno"> 1001</span>                    &amp;nNSurge,                         <span class="comment">/* In_NSURG */</span></div>
<div class="line"><a id="l01002" name="l01002"></a><span class="lineno"> 1002</span>                    &amp;dDX,                             <span class="comment">/* In_DX */</span></div>
<div class="line"><a id="l01003" name="l01003"></a><span class="lineno"> 1003</span>                    &amp;<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a6e25557aa80dd5aef09170fdc51d80ca">m_dBreakingWaveHeightDepthRatio</a>, <span class="comment">/* In_GAMMA */</span></div>
<div class="line"><a id="l01004" name="l01004"></a><span class="lineno"> 1004</span>                    &amp;VdInitTime[0],                   <span class="comment">/* In_TWAVE */</span></div>
<div class="line"><a id="l01005" name="l01005"></a><span class="lineno"> 1005</span>                    &amp;VdTPIn[0],                       <span class="comment">/* In_TPIN */</span></div>
<div class="line"><a id="l01006" name="l01006"></a><span class="lineno"> 1006</span>                    &amp;VdHrmsIn[0],                     <span class="comment">/* In_HRMSIN */</span></div>
<div class="line"><a id="l01007" name="l01007"></a><span class="lineno"> 1007</span>                    &amp;VdWangIn[0],                     <span class="comment">/* In_WANGIN */</span></div>
<div class="line"><a id="l01008" name="l01008"></a><span class="lineno"> 1008</span>                    &amp;VdTSurg[0],                      <span class="comment">/* In_TSURG */</span></div>
<div class="line"><a id="l01009" name="l01009"></a><span class="lineno"> 1009</span>                    &amp;VdSWLin[0],                      <span class="comment">/* In_SWLIN */</span></div>
<div class="line"><a id="l01010" name="l01010"></a><span class="lineno"> 1010</span>                    &amp;nProfileDistXYSize,              <span class="comment">/* In_NBINP */</span></div>
<div class="line"><a id="l01011" name="l01011"></a><span class="lineno"> 1011</span>                    &amp;VdProfileDistXY[0],              <span class="comment">/* In_XBINP */</span></div>
<div class="line"><a id="l01012" name="l01012"></a><span class="lineno"> 1012</span>                    &amp;VdProfileZ[0],                   <span class="comment">/* In_ZBINP */</span></div>
<div class="line"><a id="l01013" name="l01013"></a><span class="lineno"> 1013</span>                    &amp;VdFPInp[0],                      <span class="comment">/* In_FBINP */</span></div>
<div class="line"><a id="l01014" name="l01014"></a><span class="lineno"> 1014</span>                    &amp;nRet,                            <span class="comment">/* Out_IError */</span></div>
<div class="line"><a id="l01015" name="l01015"></a><span class="lineno"> 1015</span>                    &amp;nOutSize,                        <span class="comment">/* Out_nOutSize */</span></div>
<div class="line"><a id="l01016" name="l01016"></a><span class="lineno"> 1016</span>                    &amp;VdXYDistFromCShoreOut[0],        <span class="comment">/* Out_XYDist */</span></div>
<div class="line"><a id="l01017" name="l01017"></a><span class="lineno"> 1017</span>                    &amp;VdFreeSurfaceStdOut[0],          <span class="comment">/* Out_FreeSurfaceStd */</span></div>
<div class="line"><a id="l01018" name="l01018"></a><span class="lineno"> 1018</span>                    &amp;VdWaveSetupSurgeOut[0],          <span class="comment">/* Out_WaveSetupSurge */</span></div>
<div class="line"><a id="l01019" name="l01019"></a><span class="lineno"> 1019</span>                    &amp;VdSinWaveAngleRadiansOut[0],     <span class="comment">/* Out_SinWaveAngleRadians */</span></div>
<div class="line"><a id="l01020" name="l01020"></a><span class="lineno"> 1020</span>                    &amp;VdFractionBreakingWavesOut[0]);  <span class="comment">/* Out_FractionBreakingWaves */</span></div>
<div class="line"><a id="l01021" name="l01021"></a><span class="lineno"> 1021</span>      </div>
<div class="line"><a id="l01022" name="l01022"></a><span class="lineno"> 1022</span>      <span class="comment">// OK, now check for warnings and errors</span></div>
<div class="line"><a id="l01023" name="l01023"></a><span class="lineno"> 1023</span>      <span class="keywordflow">if</span> (nOutSize &lt; 2)</div>
<div class="line"><a id="l01024" name="l01024"></a><span class="lineno"> 1024</span>      {</div>
<div class="line"><a id="l01025" name="l01025"></a><span class="lineno"> 1025</span>         <span class="comment">// CShore sometimes returns only one row of results, which contains data only for the seaward point of the profile. This happens when all other (more coastward) points give an invalid result during CShore&#39;s calculations. This is a problem. We don&#39;t want to abandon the simulation just because of this, so instead we just put some dummy data into the second row, and carry on with these two rows. The profile will get ignored later, since it is too small to be useful</span></div>
<div class="line"><a id="l01026" name="l01026"></a><span class="lineno"> 1026</span>         <span class="keywordflow">if</span> (<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a0245d3cbdd603fbeced6ca1465eb3f16">m_nLogFileDetail</a> &gt;= <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a540d8a94fc09b0b14fd8ab657445b67a">LOG_FILE_MIDDLE_DETAIL</a>)</div>
<div class="line"><a id="l01027" name="l01027"></a><span class="lineno"> 1027</span>            <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a222962121613613a48f518e0c2110f21">LogStream</a> &lt;&lt; <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#ad67e8c5b30a0572f64ecfb5c062c2edc">m_ulIter</a> &lt;&lt; <span class="stringliteral">&quot;: &quot;</span> &lt;&lt; <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a957ca99e98618160534cafb0929f743d">WARN</a> &lt;&lt; <span class="stringliteral">&quot;for coast &quot;</span> &lt;&lt; nCoast &lt;&lt; <span class="stringliteral">&quot; profile &quot;</span> &lt;&lt; pProfile-&gt;<a class="code hl_function" href="../../da/dae/classCGeomProfile.html#aacd98f9837c3c7cf7414764b73275fba">nGetCoastID</a>() &lt;&lt; <span class="stringliteral">&quot;, only &quot;</span> &lt;&lt; nOutSize &lt;&lt; <span class="stringliteral">&quot; CShore output rows, abandoning this profile&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a id="l01028" name="l01028"></a><span class="lineno"> 1028</span> </div>
<div class="line"><a id="l01029" name="l01029"></a><span class="lineno"> 1029</span>         <span class="comment">// // Set dummy data in the second row</span></div>
<div class="line"><a id="l01030" name="l01030"></a><span class="lineno"> 1030</span>         <span class="comment">// VdXYDistFromCShoreOut[1] = 1e-5;    // Dummy data, must not be the same as VdXYDistFromCShoreOut[0] tho&#39;, or get crash in linear interpolation routine</span></div>
<div class="line"><a id="l01031" name="l01031"></a><span class="lineno"> 1031</span>         <span class="comment">// VdFreeSurfaceStdOut[1] = VdFreeSurfaceStdOut[0];</span></div>
<div class="line"><a id="l01032" name="l01032"></a><span class="lineno"> 1032</span>         <span class="comment">// VdSinWaveAngleRadiansOut[1] = VdSinWaveAngleRadiansOut[0];</span></div>
<div class="line"><a id="l01033" name="l01033"></a><span class="lineno"> 1033</span>         <span class="comment">// VdFractionBreakingWavesOut[1] = VdFractionBreakingWavesOut[0];</span></div>
<div class="line"><a id="l01034" name="l01034"></a><span class="lineno"> 1034</span>         <span class="comment">// VdWaveSetupSurgeOut[1] = VdWaveSetupSurgeOut[0];</span></div>
<div class="line"><a id="l01035" name="l01035"></a><span class="lineno"> 1035</span>         <span class="comment">// // VdStormSurgeOut[1] = VdStormSurgeOut[0];</span></div>
<div class="line"><a id="l01036" name="l01036"></a><span class="lineno"> 1036</span>         <span class="comment">// // VdWaveSetupRunUpOut[1] = VdWaveSetupRunUpOut[0];</span></div>
<div class="line"><a id="l01037" name="l01037"></a><span class="lineno"> 1037</span>         <span class="comment">//</span></div>
<div class="line"><a id="l01038" name="l01038"></a><span class="lineno"> 1038</span>         <span class="comment">// // And increase the expected number of rows</span></div>
<div class="line"><a id="l01039" name="l01039"></a><span class="lineno"> 1039</span>         <span class="comment">// nOutSize = 2;</span></div>
<div class="line"><a id="l01040" name="l01040"></a><span class="lineno"> 1040</span> </div>
<div class="line"><a id="l01041" name="l01041"></a><span class="lineno"> 1041</span>         <span class="keywordflow">return</span> <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a60017818ee26e96bf8826ef74a3cf324">RTN_ERR_CSHORE_ERROR</a>;</div>
<div class="line"><a id="l01042" name="l01042"></a><span class="lineno"> 1042</span>      }</div>
<div class="line"><a id="l01043" name="l01043"></a><span class="lineno"> 1043</span> </div>
<div class="line"><a id="l01044" name="l01044"></a><span class="lineno"> 1044</span>      <span class="keywordflow">if</span> (nRet != <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#aa768cb14b5c6123ee95e6e4ebd9fe331">RTN_OK</a>)</div>
<div class="line"><a id="l01045" name="l01045"></a><span class="lineno"> 1045</span>      {</div>
<div class="line"><a id="l01046" name="l01046"></a><span class="lineno"> 1046</span>         <span class="keywordtype">string</span> strErr;</div>
<div class="line"><a id="l01047" name="l01047"></a><span class="lineno"> 1047</span> </div>
<div class="line"><a id="l01048" name="l01048"></a><span class="lineno"> 1048</span>         <span class="keywordflow">switch</span> (nRet)</div>
<div class="line"><a id="l01049" name="l01049"></a><span class="lineno"> 1049</span>         {</div>
<div class="line"><a id="l01050" name="l01050"></a><span class="lineno"> 1050</span>            <span class="keywordflow">case</span> -1:</div>
<div class="line"><a id="l01051" name="l01051"></a><span class="lineno"> 1051</span>               strErr = to_string(<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#ad67e8c5b30a0572f64ecfb5c062c2edc">m_ulIter</a>) + <span class="stringliteral">&quot;: CShore WARNING 1: negative depth at the first node &quot;</span>;</div>
<div class="line"><a id="l01052" name="l01052"></a><span class="lineno"> 1052</span>               <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01053" name="l01053"></a><span class="lineno"> 1053</span> </div>
<div class="line"><a id="l01054" name="l01054"></a><span class="lineno"> 1054</span>            <span class="keywordflow">case</span> 2:</div>
<div class="line"><a id="l01055" name="l01055"></a><span class="lineno"> 1055</span>               strErr = to_string(<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#ad67e8c5b30a0572f64ecfb5c062c2edc">m_ulIter</a>) + <span class="stringliteral">&quot;: CShore WARNING 2: negative value at end of landward marching computation &quot;</span>;</div>
<div class="line"><a id="l01056" name="l01056"></a><span class="lineno"> 1056</span>               <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01057" name="l01057"></a><span class="lineno"> 1057</span> </div>
<div class="line"><a id="l01058" name="l01058"></a><span class="lineno"> 1058</span>            <span class="keywordflow">case</span> 3:</div>
<div class="line"><a id="l01059" name="l01059"></a><span class="lineno"> 1059</span>               strErr = to_string(<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#ad67e8c5b30a0572f64ecfb5c062c2edc">m_ulIter</a>) + <span class="stringliteral">&quot;: CShore WARNING 3: large energy gradients at the first node: small waves with short period at sea boundary &quot;</span>;</div>
<div class="line"><a id="l01060" name="l01060"></a><span class="lineno"> 1060</span>               <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01061" name="l01061"></a><span class="lineno"> 1061</span> </div>
<div class="line"><a id="l01062" name="l01062"></a><span class="lineno"> 1062</span>            <span class="keywordflow">case</span> 4:</div>
<div class="line"><a id="l01063" name="l01063"></a><span class="lineno"> 1063</span>               strErr = to_string(<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#ad67e8c5b30a0572f64ecfb5c062c2edc">m_ulIter</a>) + <span class="stringliteral">&quot;: CShore WARNING 4: zero energy at the first node &quot;</span>;</div>
<div class="line"><a id="l01064" name="l01064"></a><span class="lineno"> 1064</span>               <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01065" name="l01065"></a><span class="lineno"> 1065</span> </div>
<div class="line"><a id="l01066" name="l01066"></a><span class="lineno"> 1066</span>            <span class="keywordflow">case</span> 5:</div>
<div class="line"><a id="l01067" name="l01067"></a><span class="lineno"> 1067</span>               strErr = to_string(<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#ad67e8c5b30a0572f64ecfb5c062c2edc">m_ulIter</a>) + <span class="stringliteral">&quot;: CShore WARNING 5: at end of landward marching computation, insufficient water depth &quot;</span>;</div>
<div class="line"><a id="l01068" name="l01068"></a><span class="lineno"> 1068</span>               <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01069" name="l01069"></a><span class="lineno"> 1069</span> </div>
<div class="line"><a id="l01070" name="l01070"></a><span class="lineno"> 1070</span>            <span class="keywordflow">case</span> 7:</div>
<div class="line"><a id="l01071" name="l01071"></a><span class="lineno"> 1071</span>               strErr = to_string(<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#ad67e8c5b30a0572f64ecfb5c062c2edc">m_ulIter</a>) + <span class="stringliteral">&quot;: CShore WARNING 7: did not reach convergence &quot;</span>;</div>
<div class="line"><a id="l01072" name="l01072"></a><span class="lineno"> 1072</span>               <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01073" name="l01073"></a><span class="lineno"> 1073</span>         }</div>
<div class="line"><a id="l01074" name="l01074"></a><span class="lineno"> 1074</span> </div>
<div class="line"><a id="l01075" name="l01075"></a><span class="lineno"> 1075</span>         strErr += <span class="stringliteral">&quot;(coast &quot;</span> + to_string(nCoast) + <span class="stringliteral">&quot; profile &quot;</span> + to_string(pProfile-&gt;<a class="code hl_function" href="../../da/dae/classCGeomProfile.html#aacd98f9837c3c7cf7414764b73275fba">nGetCoastID</a>()) + <span class="stringliteral">&quot; profile length &quot;</span> + to_string(nOutSize) + <span class="stringliteral">&quot;)\n&quot;</span>;</div>
<div class="line"><a id="l01076" name="l01076"></a><span class="lineno"> 1076</span>         <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a222962121613613a48f518e0c2110f21">LogStream</a> &lt;&lt; strErr;</div>
<div class="line"><a id="l01077" name="l01077"></a><span class="lineno"> 1077</span> </div>
<div class="line"><a id="l01078" name="l01078"></a><span class="lineno"> 1078</span>         <span class="comment">// OK, give up for this profile</span></div>
<div class="line"><a id="l01079" name="l01079"></a><span class="lineno"> 1079</span>         <span class="comment">// return RTN_ERR_CSHORE_ERROR;</span></div>
<div class="line"><a id="l01080" name="l01080"></a><span class="lineno"> 1080</span>      }</div>
<div class="line"><a id="l01081" name="l01081"></a><span class="lineno"> 1081</span> </div>
<div class="line"><a id="l01082" name="l01082"></a><span class="lineno"> 1082</span>      <span class="comment">// LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: interpolating profile &quot; &lt;&lt; nProfile &lt;&lt; endl;</span></div>
<div class="line"><a id="l01083" name="l01083"></a><span class="lineno"> 1083</span> </div>
<div class="line"><a id="l01084" name="l01084"></a><span class="lineno"> 1084</span>      <span class="comment">// All OK, so interpolate the CShore output, and convert from the CShore convention (cross-shore distance has its origin at the seaward end) to the CoastalME convention (origin at the shoreline)</span></div>
<div class="line"><a id="l01085" name="l01085"></a><span class="lineno"> 1085</span>      <a class="code hl_function" href="../../d1/d98/classCSimulation.html#a0b66eca85c13a2a263db7be1e270055a">InterpolateCShoreOutput</a>(&amp;VdProfileDistXY, nOutSize, nProfileSize, &amp;VdXYDistFromCShoreOut, &amp;VdFreeSurfaceStdOut, &amp;VdWaveSetupSurgeOut, &amp;VdSinWaveAngleRadiansOut, &amp;VdFractionBreakingWavesOut, &amp;VdFreeSurfaceStd, &amp;VdWaveSetupSurge, &amp;VdSinWaveAngleRadians, &amp;VdFractionBreakingWaves);</div>
<div class="line"><a id="l01086" name="l01086"></a><span class="lineno"> 1086</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01087" name="l01087"></a><span class="lineno"> 1087</span> </div>
<div class="line"><a id="l01088" name="l01088"></a><span class="lineno"> 1088</span><span class="preprocessor">#if defined CSHORE_BOTH</span></div>
<div class="line"><a id="l01089" name="l01089"></a><span class="lineno"> 1089</span><span class="preprocessor">   #if ! defined _WIN32</span></div>
<div class="line"><a id="l01090" name="l01090"></a><span class="lineno"> 1090</span>      <span class="keywordflow">if</span> (<a class="code hl_variable" href="../../d6/d2a/cme_8h.html#aaa9e0f47a8f6eeecd6754881d7e59016">SAVE_CSHORE_OUTPUT</a>)</div>
<div class="line"><a id="l01091" name="l01091"></a><span class="lineno"> 1091</span>      {</div>
<div class="line"><a id="l01092" name="l01092"></a><span class="lineno"> 1092</span>         <span class="keywordtype">string</span> strCommand = <span class="stringliteral">&quot;./save_CShore_output.sh &quot;</span>;</div>
<div class="line"><a id="l01093" name="l01093"></a><span class="lineno"> 1093</span>         strCommand += to_string(<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#ad67e8c5b30a0572f64ecfb5c062c2edc">m_ulIter</a>);</div>
<div class="line"><a id="l01094" name="l01094"></a><span class="lineno"> 1094</span>         strCommand += <span class="stringliteral">&quot; &quot;</span>;</div>
<div class="line"><a id="l01095" name="l01095"></a><span class="lineno"> 1095</span>         strCommand += to_string(nCoast);</div>
<div class="line"><a id="l01096" name="l01096"></a><span class="lineno"> 1096</span>         strCommand += <span class="stringliteral">&quot; &quot;</span>;</div>
<div class="line"><a id="l01097" name="l01097"></a><span class="lineno"> 1097</span>         strCommand += to_string(nProfile);</div>
<div class="line"><a id="l01098" name="l01098"></a><span class="lineno"> 1098</span> </div>
<div class="line"><a id="l01099" name="l01099"></a><span class="lineno"> 1099</span>         nRet = system(strCommand.c_str());</div>
<div class="line"><a id="l01100" name="l01100"></a><span class="lineno"> 1100</span>         <span class="keywordflow">if</span> (nRet != <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#aa768cb14b5c6123ee95e6e4ebd9fe331">RTN_OK</a>)</div>
<div class="line"><a id="l01101" name="l01101"></a><span class="lineno"> 1101</span>            <span class="keywordflow">return</span> nRet;</div>
<div class="line"><a id="l01102" name="l01102"></a><span class="lineno"> 1102</span>      }</div>
<div class="line"><a id="l01103" name="l01103"></a><span class="lineno"> 1103</span><span class="preprocessor">   #endif</span></div>
<div class="line"><a id="l01104" name="l01104"></a><span class="lineno"> 1104</span> </div>
<div class="line"><a id="l01105" name="l01105"></a><span class="lineno"> 1105</span>      <span class="comment">// Return to the CoastalME folder</span></div>
<div class="line"><a id="l01106" name="l01106"></a><span class="lineno"> 1106</span>      nRet = chdir(<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a7f8368cae1a6852c1ea7ff99b2d0c035">m_strCMEDir</a>.c_str());</div>
<div class="line"><a id="l01107" name="l01107"></a><span class="lineno"> 1107</span>      <span class="keywordflow">if</span> (nRet != <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#aa768cb14b5c6123ee95e6e4ebd9fe331">RTN_OK</a>)</div>
<div class="line"><a id="l01108" name="l01108"></a><span class="lineno"> 1108</span>         <span class="keywordflow">return</span> nRet;</div>
<div class="line"><a id="l01109" name="l01109"></a><span class="lineno"> 1109</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01110" name="l01110"></a><span class="lineno"> 1110</span> </div>
<div class="line"><a id="l01111" name="l01111"></a><span class="lineno"> 1111</span>      <span class="comment">// Do more safety checks, then convert the CShore output to wave height and wave direction, and update wave profile attributes</span></div>
<div class="line"><a id="l01112" name="l01112"></a><span class="lineno"> 1112</span>      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> nProfilePoint = (nProfileSize - 1); nProfilePoint &gt;= 0; nProfilePoint--)</div>
<div class="line"><a id="l01113" name="l01113"></a><span class="lineno"> 1113</span>      {</div>
<div class="line"><a id="l01114" name="l01114"></a><span class="lineno"> 1114</span>         <span class="keywordtype">int</span> nX = pProfile-&gt;<a class="code hl_function" href="../../da/dae/classCGeomProfile.html#a6d13079f744085f2d132405e0120ca54">pPtiGetCellInProfile</a>(nProfilePoint)-&gt;<a class="code hl_function" href="../../d6/d0d/classCGeom2DIPoint.html#af84c687b2d0be01ab41cbcc0565f4f3f">nGetX</a>();</div>
<div class="line"><a id="l01115" name="l01115"></a><span class="lineno"> 1115</span>         <span class="keywordtype">int</span> nY = pProfile-&gt;<a class="code hl_function" href="../../da/dae/classCGeomProfile.html#a6d13079f744085f2d132405e0120ca54">pPtiGetCellInProfile</a>(nProfilePoint)-&gt;<a class="code hl_function" href="../../d6/d0d/classCGeom2DIPoint.html#a4d9c20bcca90dcb9d519b664aba09cbd">nGetY</a>();</div>
<div class="line"><a id="l01116" name="l01116"></a><span class="lineno"> 1116</span> </div>
<div class="line"><a id="l01117" name="l01117"></a><span class="lineno"> 1117</span>         <span class="comment">// Safety check</span></div>
<div class="line"><a id="l01118" name="l01118"></a><span class="lineno"> 1118</span>         <span class="keywordflow">if</span> (nProfilePoint &gt; <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(VdFreeSurfaceStd.size()) - 1)</div>
<div class="line"><a id="l01119" name="l01119"></a><span class="lineno"> 1119</span>            <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l01120" name="l01120"></a><span class="lineno"> 1120</span> </div>
<div class="line"><a id="l01121" name="l01121"></a><span class="lineno"> 1121</span>         <span class="comment">// Safety check: deal with NaN values</span></div>
<div class="line"><a id="l01122" name="l01122"></a><span class="lineno"> 1122</span>         <span class="keywordflow">if</span> (isnan(VdFreeSurfaceStd[nProfilePoint]))</div>
<div class="line"><a id="l01123" name="l01123"></a><span class="lineno"> 1123</span>            VdFreeSurfaceStd[nProfilePoint] = 0;</div>
<div class="line"><a id="l01124" name="l01124"></a><span class="lineno"> 1124</span>             </div>
<div class="line"><a id="l01125" name="l01125"></a><span class="lineno"> 1125</span>         VdWaveHeight[nProfilePoint] = sqrt(8) * VdFreeSurfaceStd[nProfilePoint];</div>
<div class="line"><a id="l01126" name="l01126"></a><span class="lineno"> 1126</span>         </div>
<div class="line"><a id="l01127" name="l01127"></a><span class="lineno"> 1127</span>         <span class="comment">// Another safety check: deal with NaN values</span></div>
<div class="line"><a id="l01128" name="l01128"></a><span class="lineno"> 1128</span>         <span class="keywordflow">if</span> (isnan(VdSinWaveAngleRadians[nProfilePoint]))</div>
<div class="line"><a id="l01129" name="l01129"></a><span class="lineno"> 1129</span>         {</div>
<div class="line"><a id="l01130" name="l01130"></a><span class="lineno"> 1130</span>            VdSinWaveAngleRadians[nProfilePoint] = 0;</div>
<div class="line"><a id="l01131" name="l01131"></a><span class="lineno"> 1131</span>            VdWaveHeight[nProfilePoint] = 0;</div>
<div class="line"><a id="l01132" name="l01132"></a><span class="lineno"> 1132</span>         }</div>
<div class="line"><a id="l01133" name="l01133"></a><span class="lineno"> 1133</span>         </div>
<div class="line"><a id="l01134" name="l01134"></a><span class="lineno"> 1134</span>         <span class="comment">// More safety checks: constrain to the interval -1 to +1 to keep asin() happy</span></div>
<div class="line"><a id="l01135" name="l01135"></a><span class="lineno"> 1135</span>         <span class="keywordflow">if</span> (VdSinWaveAngleRadians[nProfilePoint] &lt; -1)</div>
<div class="line"><a id="l01136" name="l01136"></a><span class="lineno"> 1136</span>            VdSinWaveAngleRadians[nProfilePoint] = -1;</div>
<div class="line"><a id="l01137" name="l01137"></a><span class="lineno"> 1137</span>         <span class="keywordflow">if</span> (VdSinWaveAngleRadians[nProfilePoint] &gt; 1)</div>
<div class="line"><a id="l01138" name="l01138"></a><span class="lineno"> 1138</span>            VdSinWaveAngleRadians[nProfilePoint] = 1;</div>
<div class="line"><a id="l01139" name="l01139"></a><span class="lineno"> 1139</span> </div>
<div class="line"><a id="l01140" name="l01140"></a><span class="lineno"> 1140</span>         <span class="keywordtype">double</span> dAlpha = asin(VdSinWaveAngleRadians[nProfilePoint]) * (180 / <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a5d502a06fdd71825be49e07c95496b16">PI</a>);</div>
<div class="line"><a id="l01141" name="l01141"></a><span class="lineno"> 1141</span>         <span class="keywordflow">if</span> (nSeaHand == <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#afdd3411d0fa60c62522af14ea2a90570">LEFT_HANDED</a>)</div>
<div class="line"><a id="l01142" name="l01142"></a><span class="lineno"> 1142</span>            VdWaveDirection[nProfilePoint] = <a class="code hl_function" href="../../d1/d98/classCSimulation.html#a425803ba4110668094dba54c0f9b91c8">dKeepWithin360</a>(dAlpha + 90 + dFluxOrientationThis);</div>
<div class="line"><a id="l01143" name="l01143"></a><span class="lineno"> 1143</span>         <span class="keywordflow">else</span></div>
<div class="line"><a id="l01144" name="l01144"></a><span class="lineno"> 1144</span>            VdWaveDirection[nProfilePoint] = <a class="code hl_function" href="../../d1/d98/classCSimulation.html#a425803ba4110668094dba54c0f9b91c8">dKeepWithin360</a>(dAlpha + 270 + dFluxOrientationThis);</div>
<div class="line"><a id="l01145" name="l01145"></a><span class="lineno"> 1145</span>         </div>
<div class="line"><a id="l01146" name="l01146"></a><span class="lineno"> 1146</span>         <span class="comment">// Yet another safety check: deal with NaN values</span></div>
<div class="line"><a id="l01147" name="l01147"></a><span class="lineno"> 1147</span>         <span class="keywordflow">if</span> (isnan(VdFractionBreakingWaves[nProfilePoint]))</div>
<div class="line"><a id="l01148" name="l01148"></a><span class="lineno"> 1148</span>         {</div>
<div class="line"><a id="l01149" name="l01149"></a><span class="lineno"> 1149</span>            VdFractionBreakingWaves[nProfilePoint] = 0;</div>
<div class="line"><a id="l01150" name="l01150"></a><span class="lineno"> 1150</span>            VdWaveHeight[nProfilePoint] = 0;</div>
<div class="line"><a id="l01151" name="l01151"></a><span class="lineno"> 1151</span>         }</div>
<div class="line"><a id="l01152" name="l01152"></a><span class="lineno"> 1152</span> </div>
<div class="line"><a id="l01153" name="l01153"></a><span class="lineno"> 1153</span>         <span class="comment">// if ((VdFractionBreakingWaves[nProfilePoint] &gt;= 0.10) &amp;&amp; (! bBreaking)) // Sometimes is possible that waves break again</span></div>
<div class="line"><a id="l01154" name="l01154"></a><span class="lineno"> 1154</span>         <span class="keywordflow">if</span> ((VdFractionBreakingWaves[nProfilePoint] &gt;= 0.10) &amp;&amp; (<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#aecac3135005148dc01ee8ba3871b7fbf">m_dDepthOfClosure</a> &gt;= <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nX][nY].dGetSeaDepth()) &amp;&amp; (! bBreaking))</div>
<div class="line"><a id="l01155" name="l01155"></a><span class="lineno"> 1155</span>         {</div>
<div class="line"><a id="l01156" name="l01156"></a><span class="lineno"> 1156</span>            bBreaking = <span class="keyword">true</span>;</div>
<div class="line"><a id="l01157" name="l01157"></a><span class="lineno"> 1157</span>            <span class="comment">// assert(VdWaveHeight[nProfilePoint] &gt;= 0);</span></div>
<div class="line"><a id="l01158" name="l01158"></a><span class="lineno"> 1158</span>            dProfileBreakingWaveHeight = VdWaveHeight[nProfilePoint];</div>
<div class="line"><a id="l01159" name="l01159"></a><span class="lineno"> 1159</span>            dProfileBreakingWaveAngle = VdWaveDirection[nProfilePoint];</div>
<div class="line"><a id="l01160" name="l01160"></a><span class="lineno"> 1160</span>            dProfileBreakingDepth = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nX][nY].dGetSeaDepth(); <span class="comment">// Water depth for the cell &#39;under&#39; this point in the profile</span></div>
<div class="line"><a id="l01161" name="l01161"></a><span class="lineno"> 1161</span>            nProfileBreakingDist = nProfilePoint + 1;                             <span class="comment">// At the nearest point nProfilePoint = 0, so, plus one</span></div>
<div class="line"><a id="l01162" name="l01162"></a><span class="lineno"> 1162</span> </div>
<div class="line"><a id="l01163" name="l01163"></a><span class="lineno"> 1163</span>            <span class="comment">//             LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: CShore breaking at [&quot; &lt;&lt; nX &lt;&lt; &quot;][&quot; &lt;&lt; nY &lt;&lt; &quot;] = {&quot; &lt;&lt; dGridCentroidXToExtCRSX(nX) &lt;&lt; &quot;, &quot; &lt;&lt; dGridCentroidYToExtCRSY(nY) &lt;&lt; &quot;} nProfile = &quot; &lt;&lt; nProfile &lt;&lt; &quot;, nProfilePoint = &quot; &lt;&lt; nProfilePoint &lt;&lt; &quot;, dBreakingWaveHeight = &quot; &lt;&lt; dBreakingWaveHeight &lt;&lt; &quot;, dBreakingWaveAngle = &quot; &lt;&lt; dBreakingWaveAngle &lt;&lt; &quot;, dProfileBreakingDepth = &quot; &lt;&lt; dProfileBreakingDepth &lt;&lt; &quot;, nProfileBreakingDist = &quot; &lt;&lt; nProfileBreakingDist &lt;&lt; endl;</span></div>
<div class="line"><a id="l01164" name="l01164"></a><span class="lineno"> 1164</span>         }</div>
<div class="line"><a id="l01165" name="l01165"></a><span class="lineno"> 1165</span> </div>
<div class="line"><a id="l01166" name="l01166"></a><span class="lineno"> 1166</span>         VbWaveIsBreaking[nProfilePoint] = bBreaking;</div>
<div class="line"><a id="l01167" name="l01167"></a><span class="lineno"> 1167</span>      }</div>
<div class="line"><a id="l01168" name="l01168"></a><span class="lineno"> 1168</span>      </div>
<div class="line"><a id="l01169" name="l01169"></a><span class="lineno"> 1169</span>      <span class="keywordflow">if</span> (dProfileBreakingWaveHeight &gt;= dProfileDeepWaterWaveHeight)</div>
<div class="line"><a id="l01170" name="l01170"></a><span class="lineno"> 1170</span>      {</div>
<div class="line"><a id="l01171" name="l01171"></a><span class="lineno"> 1171</span>         dProfileBreakingWaveHeight = <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#ac003bdff958dca839f5d274f15786e07">DBL_NODATA</a>; <span class="comment">// checking poorly conditions profiles problems for cshore</span></div>
<div class="line"><a id="l01172" name="l01172"></a><span class="lineno"> 1172</span>      }</div>
<div class="line"><a id="l01173" name="l01173"></a><span class="lineno"> 1173</span>   }</div>
<div class="line"><a id="l01174" name="l01174"></a><span class="lineno"> 1174</span> </div>
<div class="line"><a id="l01175" name="l01175"></a><span class="lineno"> 1175</span>   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a8339da211b79a1bbac7061604218dd6e">m_nWavePropagationModel</a> == <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a06de4af92b990a0b1a90b06466dc0fd5">WAVE_MODEL_COVE</a>)</div>
<div class="line"><a id="l01176" name="l01176"></a><span class="lineno"> 1176</span>   {</div>
<div class="line"><a id="l01177" name="l01177"></a><span class="lineno"> 1177</span>      <span class="comment">// We are using COVE&#39;s linear wave theory to propagate the waves</span></div>
<div class="line"><a id="l01178" name="l01178"></a><span class="lineno"> 1178</span>      <span class="keywordtype">double</span> dDepthLookupMax = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a47fe76dd475e06490d4cffc0d1afc8b0">m_dWaveDepthRatioForWaveCalcs</a> * dProfileDeepWaterWaveHeight;</div>
<div class="line"><a id="l01179" name="l01179"></a><span class="lineno"> 1179</span> </div>
<div class="line"><a id="l01180" name="l01180"></a><span class="lineno"> 1180</span>      <span class="comment">// Go landwards along the profile, calculating wave height and wave angle for every inundated point on the profile (don&#39;t do point zero, this is on the coastline) until the waves start to break  after breaking wave height is assumed to decrease linearly to zero at the shoreline and wave angle is equalt to wave angle at breaking</span></div>
<div class="line"><a id="l01181" name="l01181"></a><span class="lineno"> 1181</span>      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> nProfilePoint = (nProfileSize - 1); nProfilePoint &gt;= 0; nProfilePoint--)</div>
<div class="line"><a id="l01182" name="l01182"></a><span class="lineno"> 1182</span>      {</div>
<div class="line"><a id="l01183" name="l01183"></a><span class="lineno"> 1183</span>         <span class="keywordtype">int</span> nX = pProfile-&gt;<a class="code hl_function" href="../../da/dae/classCGeomProfile.html#a6d13079f744085f2d132405e0120ca54">pPtiGetCellInProfile</a>(nProfilePoint)-&gt;<a class="code hl_function" href="../../d6/d0d/classCGeom2DIPoint.html#af84c687b2d0be01ab41cbcc0565f4f3f">nGetX</a>();</div>
<div class="line"><a id="l01184" name="l01184"></a><span class="lineno"> 1184</span>         <span class="keywordtype">int</span> nY = pProfile-&gt;<a class="code hl_function" href="../../da/dae/classCGeomProfile.html#a6d13079f744085f2d132405e0120ca54">pPtiGetCellInProfile</a>(nProfilePoint)-&gt;<a class="code hl_function" href="../../d6/d0d/classCGeom2DIPoint.html#a4d9c20bcca90dcb9d519b664aba09cbd">nGetY</a>();</div>
<div class="line"><a id="l01185" name="l01185"></a><span class="lineno"> 1185</span> </div>
<div class="line"><a id="l01186" name="l01186"></a><span class="lineno"> 1186</span>         <span class="comment">// Safety check</span></div>
<div class="line"><a id="l01187" name="l01187"></a><span class="lineno"> 1187</span>         <span class="keywordflow">if</span> (! <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nX][nY].bIsInContiguousSea())</div>
<div class="line"><a id="l01188" name="l01188"></a><span class="lineno"> 1188</span>            <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l01189" name="l01189"></a><span class="lineno"> 1189</span> </div>
<div class="line"><a id="l01190" name="l01190"></a><span class="lineno"> 1190</span>         <span class="keywordtype">double</span> dSeaDepth = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nX][nY].dGetSeaDepth(); <span class="comment">// Water depth for the cell &#39;under&#39; this point in the profile</span></div>
<div class="line"><a id="l01191" name="l01191"></a><span class="lineno"> 1191</span>         <span class="keywordflow">if</span> (dSeaDepth &gt; dDepthLookupMax)</div>
<div class="line"><a id="l01192" name="l01192"></a><span class="lineno"> 1192</span>         {</div>
<div class="line"><a id="l01193" name="l01193"></a><span class="lineno"> 1193</span>            <span class="comment">// Sea depth is too large relative to wave height to feel the bottom, so do nothing since each cell under the profile has already been initialised with deep water wave height and wave direction</span></div>
<div class="line"><a id="l01194" name="l01194"></a><span class="lineno"> 1194</span>            dProfileWaveHeight = dProfileDeepWaterWaveHeight;</div>
<div class="line"><a id="l01195" name="l01195"></a><span class="lineno"> 1195</span>            dProfileWaveAngle = dProfileDeepWaterWaveAngle;</div>
<div class="line"><a id="l01196" name="l01196"></a><span class="lineno"> 1196</span>         }</div>
<div class="line"><a id="l01197" name="l01197"></a><span class="lineno"> 1197</span>         <span class="keywordflow">else</span></div>
<div class="line"><a id="l01198" name="l01198"></a><span class="lineno"> 1198</span>         {</div>
<div class="line"><a id="l01199" name="l01199"></a><span class="lineno"> 1199</span>            <span class="keywordflow">if</span> (! bBreaking)</div>
<div class="line"><a id="l01200" name="l01200"></a><span class="lineno"> 1200</span>            {</div>
<div class="line"><a id="l01201" name="l01201"></a><span class="lineno"> 1201</span>               <span class="comment">// Start calculating wave properties using linear wave theory</span></div>
<div class="line"><a id="l01202" name="l01202"></a><span class="lineno"> 1202</span>               <span class="keywordtype">double</span> dL = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a19723831442bb99d698366c7194a6f58">m_dL_0</a> * sqrt(tanh((2 * <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a5d502a06fdd71825be49e07c95496b16">PI</a> * dSeaDepth) / <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a19723831442bb99d698366c7194a6f58">m_dL_0</a>));                          <span class="comment">// Wavelength (m) in intermediate-shallow waters</span></div>
<div class="line"><a id="l01203" name="l01203"></a><span class="lineno"> 1203</span>               <span class="keywordtype">double</span> dC = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#acb7418ac5450534bbaa9619554a9b20f">m_dC_0</a> * tanh((2 * <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a5d502a06fdd71825be49e07c95496b16">PI</a> * dSeaDepth) / dL);                                    <span class="comment">// Wave speed (m/s) set by dSeaDepth, dL and m_dC_0</span></div>
<div class="line"><a id="l01204" name="l01204"></a><span class="lineno"> 1204</span>               <span class="keywordtype">double</span> dk = 2 * <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a5d502a06fdd71825be49e07c95496b16">PI</a> / dL;                                                                 <span class="comment">// Wave number (1/m)</span></div>
<div class="line"><a id="l01205" name="l01205"></a><span class="lineno"> 1205</span>               <span class="keywordtype">double</span> dn = ((2 * dSeaDepth * dk) / (sinh(2 * dSeaDepth * dk)) + 1) / 2;                 <span class="comment">// Shoaling factor</span></div>
<div class="line"><a id="l01206" name="l01206"></a><span class="lineno"> 1206</span>               <span class="keywordtype">double</span> dKs = sqrt(<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#acb7418ac5450534bbaa9619554a9b20f">m_dC_0</a> / (dn * dC * 2));                                               <span class="comment">// Shoaling coefficient</span></div>
<div class="line"><a id="l01207" name="l01207"></a><span class="lineno"> 1207</span>               <span class="keywordtype">double</span> dAlpha = (180 / <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a5d502a06fdd71825be49e07c95496b16">PI</a>) * asin((dC / <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#acb7418ac5450534bbaa9619554a9b20f">m_dC_0</a>) * sin((<a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a5d502a06fdd71825be49e07c95496b16">PI</a> / 180) * dWaveToNormalAngle)); <span class="comment">// Calculate angle between wave direction and the normal to the coast tangent</span></div>
<div class="line"><a id="l01208" name="l01208"></a><span class="lineno"> 1208</span>               <span class="keywordtype">double</span> dKr = sqrt(cos((<a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a5d502a06fdd71825be49e07c95496b16">PI</a> / 180) * dWaveToNormalAngle) / cos((<a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a5d502a06fdd71825be49e07c95496b16">PI</a> / 180) * dAlpha));      <span class="comment">// Refraction coefficient</span></div>
<div class="line"><a id="l01209" name="l01209"></a><span class="lineno"> 1209</span>               dProfileWaveHeight = dProfileDeepWaterWaveHeight * dKs * dKr;                            <span class="comment">// Calculate wave height, based on the previous (more seaward) wave height</span></div>
<div class="line"><a id="l01210" name="l01210"></a><span class="lineno"> 1210</span>               <span class="keywordflow">if</span> (nSeaHand == <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#afdd3411d0fa60c62522af14ea2a90570">LEFT_HANDED</a>)</div>
<div class="line"><a id="l01211" name="l01211"></a><span class="lineno"> 1211</span>                  dProfileWaveAngle = <a class="code hl_function" href="../../d1/d98/classCSimulation.html#a425803ba4110668094dba54c0f9b91c8">dKeepWithin360</a>(dAlpha + 90 + dFluxOrientationThis);</div>
<div class="line"><a id="l01212" name="l01212"></a><span class="lineno"> 1212</span>               <span class="keywordflow">else</span></div>
<div class="line"><a id="l01213" name="l01213"></a><span class="lineno"> 1213</span>                  dProfileWaveAngle = <a class="code hl_function" href="../../d1/d98/classCSimulation.html#a425803ba4110668094dba54c0f9b91c8">dKeepWithin360</a>(dAlpha + 270 + dFluxOrientationThis);</div>
<div class="line"><a id="l01214" name="l01214"></a><span class="lineno"> 1214</span> </div>
<div class="line"><a id="l01215" name="l01215"></a><span class="lineno"> 1215</span>               <span class="comment">// Test to see if the wave breaks at this depth</span></div>
<div class="line"><a id="l01216" name="l01216"></a><span class="lineno"> 1216</span>               <span class="keywordflow">if</span> (dProfileWaveHeight &lt; (dSeaDepth * <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a6e25557aa80dd5aef09170fdc51d80ca">m_dBreakingWaveHeightDepthRatio</a>))</div>
<div class="line"><a id="l01217" name="l01217"></a><span class="lineno"> 1217</span>               {</div>
<div class="line"><a id="l01218" name="l01218"></a><span class="lineno"> 1218</span>                  dProfileBreakingWaveHeight = dProfileWaveHeight;</div>
<div class="line"><a id="l01219" name="l01219"></a><span class="lineno"> 1219</span>                  dProfileBreakingWaveAngle = dProfileWaveAngle;</div>
<div class="line"><a id="l01220" name="l01220"></a><span class="lineno"> 1220</span>               }</div>
<div class="line"><a id="l01221" name="l01221"></a><span class="lineno"> 1221</span>            }</div>
<div class="line"><a id="l01222" name="l01222"></a><span class="lineno"> 1222</span>            <span class="keywordflow">else</span></div>
<div class="line"><a id="l01223" name="l01223"></a><span class="lineno"> 1223</span>            {</div>
<div class="line"><a id="l01224" name="l01224"></a><span class="lineno"> 1224</span>               <span class="comment">// It does</span></div>
<div class="line"><a id="l01225" name="l01225"></a><span class="lineno"> 1225</span>               bBreaking = <span class="keyword">true</span>;</div>
<div class="line"><a id="l01226" name="l01226"></a><span class="lineno"> 1226</span> </div>
<div class="line"><a id="l01227" name="l01227"></a><span class="lineno"> 1227</span>               <span class="comment">// Wave has already broken</span></div>
<div class="line"><a id="l01228" name="l01228"></a><span class="lineno"> 1228</span>               dProfileWaveAngle = dProfileBreakingWaveAngle; <span class="comment">// Wave orientation remains equal to wave orientation at breaking</span></div>
<div class="line"><a id="l01229" name="l01229"></a><span class="lineno"> 1229</span> </div>
<div class="line"><a id="l01230" name="l01230"></a><span class="lineno"> 1230</span>               dProfileWaveHeight = dProfileBreakingWaveHeight * (nProfilePoint / nProfileBreakingDist); <span class="comment">// Wave height decreases linearly to zero at shoreline</span></div>
<div class="line"><a id="l01231" name="l01231"></a><span class="lineno"> 1231</span>               <span class="comment">// dProfileWaveHeight = dSeaDepth * m_dBreakingWaveHeightDepthRatio; // Wave height is limited by depth</span></div>
<div class="line"><a id="l01232" name="l01232"></a><span class="lineno"> 1232</span>               dProfileBreakingDepth = dSeaDepth;</div>
<div class="line"><a id="l01233" name="l01233"></a><span class="lineno"> 1233</span>               nProfileBreakingDist = nProfilePoint;</div>
<div class="line"><a id="l01234" name="l01234"></a><span class="lineno"> 1234</span>            }</div>
<div class="line"><a id="l01235" name="l01235"></a><span class="lineno"> 1235</span>         }</div>
<div class="line"><a id="l01236" name="l01236"></a><span class="lineno"> 1236</span> </div>
<div class="line"><a id="l01237" name="l01237"></a><span class="lineno"> 1237</span>         <span class="comment">// Save current wave attributes</span></div>
<div class="line"><a id="l01238" name="l01238"></a><span class="lineno"> 1238</span>         VdWaveDirection[nProfilePoint] = dProfileWaveAngle;</div>
<div class="line"><a id="l01239" name="l01239"></a><span class="lineno"> 1239</span>         VdWaveHeight[nProfilePoint] = dProfileWaveHeight;</div>
<div class="line"><a id="l01240" name="l01240"></a><span class="lineno"> 1240</span>         VbWaveIsBreaking[nProfilePoint] = bBreaking;</div>
<div class="line"><a id="l01241" name="l01241"></a><span class="lineno"> 1241</span>      }</div>
<div class="line"><a id="l01242" name="l01242"></a><span class="lineno"> 1242</span>   }</div>
<div class="line"><a id="l01243" name="l01243"></a><span class="lineno"> 1243</span> </div>
<div class="line"><a id="l01244" name="l01244"></a><span class="lineno"> 1244</span>   <span class="comment">// Go landwards along the profile, fetching the calculated wave height and wave angle for every inundated point on this profile</span></div>
<div class="line"><a id="l01245" name="l01245"></a><span class="lineno"> 1245</span>   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> nProfilePoint = (nProfileSize - 1); nProfilePoint &gt;= 0; nProfilePoint--)</div>
<div class="line"><a id="l01246" name="l01246"></a><span class="lineno"> 1246</span>   {</div>
<div class="line"><a id="l01247" name="l01247"></a><span class="lineno"> 1247</span>      <span class="keywordtype">int</span> nX = pProfile-&gt;<a class="code hl_function" href="../../da/dae/classCGeomProfile.html#a6d13079f744085f2d132405e0120ca54">pPtiGetCellInProfile</a>(nProfilePoint)-&gt;<a class="code hl_function" href="../../d6/d0d/classCGeom2DIPoint.html#af84c687b2d0be01ab41cbcc0565f4f3f">nGetX</a>();</div>
<div class="line"><a id="l01248" name="l01248"></a><span class="lineno"> 1248</span>      <span class="keywordtype">int</span> nY = pProfile-&gt;<a class="code hl_function" href="../../da/dae/classCGeomProfile.html#a6d13079f744085f2d132405e0120ca54">pPtiGetCellInProfile</a>(nProfilePoint)-&gt;<a class="code hl_function" href="../../d6/d0d/classCGeom2DIPoint.html#a4d9c20bcca90dcb9d519b664aba09cbd">nGetY</a>();</div>
<div class="line"><a id="l01249" name="l01249"></a><span class="lineno"> 1249</span> </div>
<div class="line"><a id="l01250" name="l01250"></a><span class="lineno"> 1250</span>      <span class="comment">// Safety check</span></div>
<div class="line"><a id="l01251" name="l01251"></a><span class="lineno"> 1251</span>      <span class="keywordflow">if</span> (! <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nX][nY].bIsInContiguousSea())</div>
<div class="line"><a id="l01252" name="l01252"></a><span class="lineno"> 1252</span>         <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l01253" name="l01253"></a><span class="lineno"> 1253</span> </div>
<div class="line"><a id="l01254" name="l01254"></a><span class="lineno"> 1254</span>      <span class="comment">// Get the wave attributes calculated for this profile: wave height, wave angle, and whether is in the active zone</span></div>
<div class="line"><a id="l01255" name="l01255"></a><span class="lineno"> 1255</span>      <span class="keywordtype">double</span> dWaveHeight = VdWaveHeight[nProfilePoint];</div>
<div class="line"><a id="l01256" name="l01256"></a><span class="lineno"> 1256</span>      <span class="keywordtype">double</span> dWaveAngle = VdWaveDirection[nProfilePoint];</div>
<div class="line"><a id="l01257" name="l01257"></a><span class="lineno"> 1257</span> </div>
<div class="line"><a id="l01258" name="l01258"></a><span class="lineno"> 1258</span>      bBreaking = VbWaveIsBreaking[nProfilePoint];</div>
<div class="line"><a id="l01259" name="l01259"></a><span class="lineno"> 1259</span> </div>
<div class="line"><a id="l01260" name="l01260"></a><span class="lineno"> 1260</span>      <span class="comment">// And store the wave properties for this point in the all-profiles vectors</span></div>
<div class="line"><a id="l01261" name="l01261"></a><span class="lineno"> 1261</span>      pVdX-&gt;push_back(nX);</div>
<div class="line"><a id="l01262" name="l01262"></a><span class="lineno"> 1262</span>      pVdY-&gt;push_back(nY);</div>
<div class="line"><a id="l01263" name="l01263"></a><span class="lineno"> 1263</span>      pVdHeightX-&gt;push_back(dWaveHeight * sin(dWaveAngle * <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a5d502a06fdd71825be49e07c95496b16">PI</a> / 180));</div>
<div class="line"><a id="l01264" name="l01264"></a><span class="lineno"> 1264</span>      pVdHeightY-&gt;push_back(dWaveHeight * cos(dWaveAngle * <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a5d502a06fdd71825be49e07c95496b16">PI</a> / 180));</div>
<div class="line"><a id="l01265" name="l01265"></a><span class="lineno"> 1265</span>      pVbBreaking-&gt;push_back(bBreaking);</div>
<div class="line"><a id="l01266" name="l01266"></a><span class="lineno"> 1266</span>   }</div>
<div class="line"><a id="l01267" name="l01267"></a><span class="lineno"> 1267</span> </div>
<div class="line"><a id="l01268" name="l01268"></a><span class="lineno"> 1268</span>   <span class="comment">// Obtain the profile nodes near the coast</span></div>
<div class="line"><a id="l01269" name="l01269"></a><span class="lineno"> 1269</span>   <span class="keywordtype">int</span> nX = pProfile-&gt;<a class="code hl_function" href="../../da/dae/classCGeomProfile.html#a6d13079f744085f2d132405e0120ca54">pPtiGetCellInProfile</a>(nProfileSize - 2)-&gt;<a class="code hl_function" href="../../d6/d0d/classCGeom2DIPoint.html#af84c687b2d0be01ab41cbcc0565f4f3f">nGetX</a>();</div>
<div class="line"><a id="l01270" name="l01270"></a><span class="lineno"> 1270</span>   <span class="keywordtype">int</span> nY = pProfile-&gt;<a class="code hl_function" href="../../da/dae/classCGeomProfile.html#a6d13079f744085f2d132405e0120ca54">pPtiGetCellInProfile</a>(nProfileSize - 2)-&gt;<a class="code hl_function" href="../../d6/d0d/classCGeom2DIPoint.html#a4d9c20bcca90dcb9d519b664aba09cbd">nGetY</a>();</div>
<div class="line"><a id="l01271" name="l01271"></a><span class="lineno"> 1271</span>   <span class="keywordtype">int</span> nX1 = pProfile-&gt;<a class="code hl_function" href="../../da/dae/classCGeomProfile.html#a6d13079f744085f2d132405e0120ca54">pPtiGetCellInProfile</a>(nProfileSize - 1)-&gt;<a class="code hl_function" href="../../d6/d0d/classCGeom2DIPoint.html#af84c687b2d0be01ab41cbcc0565f4f3f">nGetX</a>();</div>
<div class="line"><a id="l01272" name="l01272"></a><span class="lineno"> 1272</span>   <span class="keywordtype">int</span> nY1 = pProfile-&gt;<a class="code hl_function" href="../../da/dae/classCGeomProfile.html#a6d13079f744085f2d132405e0120ca54">pPtiGetCellInProfile</a>(nProfileSize - 1)-&gt;<a class="code hl_function" href="../../d6/d0d/classCGeom2DIPoint.html#a4d9c20bcca90dcb9d519b664aba09cbd">nGetY</a>();</div>
<div class="line"><a id="l01273" name="l01273"></a><span class="lineno"> 1273</span> </div>
<div class="line"><a id="l01274" name="l01274"></a><span class="lineno"> 1274</span>   <span class="comment">// Calculate the horizontal distance between the profile points</span></div>
<div class="line"><a id="l01275" name="l01275"></a><span class="lineno"> 1275</span>   <span class="keywordtype">double</span> dXDist = <a class="code hl_function" href="../../d6/d2a/cme_8h.html#ae3b6dc50cfc97050529faa5e0bd66136">tAbs</a>(<a class="code hl_function" href="../../d1/d98/classCSimulation.html#ad79b925ac5f358c6f867b6e47dad74bd">dGridCentroidXToExtCRSX</a>(nX1) - <a class="code hl_function" href="../../d1/d98/classCSimulation.html#ad79b925ac5f358c6f867b6e47dad74bd">dGridCentroidXToExtCRSX</a>(nX));</div>
<div class="line"><a id="l01276" name="l01276"></a><span class="lineno"> 1276</span>   <span class="keywordtype">double</span> dYDist = <a class="code hl_function" href="../../d6/d2a/cme_8h.html#ae3b6dc50cfc97050529faa5e0bd66136">tAbs</a>(<a class="code hl_function" href="../../d1/d98/classCSimulation.html#a7e2a4bd69ce79377fee86aa5598903f8">dGridCentroidYToExtCRSY</a>(nY1) - <a class="code hl_function" href="../../d1/d98/classCSimulation.html#a7e2a4bd69ce79377fee86aa5598903f8">dGridCentroidYToExtCRSY</a>(nY));</div>
<div class="line"><a id="l01277" name="l01277"></a><span class="lineno"> 1277</span>   </div>
<div class="line"><a id="l01278" name="l01278"></a><span class="lineno"> 1278</span>   <span class="comment">// Safety check</span></div>
<div class="line"><a id="l01279" name="l01279"></a><span class="lineno"> 1279</span>   <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d6/d2a/cme_8h.html#a61afa8560a3b39c80657661a1d8f76ab">bFPIsEqual</a>(dXDist, 0.0, <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a08b1623863ee3bd4300a8892de323722">TOLERANCE</a>))</div>
<div class="line"><a id="l01280" name="l01280"></a><span class="lineno"> 1280</span>      dXDist = 1e-3;</div>
<div class="line"><a id="l01281" name="l01281"></a><span class="lineno"> 1281</span>   </div>
<div class="line"><a id="l01282" name="l01282"></a><span class="lineno"> 1282</span>   <span class="comment">// Safety check</span></div>
<div class="line"><a id="l01283" name="l01283"></a><span class="lineno"> 1283</span>   <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d6/d2a/cme_8h.html#a61afa8560a3b39c80657661a1d8f76ab">bFPIsEqual</a>(dYDist, 0.0, <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a08b1623863ee3bd4300a8892de323722">TOLERANCE</a>))</div>
<div class="line"><a id="l01284" name="l01284"></a><span class="lineno"> 1284</span>      dYDist = 1e-3;</div>
<div class="line"><a id="l01285" name="l01285"></a><span class="lineno"> 1285</span> </div>
<div class="line"><a id="l01286" name="l01286"></a><span class="lineno"> 1286</span>   <span class="keywordtype">double</span> dDiffProfileDistXY = hypot(dXDist, dYDist);</div>
<div class="line"><a id="l01287" name="l01287"></a><span class="lineno"> 1287</span> </div>
<div class="line"><a id="l01288" name="l01288"></a><span class="lineno"> 1288</span>   <span class="comment">// Compute the beach slope</span></div>
<div class="line"><a id="l01289" name="l01289"></a><span class="lineno"> 1289</span>   <span class="keywordtype">double</span> dtanBeta = tan(<a class="code hl_function" href="../../d6/d2a/cme_8h.html#ae3b6dc50cfc97050529faa5e0bd66136">tAbs</a>(<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nX1][nY1].dGetSeaDepth() - <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nX][nY].dGetSeaDepth()) / dDiffProfileDistXY);</div>
<div class="line"><a id="l01290" name="l01290"></a><span class="lineno"> 1290</span> </div>
<div class="line"><a id="l01291" name="l01291"></a><span class="lineno"> 1291</span>   <span class="comment">// Compute the wave run-up using NIELSEN &amp; HANSLOW (1991) &amp; DHI (2004)</span></div>
<div class="line"><a id="l01292" name="l01292"></a><span class="lineno"> 1292</span>   <span class="keywordtype">int</span> nValidPointsWaveHeight = 0;</div>
<div class="line"><a id="l01293" name="l01293"></a><span class="lineno"> 1293</span>   <span class="keywordtype">int</span> nValidPointsWaveSetup = 0;</div>
<div class="line"><a id="l01294" name="l01294"></a><span class="lineno"> 1294</span> </div>
<div class="line"><a id="l01295" name="l01295"></a><span class="lineno"> 1295</span>   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> nPoint = 0; nPoint &lt; static_cast&lt;int&gt;(VdWaveHeight.size()); nPoint++)</div>
<div class="line"><a id="l01296" name="l01296"></a><span class="lineno"> 1296</span>   {</div>
<div class="line"><a id="l01297" name="l01297"></a><span class="lineno"> 1297</span>      <span class="keywordflow">if</span> (VdWaveHeight[nPoint] &gt; 1e-4)</div>
<div class="line"><a id="l01298" name="l01298"></a><span class="lineno"> 1298</span>      {</div>
<div class="line"><a id="l01299" name="l01299"></a><span class="lineno"> 1299</span>         nValidPointsWaveHeight += 1;</div>
<div class="line"><a id="l01300" name="l01300"></a><span class="lineno"> 1300</span>      }</div>
<div class="line"><a id="l01301" name="l01301"></a><span class="lineno"> 1301</span>      <span class="keywordflow">else</span></div>
<div class="line"><a id="l01302" name="l01302"></a><span class="lineno"> 1302</span>      {</div>
<div class="line"><a id="l01303" name="l01303"></a><span class="lineno"> 1303</span>         <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01304" name="l01304"></a><span class="lineno"> 1304</span>      }</div>
<div class="line"><a id="l01305" name="l01305"></a><span class="lineno"> 1305</span>   }</div>
<div class="line"><a id="l01306" name="l01306"></a><span class="lineno"> 1306</span>   nValidPointsWaveHeight -= 1;</div>
<div class="line"><a id="l01307" name="l01307"></a><span class="lineno"> 1307</span> </div>
<div class="line"><a id="l01308" name="l01308"></a><span class="lineno"> 1308</span>   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> nPoint = 0; nPoint &lt; static_cast&lt;int&gt;(VdWaveSetupSurge.size()); nPoint++)</div>
<div class="line"><a id="l01309" name="l01309"></a><span class="lineno"> 1309</span>   {</div>
<div class="line"><a id="l01310" name="l01310"></a><span class="lineno"> 1310</span>      <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d6/d2a/cme_8h.html#ae3b6dc50cfc97050529faa5e0bd66136">tAbs</a>(VdWaveSetupSurge[nPoint]) &lt; 1)    <span class="comment">// limiting the absolute value of setup + surge if cshore run fails</span></div>
<div class="line"><a id="l01311" name="l01311"></a><span class="lineno"> 1311</span>      {</div>
<div class="line"><a id="l01312" name="l01312"></a><span class="lineno"> 1312</span>         nValidPointsWaveSetup += 1;</div>
<div class="line"><a id="l01313" name="l01313"></a><span class="lineno"> 1313</span>      }</div>
<div class="line"><a id="l01314" name="l01314"></a><span class="lineno"> 1314</span>      <span class="keywordflow">else</span></div>
<div class="line"><a id="l01315" name="l01315"></a><span class="lineno"> 1315</span>      {</div>
<div class="line"><a id="l01316" name="l01316"></a><span class="lineno"> 1316</span>         <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01317" name="l01317"></a><span class="lineno"> 1317</span>      }</div>
<div class="line"><a id="l01318" name="l01318"></a><span class="lineno"> 1318</span>   }</div>
<div class="line"><a id="l01319" name="l01319"></a><span class="lineno"> 1319</span>   nValidPointsWaveSetup -= 1;</div>
<div class="line"><a id="l01320" name="l01320"></a><span class="lineno"> 1320</span> </div>
<div class="line"><a id="l01321" name="l01321"></a><span class="lineno"> 1321</span>   <span class="keywordtype">double</span> dWaveHeight = 0;</div>
<div class="line"><a id="l01322" name="l01322"></a><span class="lineno"> 1322</span> </div>
<div class="line"><a id="l01323" name="l01323"></a><span class="lineno"> 1323</span>   <span class="comment">// Safety checks</span></div>
<div class="line"><a id="l01324" name="l01324"></a><span class="lineno"> 1324</span>   <span class="keywordflow">if</span> ((nValidPointsWaveHeight &gt;= 0) &amp;&amp; (! <a class="code hl_function" href="../../d6/d2a/cme_8h.html#a61afa8560a3b39c80657661a1d8f76ab">bFPIsEqual</a>(VdWaveHeight[nValidPointsWaveHeight], <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#ac003bdff958dca839f5d274f15786e07">DBL_NODATA</a>, <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a08b1623863ee3bd4300a8892de323722">TOLERANCE</a>)))</div>
<div class="line"><a id="l01325" name="l01325"></a><span class="lineno"> 1325</span>   {</div>
<div class="line"><a id="l01326" name="l01326"></a><span class="lineno"> 1326</span>      dWaveHeight = VdWaveHeight[nValidPointsWaveHeight];</div>
<div class="line"><a id="l01327" name="l01327"></a><span class="lineno"> 1327</span>   }</div>
<div class="line"><a id="l01328" name="l01328"></a><span class="lineno"> 1328</span> </div>
<div class="line"><a id="l01329" name="l01329"></a><span class="lineno"> 1329</span>   <span class="comment">// TODO 060 Remove these &#39;magic numbers&#39;</span></div>
<div class="line"><a id="l01330" name="l01330"></a><span class="lineno"> 1330</span>   <span class="keywordtype">double</span> dRunUp = 0;</div>
<div class="line"><a id="l01331" name="l01331"></a><span class="lineno"> 1331</span>   <span class="keywordflow">if</span> (<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a688a1ad67441892ad605d6b7e050ad13">m_nRunUpEquation</a> == 0)</div>
<div class="line"><a id="l01332" name="l01332"></a><span class="lineno"> 1332</span>   {</div>
<div class="line"><a id="l01333" name="l01333"></a><span class="lineno"> 1333</span>      <span class="comment">// Compute the run-up using NIELSEN &amp; HANSLOW (1991) &amp; DHI (2004) // TODO 007</span></div>
<div class="line"><a id="l01334" name="l01334"></a><span class="lineno"> 1334</span>      dRunUp = 0.36 * pow(9.81, 0.5) * dtanBeta * pow(dWaveHeight, 0.5) * dDeepWaterWavePeriod;</div>
<div class="line"><a id="l01335" name="l01335"></a><span class="lineno"> 1335</span>   }</div>
<div class="line"><a id="l01336" name="l01336"></a><span class="lineno"> 1336</span>   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a688a1ad67441892ad605d6b7e050ad13">m_nRunUpEquation</a> == 1)</div>
<div class="line"><a id="l01337" name="l01337"></a><span class="lineno"> 1337</span>   {</div>
<div class="line"><a id="l01338" name="l01338"></a><span class="lineno"> 1338</span>      <span class="comment">// Compute the run-up using MASE 1989</span></div>
<div class="line"><a id="l01339" name="l01339"></a><span class="lineno"> 1339</span>      <span class="keywordtype">double</span> dS0 = 2 * <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a5d502a06fdd71825be49e07c95496b16">PI</a> * dWaveHeight / (9.81 * dDeepWaterWavePeriod * dDeepWaterWavePeriod);</div>
<div class="line"><a id="l01340" name="l01340"></a><span class="lineno"> 1340</span>      dRunUp = 1.86 * dWaveHeight * pow(pow(dtanBeta / dS0, 0.5), 0.71);</div>
<div class="line"><a id="l01341" name="l01341"></a><span class="lineno"> 1341</span>   }</div>
<div class="line"><a id="l01342" name="l01342"></a><span class="lineno"> 1342</span>   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a688a1ad67441892ad605d6b7e050ad13">m_nRunUpEquation</a> == 2)</div>
<div class="line"><a id="l01343" name="l01343"></a><span class="lineno"> 1343</span>   {</div>
<div class="line"><a id="l01344" name="l01344"></a><span class="lineno"> 1344</span>      <span class="comment">// Compute the run-up using STOCKDON (2006)</span></div>
<div class="line"><a id="l01345" name="l01345"></a><span class="lineno"> 1345</span>      <span class="keywordtype">double</span> dS0 = 2 * <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a5d502a06fdd71825be49e07c95496b16">PI</a> * dWaveHeight / (9.81 * dDeepWaterWavePeriod * dDeepWaterWavePeriod);</div>
<div class="line"><a id="l01346" name="l01346"></a><span class="lineno"> 1346</span>      <span class="comment">// dRunUp = 1.1 * ((0.35 * dWaveHeight * (pow((1 / dS0) * dWaveHeight * dWaveHeight, 0.5))) + (((((1 / dS0) * dWaveHeight * dWaveHeight) * (0.563 * dWaveHeight * dWaveHeight + 0.0004)), 0.5)) / 2);</span></div>
<div class="line"><a id="l01347" name="l01347"></a><span class="lineno"> 1347</span> </div>
<div class="line"><a id="l01348" name="l01348"></a><span class="lineno"> 1348</span>      <span class="keywordtype">double</span> dH0OverL0 = (1 / dS0) * dWaveHeight;</div>
<div class="line"><a id="l01349" name="l01349"></a><span class="lineno"> 1349</span>      <span class="keywordtype">double</span> dTmp1 = 0.35 * dWaveHeight * pow(dH0OverL0, 0.5);</div>
<div class="line"><a id="l01350" name="l01350"></a><span class="lineno"> 1350</span>      <span class="keywordtype">double</span> dTmp2 = pow(dH0OverL0 * ((0.563 * dWaveHeight * dWaveHeight) + 0.0004), 0.5);</div>
<div class="line"><a id="l01351" name="l01351"></a><span class="lineno"> 1351</span>      dRunUp = 1.1 * (dTmp1 + (dTmp2 / 2));</div>
<div class="line"><a id="l01352" name="l01352"></a><span class="lineno"> 1352</span>   }</div>
<div class="line"><a id="l01353" name="l01353"></a><span class="lineno"> 1353</span> </div>
<div class="line"><a id="l01354" name="l01354"></a><span class="lineno"> 1354</span>   <span class="keywordflow">if</span> ((<a class="code hl_function" href="../../d6/d2a/cme_8h.html#ae3b6dc50cfc97050529faa5e0bd66136">tAbs</a>(dRunUp) &lt; 1e-4) || (isnan(dRunUp)))</div>
<div class="line"><a id="l01355" name="l01355"></a><span class="lineno"> 1355</span>   {</div>
<div class="line"><a id="l01356" name="l01356"></a><span class="lineno"> 1356</span>      dRunUp = 0;</div>
<div class="line"><a id="l01357" name="l01357"></a><span class="lineno"> 1357</span>   }</div>
<div class="line"><a id="l01358" name="l01358"></a><span class="lineno"> 1358</span> </div>
<div class="line"><a id="l01359" name="l01359"></a><span class="lineno"> 1359</span>   <span class="keywordtype">double</span> dWaveSetupSurge = 0;</div>
<div class="line"><a id="l01360" name="l01360"></a><span class="lineno"> 1360</span> </div>
<div class="line"><a id="l01361" name="l01361"></a><span class="lineno"> 1361</span>   <span class="comment">// Safety checks</span></div>
<div class="line"><a id="l01362" name="l01362"></a><span class="lineno"> 1362</span>   <span class="keywordflow">if</span> ((nValidPointsWaveSetup &gt;= 0) &amp;&amp; (! <a class="code hl_function" href="../../d6/d2a/cme_8h.html#a61afa8560a3b39c80657661a1d8f76ab">bFPIsEqual</a>(VdWaveSetupSurge[nValidPointsWaveSetup], <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#ac003bdff958dca839f5d274f15786e07">DBL_NODATA</a>, <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a08b1623863ee3bd4300a8892de323722">TOLERANCE</a>)))</div>
<div class="line"><a id="l01363" name="l01363"></a><span class="lineno"> 1363</span>   {</div>
<div class="line"><a id="l01364" name="l01364"></a><span class="lineno"> 1364</span>      dWaveSetupSurge = VdWaveSetupSurge[nValidPointsWaveSetup];</div>
<div class="line"><a id="l01365" name="l01365"></a><span class="lineno"> 1365</span>   }</div>
<div class="line"><a id="l01366" name="l01366"></a><span class="lineno"> 1366</span>   </div>
<div class="line"><a id="l01367" name="l01367"></a><span class="lineno"> 1367</span>   <span class="keywordflow">if</span> ((<a class="code hl_function" href="../../d6/d2a/cme_8h.html#ae3b6dc50cfc97050529faa5e0bd66136">tAbs</a>(dWaveSetupSurge) &lt; 1e-4) || (isnan(dWaveSetupSurge)))</div>
<div class="line"><a id="l01368" name="l01368"></a><span class="lineno"> 1368</span>   {</div>
<div class="line"><a id="l01369" name="l01369"></a><span class="lineno"> 1369</span>      dWaveSetupSurge = 0;</div>
<div class="line"><a id="l01370" name="l01370"></a><span class="lineno"> 1370</span>   }</div>
<div class="line"><a id="l01371" name="l01371"></a><span class="lineno"> 1371</span> </div>
<div class="line"><a id="l01372" name="l01372"></a><span class="lineno"> 1372</span>   <span class="comment">// Update wave attributes along the coastline object. Wave height at the coast is always calculated (i.e. whether or not waves are breaking)</span></div>
<div class="line"><a id="l01373" name="l01373"></a><span class="lineno"> 1373</span>   <span class="comment">// cout &lt;&lt; &quot;Wave Height at the coast is &quot; &lt;&lt; VdWaveHeight[nProfileSize - 1] &lt;&lt; endl;</span></div>
<div class="line"><a id="l01374" name="l01374"></a><span class="lineno"> 1374</span>   <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].SetCoastWaveHeight(nCoastPoint, dWaveHeight);</div>
<div class="line"><a id="l01375" name="l01375"></a><span class="lineno"> 1375</span>   <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].SetWaveSetupSurge(nCoastPoint, dWaveSetupSurge);</div>
<div class="line"><a id="l01376" name="l01376"></a><span class="lineno"> 1376</span>   <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].SetRunUp(nCoastPoint, dRunUp);</div>
<div class="line"><a id="l01377" name="l01377"></a><span class="lineno"> 1377</span> </div>
<div class="line"><a id="l01378" name="l01378"></a><span class="lineno"> 1378</span>   <span class="keywordflow">if</span> (nProfileBreakingDist &gt; 0)</div>
<div class="line"><a id="l01379" name="l01379"></a><span class="lineno"> 1379</span>   {</div>
<div class="line"><a id="l01380" name="l01380"></a><span class="lineno"> 1380</span>      <span class="comment">// This coast point is in the active zone, so set breaking wave height, breaking wave angle, and depth of breaking for the coast point</span></div>
<div class="line"><a id="l01381" name="l01381"></a><span class="lineno"> 1381</span>      <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].SetBreakingWaveHeight(nCoastPoint, dProfileBreakingWaveHeight);</div>
<div class="line"><a id="l01382" name="l01382"></a><span class="lineno"> 1382</span>      <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].SetBreakingWaveAngle(nCoastPoint, dProfileBreakingWaveAngle);</div>
<div class="line"><a id="l01383" name="l01383"></a><span class="lineno"> 1383</span>      <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].SetDepthOfBreaking(nCoastPoint, dProfileBreakingDepth);</div>
<div class="line"><a id="l01384" name="l01384"></a><span class="lineno"> 1384</span>      <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].SetBreakingDistance(nCoastPoint, nProfileBreakingDist);</div>
<div class="line"><a id="l01385" name="l01385"></a><span class="lineno"> 1385</span> </div>
<div class="line"><a id="l01386" name="l01386"></a><span class="lineno"> 1386</span>      <span class="comment">//       LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: nProfile = &quot; &lt;&lt; nProfile &lt;&lt; &quot;, nCoastPoint = &quot; &lt;&lt; nCoastPoint &lt;&lt; &quot; in active zone, dBreakingWaveHeight = &quot; &lt;&lt; dBreakingWaveHeight &lt;&lt; endl;</span></div>
<div class="line"><a id="l01387" name="l01387"></a><span class="lineno"> 1387</span>   }</div>
<div class="line"><a id="l01388" name="l01388"></a><span class="lineno"> 1388</span>   <span class="keywordflow">else</span></div>
<div class="line"><a id="l01389" name="l01389"></a><span class="lineno"> 1389</span>   {</div>
<div class="line"><a id="l01390" name="l01390"></a><span class="lineno"> 1390</span>      <span class="comment">// This coast point is not in the active zone, so breaking wave height, breaking wave angle, and depth of breaking are all meaningless</span></div>
<div class="line"><a id="l01391" name="l01391"></a><span class="lineno"> 1391</span>      <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].SetBreakingWaveHeight(nCoastPoint, <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#ac003bdff958dca839f5d274f15786e07">DBL_NODATA</a>);</div>
<div class="line"><a id="l01392" name="l01392"></a><span class="lineno"> 1392</span>      <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].SetBreakingWaveAngle(nCoastPoint, <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#ac003bdff958dca839f5d274f15786e07">DBL_NODATA</a>);</div>
<div class="line"><a id="l01393" name="l01393"></a><span class="lineno"> 1393</span>      <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].SetDepthOfBreaking(nCoastPoint, <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#ac003bdff958dca839f5d274f15786e07">DBL_NODATA</a>);</div>
<div class="line"><a id="l01394" name="l01394"></a><span class="lineno"> 1394</span>      <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].SetBreakingDistance(nCoastPoint, <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a01aa8b423260b337ddff2016107b51a0">INT_NODATA</a>);</div>
<div class="line"><a id="l01395" name="l01395"></a><span class="lineno"> 1395</span> </div>
<div class="line"><a id="l01396" name="l01396"></a><span class="lineno"> 1396</span>      <span class="comment">//       LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: nProfile = &quot; &lt;&lt; nProfile &lt;&lt; &quot;, nCoastPoint = &quot; &lt;&lt; nCoastPoint &lt;&lt; &quot; NOT in active zone&quot; &lt;&lt; endl;</span></div>
<div class="line"><a id="l01397" name="l01397"></a><span class="lineno"> 1397</span>   }</div>
<div class="line"><a id="l01398" name="l01398"></a><span class="lineno"> 1398</span> </div>
<div class="line"><a id="l01399" name="l01399"></a><span class="lineno"> 1399</span>   <span class="keywordflow">return</span> <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#aa768cb14b5c6123ee95e6e4ebd9fe331">RTN_OK</a>;</div>
<div class="line"><a id="l01400" name="l01400"></a><span class="lineno"> 1400</span>}</div>
</div>
<div class="line"><a id="l01401" name="l01401"></a><span class="lineno"> 1401</span> </div>
<div class="line"><a id="l01402" name="l01402"></a><span class="lineno"> 1402</span><span class="preprocessor">#if defined CSHORE_FILE_INOUT</span></div>
<div class="line"><a id="l01403" name="l01403"></a><span class="lineno"> 1403</span><span class="comment">//===============================================================================================================================</span></div>
<div class="line"><a id="l01405" name="l01405"></a><span class="lineno"> 1405</span><span class="comment">//===============================================================================================================================</span></div>
<div class="line"><a id="l01406" name="l01406"></a><span class="lineno"> 1406</span><span class="keywordtype">int</span> <a class="code hl_function" href="../../d1/d98/classCSimulation.html#a4dd8148f0c1baa096e92c3a0ff2eee2d">CSimulation::nCreateCShoreInfile</a>(<span class="keywordtype">int</span> <span class="keyword">const</span> nCoast, <span class="keywordtype">int</span> <span class="keyword">const</span> nProfile, <span class="keywordtype">int</span> <span class="keyword">const</span> nILine, <span class="keywordtype">int</span> <span class="keyword">const</span> nIProfl, <span class="keywordtype">int</span> <span class="keyword">const</span> nIPerm, <span class="keywordtype">int</span> <span class="keyword">const</span> nIOver, <span class="keywordtype">int</span> <span class="keyword">const</span> nIWcint, <span class="keywordtype">int</span> <span class="keyword">const</span> nIRoll, <span class="keywordtype">int</span> <span class="keyword">const</span> nIWind, <span class="keywordtype">int</span> <span class="keyword">const</span> nITide, <span class="keywordtype">int</span> <span class="keyword">const</span> nILab, <span class="keywordtype">int</span> <span class="keyword">const</span> nWave, <span class="keywordtype">int</span> <span class="keyword">const</span> nSurge, <span class="keywordtype">double</span> <span class="keyword">const</span> dX, <span class="keywordtype">double</span> <span class="keyword">const</span> dTimestep, <span class="keywordtype">double</span> <span class="keyword">const</span> dWaveInitTime, <span class="keywordtype">double</span> <span class="keyword">const</span> dWavePeriod, <span class="keywordtype">double</span> <span class="keyword">const</span> dHrms, <span class="keywordtype">double</span> <span class="keyword">const</span> dWaveAngle, <span class="keywordtype">double</span> <span class="keyword">const</span> dSurgeInitTime, <span class="keywordtype">double</span> <span class="keyword">const</span> dSurgeLevel, vector&lt;double&gt; <span class="keyword">const</span>* pVdXdist, vector&lt;double&gt; <span class="keyword">const</span>* pVdBottomElevation, vector&lt;double&gt; <span class="keyword">const</span>* pVdWaveFriction)</div>
<div class="line"><a id="l01407" name="l01407"></a><span class="lineno"> 1407</span>{</div>
<div class="line"><a id="l01408" name="l01408"></a><span class="lineno"> 1408</span>   <span class="comment">// Create the CShore input file</span></div>
<div class="line"><a id="l01409" name="l01409"></a><span class="lineno"> 1409</span>   ofstream CShoreOutStream;</div>
<div class="line"><a id="l01410" name="l01410"></a><span class="lineno"> 1410</span>   CShoreOutStream.open(<a class="code hl_variable" href="../../d6/d2a/cme_8h.html#afd188232c7637cf5943004f3eeacbb2b">CSHORE_INFILE</a>.c_str(), ios::out | ios::app);</div>
<div class="line"><a id="l01411" name="l01411"></a><span class="lineno"> 1411</span>   <span class="keywordflow">if</span> (CShoreOutStream.fail())</div>
<div class="line"><a id="l01412" name="l01412"></a><span class="lineno"> 1412</span>   {</div>
<div class="line"><a id="l01413" name="l01413"></a><span class="lineno"> 1413</span>      <span class="comment">// Error, cannot open file for writing</span></div>
<div class="line"><a id="l01414" name="l01414"></a><span class="lineno"> 1414</span>      <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a222962121613613a48f518e0c2110f21">LogStream</a> &lt;&lt; <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#ad67e8c5b30a0572f64ecfb5c062c2edc">m_ulIter</a> &lt;&lt; <span class="stringliteral">&quot;: &quot;</span> &lt;&lt; <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a292fc90846543ca4814daa9f759feb05">ERR</a> &lt;&lt; <span class="stringliteral">&quot;cannot write to CShore input file &#39;&quot;</span> &lt;&lt; <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#afd188232c7637cf5943004f3eeacbb2b">CSHORE_INFILE</a> &lt;&lt; <span class="stringliteral">&quot;&#39;&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a id="l01415" name="l01415"></a><span class="lineno"> 1415</span>      <span class="keywordflow">return</span> <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a206d98a82620d9512e62d54b0827a4f2">RTN_ERR_CSHORE_FILE_INPUT</a>;</div>
<div class="line"><a id="l01416" name="l01416"></a><span class="lineno"> 1416</span>   }</div>
<div class="line"><a id="l01417" name="l01417"></a><span class="lineno"> 1417</span> </div>
<div class="line"><a id="l01418" name="l01418"></a><span class="lineno"> 1418</span>   <span class="comment">// And write to the file</span></div>
<div class="line"><a id="l01419" name="l01419"></a><span class="lineno"> 1419</span>   CShoreOutStream &lt;&lt; 3 &lt;&lt; endl; <span class="comment">// Number of comment lines</span></div>
<div class="line"><a id="l01420" name="l01420"></a><span class="lineno"> 1420</span>   CShoreOutStream &lt;&lt; <span class="stringliteral">&quot;------------------------------------------------------------&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a id="l01421" name="l01421"></a><span class="lineno"> 1421</span>   CShoreOutStream &lt;&lt; <span class="stringliteral">&quot;CShore input file created by CoastalME for iteration &quot;</span> &lt;&lt; <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#ad67e8c5b30a0572f64ecfb5c062c2edc">m_ulIter</a> &lt;&lt; <span class="stringliteral">&quot;, coast &quot;</span> &lt;&lt; nCoast &lt;&lt; <span class="stringliteral">&quot;, profile &quot;</span> &lt;&lt; nProfile &lt;&lt; endl;</div>
<div class="line"><a id="l01422" name="l01422"></a><span class="lineno"> 1422</span>   CShoreOutStream &lt;&lt; <span class="stringliteral">&quot;------------------------------------------------------------&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a id="l01423" name="l01423"></a><span class="lineno"> 1423</span>   CShoreOutStream &lt;&lt; nILine &lt;&lt; <span class="stringliteral">&quot;                                         -&gt; ILINE&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a id="l01424" name="l01424"></a><span class="lineno"> 1424</span>   CShoreOutStream &lt;&lt; nIProfl &lt;&lt; <span class="stringliteral">&quot;                                         -&gt; IPROFL&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a id="l01425" name="l01425"></a><span class="lineno"> 1425</span>   CShoreOutStream &lt;&lt; nIPerm &lt;&lt; <span class="stringliteral">&quot;                                         -&gt; IPERM&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a id="l01426" name="l01426"></a><span class="lineno"> 1426</span>   CShoreOutStream &lt;&lt; nIOver &lt;&lt; <span class="stringliteral">&quot;                                         -&gt; IOVER&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a id="l01427" name="l01427"></a><span class="lineno"> 1427</span>   CShoreOutStream &lt;&lt; nIWcint &lt;&lt; <span class="stringliteral">&quot;                                         -&gt; IWCINT&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a id="l01428" name="l01428"></a><span class="lineno"> 1428</span>   CShoreOutStream &lt;&lt; nIRoll &lt;&lt; <span class="stringliteral">&quot;                                         -&gt; IROLL&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a id="l01429" name="l01429"></a><span class="lineno"> 1429</span>   CShoreOutStream &lt;&lt; nIWind &lt;&lt; <span class="stringliteral">&quot;                                         -&gt; IWIND&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a id="l01430" name="l01430"></a><span class="lineno"> 1430</span>   CShoreOutStream &lt;&lt; nITide &lt;&lt; <span class="stringliteral">&quot;                                         -&gt; ITIDE&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a id="l01431" name="l01431"></a><span class="lineno"> 1431</span>   CShoreOutStream &lt;&lt; fixed;</div>
<div class="line"><a id="l01432" name="l01432"></a><span class="lineno"> 1432</span>   CShoreOutStream &lt;&lt; setw(11) &lt;&lt; setprecision(4) &lt;&lt; dX &lt;&lt; <span class="stringliteral">&quot;                               -&gt; DX&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a id="l01433" name="l01433"></a><span class="lineno"> 1433</span>   CShoreOutStream &lt;&lt; setw(11) &lt;&lt; <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a6e25557aa80dd5aef09170fdc51d80ca">m_dBreakingWaveHeightDepthRatio</a> &lt;&lt; <span class="stringliteral">&quot;                               -&gt; GAMMA&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a id="l01434" name="l01434"></a><span class="lineno"> 1434</span>   CShoreOutStream &lt;&lt; setw(11) &lt;&lt; nILab &lt;&lt; <span class="stringliteral">&quot;                               -&gt; ILAB&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a id="l01435" name="l01435"></a><span class="lineno"> 1435</span>   CShoreOutStream &lt;&lt; setw(11) &lt;&lt; nWave &lt;&lt; <span class="stringliteral">&quot;                               -&gt; NWAVE&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a id="l01436" name="l01436"></a><span class="lineno"> 1436</span>   CShoreOutStream &lt;&lt; setw(11) &lt;&lt; nSurge &lt;&lt; <span class="stringliteral">&quot;                               -&gt; NSURGE&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a id="l01437" name="l01437"></a><span class="lineno"> 1437</span> </div>
<div class="line"><a id="l01438" name="l01438"></a><span class="lineno"> 1438</span>   <span class="comment">// Line 18 of infile</span></div>
<div class="line"><a id="l01439" name="l01439"></a><span class="lineno"> 1439</span>   CShoreOutStream &lt;&lt; setw(11) &lt;&lt; setprecision(2) &lt;&lt; dWaveInitTime;           <span class="comment">// TWAVE(1) in CShore</span></div>
<div class="line"><a id="l01440" name="l01440"></a><span class="lineno"> 1440</span>   CShoreOutStream &lt;&lt; setw(11) &lt;&lt; setprecision(4) &lt;&lt; dWavePeriod;             <span class="comment">// TPIN(1) in CShore</span></div>
<div class="line"><a id="l01441" name="l01441"></a><span class="lineno"> 1441</span>   CShoreOutStream &lt;&lt; setw(11) &lt;&lt; dHrms;                                      <span class="comment">// HRMS(1) in CShore</span></div>
<div class="line"><a id="l01442" name="l01442"></a><span class="lineno"> 1442</span>   CShoreOutStream &lt;&lt; setw(11) &lt;&lt; dWaveAngle &lt;&lt; endl;                         <span class="comment">// WANGIN(1) in CShore</span></div>
<div class="line"><a id="l01443" name="l01443"></a><span class="lineno"> 1443</span> </div>
<div class="line"><a id="l01444" name="l01444"></a><span class="lineno"> 1444</span>   <span class="comment">// Line 19 of infile</span></div>
<div class="line"><a id="l01445" name="l01445"></a><span class="lineno"> 1445</span>   CShoreOutStream &lt;&lt; setw(11) &lt;&lt; setprecision(2) &lt;&lt; dTimestep;               <span class="comment">// TWAVE(2) in CShore</span></div>
<div class="line"><a id="l01446" name="l01446"></a><span class="lineno"> 1446</span>   CShoreOutStream &lt;&lt; setw(11) &lt;&lt; setprecision(4) &lt;&lt; dWavePeriod;             <span class="comment">// TPIN(2) in CShore</span></div>
<div class="line"><a id="l01447" name="l01447"></a><span class="lineno"> 1447</span>   CShoreOutStream &lt;&lt; setw(11) &lt;&lt; dHrms;                                      <span class="comment">// HRMS(2) in CShore</span></div>
<div class="line"><a id="l01448" name="l01448"></a><span class="lineno"> 1448</span>   CShoreOutStream &lt;&lt; setw(11) &lt;&lt; dWaveAngle &lt;&lt; endl;                         <span class="comment">// WANGIN(2) in CShore</span></div>
<div class="line"><a id="l01449" name="l01449"></a><span class="lineno"> 1449</span> </div>
<div class="line"><a id="l01450" name="l01450"></a><span class="lineno"> 1450</span>   <span class="comment">// Line 20 of infile</span></div>
<div class="line"><a id="l01451" name="l01451"></a><span class="lineno"> 1451</span>   CShoreOutStream &lt;&lt; setw(11) &lt;&lt; setprecision(2) &lt;&lt; dSurgeInitTime;          <span class="comment">// TSURG(1) in CShore</span></div>
<div class="line"><a id="l01452" name="l01452"></a><span class="lineno"> 1452</span>   CShoreOutStream &lt;&lt; setw(11) &lt;&lt; setprecision(4) &lt;&lt; dSurgeLevel &lt;&lt; endl;     <span class="comment">// SWLIN(1) in CShore</span></div>
<div class="line"><a id="l01453" name="l01453"></a><span class="lineno"> 1453</span> </div>
<div class="line"><a id="l01454" name="l01454"></a><span class="lineno"> 1454</span>   <span class="comment">// Line 21 of infile</span></div>
<div class="line"><a id="l01455" name="l01455"></a><span class="lineno"> 1455</span>   CShoreOutStream &lt;&lt; setw(11) &lt;&lt; setprecision(2) &lt;&lt; dTimestep;               <span class="comment">// TSURG(2) in CShore</span></div>
<div class="line"><a id="l01456" name="l01456"></a><span class="lineno"> 1456</span>   CShoreOutStream &lt;&lt; setw(11) &lt;&lt; setprecision(4) &lt;&lt; dSurgeLevel &lt;&lt; endl;     <span class="comment">// SWLIN(2) in CShore</span></div>
<div class="line"><a id="l01457" name="l01457"></a><span class="lineno"> 1457</span> </div>
<div class="line"><a id="l01458" name="l01458"></a><span class="lineno"> 1458</span>   <span class="comment">// Line 22 of infile</span></div>
<div class="line"><a id="l01459" name="l01459"></a><span class="lineno"> 1459</span>   CShoreOutStream &lt;&lt; setw(8) &lt;&lt; pVdXdist-&gt;size() &lt;&lt; <span class="stringliteral">&quot;                                  -&gt; NBINP&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a id="l01460" name="l01460"></a><span class="lineno"> 1460</span> </div>
<div class="line"><a id="l01461" name="l01461"></a><span class="lineno"> 1461</span>   CShoreOutStream &lt;&lt; fixed &lt;&lt; setprecision(4);</div>
<div class="line"><a id="l01462" name="l01462"></a><span class="lineno"> 1462</span>   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; pVdXdist-&gt;size(); i++)</div>
<div class="line"><a id="l01463" name="l01463"></a><span class="lineno"> 1463</span>      <span class="comment">// These are BINP(J,1), ZBINP(J,1), FBINP(J-1,1) in CShore</span></div>
<div class="line"><a id="l01464" name="l01464"></a><span class="lineno"> 1464</span>      CShoreOutStream &lt;&lt; setw(11) &lt;&lt; pVdXdist-&gt;at(i) &lt;&lt; setw(11) &lt;&lt; pVdBottomElevation-&gt;at(i) &lt;&lt; setw(11) &lt;&lt; pVdWaveFriction-&gt;at(i) &lt;&lt; endl;</div>
<div class="line"><a id="l01465" name="l01465"></a><span class="lineno"> 1465</span> </div>
<div class="line"><a id="l01466" name="l01466"></a><span class="lineno"> 1466</span>   CShoreOutStream &lt;&lt; endl;</div>
<div class="line"><a id="l01467" name="l01467"></a><span class="lineno"> 1467</span> </div>
<div class="line"><a id="l01468" name="l01468"></a><span class="lineno"> 1468</span>   <span class="comment">// File written, so close it</span></div>
<div class="line"><a id="l01469" name="l01469"></a><span class="lineno"> 1469</span>   CShoreOutStream.close();</div>
<div class="line"><a id="l01470" name="l01470"></a><span class="lineno"> 1470</span> </div>
<div class="line"><a id="l01471" name="l01471"></a><span class="lineno"> 1471</span>   <span class="keywordflow">return</span> <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#aa768cb14b5c6123ee95e6e4ebd9fe331">RTN_OK</a>;</div>
<div class="line"><a id="l01472" name="l01472"></a><span class="lineno"> 1472</span>}</div>
<div class="line"><a id="l01473" name="l01473"></a><span class="lineno"> 1473</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01474" name="l01474"></a><span class="lineno"> 1474</span> </div>
<div class="line"><a id="l01475" name="l01475"></a><span class="lineno"> 1475</span><span class="comment">//===============================================================================================================================</span></div>
<div class="line"><a id="l01477" name="l01477"></a><span class="lineno"> 1477</span><span class="comment">//===============================================================================================================================</span></div>
<div class="foldopen" id="foldopen01478" data-start="{" data-end="}">
<div class="line"><a id="l01478" name="l01478"></a><span class="lineno"><a class="line" href="../../d1/d98/classCSimulation.html#ac723b53f5226b435cb6f6a617c531c04"> 1478</a></span><span class="keywordtype">int</span> <a class="code hl_function" href="../../d1/d98/classCSimulation.html#ac723b53f5226b435cb6f6a617c531c04">CSimulation::nGetThisProfileElevationsForCShore</a>(<span class="keywordtype">int</span> <span class="keyword">const</span> nCoast, <a class="code hl_class" href="../../da/dae/classCGeomProfile.html">CGeomProfile</a>* pProfile, <span class="keywordtype">int</span> <span class="keyword">const</span> nProfSize, vector&lt;double&gt;* VdDistXY, vector&lt;double&gt;* VdVZ, vector&lt;double&gt;* VdFricF)</div>
<div class="line"><a id="l01479" name="l01479"></a><span class="lineno"> 1479</span>{</div>
<div class="line"><a id="l01480" name="l01480"></a><span class="lineno"> 1480</span>   <span class="keywordtype">bool</span> bIsBehindIntervention = <span class="keyword">false</span>;</div>
<div class="line"><a id="l01481" name="l01481"></a><span class="lineno"> 1481</span> </div>
<div class="line"><a id="l01482" name="l01482"></a><span class="lineno"> 1482</span>   <span class="keywordtype">int</span> nX1 = 0;</div>
<div class="line"><a id="l01483" name="l01483"></a><span class="lineno"> 1483</span>   <span class="keywordtype">int</span> nY1 = 0;</div>
<div class="line"><a id="l01484" name="l01484"></a><span class="lineno"> 1484</span> </div>
<div class="line"><a id="l01485" name="l01485"></a><span class="lineno"> 1485</span>   <span class="keywordtype">double</span> dXDist;</div>
<div class="line"><a id="l01486" name="l01486"></a><span class="lineno"> 1486</span>   <span class="keywordtype">double</span> dYDist;</div>
<div class="line"><a id="l01487" name="l01487"></a><span class="lineno"> 1487</span>   <span class="keywordtype">double</span> dProfileDistXY = 0;</div>
<div class="line"><a id="l01488" name="l01488"></a><span class="lineno"> 1488</span>   <span class="keywordtype">double</span> dProfileFricFact;</div>
<div class="line"><a id="l01489" name="l01489"></a><span class="lineno"> 1489</span>   <span class="keywordtype">double</span> dPrevDist = -1;</div>
<div class="line"><a id="l01490" name="l01490"></a><span class="lineno"> 1490</span> </div>
<div class="line"><a id="l01491" name="l01491"></a><span class="lineno"> 1491</span>   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = nProfSize - 1; i &gt;= 0; i--)</div>
<div class="line"><a id="l01492" name="l01492"></a><span class="lineno"> 1492</span>   {</div>
<div class="line"><a id="l01493" name="l01493"></a><span class="lineno"> 1493</span>      <span class="keywordtype">int</span> nX = pProfile-&gt;<a class="code hl_function" href="../../da/dae/classCGeomProfile.html#ada96aa991d179ac71f4523de7a4be560">pPtiVGetCellsInProfile</a>()-&gt;at(i).nGetX();</div>
<div class="line"><a id="l01494" name="l01494"></a><span class="lineno"> 1494</span>      <span class="keywordtype">int</span> nY = pProfile-&gt;<a class="code hl_function" href="../../da/dae/classCGeomProfile.html#ada96aa991d179ac71f4523de7a4be560">pPtiVGetCellsInProfile</a>()-&gt;at(i).nGetY();</div>
<div class="line"><a id="l01495" name="l01495"></a><span class="lineno"> 1495</span> </div>
<div class="line"><a id="l01496" name="l01496"></a><span class="lineno"> 1496</span>      <span class="comment">// Calculate the horizontal distance relative to the most seaward point</span></div>
<div class="line"><a id="l01497" name="l01497"></a><span class="lineno"> 1497</span>      <span class="keywordflow">if</span> (i == nProfSize - 1)</div>
<div class="line"><a id="l01498" name="l01498"></a><span class="lineno"> 1498</span>         dProfileDistXY = 0;</div>
<div class="line"><a id="l01499" name="l01499"></a><span class="lineno"> 1499</span>      <span class="keywordflow">else</span></div>
<div class="line"><a id="l01500" name="l01500"></a><span class="lineno"> 1500</span>      {</div>
<div class="line"><a id="l01501" name="l01501"></a><span class="lineno"> 1501</span>         dXDist = <a class="code hl_function" href="../../d1/d98/classCSimulation.html#ad79b925ac5f358c6f867b6e47dad74bd">dGridCentroidXToExtCRSX</a>(nX1) - <a class="code hl_function" href="../../d1/d98/classCSimulation.html#ad79b925ac5f358c6f867b6e47dad74bd">dGridCentroidXToExtCRSX</a>(nX),</div>
<div class="line"><a id="l01502" name="l01502"></a><span class="lineno"> 1502</span>         dYDist = <a class="code hl_function" href="../../d1/d98/classCSimulation.html#a7e2a4bd69ce79377fee86aa5598903f8">dGridCentroidYToExtCRSY</a>(nY1) - <a class="code hl_function" href="../../d1/d98/classCSimulation.html#a7e2a4bd69ce79377fee86aa5598903f8">dGridCentroidYToExtCRSY</a>(nY),</div>
<div class="line"><a id="l01503" name="l01503"></a><span class="lineno"> 1503</span>         dProfileDistXY = dProfileDistXY + hypot(dXDist, dYDist);</div>
<div class="line"><a id="l01504" name="l01504"></a><span class="lineno"> 1504</span>      }</div>
<div class="line"><a id="l01505" name="l01505"></a><span class="lineno"> 1505</span> </div>
<div class="line"><a id="l01506" name="l01506"></a><span class="lineno"> 1506</span>      <span class="comment">// Before we store the X-Y distance, must check that it is not the same as the previously-stored distance (if it is, we get zero-divide errors in CShore). If they are the same, add on a small distance</span></div>
<div class="line"><a id="l01507" name="l01507"></a><span class="lineno"> 1507</span>      <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d6/d2a/cme_8h.html#a61afa8560a3b39c80657661a1d8f76ab">bFPIsEqual</a>(dProfileDistXY, dPrevDist, <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a08b1623863ee3bd4300a8892de323722">TOLERANCE</a>))</div>
<div class="line"><a id="l01508" name="l01508"></a><span class="lineno"> 1508</span>         dProfileDistXY += 0.1;     <span class="comment">// TODO 084 Improve this</span></div>
<div class="line"><a id="l01509" name="l01509"></a><span class="lineno"> 1509</span> </div>
<div class="line"><a id="l01510" name="l01510"></a><span class="lineno"> 1510</span>      <span class="comment">// Update the cell indexes, the initial cell is now the previous one</span></div>
<div class="line"><a id="l01511" name="l01511"></a><span class="lineno"> 1511</span>      nX1 = nX;</div>
<div class="line"><a id="l01512" name="l01512"></a><span class="lineno"> 1512</span>      nY1 = nY;</div>
<div class="line"><a id="l01513" name="l01513"></a><span class="lineno"> 1513</span> </div>
<div class="line"><a id="l01514" name="l01514"></a><span class="lineno"> 1514</span>      <span class="comment">// Get the number of the highest layer with non-zero thickness</span></div>
<div class="line"><a id="l01515" name="l01515"></a><span class="lineno"> 1515</span>      <span class="keywordtype">int</span> <span class="keyword">const</span> nTopLayer = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nX][nY].nGetTopNonZeroLayerAboveBasement();</div>
<div class="line"><a id="l01516" name="l01516"></a><span class="lineno"> 1516</span> </div>
<div class="line"><a id="l01517" name="l01517"></a><span class="lineno"> 1517</span>      <span class="comment">// Safety checks</span></div>
<div class="line"><a id="l01518" name="l01518"></a><span class="lineno"> 1518</span>      <span class="keywordflow">if</span> (nTopLayer == <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a01aa8b423260b337ddff2016107b51a0">INT_NODATA</a>)</div>
<div class="line"><a id="l01519" name="l01519"></a><span class="lineno"> 1519</span>         <span class="keywordflow">return</span> <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a0af2b64c1c33dbf4d223944b0bf234e6">RTN_ERR_NO_TOP_LAYER</a>;</div>
<div class="line"><a id="l01520" name="l01520"></a><span class="lineno"> 1520</span> </div>
<div class="line"><a id="l01521" name="l01521"></a><span class="lineno"> 1521</span>      <span class="keywordflow">if</span> (nTopLayer == <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a01522c1e8423c6586193dd5ca0c76171">NO_NONZERO_THICKNESS_LAYERS</a>)</div>
<div class="line"><a id="l01522" name="l01522"></a><span class="lineno"> 1522</span>         <span class="comment">// TODO 009 We are down to basement, decide what to do</span></div>
<div class="line"><a id="l01523" name="l01523"></a><span class="lineno"> 1523</span>         <span class="keywordflow">return</span> <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#aa768cb14b5c6123ee95e6e4ebd9fe331">RTN_OK</a>;</div>
<div class="line"><a id="l01524" name="l01524"></a><span class="lineno"> 1524</span> </div>
<div class="line"><a id="l01525" name="l01525"></a><span class="lineno"> 1525</span>      <span class="comment">// Get the elevation for both consolidated and unconsolidated sediment on this cell</span></div>
<div class="line"><a id="l01526" name="l01526"></a><span class="lineno"> 1526</span>      <span class="keywordtype">double</span> dTopElev = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nX][nY].dGetSedimentTopElev() + <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nX][nY].dGetInterventionHeight();</div>
<div class="line"><a id="l01527" name="l01527"></a><span class="lineno"> 1527</span>      <span class="keywordtype">double</span> VdProfileZ = dTopElev - <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a115ab27bae37ce2d0de57cbdaeaba852">m_dThisIterSWL</a>;</div>
<div class="line"><a id="l01528" name="l01528"></a><span class="lineno"> 1528</span> </div>
<div class="line"><a id="l01529" name="l01529"></a><span class="lineno"> 1529</span>      <span class="comment">// Check that landward elevation is greater than SWL</span></div>
<div class="line"><a id="l01530" name="l01530"></a><span class="lineno"> 1530</span>      <span class="keywordflow">if</span> (i == 0)</div>
<div class="line"><a id="l01531" name="l01531"></a><span class="lineno"> 1531</span>      {</div>
<div class="line"><a id="l01532" name="l01532"></a><span class="lineno"> 1532</span>         <span class="keywordflow">if</span> (VdProfileZ &lt; 0)</div>
<div class="line"><a id="l01533" name="l01533"></a><span class="lineno"> 1533</span>         {</div>
<div class="line"><a id="l01534" name="l01534"></a><span class="lineno"> 1534</span>            VdVZ-&gt;push_back(0.1);      <span class="comment">// TODO 053 Set it to a small +ve elevation (compared with SWL). However there must be a better way of doing this</span></div>
<div class="line"><a id="l01535" name="l01535"></a><span class="lineno"> 1535</span>            </div>
<div class="line"><a id="l01536" name="l01536"></a><span class="lineno"> 1536</span>            <span class="comment">// Could not create the profile elevation vectors</span></div>
<div class="line"><a id="l01537" name="l01537"></a><span class="lineno"> 1537</span>            <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a222962121613613a48f518e0c2110f21">LogStream</a> &lt;&lt; <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#ad67e8c5b30a0572f64ecfb5c062c2edc">m_ulIter</a> &lt;&lt; <span class="stringliteral">&quot;: &quot;</span> &lt;&lt; <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a957ca99e98618160534cafb0929f743d">WARN</a> &lt;&lt; <span class="stringliteral">&quot;for coast &quot;</span> &lt;&lt; nCoast &lt;&lt; <span class="stringliteral">&quot;, profile &quot;</span> &lt;&lt; pProfile-&gt;<a class="code hl_function" href="../../da/dae/classCGeomProfile.html#aacd98f9837c3c7cf7414764b73275fba">nGetCoastID</a>() &lt;&lt; <span class="stringliteral">&quot;, elevation at the landward end is &quot;</span> &lt;&lt; dTopElev &lt;&lt; <span class="stringliteral">&quot; m. This is lower than this-iteration SWL (&quot;</span> &lt;&lt; <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a115ab27bae37ce2d0de57cbdaeaba852">m_dThisIterSWL</a> &lt;&lt; <span class="stringliteral">&quot; m). For CShore, changing the landward elevation for profile &quot;</span> &lt;&lt; pProfile-&gt;<a class="code hl_function" href="../../da/dae/classCGeomProfile.html#aacd98f9837c3c7cf7414764b73275fba">nGetCoastID</a>() &lt;&lt; <span class="stringliteral">&quot; to &quot;</span> &lt;&lt; <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a115ab27bae37ce2d0de57cbdaeaba852">m_dThisIterSWL</a> + 0.1 &lt;&lt; <span class="stringliteral">&quot;m&quot;</span> &lt;&lt;  endl;</div>
<div class="line"><a id="l01538" name="l01538"></a><span class="lineno"> 1538</span>         }</div>
<div class="line"><a id="l01539" name="l01539"></a><span class="lineno"> 1539</span>         <span class="keywordflow">else</span></div>
<div class="line"><a id="l01540" name="l01540"></a><span class="lineno"> 1540</span>         {</div>
<div class="line"><a id="l01541" name="l01541"></a><span class="lineno"> 1541</span>            VdVZ-&gt;push_back(VdProfileZ);</div>
<div class="line"><a id="l01542" name="l01542"></a><span class="lineno"> 1542</span>         }</div>
<div class="line"><a id="l01543" name="l01543"></a><span class="lineno"> 1543</span>      }</div>
<div class="line"><a id="l01544" name="l01544"></a><span class="lineno"> 1544</span>      <span class="keywordflow">else</span></div>
<div class="line"><a id="l01545" name="l01545"></a><span class="lineno"> 1545</span>      {</div>
<div class="line"><a id="l01546" name="l01546"></a><span class="lineno"> 1546</span>         VdVZ-&gt;push_back(VdProfileZ);</div>
<div class="line"><a id="l01547" name="l01547"></a><span class="lineno"> 1547</span>      }</div>
<div class="line"><a id="l01548" name="l01548"></a><span class="lineno"> 1548</span> </div>
<div class="line"><a id="l01549" name="l01549"></a><span class="lineno"> 1549</span>      <span class="comment">// Now store the X-Y plane distance from the start of the profile</span></div>
<div class="line"><a id="l01550" name="l01550"></a><span class="lineno"> 1550</span>      VdDistXY-&gt;push_back(dProfileDistXY);</div>
<div class="line"><a id="l01551" name="l01551"></a><span class="lineno"> 1551</span> </div>
<div class="line"><a id="l01552" name="l01552"></a><span class="lineno"> 1552</span>      <span class="comment">// Get the landform type at each point along the profile</span></div>
<div class="line"><a id="l01553" name="l01553"></a><span class="lineno"> 1553</span>      <span class="keywordtype">double</span> dInterventionHeight = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nX][nY].dGetInterventionHeight();</div>
<div class="line"><a id="l01554" name="l01554"></a><span class="lineno"> 1554</span> </div>
<div class="line"><a id="l01555" name="l01555"></a><span class="lineno"> 1555</span>      <span class="comment">// Modify default friction factor if a structural intervention is found, otherwise use the default</span></div>
<div class="line"><a id="l01556" name="l01556"></a><span class="lineno"> 1556</span>      <span class="keywordflow">if</span> (dInterventionHeight &gt; 0 || bIsBehindIntervention)</div>
<div class="line"><a id="l01557" name="l01557"></a><span class="lineno"> 1557</span>      {</div>
<div class="line"><a id="l01558" name="l01558"></a><span class="lineno"> 1558</span>         <span class="comment">// Use an arbitrarily high value if structure is present</span></div>
<div class="line"><a id="l01559" name="l01559"></a><span class="lineno"> 1559</span>         dProfileFricFact = 100 * <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a3f997e237acb5d927bef6a375a4bf3f1">CSHORE_FRICTION_FACTOR</a>;</div>
<div class="line"><a id="l01560" name="l01560"></a><span class="lineno"> 1560</span>         bIsBehindIntervention = <span class="keyword">true</span>;</div>
<div class="line"><a id="l01561" name="l01561"></a><span class="lineno"> 1561</span>      }</div>
<div class="line"><a id="l01562" name="l01562"></a><span class="lineno"> 1562</span>      <span class="keywordflow">else</span></div>
<div class="line"><a id="l01563" name="l01563"></a><span class="lineno"> 1563</span>         dProfileFricFact = <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a3f997e237acb5d927bef6a375a4bf3f1">CSHORE_FRICTION_FACTOR</a>;</div>
<div class="line"><a id="l01564" name="l01564"></a><span class="lineno"> 1564</span> </div>
<div class="line"><a id="l01565" name="l01565"></a><span class="lineno"> 1565</span>      <span class="comment">// Store the friction factor</span></div>
<div class="line"><a id="l01566" name="l01566"></a><span class="lineno"> 1566</span>      VdFricF-&gt;push_back(dProfileFricFact);</div>
<div class="line"><a id="l01567" name="l01567"></a><span class="lineno"> 1567</span> </div>
<div class="line"><a id="l01568" name="l01568"></a><span class="lineno"> 1568</span>      <span class="comment">// For next time round</span></div>
<div class="line"><a id="l01569" name="l01569"></a><span class="lineno"> 1569</span>      dPrevDist = dProfileDistXY;</div>
<div class="line"><a id="l01570" name="l01570"></a><span class="lineno"> 1570</span>   }</div>
<div class="line"><a id="l01571" name="l01571"></a><span class="lineno"> 1571</span> </div>
<div class="line"><a id="l01572" name="l01572"></a><span class="lineno"> 1572</span>   <span class="keywordflow">return</span> <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#aa768cb14b5c6123ee95e6e4ebd9fe331">RTN_OK</a>;</div>
<div class="line"><a id="l01573" name="l01573"></a><span class="lineno"> 1573</span>}</div>
</div>
<div class="line"><a id="l01574" name="l01574"></a><span class="lineno"> 1574</span> </div>
<div class="line"><a id="l01575" name="l01575"></a><span class="lineno"> 1575</span><span class="preprocessor">#if defined CSHORE_FILE_INOUT</span></div>
<div class="line"><a id="l01576" name="l01576"></a><span class="lineno"> 1576</span><span class="comment">//===============================================================================================================================</span></div>
<div class="line"><a id="l01578" name="l01578"></a><span class="lineno"> 1578</span><span class="comment">//===============================================================================================================================</span></div>
<div class="line"><a id="l01579" name="l01579"></a><span class="lineno"> 1579</span><span class="keywordtype">int</span> <a class="code hl_function" href="../../d1/d98/classCSimulation.html#a7155b1d27079d97e47494e55af03b101">CSimulation::nReadCShoreOutput</a>(<span class="keywordtype">int</span> <span class="keyword">const</span> nProfile, <span class="keywordtype">string</span> <span class="keyword">const</span> *strCShoreFilename, <span class="keywordtype">int</span> <span class="keyword">const</span> nExpectedColumns, <span class="keywordtype">int</span> <span class="keyword">const</span> nCShorecolumn, vector&lt;double&gt; <span class="keyword">const</span>* pVdProfileDistXYCME, vector&lt;double&gt;* pVdInterpolatedValues)</div>
<div class="line"><a id="l01580" name="l01580"></a><span class="lineno"> 1580</span>{</div>
<div class="line"><a id="l01581" name="l01581"></a><span class="lineno"> 1581</span>   <span class="comment">// Read in the first column (contains XY distance relative to seaward limit) and CShore column from the CShore output file</span></div>
<div class="line"><a id="l01582" name="l01582"></a><span class="lineno"> 1582</span>   ifstream InStream;</div>
<div class="line"><a id="l01583" name="l01583"></a><span class="lineno"> 1583</span>   InStream.open(strCShoreFilename-&gt;c_str(), ios::in);</div>
<div class="line"><a id="l01584" name="l01584"></a><span class="lineno"> 1584</span> </div>
<div class="line"><a id="l01585" name="l01585"></a><span class="lineno"> 1585</span>   <span class="comment">// Did it open OK?</span></div>
<div class="line"><a id="l01586" name="l01586"></a><span class="lineno"> 1586</span>   <span class="keywordflow">if</span> (! InStream.is_open())</div>
<div class="line"><a id="l01587" name="l01587"></a><span class="lineno"> 1587</span>   {</div>
<div class="line"><a id="l01588" name="l01588"></a><span class="lineno"> 1588</span>      <span class="comment">// Error: cannot open CShore file for input</span></div>
<div class="line"><a id="l01589" name="l01589"></a><span class="lineno"> 1589</span>      <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a222962121613613a48f518e0c2110f21">LogStream</a> &lt;&lt; <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#ad67e8c5b30a0572f64ecfb5c062c2edc">m_ulIter</a> &lt;&lt; <span class="stringliteral">&quot;: &quot;</span> &lt;&lt; <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a292fc90846543ca4814daa9f759feb05">ERR</a> &lt;&lt; <span class="stringliteral">&quot;for profile &quot;</span> &lt;&lt; nProfile &lt;&lt; <span class="stringliteral">&quot;, cannot open &quot;</span> &lt;&lt; *strCShoreFilename &lt;&lt; <span class="stringliteral">&quot; for input&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a id="l01590" name="l01590"></a><span class="lineno"> 1590</span> </div>
<div class="line"><a id="l01591" name="l01591"></a><span class="lineno"> 1591</span>      <span class="keywordflow">return</span> <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a8c80cf547c10a0d3868dcd81abdc8e62">RTN_ERR_READING_CSHORE_FILE_OUTPUT</a>;</div>
<div class="line"><a id="l01592" name="l01592"></a><span class="lineno"> 1592</span>   }</div>
<div class="line"><a id="l01593" name="l01593"></a><span class="lineno"> 1593</span> </div>
<div class="line"><a id="l01594" name="l01594"></a><span class="lineno"> 1594</span>   <span class="comment">// Opened OK, so set up the vectors to hold the CShore output data</span></div>
<div class="line"><a id="l01595" name="l01595"></a><span class="lineno"> 1595</span>   vector&lt;double&gt; VdXYDistCShore;</div>
<div class="line"><a id="l01596" name="l01596"></a><span class="lineno"> 1596</span>   vector&lt;double&gt; VdValuesCShore;</div>
<div class="line"><a id="l01597" name="l01597"></a><span class="lineno"> 1597</span> </div>
<div class="line"><a id="l01598" name="l01598"></a><span class="lineno"> 1598</span>   <span class="comment">// And read in the data</span></div>
<div class="line"><a id="l01599" name="l01599"></a><span class="lineno"> 1599</span>   <span class="keywordtype">int</span> n = -1;</div>
<div class="line"><a id="l01600" name="l01600"></a><span class="lineno"> 1600</span>   <span class="keywordtype">int</span> nExpectedRows = 0;</div>
<div class="line"><a id="l01601" name="l01601"></a><span class="lineno"> 1601</span>   <span class="keywordtype">string</span> strLineIn;</div>
<div class="line"><a id="l01602" name="l01602"></a><span class="lineno"> 1602</span>   <span class="keywordflow">while</span> (getline(InStream, strLineIn))</div>
<div class="line"><a id="l01603" name="l01603"></a><span class="lineno"> 1603</span>   {</div>
<div class="line"><a id="l01604" name="l01604"></a><span class="lineno"> 1604</span>      n++;</div>
<div class="line"><a id="l01605" name="l01605"></a><span class="lineno"> 1605</span> </div>
<div class="line"><a id="l01606" name="l01606"></a><span class="lineno"> 1606</span>      <span class="keywordflow">if</span> (n == 0)</div>
<div class="line"><a id="l01607" name="l01607"></a><span class="lineno"> 1607</span>      {</div>
<div class="line"><a id="l01608" name="l01608"></a><span class="lineno"> 1608</span>         <span class="comment">// Read in the header line</span></div>
<div class="line"><a id="l01609" name="l01609"></a><span class="lineno"> 1609</span>         vector&lt;string&gt; VstrItems = <a class="code hl_function" href="../../d1/d98/classCSimulation.html#afa49724344dd8c5a4fd3d2733677dee2">VstrSplit</a>(&amp;strLineIn, <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#aff09a9868303fc55a863e0553987dd25">SPACE</a>);</div>
<div class="line"><a id="l01610" name="l01610"></a><span class="lineno"> 1610</span> </div>
<div class="line"><a id="l01611" name="l01611"></a><span class="lineno"> 1611</span>         <span class="keywordflow">if</span> (! <a class="code hl_function" href="../../d2/dfd/utils__global_8cpp.html#a1432a707917cd3a9582796679f4d583f">bIsStringValidInt</a>(VstrItems[1]))</div>
<div class="line"><a id="l01612" name="l01612"></a><span class="lineno"> 1612</span>         {</div>
<div class="line"><a id="l01613" name="l01613"></a><span class="lineno"> 1613</span>            <span class="keywordtype">string</span> strErr = <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a292fc90846543ca4814daa9f759feb05">ERR</a> + <span class="stringliteral">&quot;invalid integer for number of expected rows &#39;&quot;</span> + VstrItems[1] + <span class="stringliteral">&quot;&#39; in &quot;</span> + *strCShoreFilename + <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a id="l01614" name="l01614"></a><span class="lineno"> 1614</span>            cerr &lt;&lt; strErr;</div>
<div class="line"><a id="l01615" name="l01615"></a><span class="lineno"> 1615</span>            <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a222962121613613a48f518e0c2110f21">LogStream</a> &lt;&lt; strErr;</div>
<div class="line"><a id="l01616" name="l01616"></a><span class="lineno"> 1616</span> </div>
<div class="line"><a id="l01617" name="l01617"></a><span class="lineno"> 1617</span>            <span class="keywordflow">return</span> <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a8c80cf547c10a0d3868dcd81abdc8e62">RTN_ERR_READING_CSHORE_FILE_OUTPUT</a>;</div>
<div class="line"><a id="l01618" name="l01618"></a><span class="lineno"> 1618</span>         }</div>
<div class="line"><a id="l01619" name="l01619"></a><span class="lineno"> 1619</span> </div>
<div class="line"><a id="l01620" name="l01620"></a><span class="lineno"> 1620</span>         <span class="comment">// Get the number of expected rows</span></div>
<div class="line"><a id="l01621" name="l01621"></a><span class="lineno"> 1621</span>         nExpectedRows = stoi(VstrItems[1]);</div>
<div class="line"><a id="l01622" name="l01622"></a><span class="lineno"> 1622</span>      }</div>
<div class="line"><a id="l01623" name="l01623"></a><span class="lineno"> 1623</span>      <span class="keywordflow">else</span></div>
<div class="line"><a id="l01624" name="l01624"></a><span class="lineno"> 1624</span>      {</div>
<div class="line"><a id="l01625" name="l01625"></a><span class="lineno"> 1625</span>         <span class="comment">// Read in a data line</span></div>
<div class="line"><a id="l01626" name="l01626"></a><span class="lineno"> 1626</span>         vector&lt;string&gt; VstrItems = <a class="code hl_function" href="../../d1/d98/classCSimulation.html#afa49724344dd8c5a4fd3d2733677dee2">VstrSplit</a>(&amp;strLineIn, <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#aff09a9868303fc55a863e0553987dd25">SPACE</a>);</div>
<div class="line"><a id="l01627" name="l01627"></a><span class="lineno"> 1627</span> </div>
<div class="line"><a id="l01628" name="l01628"></a><span class="lineno"> 1628</span>         <span class="keywordtype">int</span> nCols = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(VstrItems.size());</div>
<div class="line"><a id="l01629" name="l01629"></a><span class="lineno"> 1629</span>         <span class="keywordflow">if</span> (nCols != nExpectedColumns)</div>
<div class="line"><a id="l01630" name="l01630"></a><span class="lineno"> 1630</span>         {</div>
<div class="line"><a id="l01631" name="l01631"></a><span class="lineno"> 1631</span>            <span class="comment">// Error: did not read the expected number of CShore output columns</span></div>
<div class="line"><a id="l01632" name="l01632"></a><span class="lineno"> 1632</span>            <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a222962121613613a48f518e0c2110f21">LogStream</a> &lt;&lt; <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#ad67e8c5b30a0572f64ecfb5c062c2edc">m_ulIter</a> &lt;&lt; <span class="stringliteral">&quot;: &quot;</span> &lt;&lt; <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a292fc90846543ca4814daa9f759feb05">ERR</a> &lt;&lt; <span class="stringliteral">&quot;for profile &quot;</span> &lt;&lt; nProfile &lt;&lt; <span class="stringliteral">&quot;, expected &quot;</span> &lt;&lt; nExpectedColumns &lt;&lt; <span class="stringliteral">&quot; CShore output columns but read &quot;</span> &lt;&lt; nCols &lt;&lt; <span class="stringliteral">&quot; columns from header section of file &quot;</span> &lt;&lt; *strCShoreFilename &lt;&lt; endl;</div>
<div class="line"><a id="l01633" name="l01633"></a><span class="lineno"> 1633</span> </div>
<div class="line"><a id="l01634" name="l01634"></a><span class="lineno"> 1634</span>            <span class="keywordflow">return</span> <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a8c80cf547c10a0d3868dcd81abdc8e62">RTN_ERR_READING_CSHORE_FILE_OUTPUT</a>;</div>
<div class="line"><a id="l01635" name="l01635"></a><span class="lineno"> 1635</span>         }</div>
<div class="line"><a id="l01636" name="l01636"></a><span class="lineno"> 1636</span> </div>
<div class="line"><a id="l01637" name="l01637"></a><span class="lineno"> 1637</span>         <span class="comment">// Number of columns is OK</span></div>
<div class="line"><a id="l01638" name="l01638"></a><span class="lineno"> 1638</span>         VdXYDistCShore.push_back(strtod(VstrItems[0].c_str(), NULL));</div>
<div class="line"><a id="l01639" name="l01639"></a><span class="lineno"> 1639</span>         VdValuesCShore.push_back(strtod(VstrItems[nCShorecolumn - 1].c_str(), NULL));</div>
<div class="line"><a id="l01640" name="l01640"></a><span class="lineno"> 1640</span>      }</div>
<div class="line"><a id="l01641" name="l01641"></a><span class="lineno"> 1641</span>   }</div>
<div class="line"><a id="l01642" name="l01642"></a><span class="lineno"> 1642</span> </div>
<div class="line"><a id="l01643" name="l01643"></a><span class="lineno"> 1643</span>   <span class="comment">// Check that we have read nExpectedRows from the file</span></div>
<div class="line"><a id="l01644" name="l01644"></a><span class="lineno"> 1644</span>   <span class="keywordtype">int</span> nReadRows = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(VdXYDistCShore.size());</div>
<div class="line"><a id="l01645" name="l01645"></a><span class="lineno"> 1645</span>   <span class="keywordflow">if</span> (nReadRows != nExpectedRows)</div>
<div class="line"><a id="l01646" name="l01646"></a><span class="lineno"> 1646</span>   {</div>
<div class="line"><a id="l01647" name="l01647"></a><span class="lineno"> 1647</span>      <span class="comment">// Error: did not get nExpectedRows CShore output rows</span></div>
<div class="line"><a id="l01648" name="l01648"></a><span class="lineno"> 1648</span>      <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a222962121613613a48f518e0c2110f21">LogStream</a> &lt;&lt; <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#ad67e8c5b30a0572f64ecfb5c062c2edc">m_ulIter</a> &lt;&lt; <span class="stringliteral">&quot;: &quot;</span> &lt;&lt; <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a292fc90846543ca4814daa9f759feb05">ERR</a> &lt;&lt; <span class="stringliteral">&quot;for profile &quot;</span> &lt;&lt; nProfile &lt;&lt; <span class="stringliteral">&quot;, expected &quot;</span> &lt;&lt; nExpectedRows &lt;&lt; <span class="stringliteral">&quot; CShore output rows, but read &quot;</span> &lt;&lt; nReadRows &lt;&lt; <span class="stringliteral">&quot; rows from file &quot;</span> &lt;&lt; *strCShoreFilename &lt;&lt; endl;</div>
<div class="line"><a id="l01649" name="l01649"></a><span class="lineno"> 1649</span> </div>
<div class="line"><a id="l01650" name="l01650"></a><span class="lineno"> 1650</span>      <span class="keywordflow">return</span> <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a8c80cf547c10a0d3868dcd81abdc8e62">RTN_ERR_READING_CSHORE_FILE_OUTPUT</a>;</div>
<div class="line"><a id="l01651" name="l01651"></a><span class="lineno"> 1651</span>   }</div>
<div class="line"><a id="l01652" name="l01652"></a><span class="lineno"> 1652</span> </div>
<div class="line"><a id="l01653" name="l01653"></a><span class="lineno"> 1653</span>   <span class="keywordflow">if</span> (nReadRows &lt; 2)</div>
<div class="line"><a id="l01654" name="l01654"></a><span class="lineno"> 1654</span>   {</div>
<div class="line"><a id="l01655" name="l01655"></a><span class="lineno"> 1655</span>      <span class="comment">// CShore sometimes returns only one row, which contains data for the seaward point of the profile. This happens when all other (more coastward) points give an invalid result during CShore&#39;s calculations. This is a problem. We don&#39;t want to abandon the simulation just because of this, so instead we just duplicate the row, so that the profile will later get marked as invalid</span></div>
<div class="line"><a id="l01656" name="l01656"></a><span class="lineno"> 1656</span>      <span class="keywordflow">if</span> (<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a0245d3cbdd603fbeced6ca1465eb3f16">m_nLogFileDetail</a> &gt;= <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a540d8a94fc09b0b14fd8ab657445b67a">LOG_FILE_MIDDLE_DETAIL</a>)</div>
<div class="line"><a id="l01657" name="l01657"></a><span class="lineno"> 1657</span>         <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a222962121613613a48f518e0c2110f21">LogStream</a> &lt;&lt; <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#ad67e8c5b30a0572f64ecfb5c062c2edc">m_ulIter</a> &lt;&lt; <span class="stringliteral">&quot;: &quot;</span> &lt;&lt; <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a957ca99e98618160534cafb0929f743d">WARN</a> &lt;&lt; <span class="stringliteral">&quot;for profile &quot;</span> &lt;&lt; nProfile &lt;&lt; <span class="stringliteral">&quot;, only &quot;</span> &lt;&lt; nReadRows &lt;&lt; <span class="stringliteral">&quot; CShore output rows in file &quot;</span> &lt;&lt; *strCShoreFilename &lt;&lt; endl;</div>
<div class="line"><a id="l01658" name="l01658"></a><span class="lineno"> 1658</span> </div>
<div class="line"><a id="l01659" name="l01659"></a><span class="lineno"> 1659</span>      <span class="comment">// Duplicate the data</span></div>
<div class="line"><a id="l01660" name="l01660"></a><span class="lineno"> 1660</span>      VdXYDistCShore.push_back(VdXYDistCShore[0]);</div>
<div class="line"><a id="l01661" name="l01661"></a><span class="lineno"> 1661</span>      VdValuesCShore.push_back(VdValuesCShore[0]);</div>
<div class="line"><a id="l01662" name="l01662"></a><span class="lineno"> 1662</span> </div>
<div class="line"><a id="l01663" name="l01663"></a><span class="lineno"> 1663</span>      <span class="comment">// And increase the expected number of rows</span></div>
<div class="line"><a id="l01664" name="l01664"></a><span class="lineno"> 1664</span>      nReadRows++;</div>
<div class="line"><a id="l01665" name="l01665"></a><span class="lineno"> 1665</span>   }</div>
<div class="line"><a id="l01666" name="l01666"></a><span class="lineno"> 1666</span> </div>
<div class="line"><a id="l01667" name="l01667"></a><span class="lineno"> 1667</span>   <span class="comment">// The output is OK, so change the origin of the across-shore distance from the CShore convention to the one used here (i.e. with the origin at the shoreline)</span></div>
<div class="line"><a id="l01668" name="l01668"></a><span class="lineno"> 1668</span>   vector&lt;double&gt; VdXYDistCShoreTmp(nReadRows, 0);</div>
<div class="line"><a id="l01669" name="l01669"></a><span class="lineno"> 1669</span>   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; nReadRows; i++)</div>
<div class="line"><a id="l01670" name="l01670"></a><span class="lineno"> 1670</span>      VdXYDistCShoreTmp[i] = VdXYDistCShore[nReadRows - 1] - VdXYDistCShore[i];</div>
<div class="line"><a id="l01671" name="l01671"></a><span class="lineno"> 1671</span> </div>
<div class="line"><a id="l01672" name="l01672"></a><span class="lineno"> 1672</span>   <span class="comment">// Reverse the XY-distance and value vectors (i.e. first point is at the shoreline and must be in strictly ascending order)</span></div>
<div class="line"><a id="l01673" name="l01673"></a><span class="lineno"> 1673</span>   reverse(VdXYDistCShoreTmp.begin(), VdXYDistCShoreTmp.end());</div>
<div class="line"><a id="l01674" name="l01674"></a><span class="lineno"> 1674</span> </div>
<div class="line"><a id="l01675" name="l01675"></a><span class="lineno"> 1675</span>   <span class="comment">// Similarly, reverse the CShore output</span></div>
<div class="line"><a id="l01676" name="l01676"></a><span class="lineno"> 1676</span>   reverse(VdValuesCShore.begin(), VdValuesCShore.end());</div>
<div class="line"><a id="l01677" name="l01677"></a><span class="lineno"> 1677</span> </div>
<div class="line"><a id="l01678" name="l01678"></a><span class="lineno"> 1678</span>   <span class="comment">// Using a simple linear interpolation approach</span></div>
<div class="line"><a id="l01679" name="l01679"></a><span class="lineno"> 1679</span>   vector&lt;double&gt; VdDistXYCopy(pVdProfileDistXYCME-&gt;begin(), pVdProfileDistXYCME-&gt;end());</div>
<div class="line"><a id="l01680" name="l01680"></a><span class="lineno"> 1680</span> </div>
<div class="line"><a id="l01681" name="l01681"></a><span class="lineno"> 1681</span>   <span class="comment">// assertVdXYDistCShoreTmp.size() == VdValuesCShore.size());</span></div>
<div class="line"><a id="l01682" name="l01682"></a><span class="lineno"> 1682</span>   *pVdInterpolatedValues = <a class="code hl_function" href="../../d7/d62/interpolate_8cpp.html#a827d9b75395722acc9e19935195772be">VdInterpolateCShoreProfileOutput</a>(&amp;VdXYDistCShoreTmp, &amp;VdValuesCShore, &amp;VdDistXYCopy);</div>
<div class="line"><a id="l01683" name="l01683"></a><span class="lineno"> 1683</span> </div>
<div class="line"><a id="l01684" name="l01684"></a><span class="lineno"> 1684</span>   <span class="keywordflow">return</span> <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#aa768cb14b5c6123ee95e6e4ebd9fe331">RTN_OK</a>;</div>
<div class="line"><a id="l01685" name="l01685"></a><span class="lineno"> 1685</span>}</div>
<div class="line"><a id="l01686" name="l01686"></a><span class="lineno"> 1686</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01687" name="l01687"></a><span class="lineno"> 1687</span> </div>
<div class="line"><a id="l01688" name="l01688"></a><span class="lineno"> 1688</span><span class="preprocessor">#if defined CSHORE_ARG_INOUT || CSHORE_BOTH</span></div>
<div class="line"><a id="l01689" name="l01689"></a><span class="lineno"> 1689</span><span class="comment">//===============================================================================================================================</span></div>
<div class="line"><a id="l01691" name="l01691"></a><span class="lineno"> 1691</span><span class="comment">//===============================================================================================================================</span></div>
<div class="line"><a id="l01692" name="l01692"></a><span class="lineno"> 1692</span><span class="keywordtype">void</span> <a class="code hl_function" href="../../d1/d98/classCSimulation.html#a0b66eca85c13a2a263db7be1e270055a">CSimulation::InterpolateCShoreOutput</a>(vector&lt;double&gt; <span class="keyword">const</span>* pVdProfileDistXYCME, <span class="keywordtype">int</span> <span class="keyword">const</span> nOutSize, <span class="keywordtype">int</span> <span class="keyword">const</span> nProfileSize, vector&lt;double&gt;* pVdXYDistFromCShore, vector&lt;double&gt;* pVdFreeSurfaceStdCShore, vector&lt;double&gt;* pVdWaveSetupSurgeCShore, vector&lt;double&gt;* pVdSinWaveAngleRadiansCShore, vector&lt;double&gt;* pVdFractionBreakingWavesCShore, vector&lt;double&gt;* pVdFreeSurfaceStdCME, vector&lt;double&gt;* pVdWaveSetupSurgeCME, vector&lt;double&gt;* pVdSinWaveAngleRadiansCME, vector&lt;double&gt;* pVdFractionBreakingWavesCME)</div>
<div class="line"><a id="l01693" name="l01693"></a><span class="lineno"> 1693</span>{</div>
<div class="line"><a id="l01694" name="l01694"></a><span class="lineno"> 1694</span>   <span class="comment">// // DEBUG CODE ========================================================================================================</span></div>
<div class="line"><a id="l01695" name="l01695"></a><span class="lineno"> 1695</span>   <span class="comment">// LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: nOutSize = &quot; &lt;&lt; nOutSize &lt;&lt; &quot; nProfileSize = &quot; &lt;&lt; nProfileSize &lt;&lt; &quot; pVdProfileDistXYCME-&gt;size() = &quot; &lt;&lt; pVdProfileDistXYCME-&gt;size() &lt;&lt; &quot; pVdXYDistFromCShore-&gt;size() = &quot; &lt;&lt; pVdXYDistFromCShore-&gt;size() &lt;&lt; endl;</span></div>
<div class="line"><a id="l01696" name="l01696"></a><span class="lineno"> 1696</span>   <span class="comment">// // DEBUG CODE ========================================================================================================</span></div>
<div class="line"><a id="l01697" name="l01697"></a><span class="lineno"> 1697</span> </div>
<div class="line"><a id="l01698" name="l01698"></a><span class="lineno"> 1698</span>   <span class="comment">// Sometimes the profile length returned from CShore is shorter than the CoastalME profile length</span></div>
<div class="line"><a id="l01699" name="l01699"></a><span class="lineno"> 1699</span>   <span class="keywordtype">bool</span> bTooShort = <span class="keyword">false</span>;</div>
<div class="line"><a id="l01700" name="l01700"></a><span class="lineno"> 1700</span>   <span class="keywordtype">int</span> nTooShort = 0;</div>
<div class="line"><a id="l01701" name="l01701"></a><span class="lineno"> 1701</span>   <span class="keywordflow">if</span> (nOutSize &lt; nProfileSize)</div>
<div class="line"><a id="l01702" name="l01702"></a><span class="lineno"> 1702</span>   {</div>
<div class="line"><a id="l01703" name="l01703"></a><span class="lineno"> 1703</span>      bTooShort = <span class="keyword">true</span>;</div>
<div class="line"><a id="l01704" name="l01704"></a><span class="lineno"> 1704</span>      nTooShort = nProfileSize - nOutSize;</div>
<div class="line"><a id="l01705" name="l01705"></a><span class="lineno"> 1705</span> </div>
<div class="line"><a id="l01706" name="l01706"></a><span class="lineno"> 1706</span>      <span class="comment">// LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: CShore PROFILE IS TOO SHORT&quot; &lt;&lt; endl;</span></div>
<div class="line"><a id="l01707" name="l01707"></a><span class="lineno"> 1707</span>   }</div>
<div class="line"><a id="l01708" name="l01708"></a><span class="lineno"> 1708</span> </div>
<div class="line"><a id="l01709" name="l01709"></a><span class="lineno"> 1709</span>   <span class="comment">// // DEBUG CODE ========================================================================================================</span></div>
<div class="line"><a id="l01710" name="l01710"></a><span class="lineno"> 1710</span>   <span class="comment">// for (int n = 0; n &lt; static_cast&lt;int&gt;(pVdProfileDistXYCME-&gt;size()); n++)</span></div>
<div class="line"><a id="l01711" name="l01711"></a><span class="lineno"> 1711</span>   <span class="comment">//    LogStream &lt;&lt; &quot;pVdProfileDistXYCME[&quot; &lt;&lt; n &lt;&lt; &quot;] = &quot; &lt;&lt; pVdProfileDistXYCME-&gt;at(n) &lt;&lt; endl;</span></div>
<div class="line"><a id="l01712" name="l01712"></a><span class="lineno"> 1712</span>   <span class="comment">//</span></div>
<div class="line"><a id="l01713" name="l01713"></a><span class="lineno"> 1713</span>   <span class="comment">// LogStream &lt;&lt; endl;</span></div>
<div class="line"><a id="l01714" name="l01714"></a><span class="lineno"> 1714</span>   <span class="comment">//</span></div>
<div class="line"><a id="l01715" name="l01715"></a><span class="lineno"> 1715</span>   <span class="comment">// LogStream &lt;&lt; &quot;ORIGINAL&quot; &lt;&lt; endl;</span></div>
<div class="line"><a id="l01716" name="l01716"></a><span class="lineno"> 1716</span>   <span class="comment">// for (int n = 0; n &lt; nOutSize; n++)</span></div>
<div class="line"><a id="l01717" name="l01717"></a><span class="lineno"> 1717</span>   <span class="comment">//    LogStream &lt;&lt; &quot;pVdXYDistFromCShore[&quot; &lt;&lt; n &lt;&lt; &quot;] = &quot; &lt;&lt; pVdXYDistFromCShore-&gt;at(n) &lt;&lt; &quot; pVdFreeSurfaceStdCShore[&quot; &lt;&lt; n &lt;&lt; &quot;] = &quot; &lt;&lt; pVdFreeSurfaceStdCShore-&gt;at(n) &lt;&lt; &quot; pVdWaveSetupSurgeCShore[&quot; &lt;&lt; n &lt;&lt; &quot;] = &quot; &lt;&lt; pVdWaveSetupSurgeCShore-&gt;at(n) &lt;&lt; &quot; pVdSinWaveAngleRadiansCShore[&quot; &lt;&lt; n &lt;&lt; &quot;] = &quot; &lt;&lt; pVdSinWaveAngleRadiansCShore-&gt;at(n) &lt;&lt; &quot; pVdFractionBreakingWavesCShore[&quot; &lt;&lt; n &lt;&lt; &quot;] = &quot; &lt;&lt; pVdFractionBreakingWavesCShore-&gt;at(n) &lt;&lt; endl;</span></div>
<div class="line"><a id="l01718" name="l01718"></a><span class="lineno"> 1718</span>   <span class="comment">//</span></div>
<div class="line"><a id="l01719" name="l01719"></a><span class="lineno"> 1719</span>   <span class="comment">// LogStream &lt;&lt; endl;</span></div>
<div class="line"><a id="l01720" name="l01720"></a><span class="lineno"> 1720</span>   <span class="comment">// // DEBUG CODE ========================================================================================================</span></div>
<div class="line"><a id="l01721" name="l01721"></a><span class="lineno"> 1721</span> </div>
<div class="line"><a id="l01722" name="l01722"></a><span class="lineno"> 1722</span>   <span class="keywordflow">if</span> (bTooShort)</div>
<div class="line"><a id="l01723" name="l01723"></a><span class="lineno"> 1723</span>   {</div>
<div class="line"><a id="l01724" name="l01724"></a><span class="lineno"> 1724</span>      <span class="comment">// Add extrapolated value(s) to the end of the valid part of each profile vector so that we have nProfileSize valid values</span></div>
<div class="line"><a id="l01725" name="l01725"></a><span class="lineno"> 1725</span>      <span class="keywordtype">double</span> dLastDiff = pVdXYDistFromCShore-&gt;at(nOutSize-1) - pVdXYDistFromCShore-&gt;at(nOutSize-2);</div>
<div class="line"><a id="l01726" name="l01726"></a><span class="lineno"> 1726</span>      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> n = 0; n &lt; nTooShort; n++)</div>
<div class="line"><a id="l01727" name="l01727"></a><span class="lineno"> 1727</span>         pVdXYDistFromCShore-&gt;at(nOutSize + n) = pVdXYDistFromCShore-&gt;at(nOutSize-1 + n) + dLastDiff;</div>
<div class="line"><a id="l01728" name="l01728"></a><span class="lineno"> 1728</span> </div>
<div class="line"><a id="l01729" name="l01729"></a><span class="lineno"> 1729</span>      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> n = 0; n &lt; nTooShort; n++)</div>
<div class="line"><a id="l01730" name="l01730"></a><span class="lineno"> 1730</span>         pVdFreeSurfaceStdCShore-&gt;at(nOutSize + n) = pVdFreeSurfaceStdCShore-&gt;at(nOutSize-1);</div>
<div class="line"><a id="l01731" name="l01731"></a><span class="lineno"> 1731</span> </div>
<div class="line"><a id="l01732" name="l01732"></a><span class="lineno"> 1732</span>      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> n = 0; n &lt; nTooShort; n++)</div>
<div class="line"><a id="l01733" name="l01733"></a><span class="lineno"> 1733</span>         pVdWaveSetupSurgeCShore-&gt;at(nOutSize + n) = pVdWaveSetupSurgeCShore-&gt;at(nOutSize-1);</div>
<div class="line"><a id="l01734" name="l01734"></a><span class="lineno"> 1734</span> </div>
<div class="line"><a id="l01735" name="l01735"></a><span class="lineno"> 1735</span>      <span class="comment">// TODO 007 Do same for pVdStormSurgeCShore and pVdWaveSetupRunUpCShore ?</span></div>
<div class="line"><a id="l01736" name="l01736"></a><span class="lineno"> 1736</span> </div>
<div class="line"><a id="l01737" name="l01737"></a><span class="lineno"> 1737</span>      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> n = 0; n &lt; nTooShort; n++)</div>
<div class="line"><a id="l01738" name="l01738"></a><span class="lineno"> 1738</span>         pVdSinWaveAngleRadiansCShore-&gt;at(nOutSize + n) = pVdSinWaveAngleRadiansCShore-&gt;at(nOutSize-1);</div>
<div class="line"><a id="l01739" name="l01739"></a><span class="lineno"> 1739</span> </div>
<div class="line"><a id="l01740" name="l01740"></a><span class="lineno"> 1740</span>      dLastDiff = pVdFractionBreakingWavesCShore-&gt;at(nOutSize-1) - pVdFractionBreakingWavesCShore-&gt;at(nOutSize-2);</div>
<div class="line"><a id="l01741" name="l01741"></a><span class="lineno"> 1741</span>      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> n = 0; n &lt; nTooShort; n++)</div>
<div class="line"><a id="l01742" name="l01742"></a><span class="lineno"> 1742</span>         pVdFractionBreakingWavesCShore-&gt;at(nOutSize + n) = <a class="code hl_function" href="../../d6/d2a/cme_8h.html#a068017859403c0629d89f8d348f6c224">tMin</a>(pVdFractionBreakingWavesCShore-&gt;at(nOutSize-1 + n) + dLastDiff, 1.0);</div>
<div class="line"><a id="l01743" name="l01743"></a><span class="lineno"> 1743</span> </div>
<div class="line"><a id="l01744" name="l01744"></a><span class="lineno"> 1744</span>      <span class="comment">// // DEBUG CODE ========================================================================================================</span></div>
<div class="line"><a id="l01745" name="l01745"></a><span class="lineno"> 1745</span>      <span class="comment">// LogStream &lt;&lt; &quot;EXTENDED&quot; &lt;&lt; endl;</span></div>
<div class="line"><a id="l01746" name="l01746"></a><span class="lineno"> 1746</span>      <span class="comment">// for (int n = 0; n &lt; nProfileSize; n++)</span></div>
<div class="line"><a id="l01747" name="l01747"></a><span class="lineno"> 1747</span>      <span class="comment">//    LogStream &lt;&lt; &quot;pVdXYDistFromCShore[&quot; &lt;&lt; n &lt;&lt; &quot;] = &quot; &lt;&lt; pVdXYDistFromCShore-&gt;at(n) &lt;&lt; &quot; pVdFreeSurfaceStdCShore[&quot; &lt;&lt; n &lt;&lt; &quot;] = &quot; &lt;&lt; pVdFreeSurfaceStdCShore-&gt;at(n) &lt;&lt; &quot; pVdWaveSetupSurgeCShore[&quot; &lt;&lt; n &lt;&lt; &quot;] = &quot; &lt;&lt; pVdWaveSetupSurgeCShore-&gt;at(n) &lt;&lt; &quot; pVdSinWaveAngleRadiansCShore[&quot; &lt;&lt; n &lt;&lt; &quot;] = &quot; &lt;&lt; pVdSinWaveAngleRadiansCShore-&gt;at(n) &lt;&lt; &quot; pVdFractionBreakingWavesCShore[&quot; &lt;&lt; n &lt;&lt; &quot;] = &quot; &lt;&lt; pVdFractionBreakingWavesCShore-&gt;at(n) &lt;&lt; &quot; &quot; &lt;&lt; (n &gt; (nOutSize-1) ? &quot;EXTRAPOLATED&quot; : &quot;&quot;) &lt;&lt; endl;</span></div>
<div class="line"><a id="l01748" name="l01748"></a><span class="lineno"> 1748</span>      <span class="comment">//</span></div>
<div class="line"><a id="l01749" name="l01749"></a><span class="lineno"> 1749</span>      <span class="comment">// LogStream &lt;&lt; endl;</span></div>
<div class="line"><a id="l01750" name="l01750"></a><span class="lineno"> 1750</span>      <span class="comment">// // DEBUG CODE ========================================================================================================</span></div>
<div class="line"><a id="l01751" name="l01751"></a><span class="lineno"> 1751</span>   }</div>
<div class="line"><a id="l01752" name="l01752"></a><span class="lineno"> 1752</span> </div>
<div class="line"><a id="l01753" name="l01753"></a><span class="lineno"> 1753</span>   vector&lt;double&gt; VdXYDistCShoreTmp(nProfileSize);</div>
<div class="line"><a id="l01754" name="l01754"></a><span class="lineno"> 1754</span>   copy(pVdXYDistFromCShore-&gt;begin(), pVdXYDistFromCShore-&gt;begin() + nProfileSize, begin(VdXYDistCShoreTmp));</div>
<div class="line"><a id="l01755" name="l01755"></a><span class="lineno"> 1755</span> </div>
<div class="line"><a id="l01756" name="l01756"></a><span class="lineno"> 1756</span>   <span class="comment">// The CShore cross-shore distance has its origin at the seaward end, but the CoastalME convention has its origin at the shoreline. So we mst reverse the other vectors to conform with the CoastalMEME convention</span></div>
<div class="line"><a id="l01757" name="l01757"></a><span class="lineno"> 1757</span>   vector&lt;double&gt; VdFreeSurfaceStdCShoreTmp(nProfileSize);</div>
<div class="line"><a id="l01758" name="l01758"></a><span class="lineno"> 1758</span>   reverse_copy(pVdFreeSurfaceStdCShore-&gt;begin(), pVdFreeSurfaceStdCShore-&gt;begin() + nProfileSize, begin(VdFreeSurfaceStdCShoreTmp));</div>
<div class="line"><a id="l01759" name="l01759"></a><span class="lineno"> 1759</span> </div>
<div class="line"><a id="l01760" name="l01760"></a><span class="lineno"> 1760</span>   vector&lt;double&gt; VdWaveSetupSurgeCShoreTmp(nProfileSize);</div>
<div class="line"><a id="l01761" name="l01761"></a><span class="lineno"> 1761</span>   reverse_copy(pVdWaveSetupSurgeCShore-&gt;begin(), pVdWaveSetupSurgeCShore-&gt;begin() + nProfileSize, begin(VdWaveSetupSurgeCShoreTmp));</div>
<div class="line"><a id="l01762" name="l01762"></a><span class="lineno"> 1762</span> </div>
<div class="line"><a id="l01763" name="l01763"></a><span class="lineno"> 1763</span>   vector&lt;double&gt; VdSinWaveAngleRadiansCShoreTmp(nProfileSize);</div>
<div class="line"><a id="l01764" name="l01764"></a><span class="lineno"> 1764</span>   reverse_copy(pVdSinWaveAngleRadiansCShore-&gt;begin(), pVdSinWaveAngleRadiansCShore-&gt;begin() + nProfileSize, begin(VdSinWaveAngleRadiansCShoreTmp));</div>
<div class="line"><a id="l01765" name="l01765"></a><span class="lineno"> 1765</span> </div>
<div class="line"><a id="l01766" name="l01766"></a><span class="lineno"> 1766</span>   vector&lt;double&gt; VdFractionBreakingWavesCShoreTmp(nProfileSize);</div>
<div class="line"><a id="l01767" name="l01767"></a><span class="lineno"> 1767</span>   reverse_copy(pVdFractionBreakingWavesCShore-&gt;begin(), pVdFractionBreakingWavesCShore-&gt;begin() + nProfileSize, begin(VdFractionBreakingWavesCShoreTmp));</div>
<div class="line"><a id="l01768" name="l01768"></a><span class="lineno"> 1768</span> </div>
<div class="line"><a id="l01769" name="l01769"></a><span class="lineno"> 1769</span>   <span class="comment">// // DEBUG CODE ========================================================================================================</span></div>
<div class="line"><a id="l01770" name="l01770"></a><span class="lineno"> 1770</span>   <span class="comment">// LogStream &lt;&lt; &quot;REVERSED&quot; &lt;&lt; endl;</span></div>
<div class="line"><a id="l01771" name="l01771"></a><span class="lineno"> 1771</span>   <span class="comment">// for (int n = 0; n &lt; nProfileSize; n++)</span></div>
<div class="line"><a id="l01772" name="l01772"></a><span class="lineno"> 1772</span>   <span class="comment">//    LogStream &lt;&lt; &quot;VdXYDistCShoreTmp[&quot; &lt;&lt; n &lt;&lt; &quot;] = &quot; &lt;&lt; VdXYDistCShoreTmp.at(n) &lt;&lt; &quot; VdFreeSurfaceStdCShoreTmp[&quot; &lt;&lt; n &lt;&lt; &quot;] = &quot; &lt;&lt; VdFreeSurfaceStdCShoreTmp.at(n) &lt;&lt; &quot; VdWaveSetupSurgeCShoreTmp[&quot; &lt;&lt; n &lt;&lt; &quot;] = &quot; &lt;&lt; VdWaveSetupSurgeCShoreTmp.at(n) &lt;&lt; &quot; VdSinWaveAngleRadiansCShoreTmp[&quot; &lt;&lt; n &lt;&lt; &quot;] = &quot; &lt;&lt; VdSinWaveAngleRadiansCShoreTmp.at(n) &lt;&lt; &quot; VdFractionBreakingWavesCShoreTmp[&quot; &lt;&lt; n &lt;&lt; &quot;] = &quot; &lt;&lt; VdFractionBreakingWavesCShoreTmp.at(n) &lt;&lt; endl;</span></div>
<div class="line"><a id="l01773" name="l01773"></a><span class="lineno"> 1773</span>   <span class="comment">//</span></div>
<div class="line"><a id="l01774" name="l01774"></a><span class="lineno"> 1774</span>   <span class="comment">// LogStream &lt;&lt; endl;</span></div>
<div class="line"><a id="l01775" name="l01775"></a><span class="lineno"> 1775</span>   <span class="comment">// // DEBUG CODE ========================================================================================================</span></div>
<div class="line"><a id="l01776" name="l01776"></a><span class="lineno"> 1776</span> </div>
<div class="line"><a id="l01777" name="l01777"></a><span class="lineno"> 1777</span>   <span class="comment">// Finally we linearly interpolate the CShore output vectors to each point on the CoastalME profile. Input parameters x_old, y_old, x_new and the routine returns y_new</span></div>
<div class="line"><a id="l01778" name="l01778"></a><span class="lineno"> 1778</span>   *pVdFreeSurfaceStdCME = <a class="code hl_function" href="../../d7/d62/interpolate_8cpp.html#a827d9b75395722acc9e19935195772be">VdInterpolateCShoreProfileOutput</a>(&amp;VdXYDistCShoreTmp, pVdFreeSurfaceStdCShore, pVdProfileDistXYCME);      <span class="comment">// was &amp;VdDistXYCopy);</span></div>
<div class="line"><a id="l01779" name="l01779"></a><span class="lineno"> 1779</span>   *pVdWaveSetupSurgeCME = <a class="code hl_function" href="../../d7/d62/interpolate_8cpp.html#a827d9b75395722acc9e19935195772be">VdInterpolateCShoreProfileOutput</a>(&amp;VdXYDistCShoreTmp, pVdWaveSetupSurgeCShore, pVdProfileDistXYCME);</div>
<div class="line"><a id="l01780" name="l01780"></a><span class="lineno"> 1780</span>   <span class="comment">// *pVdStormSurgeCME = VdInterpolateCShoreProfileOutput(&amp;VdXYDistCShoreTmp, pVdStormSurgeCShore, pVdProfileDistXYCME);</span></div>
<div class="line"><a id="l01781" name="l01781"></a><span class="lineno"> 1781</span>   <span class="comment">// *pVdWaveSetupRunUpCME = VdInterpolateCShoreProfileOutput(&amp;VdXYDistCShoreTmp, pVdWaveSetupRunUpCShore, pVdProfileDistXYCME);</span></div>
<div class="line"><a id="l01782" name="l01782"></a><span class="lineno"> 1782</span>   *pVdSinWaveAngleRadiansCME = <a class="code hl_function" href="../../d7/d62/interpolate_8cpp.html#a827d9b75395722acc9e19935195772be">VdInterpolateCShoreProfileOutput</a>(&amp;VdXYDistCShoreTmp, pVdSinWaveAngleRadiansCShore, pVdProfileDistXYCME);</div>
<div class="line"><a id="l01783" name="l01783"></a><span class="lineno"> 1783</span>   *pVdFractionBreakingWavesCME = <a class="code hl_function" href="../../d7/d62/interpolate_8cpp.html#a827d9b75395722acc9e19935195772be">VdInterpolateCShoreProfileOutput</a>(&amp;VdXYDistCShoreTmp, pVdFractionBreakingWavesCShore, pVdProfileDistXYCME);</div>
<div class="line"><a id="l01784" name="l01784"></a><span class="lineno"> 1784</span> </div>
<div class="line"><a id="l01785" name="l01785"></a><span class="lineno"> 1785</span>   <span class="comment">// LogStream &lt;&lt; &quot;INTERPOLATED&quot; &lt;&lt; endl;</span></div>
<div class="line"><a id="l01786" name="l01786"></a><span class="lineno"> 1786</span>   <span class="comment">// for (int n = 0; n &lt; nProfileSize; n++)</span></div>
<div class="line"><a id="l01787" name="l01787"></a><span class="lineno"> 1787</span>   <span class="comment">//    LogStream &lt;&lt; &quot;pVdProfileDistXYCME[&quot; &lt;&lt; n &lt;&lt; &quot;] = &quot; &lt;&lt; pVdProfileDistXYCME-&gt;at(n) &lt;&lt; &quot; pVdFreeSurfaceStdCME[&quot; &lt;&lt; n &lt;&lt; &quot;] = &quot; &lt;&lt; pVdFreeSurfaceStdCME-&gt;at(n) &lt;&lt; &quot; pVdWaveSetupSurgeCME[&quot; &lt;&lt; n &lt;&lt; &quot;] = &quot; &lt;&lt; pVdWaveSetupSurgeCME-&gt;at(n) &lt;&lt; &quot; pVdSinWaveAngleRadiansCME[&quot; &lt;&lt; n &lt;&lt; &quot;] = &quot; &lt;&lt; pVdSinWaveAngleRadiansCME-&gt;at(n) &lt;&lt; &quot; pVdFractionBreakingWavesCME[&quot; &lt;&lt; n &lt;&lt; &quot;] = &quot; &lt;&lt; pVdFractionBreakingWavesCME-&gt;at(n) &lt;&lt; endl;</span></div>
<div class="line"><a id="l01788" name="l01788"></a><span class="lineno"> 1788</span>   <span class="comment">//</span></div>
<div class="line"><a id="l01789" name="l01789"></a><span class="lineno"> 1789</span>   <span class="comment">// LogStream &lt;&lt; &quot;================================================ &quot; &lt;&lt; endl;</span></div>
<div class="line"><a id="l01790" name="l01790"></a><span class="lineno"> 1790</span>}</div>
<div class="line"><a id="l01791" name="l01791"></a><span class="lineno"> 1791</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01792" name="l01792"></a><span class="lineno"> 1792</span> </div>
<div class="line"><a id="l01793" name="l01793"></a><span class="lineno"> 1793</span><span class="comment">//===============================================================================================================================</span></div>
<div class="line"><a id="l01795" name="l01795"></a><span class="lineno"> 1795</span><span class="comment">//===============================================================================================================================</span></div>
<div class="foldopen" id="foldopen01796" data-start="{" data-end="}">
<div class="line"><a id="l01796" name="l01796"></a><span class="lineno"><a class="line" href="../../d1/d98/classCSimulation.html#aca89a5d1f76e900ce10acc73294aa279"> 1796</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../d1/d98/classCSimulation.html#aca89a5d1f76e900ce10acc73294aa279">CSimulation::ModifyBreakingWavePropertiesWithinShadowZoneToCoastline</a>(<span class="keywordtype">int</span> <span class="keyword">const</span> nCoast, <span class="keywordtype">int</span> <span class="keyword">const</span> nProfile)</div>
<div class="line"><a id="l01797" name="l01797"></a><span class="lineno"> 1797</span>{</div>
<div class="line"><a id="l01798" name="l01798"></a><span class="lineno"> 1798</span>   <a class="code hl_class" href="../../da/dae/classCGeomProfile.html">CGeomProfile</a>* pProfile = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].pGetProfile(nProfile);</div>
<div class="line"><a id="l01799" name="l01799"></a><span class="lineno"> 1799</span> </div>
<div class="line"><a id="l01800" name="l01800"></a><span class="lineno"> 1800</span>   <span class="comment">// Only do this for profiles without problems, including the start and end-of-coast profile</span></div>
<div class="line"><a id="l01801" name="l01801"></a><span class="lineno"> 1801</span>   <span class="keywordflow">if</span> (! pProfile-&gt;<a class="code hl_function" href="../../da/dae/classCGeomProfile.html#aac223e2610d50ca2c7eadaf8542e9498">bOKIncStartAndEndOfCoast</a>())</div>
<div class="line"><a id="l01802" name="l01802"></a><span class="lineno"> 1802</span>      <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l01803" name="l01803"></a><span class="lineno"> 1803</span> </div>
<div class="line"><a id="l01804" name="l01804"></a><span class="lineno"> 1804</span>   <span class="keywordtype">bool</span> bModfiedWaveHeightisBreaking = <span class="keyword">false</span>;</div>
<div class="line"><a id="l01805" name="l01805"></a><span class="lineno"> 1805</span>   <span class="keywordtype">bool</span> bProfileIsinShadowZone = <span class="keyword">false</span>;</div>
<div class="line"><a id="l01806" name="l01806"></a><span class="lineno"> 1806</span>   <span class="keywordtype">int</span> nThisCoastPoint = pProfile-&gt;<a class="code hl_function" href="../../da/dae/classCGeomProfile.html#a343fd2b73e3a87cf425572860e79ebd6">nGetCoastPoint</a>();</div>
<div class="line"><a id="l01807" name="l01807"></a><span class="lineno"> 1807</span>   <span class="keywordtype">int</span> nProfileSize = pProfile-&gt;<a class="code hl_function" href="../../da/dae/classCGeomProfile.html#a8a29c3fa364ab1f7b3930b7a9c83f45f">nGetNumCellsInProfile</a>();</div>
<div class="line"><a id="l01808" name="l01808"></a><span class="lineno"> 1808</span>   <span class="keywordtype">int</span> nThisBreakingDist = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].nGetBreakingDistance(nThisCoastPoint);</div>
<div class="line"><a id="l01809" name="l01809"></a><span class="lineno"> 1809</span>   <span class="keywordtype">double</span> dThisBreakingWaveHeight = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].dGetBreakingWaveHeight(nThisCoastPoint);      <span class="comment">// This could be DBL_NODATA</span></div>
<div class="line"><a id="l01810" name="l01810"></a><span class="lineno"> 1810</span>   <span class="keywordtype">double</span> dThisBreakingWaveAngle = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].dGetBreakingWaveAngle(nThisCoastPoint);</div>
<div class="line"><a id="l01811" name="l01811"></a><span class="lineno"> 1811</span>   <span class="keywordtype">double</span> dThisBreakingDepth = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].dGetDepthOfBreaking(nThisCoastPoint);</div>
<div class="line"><a id="l01812" name="l01812"></a><span class="lineno"> 1812</span> </div>
<div class="line"><a id="l01813" name="l01813"></a><span class="lineno"> 1813</span>   <span class="comment">// Traverse the profile landwards, checking if any profile cell is within the shadow zone</span></div>
<div class="line"><a id="l01814" name="l01814"></a><span class="lineno"> 1814</span>   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> nProfilePoint = (nProfileSize - 1); nProfilePoint &gt;= 0; nProfilePoint--)</div>
<div class="line"><a id="l01815" name="l01815"></a><span class="lineno"> 1815</span>   {</div>
<div class="line"><a id="l01816" name="l01816"></a><span class="lineno"> 1816</span>      <span class="keywordtype">int</span> nX = pProfile-&gt;<a class="code hl_function" href="../../da/dae/classCGeomProfile.html#a6d13079f744085f2d132405e0120ca54">pPtiGetCellInProfile</a>(nProfilePoint)-&gt;<a class="code hl_function" href="../../d6/d0d/classCGeom2DIPoint.html#af84c687b2d0be01ab41cbcc0565f4f3f">nGetX</a>();</div>
<div class="line"><a id="l01817" name="l01817"></a><span class="lineno"> 1817</span>      <span class="keywordtype">int</span> nY = pProfile-&gt;<a class="code hl_function" href="../../da/dae/classCGeomProfile.html#a6d13079f744085f2d132405e0120ca54">pPtiGetCellInProfile</a>(nProfilePoint)-&gt;<a class="code hl_function" href="../../d6/d0d/classCGeom2DIPoint.html#a4d9c20bcca90dcb9d519b664aba09cbd">nGetY</a>();</div>
<div class="line"><a id="l01818" name="l01818"></a><span class="lineno"> 1818</span> </div>
<div class="line"><a id="l01819" name="l01819"></a><span class="lineno"> 1819</span>      <span class="comment">// If there is any cell profile  within the shadow zone and waves are breaking then modify wave breaking properties otherwise continue</span></div>
<div class="line"><a id="l01820" name="l01820"></a><span class="lineno"> 1820</span>      <span class="keywordflow">if</span> (<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nX][nY].bIsinAnyShadowZone())</div>
<div class="line"><a id="l01821" name="l01821"></a><span class="lineno"> 1821</span>      {</div>
<div class="line"><a id="l01822" name="l01822"></a><span class="lineno"> 1822</span>         bProfileIsinShadowZone = <span class="keyword">true</span>;</div>
<div class="line"><a id="l01823" name="l01823"></a><span class="lineno"> 1823</span> </div>
<div class="line"><a id="l01824" name="l01824"></a><span class="lineno"> 1824</span>         <span class="comment">// Check if the new wave height is breaking</span></div>
<div class="line"><a id="l01825" name="l01825"></a><span class="lineno"> 1825</span>         <span class="keywordtype">double</span> dWaveHeight = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nX][nY].dGetWaveHeight();</div>
<div class="line"><a id="l01826" name="l01826"></a><span class="lineno"> 1826</span> </div>
<div class="line"><a id="l01827" name="l01827"></a><span class="lineno"> 1827</span>         <span class="comment">// Check that wave height at the given point is lower than maximum real wave height. If breaking wave height is expected that no good wave height are obtained, so, do not take it</span></div>
<div class="line"><a id="l01828" name="l01828"></a><span class="lineno"> 1828</span>         <span class="keywordflow">if</span> (dWaveHeight &gt; (<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#aecac3135005148dc01ee8ba3871b7fbf">m_dDepthOfClosure</a> * <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a6e25557aa80dd5aef09170fdc51d80ca">m_dBreakingWaveHeightDepthRatio</a>) &amp;&amp; (! bModfiedWaveHeightisBreaking) &amp;&amp; (! <a class="code hl_function" href="../../d6/d2a/cme_8h.html#a61afa8560a3b39c80657661a1d8f76ab">bFPIsEqual</a>(dThisBreakingWaveHeight, <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#ac003bdff958dca839f5d274f15786e07">DBL_NODATA</a>, <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a08b1623863ee3bd4300a8892de323722">TOLERANCE</a>)))</div>
<div class="line"><a id="l01829" name="l01829"></a><span class="lineno"> 1829</span>         {</div>
<div class="line"><a id="l01830" name="l01830"></a><span class="lineno"> 1830</span>            <span class="comment">// It is breaking</span></div>
<div class="line"><a id="l01831" name="l01831"></a><span class="lineno"> 1831</span>            bModfiedWaveHeightisBreaking = <span class="keyword">true</span>;</div>
<div class="line"><a id="l01832" name="l01832"></a><span class="lineno"> 1832</span> </div>
<div class="line"><a id="l01833" name="l01833"></a><span class="lineno"> 1833</span>            dThisBreakingWaveHeight = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#aecac3135005148dc01ee8ba3871b7fbf">m_dDepthOfClosure</a> * <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a6e25557aa80dd5aef09170fdc51d80ca">m_dBreakingWaveHeightDepthRatio</a>;</div>
<div class="line"><a id="l01834" name="l01834"></a><span class="lineno"> 1834</span>            dThisBreakingWaveAngle = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nX][nY].dGetWaveAngle();</div>
<div class="line"><a id="l01835" name="l01835"></a><span class="lineno"> 1835</span>            dThisBreakingDepth = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#aecac3135005148dc01ee8ba3871b7fbf">m_dDepthOfClosure</a>;</div>
<div class="line"><a id="l01836" name="l01836"></a><span class="lineno"> 1836</span>            nThisBreakingDist = nProfilePoint;</div>
<div class="line"><a id="l01837" name="l01837"></a><span class="lineno"> 1837</span>         }</div>
<div class="line"><a id="l01838" name="l01838"></a><span class="lineno"> 1838</span>      }</div>
<div class="line"><a id="l01839" name="l01839"></a><span class="lineno"> 1839</span>   }</div>
<div class="line"><a id="l01840" name="l01840"></a><span class="lineno"> 1840</span> </div>
<div class="line"><a id="l01841" name="l01841"></a><span class="lineno"> 1841</span>   <span class="comment">// Update breaking wave properties along coastal line object (Wave height, dir, distance). TODO 010 Update the active zone cells</span></div>
<div class="line"><a id="l01842" name="l01842"></a><span class="lineno"> 1842</span>   <span class="keywordflow">if</span> (bProfileIsinShadowZone &amp;&amp; bModfiedWaveHeightisBreaking)    <span class="comment">// Modified wave height is still breaking</span></div>
<div class="line"><a id="l01843" name="l01843"></a><span class="lineno"> 1843</span>   {</div>
<div class="line"><a id="l01844" name="l01844"></a><span class="lineno"> 1844</span>      <span class="comment">// This coast point is in the active zone, so set breaking wave height, breaking wave angle, and depth of breaking for the coast point TODO 007 Where does the 0.78 come from? TODO 011 Should it be an input variable or a named constant?</span></div>
<div class="line"><a id="l01845" name="l01845"></a><span class="lineno"> 1845</span>      <span class="keywordflow">if</span> (dThisBreakingWaveHeight &gt; dThisBreakingDepth * 0.78)</div>
<div class="line"><a id="l01846" name="l01846"></a><span class="lineno"> 1846</span>      {</div>
<div class="line"><a id="l01847" name="l01847"></a><span class="lineno"> 1847</span>         dThisBreakingWaveHeight = dThisBreakingDepth * 0.78;     <span class="comment">// Likely CShore output wave height is not adequately reproduced due to input profile and wave properties. TODO 007 Info needed. Does something need to be changed then?</span></div>
<div class="line"><a id="l01848" name="l01848"></a><span class="lineno"> 1848</span>      }</div>
<div class="line"><a id="l01849" name="l01849"></a><span class="lineno"> 1849</span> </div>
<div class="line"><a id="l01850" name="l01850"></a><span class="lineno"> 1850</span>      <span class="comment">// assert(dThisBreakingWaveHeight &gt;= 0);</span></div>
<div class="line"><a id="l01851" name="l01851"></a><span class="lineno"> 1851</span>      <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].SetBreakingWaveHeight(nThisCoastPoint, dThisBreakingWaveHeight);</div>
<div class="line"><a id="l01852" name="l01852"></a><span class="lineno"> 1852</span>      <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].SetBreakingWaveAngle(nThisCoastPoint, dThisBreakingWaveAngle);</div>
<div class="line"><a id="l01853" name="l01853"></a><span class="lineno"> 1853</span>      <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].SetDepthOfBreaking(nThisCoastPoint, dThisBreakingDepth);</div>
<div class="line"><a id="l01854" name="l01854"></a><span class="lineno"> 1854</span>      <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].SetBreakingDistance(nThisCoastPoint, nThisBreakingDist);</div>
<div class="line"><a id="l01855" name="l01855"></a><span class="lineno"> 1855</span> </div>
<div class="line"><a id="l01856" name="l01856"></a><span class="lineno"> 1856</span>      <span class="comment">//       LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: nProfile = &quot; &lt;&lt; nProfile &lt;&lt; &quot;, nCoastPoint = &quot; &lt;&lt; nCoastPoint &lt;&lt; &quot; in active zone, dBreakingWaveHeight = &quot; &lt;&lt; dBreakingWaveHeight &lt;&lt; endl;</span></div>
<div class="line"><a id="l01857" name="l01857"></a><span class="lineno"> 1857</span>   }</div>
<div class="line"><a id="l01858" name="l01858"></a><span class="lineno"> 1858</span>   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bProfileIsinShadowZone &amp;&amp; (! bModfiedWaveHeightisBreaking))</div>
<div class="line"><a id="l01859" name="l01859"></a><span class="lineno"> 1859</span>   {</div>
<div class="line"><a id="l01860" name="l01860"></a><span class="lineno"> 1860</span>      <span class="comment">// This coast point is no longer in the active zone</span></div>
<div class="line"><a id="l01861" name="l01861"></a><span class="lineno"> 1861</span>      <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].SetBreakingWaveHeight(nThisCoastPoint, <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#ac003bdff958dca839f5d274f15786e07">DBL_NODATA</a>);</div>
<div class="line"><a id="l01862" name="l01862"></a><span class="lineno"> 1862</span>      <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].SetBreakingWaveAngle(nThisCoastPoint, <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#ac003bdff958dca839f5d274f15786e07">DBL_NODATA</a>);</div>
<div class="line"><a id="l01863" name="l01863"></a><span class="lineno"> 1863</span>      <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].SetDepthOfBreaking(nThisCoastPoint, <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#ac003bdff958dca839f5d274f15786e07">DBL_NODATA</a>);</div>
<div class="line"><a id="l01864" name="l01864"></a><span class="lineno"> 1864</span>      <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].SetBreakingDistance(nThisCoastPoint, <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a01aa8b423260b337ddff2016107b51a0">INT_NODATA</a>);</div>
<div class="line"><a id="l01865" name="l01865"></a><span class="lineno"> 1865</span> </div>
<div class="line"><a id="l01866" name="l01866"></a><span class="lineno"> 1866</span>      <span class="comment">//       LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: nProfile = &quot; &lt;&lt; nProfile &lt;&lt; &quot;, nCoastPoint = &quot; &lt;&lt; nCoastPoint &lt;&lt; &quot; NOT in active zone&quot; &lt;&lt; endl;</span></div>
<div class="line"><a id="l01867" name="l01867"></a><span class="lineno"> 1867</span>   }</div>
<div class="line"><a id="l01868" name="l01868"></a><span class="lineno"> 1868</span> </div>
<div class="line"><a id="l01869" name="l01869"></a><span class="lineno"> 1869</span>   <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l01870" name="l01870"></a><span class="lineno"> 1870</span>}</div>
</div>
<div class="line"><a id="l01871" name="l01871"></a><span class="lineno"> 1871</span> </div>
<div class="line"><a id="l01872" name="l01872"></a><span class="lineno"> 1872</span><span class="comment">//===============================================================================================================================</span></div>
<div class="line"><a id="l01874" name="l01874"></a><span class="lineno"> 1874</span><span class="comment">//===============================================================================================================================</span></div>
<div class="foldopen" id="foldopen01875" data-start="{" data-end="}">
<div class="line"><a id="l01875" name="l01875"></a><span class="lineno"><a class="line" href="../../d1/d98/classCSimulation.html#a5c5b3c6af9aaf01e7bf236e88d397e2d"> 1875</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../d1/d98/classCSimulation.html#a5c5b3c6af9aaf01e7bf236e88d397e2d">CSimulation::InterpolateWavePropertiesBetweenProfiles</a>(<span class="keywordtype">int</span> <span class="keyword">const</span> nCoast, <span class="keywordtype">int</span> <span class="keyword">const</span> nCount)</div>
<div class="line"><a id="l01876" name="l01876"></a><span class="lineno"> 1876</span>{</div>
<div class="line"><a id="l01877" name="l01877"></a><span class="lineno"> 1877</span>   <a class="code hl_class" href="../../da/dae/classCGeomProfile.html">CGeomProfile</a>* pProfile = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].pGetProfileWithDownCoastSeq(nCount);</div>
<div class="line"><a id="l01878" name="l01878"></a><span class="lineno"> 1878</span> </div>
<div class="line"><a id="l01879" name="l01879"></a><span class="lineno"> 1879</span>   <span class="comment">// Only do this for profiles without problems, including the start-of-coast profile (but not the end-of-coast profile)</span></div>
<div class="line"><a id="l01880" name="l01880"></a><span class="lineno"> 1880</span>   <span class="comment">// if (!pProfile-&gt;bOKIncStartOfCoast())</span></div>
<div class="line"><a id="l01881" name="l01881"></a><span class="lineno"> 1881</span>   <span class="comment">//    return;</span></div>
<div class="line"><a id="l01882" name="l01882"></a><span class="lineno"> 1882</span> </div>
<div class="line"><a id="l01883" name="l01883"></a><span class="lineno"> 1883</span>   <span class="keywordtype">int</span> nThisCoastPoint = pProfile-&gt;<a class="code hl_function" href="../../da/dae/classCGeomProfile.html#a343fd2b73e3a87cf425572860e79ebd6">nGetCoastPoint</a>();</div>
<div class="line"><a id="l01884" name="l01884"></a><span class="lineno"> 1884</span> </div>
<div class="line"><a id="l01885" name="l01885"></a><span class="lineno"> 1885</span>   <span class="comment">// For the breaking wave stuff, to go into the in-between coastline points</span></div>
<div class="line"><a id="l01886" name="l01886"></a><span class="lineno"> 1886</span>   <span class="keywordtype">int</span> <span class="keyword">const</span> nThisBreakingDist = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].nGetBreakingDistance(nThisCoastPoint);</div>
<div class="line"><a id="l01887" name="l01887"></a><span class="lineno"> 1887</span>   <span class="keywordtype">double</span> dThisBreakingWaveHeight = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].dGetBreakingWaveHeight(nThisCoastPoint);   <span class="comment">// This could be DBL_NODATA</span></div>
<div class="line"><a id="l01888" name="l01888"></a><span class="lineno"> 1888</span>   <span class="keywordtype">double</span> dThisBreakingWaveAngle = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].dGetBreakingWaveAngle(nThisCoastPoint);</div>
<div class="line"><a id="l01889" name="l01889"></a><span class="lineno"> 1889</span>   <span class="keywordtype">double</span> dThisBreakingDepth = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].dGetDepthOfBreaking(nThisCoastPoint);</div>
<div class="line"><a id="l01890" name="l01890"></a><span class="lineno"> 1890</span>   <span class="keywordtype">double</span> dThisWaveSetupSurge = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].dGetWaveSetupSurge(nThisCoastPoint);</div>
<div class="line"><a id="l01891" name="l01891"></a><span class="lineno"> 1891</span>   <span class="comment">//  double dThisStormSurge = m_VCoast[nCoast].dGetStormSurge(nThisCoastPoint);</span></div>
<div class="line"><a id="l01892" name="l01892"></a><span class="lineno"> 1892</span>   <span class="keywordtype">double</span> dThisRunUp = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].dGetRunUp(nThisCoastPoint);</div>
<div class="line"><a id="l01893" name="l01893"></a><span class="lineno"> 1893</span> </div>
<div class="line"><a id="l01894" name="l01894"></a><span class="lineno"> 1894</span>   <span class="comment">// Get the next profile along the coast, in the down-coast direction. If this next profile has a problem, go to the one after that, etc</span></div>
<div class="line"><a id="l01895" name="l01895"></a><span class="lineno"> 1895</span>   <a class="code hl_class" href="../../da/dae/classCGeomProfile.html">CGeomProfile</a> <span class="keyword">const</span>* pTmpProfile = pProfile;</div>
<div class="line"><a id="l01896" name="l01896"></a><span class="lineno"> 1896</span>   <a class="code hl_class" href="../../da/dae/classCGeomProfile.html">CGeomProfile</a>* pNextProfile;</div>
<div class="line"><a id="l01897" name="l01897"></a><span class="lineno"> 1897</span>   <span class="keywordflow">while</span> (<span class="keyword">true</span>)</div>
<div class="line"><a id="l01898" name="l01898"></a><span class="lineno"> 1898</span>   {</div>
<div class="line"><a id="l01899" name="l01899"></a><span class="lineno"> 1899</span>      pNextProfile = pTmpProfile-&gt;<a class="code hl_function" href="../../da/dae/classCGeomProfile.html#a60a83e788c19cfee1f79e44253e09fca">pGetDownCoastAdjacentProfile</a>();</div>
<div class="line"><a id="l01900" name="l01900"></a><span class="lineno"> 1900</span> </div>
<div class="line"><a id="l01901" name="l01901"></a><span class="lineno"> 1901</span>      <span class="keywordflow">if</span> (pNextProfile-&gt;<a class="code hl_function" href="../../da/dae/classCGeomProfile.html#aac223e2610d50ca2c7eadaf8542e9498">bOKIncStartAndEndOfCoast</a>())</div>
<div class="line"><a id="l01902" name="l01902"></a><span class="lineno"> 1902</span>      {</div>
<div class="line"><a id="l01903" name="l01903"></a><span class="lineno"> 1903</span>         <span class="comment">// The next profile is OK</span></div>
<div class="line"><a id="l01904" name="l01904"></a><span class="lineno"> 1904</span>         <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01905" name="l01905"></a><span class="lineno"> 1905</span>      }</div>
<div class="line"><a id="l01906" name="l01906"></a><span class="lineno"> 1906</span> </div>
<div class="line"><a id="l01907" name="l01907"></a><span class="lineno"> 1907</span>      <span class="comment">// The next profile is not OK, so prepare to the one after that</span></div>
<div class="line"><a id="l01908" name="l01908"></a><span class="lineno"> 1908</span>      pTmpProfile = pNextProfile;</div>
<div class="line"><a id="l01909" name="l01909"></a><span class="lineno"> 1909</span> </div>
<div class="line"><a id="l01910" name="l01910"></a><span class="lineno"> 1910</span>      <span class="keywordflow">if</span> (pTmpProfile-&gt;<a class="code hl_function" href="../../da/dae/classCGeomProfile.html#aec35bc03fc47a65349def96364c99bbd">bEndOfCoast</a>())</div>
<div class="line"><a id="l01911" name="l01911"></a><span class="lineno"> 1911</span>      {</div>
<div class="line"><a id="l01912" name="l01912"></a><span class="lineno"> 1912</span>         <span class="comment">// Uh-oh, we&#39;ve reached the down-coast end of the coast without finding an OK down-coast profile. So give up</span></div>
<div class="line"><a id="l01913" name="l01913"></a><span class="lineno"> 1913</span>         <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l01914" name="l01914"></a><span class="lineno"> 1914</span>      }</div>
<div class="line"><a id="l01915" name="l01915"></a><span class="lineno"> 1915</span>   }</div>
<div class="line"><a id="l01916" name="l01916"></a><span class="lineno"> 1916</span> </div>
<div class="line"><a id="l01917" name="l01917"></a><span class="lineno"> 1917</span>   <span class="comment">// The next profile is OK</span></div>
<div class="line"><a id="l01918" name="l01918"></a><span class="lineno"> 1918</span>   <span class="keywordtype">int</span> <span class="keyword">const</span> nNextCoastPoint = pNextProfile-&gt;<a class="code hl_function" href="../../da/dae/classCGeomProfile.html#a343fd2b73e3a87cf425572860e79ebd6">nGetCoastPoint</a>();</div>
<div class="line"><a id="l01919" name="l01919"></a><span class="lineno"> 1919</span>   <span class="keywordtype">int</span> <span class="keyword">const</span> nDistBetween = nNextCoastPoint - nThisCoastPoint;</div>
<div class="line"><a id="l01920" name="l01920"></a><span class="lineno"> 1920</span> </div>
<div class="line"><a id="l01921" name="l01921"></a><span class="lineno"> 1921</span>   <span class="comment">// Safety check</span></div>
<div class="line"><a id="l01922" name="l01922"></a><span class="lineno"> 1922</span>   <span class="keywordflow">if</span> (nDistBetween &lt;= 0)</div>
<div class="line"><a id="l01923" name="l01923"></a><span class="lineno"> 1923</span>      <span class="comment">// Nothing to do</span></div>
<div class="line"><a id="l01924" name="l01924"></a><span class="lineno"> 1924</span>      <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l01925" name="l01925"></a><span class="lineno"> 1925</span> </div>
<div class="line"><a id="l01926" name="l01926"></a><span class="lineno"> 1926</span>   <span class="keywordtype">int</span> nNextBreakingDist = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].nGetBreakingDistance(nNextCoastPoint);</div>
<div class="line"><a id="l01927" name="l01927"></a><span class="lineno"> 1927</span>   <span class="keywordtype">double</span> dNextBreakingWaveHeight = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].dGetBreakingWaveHeight(nNextCoastPoint); <span class="comment">// This could be DBL_NODATA</span></div>
<div class="line"><a id="l01928" name="l01928"></a><span class="lineno"> 1928</span>   <span class="keywordtype">double</span> dNextBreakingWaveAngle = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].dGetBreakingWaveAngle(nNextCoastPoint);</div>
<div class="line"><a id="l01929" name="l01929"></a><span class="lineno"> 1929</span>   <span class="keywordtype">double</span> dNextBreakingDepth = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].dGetDepthOfBreaking(nNextCoastPoint);</div>
<div class="line"><a id="l01930" name="l01930"></a><span class="lineno"> 1930</span>   <span class="keywordtype">double</span> dNextWaveSetupSurge = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].dGetWaveSetupSurge(nNextCoastPoint);</div>
<div class="line"><a id="l01931" name="l01931"></a><span class="lineno"> 1931</span>   <span class="keywordtype">double</span> dNextRunUp = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].dGetRunUp(nNextCoastPoint);</div>
<div class="line"><a id="l01932" name="l01932"></a><span class="lineno"> 1932</span> </div>
<div class="line"><a id="l01933" name="l01933"></a><span class="lineno"> 1933</span>   <span class="comment">// OK, fill coast point between profiles for setupsurge and runup</span></div>
<div class="line"><a id="l01934" name="l01934"></a><span class="lineno"> 1934</span>   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> n = nThisCoastPoint; n &lt;= nNextCoastPoint; n++)</div>
<div class="line"><a id="l01935" name="l01935"></a><span class="lineno"> 1935</span>   {</div>
<div class="line"><a id="l01936" name="l01936"></a><span class="lineno"> 1936</span>      <span class="comment">// Fill first wave setup and surge</span></div>
<div class="line"><a id="l01937" name="l01937"></a><span class="lineno"> 1937</span>      <span class="keywordtype">int</span> nDist = n - nThisCoastPoint;</div>
<div class="line"><a id="l01938" name="l01938"></a><span class="lineno"> 1938</span>      <span class="keywordtype">double</span> dThisWeight = (nDistBetween - nDist) / <span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>(nDistBetween);</div>
<div class="line"><a id="l01939" name="l01939"></a><span class="lineno"> 1939</span>      <span class="keywordtype">double</span> dNextWeight = 1 - dThisWeight;</div>
<div class="line"><a id="l01940" name="l01940"></a><span class="lineno"> 1940</span>      <span class="keywordtype">double</span> dWaveSetupSurge = 0;</div>
<div class="line"><a id="l01941" name="l01941"></a><span class="lineno"> 1941</span>      <span class="keywordtype">double</span> dRunUp = 0;</div>
<div class="line"><a id="l01942" name="l01942"></a><span class="lineno"> 1942</span> </div>
<div class="line"><a id="l01943" name="l01943"></a><span class="lineno"> 1943</span>      dWaveSetupSurge = (dThisWeight * dThisWaveSetupSurge) + (dNextWeight * dNextWaveSetupSurge);</div>
<div class="line"><a id="l01944" name="l01944"></a><span class="lineno"> 1944</span>      <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].SetWaveSetupSurge(n, dWaveSetupSurge);</div>
<div class="line"><a id="l01945" name="l01945"></a><span class="lineno"> 1945</span> </div>
<div class="line"><a id="l01946" name="l01946"></a><span class="lineno"> 1946</span>      dRunUp = (dThisWeight * dThisRunUp) + (dNextWeight * dNextRunUp);</div>
<div class="line"><a id="l01947" name="l01947"></a><span class="lineno"> 1947</span>      <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].SetRunUp(n, dRunUp);</div>
<div class="line"><a id="l01948" name="l01948"></a><span class="lineno"> 1948</span>   }</div>
<div class="line"><a id="l01949" name="l01949"></a><span class="lineno"> 1949</span> </div>
<div class="line"><a id="l01950" name="l01950"></a><span class="lineno"> 1950</span>   <span class="comment">// int const nNextProfile = pNextProfile-&gt;nGetCoastID();</span></div>
<div class="line"><a id="l01951" name="l01951"></a><span class="lineno"> 1951</span> </div>
<div class="line"><a id="l01952" name="l01952"></a><span class="lineno"> 1952</span>   <span class="comment">// If both this profile and the next profile are not in the active zone, then do no more</span></div>
<div class="line"><a id="l01953" name="l01953"></a><span class="lineno"> 1953</span>   <span class="keywordflow">if</span> ((<a class="code hl_function" href="../../d6/d2a/cme_8h.html#a61afa8560a3b39c80657661a1d8f76ab">bFPIsEqual</a>(dThisBreakingWaveHeight, <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#ac003bdff958dca839f5d274f15786e07">DBL_NODATA</a>, <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a08b1623863ee3bd4300a8892de323722">TOLERANCE</a>)) &amp;&amp; (<a class="code hl_function" href="../../d6/d2a/cme_8h.html#a61afa8560a3b39c80657661a1d8f76ab">bFPIsEqual</a>(dNextBreakingWaveHeight, <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#ac003bdff958dca839f5d274f15786e07">DBL_NODATA</a>, <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a08b1623863ee3bd4300a8892de323722">TOLERANCE</a>)))</div>
<div class="line"><a id="l01954" name="l01954"></a><span class="lineno"> 1954</span>   {</div>
<div class="line"><a id="l01955" name="l01955"></a><span class="lineno"> 1955</span>      <span class="comment">// if (m_nLogFileDetail &gt;= LOG_FILE_HIGH_DETAIL)</span></div>
<div class="line"><a id="l01956" name="l01956"></a><span class="lineno"> 1956</span>      <span class="comment">//    LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: both profile &quot; &lt;&lt; pProfile-&gt;nGetCoastID() &lt;&lt; &quot; at coast point &quot; &lt;&lt; nThisCoastPoint &lt;&lt; &quot;, and profile &quot; &lt;&lt; nNextProfile &lt;&lt; &quot; at coast point &quot; &lt;&lt; nNextCoastPoint &lt;&lt; &quot;, are not in the active zone&quot; &lt;&lt; endl;</span></div>
<div class="line"><a id="l01957" name="l01957"></a><span class="lineno"> 1957</span>      </div>
<div class="line"><a id="l01958" name="l01958"></a><span class="lineno"> 1958</span>      <span class="comment">// Set the breaking wave height, breaking wave angle, and depth of breaking to DBL_NODATA</span></div>
<div class="line"><a id="l01959" name="l01959"></a><span class="lineno"> 1959</span>      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> n = nThisCoastPoint; n &lt; nNextCoastPoint; n++)</div>
<div class="line"><a id="l01960" name="l01960"></a><span class="lineno"> 1960</span>      {</div>
<div class="line"><a id="l01961" name="l01961"></a><span class="lineno"> 1961</span>         <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].SetBreakingWaveHeight(nThisCoastPoint, <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#ac003bdff958dca839f5d274f15786e07">DBL_NODATA</a>);</div>
<div class="line"><a id="l01962" name="l01962"></a><span class="lineno"> 1962</span>         <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].SetBreakingWaveAngle(nThisCoastPoint, <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#ac003bdff958dca839f5d274f15786e07">DBL_NODATA</a>);</div>
<div class="line"><a id="l01963" name="l01963"></a><span class="lineno"> 1963</span>         <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].SetDepthOfBreaking(nThisCoastPoint, <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#ac003bdff958dca839f5d274f15786e07">DBL_NODATA</a>);</div>
<div class="line"><a id="l01964" name="l01964"></a><span class="lineno"> 1964</span>         <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].SetBreakingDistance(nThisCoastPoint, <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#ac003bdff958dca839f5d274f15786e07">DBL_NODATA</a>);</div>
<div class="line"><a id="l01965" name="l01965"></a><span class="lineno"> 1965</span>      }</div>
<div class="line"><a id="l01966" name="l01966"></a><span class="lineno"> 1966</span>      <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l01967" name="l01967"></a><span class="lineno"> 1967</span>   }</div>
<div class="line"><a id="l01968" name="l01968"></a><span class="lineno"> 1968</span> </div>
<div class="line"><a id="l01969" name="l01969"></a><span class="lineno"> 1969</span>   <span class="comment">// OK, at least one of the two profiles is in the active zone</span></div>
<div class="line"><a id="l01970" name="l01970"></a><span class="lineno"> 1970</span>   <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d6/d2a/cme_8h.html#a61afa8560a3b39c80657661a1d8f76ab">bFPIsEqual</a>(dThisBreakingWaveHeight, <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#ac003bdff958dca839f5d274f15786e07">DBL_NODATA</a>, <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a08b1623863ee3bd4300a8892de323722">TOLERANCE</a>)) </div>
<div class="line"><a id="l01971" name="l01971"></a><span class="lineno"> 1971</span>   {</div>
<div class="line"><a id="l01972" name="l01972"></a><span class="lineno"> 1972</span>      <span class="comment">// The next profile must be in the active zone, so use values from the next profile</span></div>
<div class="line"><a id="l01973" name="l01973"></a><span class="lineno"> 1973</span>      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> n = nThisCoastPoint; n &lt; nNextCoastPoint; n++)</div>
<div class="line"><a id="l01974" name="l01974"></a><span class="lineno"> 1974</span>      {</div>
<div class="line"><a id="l01975" name="l01975"></a><span class="lineno"> 1975</span>         <span class="comment">// Set the breaking wave height, breaking wave angle, and depth of breaking for this coast point TODO 056 This assert sometimes fails: why?</span></div>
<div class="line"><a id="l01976" name="l01976"></a><span class="lineno"> 1976</span>         <span class="comment">// assert(dNextBreakingWaveHeight &gt;= 0);</span></div>
<div class="line"><a id="l01977" name="l01977"></a><span class="lineno"> 1977</span>         <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].SetBreakingWaveHeight(n, dNextBreakingWaveHeight);</div>
<div class="line"><a id="l01978" name="l01978"></a><span class="lineno"> 1978</span>         <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].SetBreakingWaveAngle(n, dNextBreakingWaveAngle);</div>
<div class="line"><a id="l01979" name="l01979"></a><span class="lineno"> 1979</span>         <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].SetDepthOfBreaking(n, dNextBreakingDepth);</div>
<div class="line"><a id="l01980" name="l01980"></a><span class="lineno"> 1980</span>         <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].SetBreakingDistance(n, nNextBreakingDist);</div>
<div class="line"><a id="l01981" name="l01981"></a><span class="lineno"> 1981</span>      }</div>
<div class="line"><a id="l01982" name="l01982"></a><span class="lineno"> 1982</span>      <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l01983" name="l01983"></a><span class="lineno"> 1983</span>   }</div>
<div class="line"><a id="l01984" name="l01984"></a><span class="lineno"> 1984</span> </div>
<div class="line"><a id="l01985" name="l01985"></a><span class="lineno"> 1985</span>   <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d6/d2a/cme_8h.html#a61afa8560a3b39c80657661a1d8f76ab">bFPIsEqual</a>(dNextBreakingWaveHeight, <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#ac003bdff958dca839f5d274f15786e07">DBL_NODATA</a>, <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a08b1623863ee3bd4300a8892de323722">TOLERANCE</a>))</div>
<div class="line"><a id="l01986" name="l01986"></a><span class="lineno"> 1986</span>   {</div>
<div class="line"><a id="l01987" name="l01987"></a><span class="lineno"> 1987</span>      <span class="comment">// This profile must be in the active zone, so use values from this profile</span></div>
<div class="line"><a id="l01988" name="l01988"></a><span class="lineno"> 1988</span>      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> n = nThisCoastPoint + 1; n &lt;= nNextCoastPoint; n++)</div>
<div class="line"><a id="l01989" name="l01989"></a><span class="lineno"> 1989</span>      {</div>
<div class="line"><a id="l01990" name="l01990"></a><span class="lineno"> 1990</span>         <span class="comment">// Set the breaking wave height, breaking wave angle, and depth of breaking for this coast point TODO 056 This assert sometimes fails: why?</span></div>
<div class="line"><a id="l01991" name="l01991"></a><span class="lineno"> 1991</span>         <span class="comment">// assert(dThisBreakingWaveHeight &gt;= 0);</span></div>
<div class="line"><a id="l01992" name="l01992"></a><span class="lineno"> 1992</span>         <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].SetBreakingWaveHeight(n, dThisBreakingWaveHeight);</div>
<div class="line"><a id="l01993" name="l01993"></a><span class="lineno"> 1993</span>         <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].SetBreakingWaveAngle(n, dThisBreakingWaveAngle);</div>
<div class="line"><a id="l01994" name="l01994"></a><span class="lineno"> 1994</span>         <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].SetDepthOfBreaking(n, dThisBreakingDepth);</div>
<div class="line"><a id="l01995" name="l01995"></a><span class="lineno"> 1995</span>         <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].SetBreakingDistance(n, nThisBreakingDist);</div>
<div class="line"><a id="l01996" name="l01996"></a><span class="lineno"> 1996</span>      }</div>
<div class="line"><a id="l01997" name="l01997"></a><span class="lineno"> 1997</span> </div>
<div class="line"><a id="l01998" name="l01998"></a><span class="lineno"> 1998</span>      <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l01999" name="l01999"></a><span class="lineno"> 1999</span>   }</div>
<div class="line"><a id="l02000" name="l02000"></a><span class="lineno"> 2000</span> </div>
<div class="line"><a id="l02001" name="l02001"></a><span class="lineno"> 2001</span>   <span class="comment">// The values for both this profile point and the next profile point are fine, so do a weighted interpolation between this profile and the next profile</span></div>
<div class="line"><a id="l02002" name="l02002"></a><span class="lineno"> 2002</span>   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> n = nThisCoastPoint + 1; n &lt; nNextCoastPoint; n++)</div>
<div class="line"><a id="l02003" name="l02003"></a><span class="lineno"> 2003</span>   {</div>
<div class="line"><a id="l02004" name="l02004"></a><span class="lineno"> 2004</span>      <span class="keywordtype">int</span> nDist = n - nThisCoastPoint;</div>
<div class="line"><a id="l02005" name="l02005"></a><span class="lineno"> 2005</span> </div>
<div class="line"><a id="l02006" name="l02006"></a><span class="lineno"> 2006</span>      <span class="keywordtype">double</span> dBreakingWaveHeight = <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#ac003bdff958dca839f5d274f15786e07">DBL_NODATA</a>;</div>
<div class="line"><a id="l02007" name="l02007"></a><span class="lineno"> 2007</span>      <span class="keywordtype">double</span> dBreakingWaveAngle = <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#ac003bdff958dca839f5d274f15786e07">DBL_NODATA</a>;</div>
<div class="line"><a id="l02008" name="l02008"></a><span class="lineno"> 2008</span>      <span class="keywordtype">double</span> dBreakingDepth = <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#ac003bdff958dca839f5d274f15786e07">DBL_NODATA</a>;</div>
<div class="line"><a id="l02009" name="l02009"></a><span class="lineno"> 2009</span>      <span class="keywordtype">double</span> dBreakingDist = <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#ac003bdff958dca839f5d274f15786e07">DBL_NODATA</a>;</div>
<div class="line"><a id="l02010" name="l02010"></a><span class="lineno"> 2010</span> </div>
<div class="line"><a id="l02011" name="l02011"></a><span class="lineno"> 2011</span>      <span class="keywordflow">if</span> ((dNextBreakingDepth &gt; 0) &amp;&amp; (dThisBreakingDepth &gt; 0))</div>
<div class="line"><a id="l02012" name="l02012"></a><span class="lineno"> 2012</span>      {</div>
<div class="line"><a id="l02013" name="l02013"></a><span class="lineno"> 2013</span>         <span class="keywordtype">double</span></div>
<div class="line"><a id="l02014" name="l02014"></a><span class="lineno"> 2014</span>             dThisWeight = (nDistBetween - nDist) / <span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>(nDistBetween),</div>
<div class="line"><a id="l02015" name="l02015"></a><span class="lineno"> 2015</span>             dNextWeight = 1 - dThisWeight;</div>
<div class="line"><a id="l02016" name="l02016"></a><span class="lineno"> 2016</span> </div>
<div class="line"><a id="l02017" name="l02017"></a><span class="lineno"> 2017</span>         dBreakingWaveHeight = (dThisWeight * dThisBreakingWaveHeight) + (dNextWeight * dNextBreakingWaveHeight),</div>
<div class="line"><a id="l02018" name="l02018"></a><span class="lineno"> 2018</span>         dBreakingWaveAngle = (dThisWeight * dThisBreakingWaveAngle) + (dNextWeight * dNextBreakingWaveAngle),</div>
<div class="line"><a id="l02019" name="l02019"></a><span class="lineno"> 2019</span>         dBreakingDepth = (dThisWeight * dThisBreakingDepth) + (dNextWeight * dNextBreakingDepth),</div>
<div class="line"><a id="l02020" name="l02020"></a><span class="lineno"> 2020</span>         dBreakingDist = (dThisWeight * nThisBreakingDist) + (dNextWeight * nNextBreakingDist);</div>
<div class="line"><a id="l02021" name="l02021"></a><span class="lineno"> 2021</span>      }</div>
<div class="line"><a id="l02022" name="l02022"></a><span class="lineno"> 2022</span>      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dNextBreakingDepth &gt; 0)</div>
<div class="line"><a id="l02023" name="l02023"></a><span class="lineno"> 2023</span>      {</div>
<div class="line"><a id="l02024" name="l02024"></a><span class="lineno"> 2024</span>         dBreakingWaveHeight = dNextBreakingWaveHeight,</div>
<div class="line"><a id="l02025" name="l02025"></a><span class="lineno"> 2025</span>         dBreakingWaveAngle = dNextBreakingWaveAngle,</div>
<div class="line"><a id="l02026" name="l02026"></a><span class="lineno"> 2026</span>         dBreakingDepth = dNextBreakingDepth,</div>
<div class="line"><a id="l02027" name="l02027"></a><span class="lineno"> 2027</span>         dBreakingDist = nNextBreakingDist;</div>
<div class="line"><a id="l02028" name="l02028"></a><span class="lineno"> 2028</span>      }</div>
<div class="line"><a id="l02029" name="l02029"></a><span class="lineno"> 2029</span>      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dThisBreakingDepth &gt; 0)</div>
<div class="line"><a id="l02030" name="l02030"></a><span class="lineno"> 2030</span>      {</div>
<div class="line"><a id="l02031" name="l02031"></a><span class="lineno"> 2031</span>         dBreakingWaveHeight = dThisBreakingWaveHeight,</div>
<div class="line"><a id="l02032" name="l02032"></a><span class="lineno"> 2032</span>         dBreakingWaveAngle = dThisBreakingWaveAngle,</div>
<div class="line"><a id="l02033" name="l02033"></a><span class="lineno"> 2033</span>         dBreakingDepth = dThisBreakingDepth,</div>
<div class="line"><a id="l02034" name="l02034"></a><span class="lineno"> 2034</span>         dBreakingDist = nThisBreakingDist;</div>
<div class="line"><a id="l02035" name="l02035"></a><span class="lineno"> 2035</span>      }</div>
<div class="line"><a id="l02036" name="l02036"></a><span class="lineno"> 2036</span> </div>
<div class="line"><a id="l02037" name="l02037"></a><span class="lineno"> 2037</span>      <span class="comment">// Set the breaking wave height, breaking wave angle, and depth of breaking for this coast point TODO 056 This assert sometimes fails: why?</span></div>
<div class="line"><a id="l02038" name="l02038"></a><span class="lineno"> 2038</span>      <span class="comment">// assert(dBreakingWaveHeight &gt;= 0);</span></div>
<div class="line"><a id="l02039" name="l02039"></a><span class="lineno"> 2039</span>      <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].SetBreakingWaveHeight(n, dBreakingWaveHeight);</div>
<div class="line"><a id="l02040" name="l02040"></a><span class="lineno"> 2040</span>      <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].SetBreakingWaveAngle(n, dBreakingWaveAngle);</div>
<div class="line"><a id="l02041" name="l02041"></a><span class="lineno"> 2041</span>      <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].SetDepthOfBreaking(n, dBreakingDepth);</div>
<div class="line"><a id="l02042" name="l02042"></a><span class="lineno"> 2042</span>      <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].SetBreakingDistance(n, <a class="code hl_function" href="../../d2/dfd/utils__global_8cpp.html#a20842d0a19d0ca952c91f3e1eb175fee">nRound</a>(dBreakingDist));</div>
<div class="line"><a id="l02043" name="l02043"></a><span class="lineno"> 2043</span>   }</div>
<div class="line"><a id="l02044" name="l02044"></a><span class="lineno"> 2044</span>}</div>
</div>
<div class="line"><a id="l02045" name="l02045"></a><span class="lineno"> 2045</span> </div>
<div class="line"><a id="l02046" name="l02046"></a><span class="lineno"> 2046</span><span class="comment">//===============================================================================================================================</span></div>
<div class="line"><a id="l02048" name="l02048"></a><span class="lineno"> 2048</span><span class="comment">//===============================================================================================================================</span></div>
<div class="foldopen" id="foldopen02049" data-start="{" data-end="}">
<div class="line"><a id="l02049" name="l02049"></a><span class="lineno"><a class="line" href="../../d1/d98/classCSimulation.html#af4c1d4172cbc1ef26d5cae02ffe03409"> 2049</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../d1/d98/classCSimulation.html#af4c1d4172cbc1ef26d5cae02ffe03409">CSimulation::InterpolateWaveHeightToCoastPoints</a>(<span class="keywordtype">int</span> <span class="keyword">const</span> nCoast)</div>
<div class="line"><a id="l02050" name="l02050"></a><span class="lineno"> 2050</span>{</div>
<div class="line"><a id="l02051" name="l02051"></a><span class="lineno"> 2051</span>   <span class="keywordtype">int</span> nCoastPoints = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].nGetCoastlineSize();</div>
<div class="line"><a id="l02052" name="l02052"></a><span class="lineno"> 2052</span> </div>
<div class="line"><a id="l02053" name="l02053"></a><span class="lineno"> 2053</span>   <span class="comment">// Initialize all vectors pairs (x,y) for each variable</span></div>
<div class="line"><a id="l02054" name="l02054"></a><span class="lineno"> 2054</span>   vector&lt;int&gt; nVCoastWaveHeightX;</div>
<div class="line"><a id="l02055" name="l02055"></a><span class="lineno"> 2055</span>   vector&lt;double&gt; dVCoastWaveHeightY;</div>
<div class="line"><a id="l02056" name="l02056"></a><span class="lineno"> 2056</span> </div>
<div class="line"><a id="l02057" name="l02057"></a><span class="lineno"> 2057</span>   <span class="comment">// Search all coast points for non NaN values and store them into temporary variables for later interporlation</span></div>
<div class="line"><a id="l02058" name="l02058"></a><span class="lineno"> 2058</span>   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> n = 0; n &lt; nCoastPoints; n++)</div>
<div class="line"><a id="l02059" name="l02059"></a><span class="lineno"> 2059</span>   {</div>
<div class="line"><a id="l02060" name="l02060"></a><span class="lineno"> 2060</span>      <span class="keywordtype">double</span> dCoastWaveHeight = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].dGetCoastWaveHeight(n);</div>
<div class="line"><a id="l02061" name="l02061"></a><span class="lineno"> 2061</span> </div>
<div class="line"><a id="l02062" name="l02062"></a><span class="lineno"> 2062</span>      <span class="keywordflow">if</span> (! <a class="code hl_function" href="../../d6/d2a/cme_8h.html#a61afa8560a3b39c80657661a1d8f76ab">bFPIsEqual</a>(dCoastWaveHeight, <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#ac003bdff958dca839f5d274f15786e07">DBL_NODATA</a>, <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a08b1623863ee3bd4300a8892de323722">TOLERANCE</a>))</div>
<div class="line"><a id="l02063" name="l02063"></a><span class="lineno"> 2063</span>      {</div>
<div class="line"><a id="l02064" name="l02064"></a><span class="lineno"> 2064</span>         nVCoastWaveHeightX.push_back(n);</div>
<div class="line"><a id="l02065" name="l02065"></a><span class="lineno"> 2065</span>         dVCoastWaveHeightY.push_back(dCoastWaveHeight);</div>
<div class="line"><a id="l02066" name="l02066"></a><span class="lineno"> 2066</span>      }</div>
<div class="line"><a id="l02067" name="l02067"></a><span class="lineno"> 2067</span>   }</div>
<div class="line"><a id="l02068" name="l02068"></a><span class="lineno"> 2068</span> </div>
<div class="line"><a id="l02069" name="l02069"></a><span class="lineno"> 2069</span>   <span class="comment">// Interpolate all coast points. Check first that x,y have more than 3 points and are both of equal size</span></div>
<div class="line"><a id="l02070" name="l02070"></a><span class="lineno"> 2070</span>   <span class="keywordflow">if</span> ((nVCoastWaveHeightX.size() &gt;= 3) &amp;&amp; (nVCoastWaveHeightX.size() == dVCoastWaveHeightY.size()))</div>
<div class="line"><a id="l02071" name="l02071"></a><span class="lineno"> 2071</span>   {</div>
<div class="line"><a id="l02072" name="l02072"></a><span class="lineno"> 2072</span>      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> n = 0; n &lt; nCoastPoints; n++)</div>
<div class="line"><a id="l02073" name="l02073"></a><span class="lineno"> 2073</span>      {</div>
<div class="line"><a id="l02074" name="l02074"></a><span class="lineno"> 2074</span>         <span class="keywordtype">double</span> dInterpCoastWaveHeight = <a class="code hl_function" href="../../d7/d62/interpolate_8cpp.html#aec8942141bf8fa2a69bacd12ee72cbd2">dGetInterpolatedValue</a>(&amp;nVCoastWaveHeightX, &amp;dVCoastWaveHeightY, n, <span class="keyword">false</span>);</div>
<div class="line"><a id="l02075" name="l02075"></a><span class="lineno"> 2075</span>         <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].SetCoastWaveHeight(n, dInterpCoastWaveHeight);</div>
<div class="line"><a id="l02076" name="l02076"></a><span class="lineno"> 2076</span>      }</div>
<div class="line"><a id="l02077" name="l02077"></a><span class="lineno"> 2077</span>   }</div>
<div class="line"><a id="l02078" name="l02078"></a><span class="lineno"> 2078</span>   <span class="keywordflow">else</span></div>
<div class="line"><a id="l02079" name="l02079"></a><span class="lineno"> 2079</span>   {</div>
<div class="line"><a id="l02080" name="l02080"></a><span class="lineno"> 2080</span>      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> n = 0; n &lt; nCoastPoints; n++)</div>
<div class="line"><a id="l02081" name="l02081"></a><span class="lineno"> 2081</span>      {</div>
<div class="line"><a id="l02082" name="l02082"></a><span class="lineno"> 2082</span>         <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].SetCoastWaveHeight(n, 0);</div>
<div class="line"><a id="l02083" name="l02083"></a><span class="lineno"> 2083</span>      }</div>
<div class="line"><a id="l02084" name="l02084"></a><span class="lineno"> 2084</span>   }</div>
<div class="line"><a id="l02085" name="l02085"></a><span class="lineno"> 2085</span>}</div>
</div>
<div class="line"><a id="l02086" name="l02086"></a><span class="lineno"> 2086</span> </div>
<div class="line"><a id="l02087" name="l02087"></a><span class="lineno"> 2087</span><span class="comment">//===============================================================================================================================</span></div>
<div class="line"><a id="l02089" name="l02089"></a><span class="lineno"> 2089</span><span class="comment">//===============================================================================================================================</span></div>
<div class="foldopen" id="foldopen02090" data-start="{" data-end="}">
<div class="line"><a id="l02090" name="l02090"></a><span class="lineno"><a class="line" href="../../d1/d98/classCSimulation.html#a451022d3ec5423d453cbbe06b84fddc7"> 2090</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../d1/d98/classCSimulation.html#a451022d3ec5423d453cbbe06b84fddc7">CSimulation::CalcCoastTangents</a>(<span class="keywordtype">int</span> <span class="keyword">const</span> nCoast)</div>
<div class="line"><a id="l02091" name="l02091"></a><span class="lineno"> 2091</span>{</div>
<div class="line"><a id="l02092" name="l02092"></a><span class="lineno"> 2092</span>   <span class="keywordtype">int</span> nCoastSize = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].nGetCoastlineSize();</div>
<div class="line"><a id="l02093" name="l02093"></a><span class="lineno"> 2093</span> </div>
<div class="line"><a id="l02094" name="l02094"></a><span class="lineno"> 2094</span>   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> nCoastPoint = 0; nCoastPoint &lt; nCoastSize; nCoastPoint++)</div>
<div class="line"><a id="l02095" name="l02095"></a><span class="lineno"> 2095</span>   {</div>
<div class="line"><a id="l02096" name="l02096"></a><span class="lineno"> 2096</span>      <span class="keywordtype">double</span> dXDiff;</div>
<div class="line"><a id="l02097" name="l02097"></a><span class="lineno"> 2097</span>      <span class="keywordtype">double</span> dYDiff;</div>
<div class="line"><a id="l02098" name="l02098"></a><span class="lineno"> 2098</span> </div>
<div class="line"><a id="l02099" name="l02099"></a><span class="lineno"> 2099</span>      <span class="keywordflow">if</span> (nCoastPoint == 0)</div>
<div class="line"><a id="l02100" name="l02100"></a><span class="lineno"> 2100</span>      {</div>
<div class="line"><a id="l02101" name="l02101"></a><span class="lineno"> 2101</span>         <span class="comment">// For the point at the start of the coastline: use the straight line from &#39;this&#39; point to the next point</span></div>
<div class="line"><a id="l02102" name="l02102"></a><span class="lineno"> 2102</span>         <a class="code hl_class" href="../../d5/d4e/classCGeom2DPoint.html">CGeom2DPoint</a> PtThis = *<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].pPtGetCoastlinePointExtCRS(nCoastPoint);      <span class="comment">// In external CRS</span></div>
<div class="line"><a id="l02103" name="l02103"></a><span class="lineno"> 2103</span>         <a class="code hl_class" href="../../d5/d4e/classCGeom2DPoint.html">CGeom2DPoint</a> PtAfter = *<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].pPtGetCoastlinePointExtCRS(nCoastPoint + 1); <span class="comment">// In external CRS</span></div>
<div class="line"><a id="l02104" name="l02104"></a><span class="lineno"> 2104</span> </div>
<div class="line"><a id="l02105" name="l02105"></a><span class="lineno"> 2105</span>         dXDiff = PtAfter.<a class="code hl_function" href="../../d5/d4e/classCGeom2DPoint.html#a250f937d03cfdf6e0244b74ad2bf96a4">dGetX</a>() - PtThis.<a class="code hl_function" href="../../d5/d4e/classCGeom2DPoint.html#a250f937d03cfdf6e0244b74ad2bf96a4">dGetX</a>();</div>
<div class="line"><a id="l02106" name="l02106"></a><span class="lineno"> 2106</span>         dYDiff = PtAfter.<a class="code hl_function" href="../../d5/d4e/classCGeom2DPoint.html#a216921dc2c592d9468e6430fee7c7719">dGetY</a>() - PtThis.<a class="code hl_function" href="../../d5/d4e/classCGeom2DPoint.html#a216921dc2c592d9468e6430fee7c7719">dGetY</a>();</div>
<div class="line"><a id="l02107" name="l02107"></a><span class="lineno"> 2107</span>      }</div>
<div class="line"><a id="l02108" name="l02108"></a><span class="lineno"> 2108</span>      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (nCoastPoint == nCoastSize - 1)</div>
<div class="line"><a id="l02109" name="l02109"></a><span class="lineno"> 2109</span>      {</div>
<div class="line"><a id="l02110" name="l02110"></a><span class="lineno"> 2110</span>         <span class="comment">// For the point at the end of the coastline: use the straight line from the point before to &#39;this&#39; point</span></div>
<div class="line"><a id="l02111" name="l02111"></a><span class="lineno"> 2111</span>         <a class="code hl_class" href="../../d5/d4e/classCGeom2DPoint.html">CGeom2DPoint</a> PtBefore = *<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].pPtGetCoastlinePointExtCRS(nCoastPoint - 1); <span class="comment">// In external CRS</span></div>
<div class="line"><a id="l02112" name="l02112"></a><span class="lineno"> 2112</span>         <a class="code hl_class" href="../../d5/d4e/classCGeom2DPoint.html">CGeom2DPoint</a> PtThis = *<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].pPtGetCoastlinePointExtCRS(nCoastPoint);       <span class="comment">// In external CRS</span></div>
<div class="line"><a id="l02113" name="l02113"></a><span class="lineno"> 2113</span> </div>
<div class="line"><a id="l02114" name="l02114"></a><span class="lineno"> 2114</span>         dXDiff = PtThis.<a class="code hl_function" href="../../d5/d4e/classCGeom2DPoint.html#a250f937d03cfdf6e0244b74ad2bf96a4">dGetX</a>() - PtBefore.<a class="code hl_function" href="../../d5/d4e/classCGeom2DPoint.html#a250f937d03cfdf6e0244b74ad2bf96a4">dGetX</a>();</div>
<div class="line"><a id="l02115" name="l02115"></a><span class="lineno"> 2115</span>         dYDiff = PtThis.<a class="code hl_function" href="../../d5/d4e/classCGeom2DPoint.html#a216921dc2c592d9468e6430fee7c7719">dGetY</a>() - PtBefore.<a class="code hl_function" href="../../d5/d4e/classCGeom2DPoint.html#a216921dc2c592d9468e6430fee7c7719">dGetY</a>();</div>
<div class="line"><a id="l02116" name="l02116"></a><span class="lineno"> 2116</span>      }</div>
<div class="line"><a id="l02117" name="l02117"></a><span class="lineno"> 2117</span>      <span class="keywordflow">else</span></div>
<div class="line"><a id="l02118" name="l02118"></a><span class="lineno"> 2118</span>      {</div>
<div class="line"><a id="l02119" name="l02119"></a><span class="lineno"> 2119</span>         <span class="comment">// For coastline points not at the start or end of the coast: start with a straight line which links the coastline points before and after &#39;this&#39; coastline point</span></div>
<div class="line"><a id="l02120" name="l02120"></a><span class="lineno"> 2120</span>         <a class="code hl_class" href="../../d5/d4e/classCGeom2DPoint.html">CGeom2DPoint</a> PtBefore = *<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].pPtGetCoastlinePointExtCRS(nCoastPoint - 1); <span class="comment">// In external CRS</span></div>
<div class="line"><a id="l02121" name="l02121"></a><span class="lineno"> 2121</span>         <a class="code hl_class" href="../../d5/d4e/classCGeom2DPoint.html">CGeom2DPoint</a> PtAfter = *<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].pPtGetCoastlinePointExtCRS(nCoastPoint + 1);  <span class="comment">// In external CRS</span></div>
<div class="line"><a id="l02122" name="l02122"></a><span class="lineno"> 2122</span> </div>
<div class="line"><a id="l02123" name="l02123"></a><span class="lineno"> 2123</span>         dXDiff = PtAfter.<a class="code hl_function" href="../../d5/d4e/classCGeom2DPoint.html#a250f937d03cfdf6e0244b74ad2bf96a4">dGetX</a>() - PtBefore.<a class="code hl_function" href="../../d5/d4e/classCGeom2DPoint.html#a250f937d03cfdf6e0244b74ad2bf96a4">dGetX</a>();</div>
<div class="line"><a id="l02124" name="l02124"></a><span class="lineno"> 2124</span>         dYDiff = PtAfter.<a class="code hl_function" href="../../d5/d4e/classCGeom2DPoint.html#a216921dc2c592d9468e6430fee7c7719">dGetY</a>() - PtBefore.<a class="code hl_function" href="../../d5/d4e/classCGeom2DPoint.html#a216921dc2c592d9468e6430fee7c7719">dGetY</a>();</div>
<div class="line"><a id="l02125" name="l02125"></a><span class="lineno"> 2125</span>      }</div>
<div class="line"><a id="l02126" name="l02126"></a><span class="lineno"> 2126</span> </div>
<div class="line"><a id="l02127" name="l02127"></a><span class="lineno"> 2127</span>      <span class="comment">// Calculate angle between line and north point, measured clockwise (the azimuth)</span></div>
<div class="line"><a id="l02128" name="l02128"></a><span class="lineno"> 2128</span>      <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d6/d2a/cme_8h.html#a61afa8560a3b39c80657661a1d8f76ab">bFPIsEqual</a>(dYDiff, 0.0, <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a08b1623863ee3bd4300a8892de323722">TOLERANCE</a>))</div>
<div class="line"><a id="l02129" name="l02129"></a><span class="lineno"> 2129</span>      {</div>
<div class="line"><a id="l02130" name="l02130"></a><span class="lineno"> 2130</span>         <span class="comment">// The linking line runs either W-E or E-W</span></div>
<div class="line"><a id="l02131" name="l02131"></a><span class="lineno"> 2131</span>         <span class="keywordflow">if</span> (dXDiff &gt; 0)</div>
<div class="line"><a id="l02132" name="l02132"></a><span class="lineno"> 2132</span>            <span class="comment">// It runs W to E</span></div>
<div class="line"><a id="l02133" name="l02133"></a><span class="lineno"> 2133</span>            <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].SetFluxOrientation(nCoastPoint, 90);</div>
<div class="line"><a id="l02134" name="l02134"></a><span class="lineno"> 2134</span>         <span class="keywordflow">else</span></div>
<div class="line"><a id="l02135" name="l02135"></a><span class="lineno"> 2135</span>            <span class="comment">// It runs E to W</span></div>
<div class="line"><a id="l02136" name="l02136"></a><span class="lineno"> 2136</span>            <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].SetFluxOrientation(nCoastPoint, 270);</div>
<div class="line"><a id="l02137" name="l02137"></a><span class="lineno"> 2137</span>      }</div>
<div class="line"><a id="l02138" name="l02138"></a><span class="lineno"> 2138</span>      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d6/d2a/cme_8h.html#a61afa8560a3b39c80657661a1d8f76ab">bFPIsEqual</a>(dXDiff, 0.0, <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a08b1623863ee3bd4300a8892de323722">TOLERANCE</a>))</div>
<div class="line"><a id="l02139" name="l02139"></a><span class="lineno"> 2139</span>      {</div>
<div class="line"><a id="l02140" name="l02140"></a><span class="lineno"> 2140</span>         <span class="comment">// The linking line runs N-S or S-N</span></div>
<div class="line"><a id="l02141" name="l02141"></a><span class="lineno"> 2141</span>         <span class="keywordflow">if</span> (dYDiff &gt; 0)</div>
<div class="line"><a id="l02142" name="l02142"></a><span class="lineno"> 2142</span>            <span class="comment">// It runs S to N</span></div>
<div class="line"><a id="l02143" name="l02143"></a><span class="lineno"> 2143</span>            <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].SetFluxOrientation(nCoastPoint, 0);</div>
<div class="line"><a id="l02144" name="l02144"></a><span class="lineno"> 2144</span>         <span class="keywordflow">else</span></div>
<div class="line"><a id="l02145" name="l02145"></a><span class="lineno"> 2145</span>            <span class="comment">// It runs N to S</span></div>
<div class="line"><a id="l02146" name="l02146"></a><span class="lineno"> 2146</span>            <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].SetFluxOrientation(nCoastPoint, 180);</div>
<div class="line"><a id="l02147" name="l02147"></a><span class="lineno"> 2147</span>      }</div>
<div class="line"><a id="l02148" name="l02148"></a><span class="lineno"> 2148</span>      <span class="keywordflow">else</span></div>
<div class="line"><a id="l02149" name="l02149"></a><span class="lineno"> 2149</span>      {</div>
<div class="line"><a id="l02150" name="l02150"></a><span class="lineno"> 2150</span>         <span class="comment">// The linking line runs neither W-E nor N-S so we have to work a bit harder to find the angle between it and the azimuth</span></div>
<div class="line"><a id="l02151" name="l02151"></a><span class="lineno"> 2151</span>         <span class="keywordtype">double</span> dAzimuthAngle;</div>
<div class="line"><a id="l02152" name="l02152"></a><span class="lineno"> 2152</span>         <span class="keywordflow">if</span> (dXDiff &gt; 0)</div>
<div class="line"><a id="l02153" name="l02153"></a><span class="lineno"> 2153</span>            dAzimuthAngle = (180 / <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a5d502a06fdd71825be49e07c95496b16">PI</a>) * (<a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a5d502a06fdd71825be49e07c95496b16">PI</a> * 0.5 - atan(dYDiff / dXDiff));</div>
<div class="line"><a id="l02154" name="l02154"></a><span class="lineno"> 2154</span>         <span class="keywordflow">else</span></div>
<div class="line"><a id="l02155" name="l02155"></a><span class="lineno"> 2155</span>            dAzimuthAngle = (180 / <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a5d502a06fdd71825be49e07c95496b16">PI</a>) * (<a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a5d502a06fdd71825be49e07c95496b16">PI</a> * 1.5 - atan(dYDiff / dXDiff));</div>
<div class="line"><a id="l02156" name="l02156"></a><span class="lineno"> 2156</span> </div>
<div class="line"><a id="l02157" name="l02157"></a><span class="lineno"> 2157</span>         <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].SetFluxOrientation(nCoastPoint, dAzimuthAngle);</div>
<div class="line"><a id="l02158" name="l02158"></a><span class="lineno"> 2158</span>      }</div>
<div class="line"><a id="l02159" name="l02159"></a><span class="lineno"> 2159</span> </div>
<div class="line"><a id="l02160" name="l02160"></a><span class="lineno"> 2160</span>      <span class="comment">//      LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: nCoastPoint = &quot; &lt;&lt; nCoastPoint &lt;&lt; &quot; FluxOrientation = &quot; &lt;&lt; m_VCoast[nCoast].dGetFluxOrientation(nCoastPoint) &lt;&lt; endl;</span></div>
<div class="line"><a id="l02161" name="l02161"></a><span class="lineno"> 2161</span>   }</div>
<div class="line"><a id="l02162" name="l02162"></a><span class="lineno"> 2162</span>}</div>
</div>
<div class="line"><a id="l02163" name="l02163"></a><span class="lineno"> 2163</span> </div>
<div class="line"><a id="l02164" name="l02164"></a><span class="lineno"> 2164</span><span class="comment">//===============================================================================================================================</span></div>
<div class="line"><a id="l02166" name="l02166"></a><span class="lineno"> 2166</span><span class="comment">//===============================================================================================================================</span></div>
<div class="foldopen" id="foldopen02167" data-start="{" data-end="}">
<div class="line"><a id="l02167" name="l02167"></a><span class="lineno"><a class="line" href="../../d1/d98/classCSimulation.html#a7e6ba198fd9083eca4c5985c5fd564df"> 2167</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../d1/d98/classCSimulation.html#a7e6ba198fd9083eca4c5985c5fd564df">CSimulation::CalcD50AndFillWaveCalcHoles</a>(<span class="keywordtype">void</span>)</div>
<div class="line"><a id="l02168" name="l02168"></a><span class="lineno"> 2168</span>{</div>
<div class="line"><a id="l02169" name="l02169"></a><span class="lineno"> 2169</span>   vector&lt;int&gt; VnPolygonD50Count(<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#ad89a4ca2ea821f9853becbbce8af52b7">m_nNumPolygonGlobal</a> + 1, 0);      <span class="comment">// TODO 044</span></div>
<div class="line"><a id="l02170" name="l02170"></a><span class="lineno"> 2170</span>   vector&lt;double&gt; VdPolygonD50(<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#ad89a4ca2ea821f9853becbbce8af52b7">m_nNumPolygonGlobal</a> + 1, 0);        <span class="comment">// TODO 044</span></div>
<div class="line"><a id="l02171" name="l02171"></a><span class="lineno"> 2171</span> </div>
<div class="line"><a id="l02172" name="l02172"></a><span class="lineno"> 2172</span>   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> nX = 0; nX &lt; <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1652253500dab35e6f6f9f734207e20b">m_nXGridSize</a>; nX++)</div>
<div class="line"><a id="l02173" name="l02173"></a><span class="lineno"> 2173</span>   {</div>
<div class="line"><a id="l02174" name="l02174"></a><span class="lineno"> 2174</span>      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> nY = 0; nY &lt; <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a3755fdc07c0ac9f2ce6c2237cfef50ce">m_nYGridSize</a>; nY++)</div>
<div class="line"><a id="l02175" name="l02175"></a><span class="lineno"> 2175</span>      {</div>
<div class="line"><a id="l02176" name="l02176"></a><span class="lineno"> 2176</span>         <span class="keywordflow">if</span> (<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nX][nY].bIsInContiguousSea())</div>
<div class="line"><a id="l02177" name="l02177"></a><span class="lineno"> 2177</span>         {</div>
<div class="line"><a id="l02178" name="l02178"></a><span class="lineno"> 2178</span>            <span class="comment">// This is a sea cell, first get polygon ID</span></div>
<div class="line"><a id="l02179" name="l02179"></a><span class="lineno"> 2179</span>            <span class="keywordtype">int</span> nID = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nX][nY].nGetPolygonID();</div>
<div class="line"><a id="l02180" name="l02180"></a><span class="lineno"> 2180</span> </div>
<div class="line"><a id="l02181" name="l02181"></a><span class="lineno"> 2181</span>            <span class="comment">// Is it in the active zone?</span></div>
<div class="line"><a id="l02182" name="l02182"></a><span class="lineno"> 2182</span>            <span class="keywordtype">bool</span> bActive = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nX][nY].bIsInActiveZone();</div>
<div class="line"><a id="l02183" name="l02183"></a><span class="lineno"> 2183</span> </div>
<div class="line"><a id="l02184" name="l02184"></a><span class="lineno"> 2184</span>            <span class="keywordflow">if</span> (bActive)</div>
<div class="line"><a id="l02185" name="l02185"></a><span class="lineno"> 2185</span>            {</div>
<div class="line"><a id="l02186" name="l02186"></a><span class="lineno"> 2186</span>               <span class="comment">// It is in the active zone. Does it have unconsolidated sediment on it? Test this using the UnconD50 value: if dGetUnconsD50() returns DBL_NODATA, there is no unconsolidated sediment</span></div>
<div class="line"><a id="l02187" name="l02187"></a><span class="lineno"> 2187</span>               <span class="keywordtype">double</span> dTmpd50 = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nX][nY].dGetUnconsD50();</div>
<div class="line"><a id="l02188" name="l02188"></a><span class="lineno"> 2188</span>               <span class="keywordflow">if</span> (! <a class="code hl_function" href="../../d6/d2a/cme_8h.html#a61afa8560a3b39c80657661a1d8f76ab">bFPIsEqual</a>(dTmpd50, <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#ac003bdff958dca839f5d274f15786e07">DBL_NODATA</a>, <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a08b1623863ee3bd4300a8892de323722">TOLERANCE</a>))</div>
<div class="line"><a id="l02189" name="l02189"></a><span class="lineno"> 2189</span>               {</div>
<div class="line"><a id="l02190" name="l02190"></a><span class="lineno"> 2190</span>                  <span class="comment">// It does have unconsolidated sediment, so which polygon is this cell in?</span></div>
<div class="line"><a id="l02191" name="l02191"></a><span class="lineno"> 2191</span>                  <span class="keywordflow">if</span> (nID != <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a01aa8b423260b337ddff2016107b51a0">INT_NODATA</a>)</div>
<div class="line"><a id="l02192" name="l02192"></a><span class="lineno"> 2192</span>                  {</div>
<div class="line"><a id="l02193" name="l02193"></a><span class="lineno"> 2193</span>                     VnPolygonD50Count[nID]++;</div>
<div class="line"><a id="l02194" name="l02194"></a><span class="lineno"> 2194</span>                     VdPolygonD50[nID] += dTmpd50;</div>
<div class="line"><a id="l02195" name="l02195"></a><span class="lineno"> 2195</span>                  }</div>
<div class="line"><a id="l02196" name="l02196"></a><span class="lineno"> 2196</span>               }</div>
<div class="line"><a id="l02197" name="l02197"></a><span class="lineno"> 2197</span>            }</div>
<div class="line"><a id="l02198" name="l02198"></a><span class="lineno"> 2198</span> </div>
<div class="line"><a id="l02199" name="l02199"></a><span class="lineno"> 2199</span>            <span class="comment">//             // Now fill in wave calc holes</span></div>
<div class="line"><a id="l02200" name="l02200"></a><span class="lineno"> 2200</span>            <span class="comment">//             if (m_pRasterGrid-&gt;m_Cell[nX][nY].dGetWaveHeight() == 0)</span></div>
<div class="line"><a id="l02201" name="l02201"></a><span class="lineno"> 2201</span>            <span class="comment">//             {</span></div>
<div class="line"><a id="l02202" name="l02202"></a><span class="lineno"> 2202</span>            <span class="comment">//                if (nID == INT_NODATA)</span></div>
<div class="line"><a id="l02203" name="l02203"></a><span class="lineno"> 2203</span>            <span class="comment">//                   m_pRasterGrid-&gt;m_Cell[nX][nY].SetWaveHeight(m_dAllCellsDeepWaterWaveHeight);</span></div>
<div class="line"><a id="l02204" name="l02204"></a><span class="lineno"> 2204</span>            <span class="comment">//             }</span></div>
<div class="line"><a id="l02205" name="l02205"></a><span class="lineno"> 2205</span>            <span class="comment">//</span></div>
<div class="line"><a id="l02206" name="l02206"></a><span class="lineno"> 2206</span>            <span class="comment">//             if (m_pRasterGrid-&gt;m_Cell[nX][nY].dGetWaveAngle() == 0)</span></div>
<div class="line"><a id="l02207" name="l02207"></a><span class="lineno"> 2207</span>            <span class="comment">//             {</span></div>
<div class="line"><a id="l02208" name="l02208"></a><span class="lineno"> 2208</span>            <span class="comment">//                if (nID == INT_NODATA)</span></div>
<div class="line"><a id="l02209" name="l02209"></a><span class="lineno"> 2209</span>            <span class="comment">//                   m_pRasterGrid-&gt;m_Cell[nX][nY].SetWaveAngle(m_dAllCellsDeepWaterWaveAngle);</span></div>
<div class="line"><a id="l02210" name="l02210"></a><span class="lineno"> 2210</span>            <span class="comment">//             }</span></div>
<div class="line"><a id="l02211" name="l02211"></a><span class="lineno"> 2211</span> </div>
<div class="line"><a id="l02212" name="l02212"></a><span class="lineno"> 2212</span>            <span class="comment">// Next look at the cell&#39;s N-S and W-E neighbours</span></div>
<div class="line"><a id="l02213" name="l02213"></a><span class="lineno"> 2213</span>            <span class="keywordtype">int</span> nXTmp;</div>
<div class="line"><a id="l02214" name="l02214"></a><span class="lineno"> 2214</span>            <span class="keywordtype">int</span> nYTmp;</div>
<div class="line"><a id="l02215" name="l02215"></a><span class="lineno"> 2215</span>            <span class="keywordtype">int</span> nActive = 0;</div>
<div class="line"><a id="l02216" name="l02216"></a><span class="lineno"> 2216</span>            <span class="keywordtype">int</span> nShadow = 0;</div>
<div class="line"><a id="l02217" name="l02217"></a><span class="lineno"> 2217</span>            <span class="keywordtype">int</span> nShadowNum = 0;</div>
<div class="line"><a id="l02218" name="l02218"></a><span class="lineno"> 2218</span>            <span class="keywordtype">int</span> nDownDrift = 0;</div>
<div class="line"><a id="l02219" name="l02219"></a><span class="lineno"> 2219</span>            <span class="keywordtype">int</span> nDownDriftNum = 0;</div>
<div class="line"><a id="l02220" name="l02220"></a><span class="lineno"> 2220</span>            <span class="keywordtype">int</span> nCoast = 0;</div>
<div class="line"><a id="l02221" name="l02221"></a><span class="lineno"> 2221</span>            <span class="keywordtype">int</span> nRead = 0;</div>
<div class="line"><a id="l02222" name="l02222"></a><span class="lineno"> 2222</span>            <span class="keywordtype">double</span> dWaveHeight = 0;</div>
<div class="line"><a id="l02223" name="l02223"></a><span class="lineno"> 2223</span>            <span class="keywordtype">double</span> dWaveAngle = 0;</div>
<div class="line"><a id="l02224" name="l02224"></a><span class="lineno"> 2224</span> </div>
<div class="line"><a id="l02225" name="l02225"></a><span class="lineno"> 2225</span>            <span class="comment">// North</span></div>
<div class="line"><a id="l02226" name="l02226"></a><span class="lineno"> 2226</span>            nXTmp = nX;</div>
<div class="line"><a id="l02227" name="l02227"></a><span class="lineno"> 2227</span>            nYTmp = nY - 1;</div>
<div class="line"><a id="l02228" name="l02228"></a><span class="lineno"> 2228</span>            <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d1/d98/classCSimulation.html#ac900a5701df97da22278fae928951f50">bIsWithinValidGrid</a>(nXTmp, nYTmp))</div>
<div class="line"><a id="l02229" name="l02229"></a><span class="lineno"> 2229</span>            {</div>
<div class="line"><a id="l02230" name="l02230"></a><span class="lineno"> 2230</span>               <span class="keywordflow">if</span> (<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nXTmp][nYTmp].bIsInContiguousSea())</div>
<div class="line"><a id="l02231" name="l02231"></a><span class="lineno"> 2231</span>               {</div>
<div class="line"><a id="l02232" name="l02232"></a><span class="lineno"> 2232</span>                  nRead++;</div>
<div class="line"><a id="l02233" name="l02233"></a><span class="lineno"> 2233</span>                  dWaveHeight += <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nXTmp][nYTmp].dGetWaveHeight();</div>
<div class="line"><a id="l02234" name="l02234"></a><span class="lineno"> 2234</span>                  dWaveAngle += (<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nXTmp][nYTmp].dGetWaveAngle());</div>
<div class="line"><a id="l02235" name="l02235"></a><span class="lineno"> 2235</span> </div>
<div class="line"><a id="l02236" name="l02236"></a><span class="lineno"> 2236</span>                  <span class="keywordflow">if</span> (<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nXTmp][nYTmp].bIsInActiveZone())</div>
<div class="line"><a id="l02237" name="l02237"></a><span class="lineno"> 2237</span>                     nActive++;</div>
<div class="line"><a id="l02238" name="l02238"></a><span class="lineno"> 2238</span> </div>
<div class="line"><a id="l02239" name="l02239"></a><span class="lineno"> 2239</span>                  <span class="keywordtype">int</span> nTmp = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nXTmp][nYTmp].nGetShadowZoneNumber();</div>
<div class="line"><a id="l02240" name="l02240"></a><span class="lineno"> 2240</span>                  <span class="keywordflow">if</span> (nTmp != 0)</div>
<div class="line"><a id="l02241" name="l02241"></a><span class="lineno"> 2241</span>                  {</div>
<div class="line"><a id="l02242" name="l02242"></a><span class="lineno"> 2242</span>                     nShadow++;</div>
<div class="line"><a id="l02243" name="l02243"></a><span class="lineno"> 2243</span>                     nShadowNum = nTmp;</div>
<div class="line"><a id="l02244" name="l02244"></a><span class="lineno"> 2244</span>                  }</div>
<div class="line"><a id="l02245" name="l02245"></a><span class="lineno"> 2245</span> </div>
<div class="line"><a id="l02246" name="l02246"></a><span class="lineno"> 2246</span>                  nTmp = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nXTmp][nYTmp].nGetDownDriftZoneNumber();</div>
<div class="line"><a id="l02247" name="l02247"></a><span class="lineno"> 2247</span>                  <span class="keywordflow">if</span> (nTmp &gt; 0)</div>
<div class="line"><a id="l02248" name="l02248"></a><span class="lineno"> 2248</span>                  {</div>
<div class="line"><a id="l02249" name="l02249"></a><span class="lineno"> 2249</span>                     nDownDrift++;</div>
<div class="line"><a id="l02250" name="l02250"></a><span class="lineno"> 2250</span>                     nDownDriftNum = nTmp;</div>
<div class="line"><a id="l02251" name="l02251"></a><span class="lineno"> 2251</span>                  }</div>
<div class="line"><a id="l02252" name="l02252"></a><span class="lineno"> 2252</span>               }</div>
<div class="line"><a id="l02253" name="l02253"></a><span class="lineno"> 2253</span>               <span class="keywordflow">else</span></div>
<div class="line"><a id="l02254" name="l02254"></a><span class="lineno"> 2254</span>                  nCoast++;</div>
<div class="line"><a id="l02255" name="l02255"></a><span class="lineno"> 2255</span>            }</div>
<div class="line"><a id="l02256" name="l02256"></a><span class="lineno"> 2256</span> </div>
<div class="line"><a id="l02257" name="l02257"></a><span class="lineno"> 2257</span>            <span class="comment">// East</span></div>
<div class="line"><a id="l02258" name="l02258"></a><span class="lineno"> 2258</span>            nXTmp = nX + 1;</div>
<div class="line"><a id="l02259" name="l02259"></a><span class="lineno"> 2259</span>            nYTmp = nY;</div>
<div class="line"><a id="l02260" name="l02260"></a><span class="lineno"> 2260</span>            <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d1/d98/classCSimulation.html#ac900a5701df97da22278fae928951f50">bIsWithinValidGrid</a>(nXTmp, nYTmp))</div>
<div class="line"><a id="l02261" name="l02261"></a><span class="lineno"> 2261</span>            {</div>
<div class="line"><a id="l02262" name="l02262"></a><span class="lineno"> 2262</span>               <span class="keywordflow">if</span> (<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nXTmp][nYTmp].bIsInContiguousSea())</div>
<div class="line"><a id="l02263" name="l02263"></a><span class="lineno"> 2263</span>               {</div>
<div class="line"><a id="l02264" name="l02264"></a><span class="lineno"> 2264</span>                  nRead++;</div>
<div class="line"><a id="l02265" name="l02265"></a><span class="lineno"> 2265</span>                  dWaveHeight += <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nXTmp][nYTmp].dGetWaveHeight();</div>
<div class="line"><a id="l02266" name="l02266"></a><span class="lineno"> 2266</span>                  dWaveAngle += (<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nXTmp][nYTmp].dGetWaveAngle());</div>
<div class="line"><a id="l02267" name="l02267"></a><span class="lineno"> 2267</span> </div>
<div class="line"><a id="l02268" name="l02268"></a><span class="lineno"> 2268</span>                  <span class="keywordflow">if</span> (<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nXTmp][nYTmp].bIsInActiveZone())</div>
<div class="line"><a id="l02269" name="l02269"></a><span class="lineno"> 2269</span>                     nActive++;</div>
<div class="line"><a id="l02270" name="l02270"></a><span class="lineno"> 2270</span> </div>
<div class="line"><a id="l02271" name="l02271"></a><span class="lineno"> 2271</span>                  <span class="keywordtype">int</span> nTmp = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nXTmp][nYTmp].nGetShadowZoneNumber();</div>
<div class="line"><a id="l02272" name="l02272"></a><span class="lineno"> 2272</span>                  <span class="keywordflow">if</span> (nTmp != 0)</div>
<div class="line"><a id="l02273" name="l02273"></a><span class="lineno"> 2273</span>                  {</div>
<div class="line"><a id="l02274" name="l02274"></a><span class="lineno"> 2274</span>                     nShadow++;</div>
<div class="line"><a id="l02275" name="l02275"></a><span class="lineno"> 2275</span>                     nShadowNum = nTmp;</div>
<div class="line"><a id="l02276" name="l02276"></a><span class="lineno"> 2276</span>                  }</div>
<div class="line"><a id="l02277" name="l02277"></a><span class="lineno"> 2277</span> </div>
<div class="line"><a id="l02278" name="l02278"></a><span class="lineno"> 2278</span>                  nTmp = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nXTmp][nYTmp].nGetDownDriftZoneNumber();</div>
<div class="line"><a id="l02279" name="l02279"></a><span class="lineno"> 2279</span>                  <span class="keywordflow">if</span> (nTmp &gt; 0)</div>
<div class="line"><a id="l02280" name="l02280"></a><span class="lineno"> 2280</span>                  {</div>
<div class="line"><a id="l02281" name="l02281"></a><span class="lineno"> 2281</span>                     nDownDrift++;</div>
<div class="line"><a id="l02282" name="l02282"></a><span class="lineno"> 2282</span>                     nDownDriftNum = nTmp;</div>
<div class="line"><a id="l02283" name="l02283"></a><span class="lineno"> 2283</span>                  }</div>
<div class="line"><a id="l02284" name="l02284"></a><span class="lineno"> 2284</span>               }</div>
<div class="line"><a id="l02285" name="l02285"></a><span class="lineno"> 2285</span>               <span class="keywordflow">else</span></div>
<div class="line"><a id="l02286" name="l02286"></a><span class="lineno"> 2286</span>                  nCoast++;</div>
<div class="line"><a id="l02287" name="l02287"></a><span class="lineno"> 2287</span>            }</div>
<div class="line"><a id="l02288" name="l02288"></a><span class="lineno"> 2288</span> </div>
<div class="line"><a id="l02289" name="l02289"></a><span class="lineno"> 2289</span>            <span class="comment">// South</span></div>
<div class="line"><a id="l02290" name="l02290"></a><span class="lineno"> 2290</span>            nXTmp = nX;</div>
<div class="line"><a id="l02291" name="l02291"></a><span class="lineno"> 2291</span>            nYTmp = nY + 1;</div>
<div class="line"><a id="l02292" name="l02292"></a><span class="lineno"> 2292</span>            <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d1/d98/classCSimulation.html#ac900a5701df97da22278fae928951f50">bIsWithinValidGrid</a>(nXTmp, nYTmp))</div>
<div class="line"><a id="l02293" name="l02293"></a><span class="lineno"> 2293</span>            {</div>
<div class="line"><a id="l02294" name="l02294"></a><span class="lineno"> 2294</span>               <span class="keywordflow">if</span> (<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nXTmp][nYTmp].bIsInContiguousSea())</div>
<div class="line"><a id="l02295" name="l02295"></a><span class="lineno"> 2295</span>               {</div>
<div class="line"><a id="l02296" name="l02296"></a><span class="lineno"> 2296</span>                  nRead++;</div>
<div class="line"><a id="l02297" name="l02297"></a><span class="lineno"> 2297</span>                  dWaveHeight += <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nXTmp][nYTmp].dGetWaveHeight();</div>
<div class="line"><a id="l02298" name="l02298"></a><span class="lineno"> 2298</span>                  dWaveAngle += (<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nXTmp][nYTmp].dGetWaveAngle());</div>
<div class="line"><a id="l02299" name="l02299"></a><span class="lineno"> 2299</span> </div>
<div class="line"><a id="l02300" name="l02300"></a><span class="lineno"> 2300</span>                  <span class="keywordflow">if</span> (<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nXTmp][nYTmp].bIsInActiveZone())</div>
<div class="line"><a id="l02301" name="l02301"></a><span class="lineno"> 2301</span>                     nActive++;</div>
<div class="line"><a id="l02302" name="l02302"></a><span class="lineno"> 2302</span> </div>
<div class="line"><a id="l02303" name="l02303"></a><span class="lineno"> 2303</span>                  <span class="keywordtype">int</span> nTmp = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nXTmp][nYTmp].nGetShadowZoneNumber();</div>
<div class="line"><a id="l02304" name="l02304"></a><span class="lineno"> 2304</span>                  <span class="keywordflow">if</span> (nTmp != 0)</div>
<div class="line"><a id="l02305" name="l02305"></a><span class="lineno"> 2305</span>                  {</div>
<div class="line"><a id="l02306" name="l02306"></a><span class="lineno"> 2306</span>                     nShadow++;</div>
<div class="line"><a id="l02307" name="l02307"></a><span class="lineno"> 2307</span>                     nShadowNum = nTmp;</div>
<div class="line"><a id="l02308" name="l02308"></a><span class="lineno"> 2308</span>                  }</div>
<div class="line"><a id="l02309" name="l02309"></a><span class="lineno"> 2309</span> </div>
<div class="line"><a id="l02310" name="l02310"></a><span class="lineno"> 2310</span>                  nTmp = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nXTmp][nYTmp].nGetDownDriftZoneNumber();</div>
<div class="line"><a id="l02311" name="l02311"></a><span class="lineno"> 2311</span>                  <span class="keywordflow">if</span> (nTmp &gt; 0)</div>
<div class="line"><a id="l02312" name="l02312"></a><span class="lineno"> 2312</span>                  {</div>
<div class="line"><a id="l02313" name="l02313"></a><span class="lineno"> 2313</span>                     nDownDrift++;</div>
<div class="line"><a id="l02314" name="l02314"></a><span class="lineno"> 2314</span>                     nDownDriftNum = nTmp;</div>
<div class="line"><a id="l02315" name="l02315"></a><span class="lineno"> 2315</span>                  }</div>
<div class="line"><a id="l02316" name="l02316"></a><span class="lineno"> 2316</span>               }</div>
<div class="line"><a id="l02317" name="l02317"></a><span class="lineno"> 2317</span>               <span class="keywordflow">else</span></div>
<div class="line"><a id="l02318" name="l02318"></a><span class="lineno"> 2318</span>                  nCoast++;</div>
<div class="line"><a id="l02319" name="l02319"></a><span class="lineno"> 2319</span>            }</div>
<div class="line"><a id="l02320" name="l02320"></a><span class="lineno"> 2320</span> </div>
<div class="line"><a id="l02321" name="l02321"></a><span class="lineno"> 2321</span>            <span class="comment">// West</span></div>
<div class="line"><a id="l02322" name="l02322"></a><span class="lineno"> 2322</span>            nXTmp = nX - 1;</div>
<div class="line"><a id="l02323" name="l02323"></a><span class="lineno"> 2323</span>            nYTmp = nY;</div>
<div class="line"><a id="l02324" name="l02324"></a><span class="lineno"> 2324</span>            <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d1/d98/classCSimulation.html#ac900a5701df97da22278fae928951f50">bIsWithinValidGrid</a>(nXTmp, nYTmp))</div>
<div class="line"><a id="l02325" name="l02325"></a><span class="lineno"> 2325</span>            {</div>
<div class="line"><a id="l02326" name="l02326"></a><span class="lineno"> 2326</span>               <span class="keywordflow">if</span> (<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nXTmp][nYTmp].bIsInContiguousSea())</div>
<div class="line"><a id="l02327" name="l02327"></a><span class="lineno"> 2327</span>               {</div>
<div class="line"><a id="l02328" name="l02328"></a><span class="lineno"> 2328</span>                  nRead++;</div>
<div class="line"><a id="l02329" name="l02329"></a><span class="lineno"> 2329</span>                  dWaveHeight += <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nXTmp][nYTmp].dGetWaveHeight();</div>
<div class="line"><a id="l02330" name="l02330"></a><span class="lineno"> 2330</span>                  dWaveAngle += (<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nXTmp][nYTmp].dGetWaveAngle());</div>
<div class="line"><a id="l02331" name="l02331"></a><span class="lineno"> 2331</span> </div>
<div class="line"><a id="l02332" name="l02332"></a><span class="lineno"> 2332</span>                  <span class="keywordflow">if</span> (<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nXTmp][nYTmp].bIsInActiveZone())</div>
<div class="line"><a id="l02333" name="l02333"></a><span class="lineno"> 2333</span>                     nActive++;</div>
<div class="line"><a id="l02334" name="l02334"></a><span class="lineno"> 2334</span> </div>
<div class="line"><a id="l02335" name="l02335"></a><span class="lineno"> 2335</span>                  <span class="keywordtype">int</span> nTmp = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nXTmp][nYTmp].nGetShadowZoneNumber();</div>
<div class="line"><a id="l02336" name="l02336"></a><span class="lineno"> 2336</span>                  <span class="keywordflow">if</span> (nTmp != 0)</div>
<div class="line"><a id="l02337" name="l02337"></a><span class="lineno"> 2337</span>                  {</div>
<div class="line"><a id="l02338" name="l02338"></a><span class="lineno"> 2338</span>                     nShadow++;</div>
<div class="line"><a id="l02339" name="l02339"></a><span class="lineno"> 2339</span>                     nShadowNum = nTmp;</div>
<div class="line"><a id="l02340" name="l02340"></a><span class="lineno"> 2340</span>                  }</div>
<div class="line"><a id="l02341" name="l02341"></a><span class="lineno"> 2341</span> </div>
<div class="line"><a id="l02342" name="l02342"></a><span class="lineno"> 2342</span>                  nTmp = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nXTmp][nYTmp].nGetDownDriftZoneNumber();</div>
<div class="line"><a id="l02343" name="l02343"></a><span class="lineno"> 2343</span>                  <span class="keywordflow">if</span> (nTmp &gt; 0)</div>
<div class="line"><a id="l02344" name="l02344"></a><span class="lineno"> 2344</span>                  {</div>
<div class="line"><a id="l02345" name="l02345"></a><span class="lineno"> 2345</span>                     nDownDrift++;</div>
<div class="line"><a id="l02346" name="l02346"></a><span class="lineno"> 2346</span>                     nDownDriftNum = nTmp;</div>
<div class="line"><a id="l02347" name="l02347"></a><span class="lineno"> 2347</span>                  }</div>
<div class="line"><a id="l02348" name="l02348"></a><span class="lineno"> 2348</span>               }</div>
<div class="line"><a id="l02349" name="l02349"></a><span class="lineno"> 2349</span>               <span class="keywordflow">else</span></div>
<div class="line"><a id="l02350" name="l02350"></a><span class="lineno"> 2350</span>                  nCoast++;</div>
<div class="line"><a id="l02351" name="l02351"></a><span class="lineno"> 2351</span>            }</div>
<div class="line"><a id="l02352" name="l02352"></a><span class="lineno"> 2352</span> </div>
<div class="line"><a id="l02353" name="l02353"></a><span class="lineno"> 2353</span>            <span class="keywordflow">if</span> (nRead &gt; 0)</div>
<div class="line"><a id="l02354" name="l02354"></a><span class="lineno"> 2354</span>            {</div>
<div class="line"><a id="l02355" name="l02355"></a><span class="lineno"> 2355</span>               <span class="comment">// Calculate the average of neighbours</span></div>
<div class="line"><a id="l02356" name="l02356"></a><span class="lineno"> 2356</span>               dWaveHeight /= nRead;</div>
<div class="line"><a id="l02357" name="l02357"></a><span class="lineno"> 2357</span>               dWaveAngle /= nRead;</div>
<div class="line"><a id="l02358" name="l02358"></a><span class="lineno"> 2358</span>               dWaveAngle = <a class="code hl_function" href="../../d1/d98/classCSimulation.html#a425803ba4110668094dba54c0f9b91c8">dKeepWithin360</a>(dWaveAngle);</div>
<div class="line"><a id="l02359" name="l02359"></a><span class="lineno"> 2359</span> </div>
<div class="line"><a id="l02360" name="l02360"></a><span class="lineno"> 2360</span>               <span class="comment">// If this sea cell has four active-zone neighbours, then it must also be in the active zone: give it wave height and orientation which is the average of its neighbours</span></div>
<div class="line"><a id="l02361" name="l02361"></a><span class="lineno"> 2361</span>               <span class="keywordflow">if</span> (nActive == 4)</div>
<div class="line"><a id="l02362" name="l02362"></a><span class="lineno"> 2362</span>               {</div>
<div class="line"><a id="l02363" name="l02363"></a><span class="lineno"> 2363</span>                  <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nX][nY].SetInActiveZone(<span class="keyword">true</span>);</div>
<div class="line"><a id="l02364" name="l02364"></a><span class="lineno"> 2364</span>                  <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nX][nY].SetWaveHeight(dWaveHeight);</div>
<div class="line"><a id="l02365" name="l02365"></a><span class="lineno"> 2365</span>                  <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nX][nY].SetWaveAngle(dWaveAngle);</div>
<div class="line"><a id="l02366" name="l02366"></a><span class="lineno"> 2366</span>               }</div>
<div class="line"><a id="l02367" name="l02367"></a><span class="lineno"> 2367</span> </div>
<div class="line"><a id="l02368" name="l02368"></a><span class="lineno"> 2368</span>               <span class="comment">// If this sea cell has a wave height which is the same as its deep-water wave height, but its neighbours have a different average wave height, then give it the average of its neighbours</span></div>
<div class="line"><a id="l02369" name="l02369"></a><span class="lineno"> 2369</span>               <span class="keywordtype">double</span> dDeepWaterWaveHeight = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nX][nY].dGetCellDeepWaterWaveHeight();</div>
<div class="line"><a id="l02370" name="l02370"></a><span class="lineno"> 2370</span>               <span class="keywordflow">if</span> ((<a class="code hl_function" href="../../d6/d2a/cme_8h.html#a61afa8560a3b39c80657661a1d8f76ab">bFPIsEqual</a>(<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nX][nY].dGetWaveHeight(), dDeepWaterWaveHeight, <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a08b1623863ee3bd4300a8892de323722">TOLERANCE</a>)) &amp;&amp; (! <a class="code hl_function" href="../../d6/d2a/cme_8h.html#a61afa8560a3b39c80657661a1d8f76ab">bFPIsEqual</a>(dDeepWaterWaveHeight, dWaveHeight, <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a08b1623863ee3bd4300a8892de323722">TOLERANCE</a>)))</div>
<div class="line"><a id="l02371" name="l02371"></a><span class="lineno"> 2371</span>               {</div>
<div class="line"><a id="l02372" name="l02372"></a><span class="lineno"> 2372</span>                  <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nX][nY].SetWaveHeight(dWaveHeight);</div>
<div class="line"><a id="l02373" name="l02373"></a><span class="lineno"> 2373</span>               }</div>
<div class="line"><a id="l02374" name="l02374"></a><span class="lineno"> 2374</span> </div>
<div class="line"><a id="l02375" name="l02375"></a><span class="lineno"> 2375</span>               <span class="comment">// If this sea cell has a wave orientation which is the same as its deep-water wave orientation, but its neighbours have a different average wave orientation, then give it the average of its neighbours</span></div>
<div class="line"><a id="l02376" name="l02376"></a><span class="lineno"> 2376</span>               <span class="keywordtype">double</span> dDeepWaterWaveAngle = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nX][nY].dGetCellDeepWaterWaveAngle();</div>
<div class="line"><a id="l02377" name="l02377"></a><span class="lineno"> 2377</span>               <span class="keywordflow">if</span> ((<a class="code hl_function" href="../../d6/d2a/cme_8h.html#a61afa8560a3b39c80657661a1d8f76ab">bFPIsEqual</a>(<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nX][nY].dGetWaveAngle(), dDeepWaterWaveAngle, <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a08b1623863ee3bd4300a8892de323722">TOLERANCE</a>)) &amp;&amp; (! <a class="code hl_function" href="../../d6/d2a/cme_8h.html#a61afa8560a3b39c80657661a1d8f76ab">bFPIsEqual</a>(dDeepWaterWaveAngle, dWaveAngle, <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a08b1623863ee3bd4300a8892de323722">TOLERANCE</a>)))</div>
<div class="line"><a id="l02378" name="l02378"></a><span class="lineno"> 2378</span>               {</div>
<div class="line"><a id="l02379" name="l02379"></a><span class="lineno"> 2379</span>                  <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nX][nY].SetWaveAngle(dWaveAngle);</div>
<div class="line"><a id="l02380" name="l02380"></a><span class="lineno"> 2380</span>               }</div>
<div class="line"><a id="l02381" name="l02381"></a><span class="lineno"> 2381</span> </div>
<div class="line"><a id="l02382" name="l02382"></a><span class="lineno"> 2382</span>               <span class="comment">// Is this sea cell is not already marked as in a shadow zone (note could be marked as in a shadow zone but not yet processed: a -ve number)?</span></div>
<div class="line"><a id="l02383" name="l02383"></a><span class="lineno"> 2383</span>               <span class="keywordtype">int</span> nShadowZoneCode = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nX][nY].nGetShadowZoneNumber();</div>
<div class="line"><a id="l02384" name="l02384"></a><span class="lineno"> 2384</span>               <span class="keywordflow">if</span> (nShadowZoneCode &lt;= 0)</div>
<div class="line"><a id="l02385" name="l02385"></a><span class="lineno"> 2385</span>               {</div>
<div class="line"><a id="l02386" name="l02386"></a><span class="lineno"> 2386</span>                  <span class="comment">// If the cell has four neighbours which are all in a shadow zone, or four neighbours some of which are shadow zone and the remainder downdrift zone, or four neighbours some of which are shadow zone and the remainder coast; then it should also be in the shadow zone: give it the average of its neighbours</span></div>
<div class="line"><a id="l02387" name="l02387"></a><span class="lineno"> 2387</span>                  <span class="keywordflow">if</span> ((nShadow == 4) || (nShadow + nDownDrift == 4) || (nShadow + nCoast == 4))</div>
<div class="line"><a id="l02388" name="l02388"></a><span class="lineno"> 2388</span>                  {</div>
<div class="line"><a id="l02389" name="l02389"></a><span class="lineno"> 2389</span>                     <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nX][nY].SetShadowZoneNumber(nShadowNum);</div>
<div class="line"><a id="l02390" name="l02390"></a><span class="lineno"> 2390</span>                     <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nX][nY].SetWaveHeight(dWaveHeight);</div>
<div class="line"><a id="l02391" name="l02391"></a><span class="lineno"> 2391</span>                     <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nX][nY].SetWaveAngle(dWaveAngle);</div>
<div class="line"><a id="l02392" name="l02392"></a><span class="lineno"> 2392</span>                  }</div>
<div class="line"><a id="l02393" name="l02393"></a><span class="lineno"> 2393</span>               }</div>
<div class="line"><a id="l02394" name="l02394"></a><span class="lineno"> 2394</span> </div>
<div class="line"><a id="l02395" name="l02395"></a><span class="lineno"> 2395</span>               <span class="comment">// If this sea cell is not marked as in a downdrift zone but has four neighbours which are in a downdrift zone, then it should also be in the downdrift zone: give it the average of its neighbours</span></div>
<div class="line"><a id="l02396" name="l02396"></a><span class="lineno"> 2396</span>               <span class="keywordtype">int</span> nDownDriftZoneCode = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nX][nY].nGetDownDriftZoneNumber();</div>
<div class="line"><a id="l02397" name="l02397"></a><span class="lineno"> 2397</span>               <span class="keywordflow">if</span> ((nDownDriftZoneCode == 0) &amp;&amp; (nDownDrift == 4))</div>
<div class="line"><a id="l02398" name="l02398"></a><span class="lineno"> 2398</span>               {</div>
<div class="line"><a id="l02399" name="l02399"></a><span class="lineno"> 2399</span>                  <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nX][nY].SetDownDriftZoneNumber(nDownDriftNum);</div>
<div class="line"><a id="l02400" name="l02400"></a><span class="lineno"> 2400</span>                  <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nX][nY].SetWaveHeight(dWaveHeight);</div>
<div class="line"><a id="l02401" name="l02401"></a><span class="lineno"> 2401</span>                  <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nX][nY].SetWaveAngle(dWaveAngle);</div>
<div class="line"><a id="l02402" name="l02402"></a><span class="lineno"> 2402</span>               }</div>
<div class="line"><a id="l02403" name="l02403"></a><span class="lineno"> 2403</span>            }</div>
<div class="line"><a id="l02404" name="l02404"></a><span class="lineno"> 2404</span>         }</div>
<div class="line"><a id="l02405" name="l02405"></a><span class="lineno"> 2405</span>      }</div>
<div class="line"><a id="l02406" name="l02406"></a><span class="lineno"> 2406</span>   }</div>
<div class="line"><a id="l02407" name="l02407"></a><span class="lineno"> 2407</span> </div>
<div class="line"><a id="l02408" name="l02408"></a><span class="lineno"> 2408</span>   <span class="comment">// Calculate the average d50 for every polygon TODO 044</span></div>
<div class="line"><a id="l02409" name="l02409"></a><span class="lineno"> 2409</span>   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> nCoast = 0; nCoast &lt; static_cast&lt;int&gt;(<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>.size()); nCoast++)</div>
<div class="line"><a id="l02410" name="l02410"></a><span class="lineno"> 2410</span>   {</div>
<div class="line"><a id="l02411" name="l02411"></a><span class="lineno"> 2411</span>      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> nPoly = 0; nPoly &lt; <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].nGetNumPolygons(); nPoly++)</div>
<div class="line"><a id="l02412" name="l02412"></a><span class="lineno"> 2412</span>      {</div>
<div class="line"><a id="l02413" name="l02413"></a><span class="lineno"> 2413</span>         <a class="code hl_class" href="../../df/d45/classCGeomCoastPolygon.html">CGeomCoastPolygon</a>* pPolygon = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].pGetPolygon(nPoly);</div>
<div class="line"><a id="l02414" name="l02414"></a><span class="lineno"> 2414</span>         <span class="keywordtype">int</span> nID = pPolygon-&gt;<a class="code hl_function" href="../../df/d45/classCGeomCoastPolygon.html#ae97ed135e92d392e9b72f83feee59b2b">nGetCoastID</a>();</div>
<div class="line"><a id="l02415" name="l02415"></a><span class="lineno"> 2415</span> </div>
<div class="line"><a id="l02416" name="l02416"></a><span class="lineno"> 2416</span>         <span class="keywordflow">if</span> (VnPolygonD50Count[nID] &gt; 0)</div>
<div class="line"><a id="l02417" name="l02417"></a><span class="lineno"> 2417</span>            VdPolygonD50[nID] /= VnPolygonD50Count[nID];</div>
<div class="line"><a id="l02418" name="l02418"></a><span class="lineno"> 2418</span> </div>
<div class="line"><a id="l02419" name="l02419"></a><span class="lineno"> 2419</span>         pPolygon-&gt;<a class="code hl_function" href="../../df/d45/classCGeomCoastPolygon.html#ab219b0486c117c4bf946d58fab51763e">SetAvgUnconsD50</a>(VdPolygonD50[nID]);</div>
<div class="line"><a id="l02420" name="l02420"></a><span class="lineno"> 2420</span>      }</div>
<div class="line"><a id="l02421" name="l02421"></a><span class="lineno"> 2421</span>   }</div>
<div class="line"><a id="l02422" name="l02422"></a><span class="lineno"> 2422</span>}</div>
</div>
<div class="ttc" id="aclassCGeom2DIPoint_html_a4d9c20bcca90dcb9d519b664aba09cbd"><div class="ttname"><a href="../../d6/d0d/classCGeom2DIPoint.html#a4d9c20bcca90dcb9d519b664aba09cbd">CGeom2DIPoint::nGetY</a></div><div class="ttdeci">int nGetY(void) const</div><div class="ttdoc">Returns the CGeom2DIPoint object&#39;s integer Y coordinate.</div><div class="ttdef"><b>Definition</b> <a href="../../d8/dc5/2di__point_8cpp_source.html#l00048">2di_point.cpp:48</a></div></div>
<div class="ttc" id="aclassCGeom2DIPoint_html_af84c687b2d0be01ab41cbcc0565f4f3f"><div class="ttname"><a href="../../d6/d0d/classCGeom2DIPoint.html#af84c687b2d0be01ab41cbcc0565f4f3f">CGeom2DIPoint::nGetX</a></div><div class="ttdeci">int nGetX(void) const</div><div class="ttdoc">Returns the CGeom2DIPoint object&#39;s integer X coordinate.</div><div class="ttdef"><b>Definition</b> <a href="../../d8/dc5/2di__point_8cpp_source.html#l00042">2di_point.cpp:42</a></div></div>
<div class="ttc" id="aclassCGeom2DPoint_html"><div class="ttname"><a href="../../d5/d4e/classCGeom2DPoint.html">CGeom2DPoint</a></div><div class="ttdoc">Geometry class used to represent 2D point objects with floating-point coordinates.</div><div class="ttdef"><b>Definition</b> <a href="../../d0/dee/2d__point_8h_source.html#l00026">2d_point.h:27</a></div></div>
<div class="ttc" id="aclassCGeom2DPoint_html_a216921dc2c592d9468e6430fee7c7719"><div class="ttname"><a href="../../d5/d4e/classCGeom2DPoint.html#a216921dc2c592d9468e6430fee7c7719">CGeom2DPoint::dGetY</a></div><div class="ttdeci">double dGetY(void) const</div><div class="ttdoc">Returns the CGeom2DPoint object&#39;s double Y coordinate.</div><div class="ttdef"><b>Definition</b> <a href="../../d2/d81/2d__point_8cpp_source.html#l00046">2d_point.cpp:46</a></div></div>
<div class="ttc" id="aclassCGeom2DPoint_html_a250f937d03cfdf6e0244b74ad2bf96a4"><div class="ttname"><a href="../../d5/d4e/classCGeom2DPoint.html#a250f937d03cfdf6e0244b74ad2bf96a4">CGeom2DPoint::dGetX</a></div><div class="ttdeci">double dGetX(void) const</div><div class="ttdoc">Returns the CGeom2DPoint object&#39;s double X coordinate.</div><div class="ttdef"><b>Definition</b> <a href="../../d2/d81/2d__point_8cpp_source.html#l00040">2d_point.cpp:40</a></div></div>
<div class="ttc" id="aclassCGeomCoastPolygon_html"><div class="ttname"><a href="../../df/d45/classCGeomCoastPolygon.html">CGeomCoastPolygon</a></div><div class="ttdoc">Geometry class used for coast polygon objects.</div><div class="ttdef"><b>Definition</b> <a href="../../d6/db2/coast__polygon_8h_source.html#l00030">coast_polygon.h:31</a></div></div>
<div class="ttc" id="aclassCGeomCoastPolygon_html_ab219b0486c117c4bf946d58fab51763e"><div class="ttname"><a href="../../df/d45/classCGeomCoastPolygon.html#ab219b0486c117c4bf946d58fab51763e">CGeomCoastPolygon::SetAvgUnconsD50</a></div><div class="ttdeci">void SetAvgUnconsD50(double const)</div><div class="ttdoc">Set the average d50 for unconsolidated sediment on this polygon.</div><div class="ttdef"><b>Definition</b> <a href="../../df/d30/coast__polygon_8cpp_source.html#l00483">coast_polygon.cpp:483</a></div></div>
<div class="ttc" id="aclassCGeomCoastPolygon_html_ae97ed135e92d392e9b72f83feee59b2b"><div class="ttname"><a href="../../df/d45/classCGeomCoastPolygon.html#ae97ed135e92d392e9b72f83feee59b2b">CGeomCoastPolygon::nGetCoastID</a></div><div class="ttdeci">int nGetCoastID(void) const</div><div class="ttdoc">Get the coast ID, this is the same as the down-coast sequence.</div><div class="ttdef"><b>Definition</b> <a href="../../df/d30/coast__polygon_8cpp_source.html#l00144">coast_polygon.cpp:144</a></div></div>
<div class="ttc" id="aclassCGeomProfile_html"><div class="ttname"><a href="../../da/dae/classCGeomProfile.html">CGeomProfile</a></div><div class="ttdoc">Geometry class used to represent coast profile objects.</div><div class="ttdef"><b>Definition</b> <a href="../../de/d45/profile_8h_source.html#l00034">profile.h:35</a></div></div>
<div class="ttc" id="aclassCGeomProfile_html_a1efc4d74a49196572e58433ab05b5d86"><div class="ttname"><a href="../../da/dae/classCGeomProfile.html#a1efc4d74a49196572e58433ab05b5d86">CGeomProfile::dGetProfileDeepWaterWaveAngle</a></div><div class="ttdeci">double dGetProfileDeepWaterWaveAngle(void) const</div><div class="ttdoc">Returns the deep-water wave orientation for this profile.</div><div class="ttdef"><b>Definition</b> <a href="../../db/dfa/profile_8cpp_source.html#l00589">profile.cpp:589</a></div></div>
<div class="ttc" id="aclassCGeomProfile_html_a25efa8fb09d83f8e50b82e90eb6c9a59"><div class="ttname"><a href="../../da/dae/classCGeomProfile.html#a25efa8fb09d83f8e50b82e90eb6c9a59">CGeomProfile::dGetProfileDeepWaterWaveHeight</a></div><div class="ttdeci">double dGetProfileDeepWaterWaveHeight(void) const</div><div class="ttdoc">Returns the deep-water wave height for this profile.</div><div class="ttdef"><b>Definition</b> <a href="../../db/dfa/profile_8cpp_source.html#l00577">profile.cpp:577</a></div></div>
<div class="ttc" id="aclassCGeomProfile_html_a343fd2b73e3a87cf425572860e79ebd6"><div class="ttname"><a href="../../da/dae/classCGeomProfile.html#a343fd2b73e3a87cf425572860e79ebd6">CGeomProfile::nGetCoastPoint</a></div><div class="ttdeci">int nGetCoastPoint(void) const</div><div class="ttdoc">Returns the coast point at which the profile starts.</div><div class="ttdef"><b>Definition</b> <a href="../../db/dfa/profile_8cpp_source.html#l00079">profile.cpp:79</a></div></div>
<div class="ttc" id="aclassCGeomProfile_html_a60a83e788c19cfee1f79e44253e09fca"><div class="ttname"><a href="../../da/dae/classCGeomProfile.html#a60a83e788c19cfee1f79e44253e09fca">CGeomProfile::pGetDownCoastAdjacentProfile</a></div><div class="ttdeci">CGeomProfile * pGetDownCoastAdjacentProfile(void) const</div><div class="ttdef"><b>Definition</b> <a href="../../db/dfa/profile_8cpp_source.html#l00466">profile.cpp:466</a></div></div>
<div class="ttc" id="aclassCGeomProfile_html_a6d13079f744085f2d132405e0120ca54"><div class="ttname"><a href="../../da/dae/classCGeomProfile.html#a6d13079f744085f2d132405e0120ca54">CGeomProfile::pPtiGetCellInProfile</a></div><div class="ttdeci">CGeom2DIPoint * pPtiGetCellInProfile(int const)</div><div class="ttdoc">Returns a single cell in the profile.</div><div class="ttdef"><b>Definition</b> <a href="../../db/dfa/profile_8cpp_source.html#l00499">profile.cpp:499</a></div></div>
<div class="ttc" id="aclassCGeomProfile_html_a8a29c3fa364ab1f7b3930b7a9c83f45f"><div class="ttname"><a href="../../da/dae/classCGeomProfile.html#a8a29c3fa364ab1f7b3930b7a9c83f45f">CGeomProfile::nGetNumCellsInProfile</a></div><div class="ttdeci">int nGetNumCellsInProfile(void) const</div><div class="ttdoc">Returns the number of cells in the profile.</div><div class="ttdef"><b>Definition</b> <a href="../../db/dfa/profile_8cpp_source.html#l00513">profile.cpp:513</a></div></div>
<div class="ttc" id="aclassCGeomProfile_html_aa7a610faab536f4f0c30ca2cbc8abebb"><div class="ttname"><a href="../../da/dae/classCGeomProfile.html#aa7a610faab536f4f0c30ca2cbc8abebb">CGeomProfile::SetCShoreProblem</a></div><div class="ttdeci">void SetCShoreProblem(bool const)</div><div class="ttdoc">Sets a switch to indicate whether this profile has a CShore problem.</div><div class="ttdef"><b>Definition</b> <a href="../../db/dfa/profile_8cpp_source.html#l00127">profile.cpp:127</a></div></div>
<div class="ttc" id="aclassCGeomProfile_html_aac223e2610d50ca2c7eadaf8542e9498"><div class="ttname"><a href="../../da/dae/classCGeomProfile.html#aac223e2610d50ca2c7eadaf8542e9498">CGeomProfile::bOKIncStartAndEndOfCoast</a></div><div class="ttdeci">bool bOKIncStartAndEndOfCoast(void) const</div><div class="ttdoc">Returns true if this is a problem-free profile (however it could be a start-of-coast or an end-of-coa...</div><div class="ttdef"><b>Definition</b> <a href="../../db/dfa/profile_8cpp_source.html#l00246">profile.cpp:246</a></div></div>
<div class="ttc" id="aclassCGeomProfile_html_aacd98f9837c3c7cf7414764b73275fba"><div class="ttname"><a href="../../da/dae/classCGeomProfile.html#aacd98f9837c3c7cf7414764b73275fba">CGeomProfile::nGetCoastID</a></div><div class="ttdeci">int nGetCoastID(void) const</div><div class="ttdoc">Returns the profile&#39;s coast ID.</div><div class="ttdef"><b>Definition</b> <a href="../../db/dfa/profile_8cpp_source.html#l00067">profile.cpp:67</a></div></div>
<div class="ttc" id="aclassCGeomProfile_html_ac591314b290b032ffc8a70d22df64ec0"><div class="ttname"><a href="../../da/dae/classCGeomProfile.html#ac591314b290b032ffc8a70d22df64ec0">CGeomProfile::bStartOfCoast</a></div><div class="ttdeci">bool bStartOfCoast(void) const</div><div class="ttdoc">Returns the switch to indicate whether this is a start-of-coast profile.</div><div class="ttdef"><b>Definition</b> <a href="../../db/dfa/profile_8cpp_source.html#l00109">profile.cpp:109</a></div></div>
<div class="ttc" id="aclassCGeomProfile_html_ada96aa991d179ac71f4523de7a4be560"><div class="ttname"><a href="../../da/dae/classCGeomProfile.html#ada96aa991d179ac71f4523de7a4be560">CGeomProfile::pPtiVGetCellsInProfile</a></div><div class="ttdeci">vector&lt; CGeom2DIPoint &gt; * pPtiVGetCellsInProfile(void)</div><div class="ttdoc">Returns all cells in the profile.</div><div class="ttdef"><b>Definition</b> <a href="../../db/dfa/profile_8cpp_source.html#l00492">profile.cpp:492</a></div></div>
<div class="ttc" id="aclassCGeomProfile_html_aec35bc03fc47a65349def96364c99bbd"><div class="ttname"><a href="../../da/dae/classCGeomProfile.html#aec35bc03fc47a65349def96364c99bbd">CGeomProfile::bEndOfCoast</a></div><div class="ttdeci">bool bEndOfCoast(void) const</div><div class="ttdoc">Returns the switch to indicate whether this is an end-of-coast profile.</div><div class="ttdef"><b>Definition</b> <a href="../../db/dfa/profile_8cpp_source.html#l00121">profile.cpp:121</a></div></div>
<div class="ttc" id="aclassCGeomProfile_html_af21ee378022208ccdfdfa56178c3ee1b"><div class="ttname"><a href="../../da/dae/classCGeomProfile.html#af21ee378022208ccdfdfa56178c3ee1b">CGeomProfile::dGetProfileDeepWaterWavePeriod</a></div><div class="ttdeci">double dGetProfileDeepWaterWavePeriod(void) const</div><div class="ttdoc">Returns the deep-water wave Period for this profile.</div><div class="ttdef"><b>Definition</b> <a href="../../db/dfa/profile_8cpp_source.html#l00601">profile.cpp:601</a></div></div>
<div class="ttc" id="aclassCSimulation_html_a0245d3cbdd603fbeced6ca1465eb3f16"><div class="ttname"><a href="../../d1/d98/classCSimulation.html#a0245d3cbdd603fbeced6ca1465eb3f16">CSimulation::m_nLogFileDetail</a></div><div class="ttdeci">int m_nLogFileDetail</div><div class="ttdoc">The level of detail in the log file output. Can be LOG_FILE_LOW_DETAIL, LOG_FILE_MIDDLE_DETAIL,...</div><div class="ttdef"><b>Definition</b> <a href="../../dd/d6a/simulation_8h_source.html#l00531">simulation.h:531</a></div></div>
<div class="ttc" id="aclassCSimulation_html_a045629fd82b44f7aa4544f95d4500831"><div class="ttname"><a href="../../d1/d98/classCSimulation.html#a045629fd82b44f7aa4544f95d4500831">CSimulation::m_dAllCellsDeepWaterWaveHeight</a></div><div class="ttdeci">double m_dAllCellsDeepWaterWaveHeight</div><div class="ttdoc">Deep water wave height (m) for all sea cells.</div><div class="ttdef"><b>Definition</b> <a href="../../dd/d6a/simulation_8h_source.html#l00710">simulation.h:710</a></div></div>
<div class="ttc" id="aclassCSimulation_html_a0b66eca85c13a2a263db7be1e270055a"><div class="ttname"><a href="../../d1/d98/classCSimulation.html#a0b66eca85c13a2a263db7be1e270055a">CSimulation::InterpolateCShoreOutput</a></div><div class="ttdeci">void InterpolateCShoreOutput(vector&lt; double &gt; const *, int const, int const, vector&lt; double &gt; *, vector&lt; double &gt; *, vector&lt; double &gt; *, vector&lt; double &gt; *, vector&lt; double &gt; *, vector&lt; double &gt; *, vector&lt; double &gt; *, vector&lt; double &gt; *, vector&lt; double &gt; *)</div></div>
<div class="ttc" id="aclassCSimulation_html_a109431a5f83244ad4627895e30802b4f"><div class="ttname"><a href="../../d1/d98/classCSimulation.html#a109431a5f83244ad4627895e30802b4f">CSimulation::m_dG</a></div><div class="ttdeci">double m_dG</div><div class="ttdoc">Gravitational acceleration (m**2/sec)</div><div class="ttdef"><b>Definition</b> <a href="../../dd/d6a/simulation_8h_source.html#l00767">simulation.h:767</a></div></div>
<div class="ttc" id="aclassCSimulation_html_a115ab27bae37ce2d0de57cbdaeaba852"><div class="ttname"><a href="../../d1/d98/classCSimulation.html#a115ab27bae37ce2d0de57cbdaeaba852">CSimulation::m_dThisIterSWL</a></div><div class="ttdeci">double m_dThisIterSWL</div><div class="ttdoc">The still water level for this timestep (this includes tidal changes and any long-term SWL change)</div><div class="ttdef"><b>Definition</b> <a href="../../dd/d6a/simulation_8h_source.html#l00668">simulation.h:668</a></div></div>
<div class="ttc" id="aclassCSimulation_html_a1312f0ac2c93a6cb2bc41c23eb01c293"><div class="ttname"><a href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">CSimulation::m_pRasterGrid</a></div><div class="ttdeci">CGeomRasterGrid * m_pRasterGrid</div><div class="ttdoc">Pointer to the raster grid object.</div><div class="ttdef"><b>Definition</b> <a href="../../dd/d6a/simulation_8h_source.html#l01482">simulation.h:1482</a></div></div>
<div class="ttc" id="aclassCSimulation_html_a1467ae7c46f92c9cd09dd8bcb683a485"><div class="ttname"><a href="../../d1/d98/classCSimulation.html#a1467ae7c46f92c9cd09dd8bcb683a485">CSimulation::nCalcWavePropertiesOnProfile</a></div><div class="ttdeci">int nCalcWavePropertiesOnProfile(int const, int const, CGeomProfile *, vector&lt; double &gt; *, vector&lt; double &gt; *, vector&lt; double &gt; *, vector&lt; double &gt; *, vector&lt; bool &gt; *)</div><div class="ttdoc">Calculates wave properties along a coastline-normal profile using either the COVE linear wave theory ...</div><div class="ttdef"><b>Definition</b> <a href="#l00632">calc_waves.cpp:632</a></div></div>
<div class="ttc" id="aclassCSimulation_html_a1652253500dab35e6f6f9f734207e20b"><div class="ttname"><a href="../../d1/d98/classCSimulation.html#a1652253500dab35e6f6f9f734207e20b">CSimulation::m_nXGridSize</a></div><div class="ttdeci">int m_nXGridSize</div><div class="ttdoc">The size of the grid in the x direction.</div><div class="ttdef"><b>Definition</b> <a href="../../dd/d6a/simulation_8h_source.html#l00429">simulation.h:429</a></div></div>
<div class="ttc" id="aclassCSimulation_html_a19723831442bb99d698366c7194a6f58"><div class="ttname"><a href="../../d1/d98/classCSimulation.html#a19723831442bb99d698366c7194a6f58">CSimulation::m_dL_0</a></div><div class="ttdeci">double m_dL_0</div><div class="ttdoc">Deep water wave length (m)</div><div class="ttdef"><b>Definition</b> <a href="../../dd/d6a/simulation_8h_source.html#l00701">simulation.h:701</a></div></div>
<div class="ttc" id="aclassCSimulation_html_a222962121613613a48f518e0c2110f21"><div class="ttname"><a href="../../d1/d98/classCSimulation.html#a222962121613613a48f518e0c2110f21">CSimulation::LogStream</a></div><div class="ttdeci">ofstream LogStream</div><div class="ttdef"><b>Definition</b> <a href="../../dd/d6a/simulation_8h_source.html#l01772">simulation.h:1772</a></div></div>
<div class="ttc" id="aclassCSimulation_html_a25ada8139c82ca7beab3f279cff83184"><div class="ttname"><a href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">CSimulation::m_VCoast</a></div><div class="ttdeci">vector&lt; CRWCoast &gt; m_VCoast</div><div class="ttdoc">The coastline objects.</div><div class="ttdef"><b>Definition</b> <a href="../../dd/d6a/simulation_8h_source.html#l01485">simulation.h:1485</a></div></div>
<div class="ttc" id="aclassCSimulation_html_a2963505fabb1d12ef0d3e9de2efd35dc"><div class="ttname"><a href="../../d1/d98/classCSimulation.html#a2963505fabb1d12ef0d3e9de2efd35dc">CSimulation::m_bSingleDeepWaterWaveValues</a></div><div class="ttdeci">bool m_bSingleDeepWaterWaveValues</div><div class="ttdoc">Do we have just a point source for (i.e. only a single measurement of) deep water wave values.</div><div class="ttdef"><b>Definition</b> <a href="../../dd/d6a/simulation_8h_source.html#l00360">simulation.h:360</a></div></div>
<div class="ttc" id="aclassCSimulation_html_a3755fdc07c0ac9f2ce6c2237cfef50ce"><div class="ttname"><a href="../../d1/d98/classCSimulation.html#a3755fdc07c0ac9f2ce6c2237cfef50ce">CSimulation::m_nYGridSize</a></div><div class="ttdeci">int m_nYGridSize</div><div class="ttdoc">The size of the grid in the y direction.</div><div class="ttdef"><b>Definition</b> <a href="../../dd/d6a/simulation_8h_source.html#l00432">simulation.h:432</a></div></div>
<div class="ttc" id="aclassCSimulation_html_a4183ba0c6f5e8376ead62d0ded3e4c73"><div class="ttname"><a href="../../d1/d98/classCSimulation.html#a4183ba0c6f5e8376ead62d0ded3e4c73">CSimulation::nDoAllShadowZones</a></div><div class="ttdeci">int nDoAllShadowZones(void)</div><div class="ttdoc">Finds wave shadow zones and modifies waves in and near them. Note that where up-coast and down-coast ...</div><div class="ttdef"><b>Definition</b> <a href="../../d8/dce/calc__shadow__zones_8cpp_source.html#l00140">calc_shadow_zones.cpp:140</a></div></div>
<div class="ttc" id="aclassCSimulation_html_a425803ba4110668094dba54c0f9b91c8"><div class="ttname"><a href="../../d1/d98/classCSimulation.html#a425803ba4110668094dba54c0f9b91c8">CSimulation::dKeepWithin360</a></div><div class="ttdeci">static double dKeepWithin360(double const)</div><div class="ttdoc">Constrains the supplied angle to be within 0 and 360 degrees.</div><div class="ttdef"><b>Definition</b> <a href="../../db/df7/gis__utils_8cpp_source.html#l00363">gis_utils.cpp:363</a></div></div>
<div class="ttc" id="aclassCSimulation_html_a451022d3ec5423d453cbbe06b84fddc7"><div class="ttname"><a href="../../d1/d98/classCSimulation.html#a451022d3ec5423d453cbbe06b84fddc7">CSimulation::CalcCoastTangents</a></div><div class="ttdeci">void CalcCoastTangents(int const)</div><div class="ttdoc">Calculates tangents to a coastline: the tangent is assumed to be the orientation of energy/sediment f...</div><div class="ttdef"><b>Definition</b> <a href="#l02090">calc_waves.cpp:2090</a></div></div>
<div class="ttc" id="aclassCSimulation_html_a47fe76dd475e06490d4cffc0d1afc8b0"><div class="ttname"><a href="../../d1/d98/classCSimulation.html#a47fe76dd475e06490d4cffc0d1afc8b0">CSimulation::m_dWaveDepthRatioForWaveCalcs</a></div><div class="ttdeci">double m_dWaveDepthRatioForWaveCalcs</div><div class="ttdoc">Start depth for wave calculations.</div><div class="ttdef"><b>Definition</b> <a href="../../dd/d6a/simulation_8h_source.html#l00704">simulation.h:704</a></div></div>
<div class="ttc" id="aclassCSimulation_html_a4dd8148f0c1baa096e92c3a0ff2eee2d"><div class="ttname"><a href="../../d1/d98/classCSimulation.html#a4dd8148f0c1baa096e92c3a0ff2eee2d">CSimulation::nCreateCShoreInfile</a></div><div class="ttdeci">int nCreateCShoreInfile(int const, int const, int const, int const, int const, int const, int const, int const, int const, int const, int const, int const, int const, double const, double const, double const, double const, double const, double const, double const, double const, vector&lt; double &gt; const *, vector&lt; double &gt; const *, vector&lt; double &gt; const *)</div></div>
<div class="ttc" id="aclassCSimulation_html_a5c5b3c6af9aaf01e7bf236e88d397e2d"><div class="ttname"><a href="../../d1/d98/classCSimulation.html#a5c5b3c6af9aaf01e7bf236e88d397e2d">CSimulation::InterpolateWavePropertiesBetweenProfiles</a></div><div class="ttdeci">void InterpolateWavePropertiesBetweenProfiles(int const, int const)</div><div class="ttdoc">Interpolates wave properties from profiles to the coastline points between two profiles....</div><div class="ttdef"><b>Definition</b> <a href="#l01875">calc_waves.cpp:1875</a></div></div>
<div class="ttc" id="aclassCSimulation_html_a5e3b5134f2c34bdb81312ab8f3a0faf1"><div class="ttname"><a href="../../d1/d98/classCSimulation.html#a5e3b5134f2c34bdb81312ab8f3a0faf1">CSimulation::nInterpolateWavesToPolygonCells</a></div><div class="ttdeci">int nInterpolateWavesToPolygonCells(vector&lt; double &gt; const *, vector&lt; double &gt; const *, vector&lt; double &gt; const *, vector&lt; double &gt; const *)</div><div class="ttdoc">Interpolates wave properties from all profiles to all within-polygon sea cells, using GDALGridCreate(...</div><div class="ttdef"><b>Definition</b> <a href="../../d1/dfb/gis__raster_8cpp_source.html#l01875">gis_raster.cpp:1875</a></div></div>
<div class="ttc" id="aclassCSimulation_html_a688a1ad67441892ad605d6b7e050ad13"><div class="ttname"><a href="../../d1/d98/classCSimulation.html#a688a1ad67441892ad605d6b7e050ad13">CSimulation::m_nRunUpEquation</a></div><div class="ttdeci">int m_nRunUpEquation</div><div class="ttdoc">The run-up equation used TODO 007.</div><div class="ttdef"><b>Definition</b> <a href="../../dd/d6a/simulation_8h_source.html#l00534">simulation.h:534</a></div></div>
<div class="ttc" id="aclassCSimulation_html_a6e25557aa80dd5aef09170fdc51d80ca"><div class="ttname"><a href="../../d1/d98/classCSimulation.html#a6e25557aa80dd5aef09170fdc51d80ca">CSimulation::m_dBreakingWaveHeightDepthRatio</a></div><div class="ttdeci">double m_dBreakingWaveHeightDepthRatio</div><div class="ttdoc">Breaking wave height-to-depth ratio.</div><div class="ttdef"><b>Definition</b> <a href="../../dd/d6a/simulation_8h_source.html#l00707">simulation.h:707</a></div></div>
<div class="ttc" id="aclassCSimulation_html_a7155b1d27079d97e47494e55af03b101"><div class="ttname"><a href="../../d1/d98/classCSimulation.html#a7155b1d27079d97e47494e55af03b101">CSimulation::nReadCShoreOutput</a></div><div class="ttdeci">int nReadCShoreOutput(int const, string const *, int const, int const, vector&lt; double &gt; const *, vector&lt; double &gt; *)</div></div>
<div class="ttc" id="aclassCSimulation_html_a7e2a4bd69ce79377fee86aa5598903f8"><div class="ttname"><a href="../../d1/d98/classCSimulation.html#a7e2a4bd69ce79377fee86aa5598903f8">CSimulation::dGridCentroidYToExtCRSY</a></div><div class="ttdeci">double dGridCentroidYToExtCRSY(int const) const</div><div class="ttdoc">Given the integer Y-axis ordinate of a cell in the raster grid CRS, returns the external CRS Y-axis o...</div><div class="ttdef"><b>Definition</b> <a href="../../db/df7/gis__utils_8cpp_source.html#l00071">gis_utils.cpp:71</a></div></div>
<div class="ttc" id="aclassCSimulation_html_a7e6ba198fd9083eca4c5985c5fd564df"><div class="ttname"><a href="../../d1/d98/classCSimulation.html#a7e6ba198fd9083eca4c5985c5fd564df">CSimulation::CalcD50AndFillWaveCalcHoles</a></div><div class="ttdeci">void CalcD50AndFillWaveCalcHoles(void)</div><div class="ttdoc">Calculates an average d50 for each polygon. Also fills in &#39;holes&#39; in active zone and wave calcs i....</div><div class="ttdef"><b>Definition</b> <a href="#l02167">calc_waves.cpp:2167</a></div></div>
<div class="ttc" id="aclassCSimulation_html_a7f8368cae1a6852c1ea7ff99b2d0c035"><div class="ttname"><a href="../../d1/d98/classCSimulation.html#a7f8368cae1a6852c1ea7ff99b2d0c035">CSimulation::m_strCMEDir</a></div><div class="ttdeci">string m_strCMEDir</div><div class="ttdoc">The CME folder.</div><div class="ttdef"><b>Definition</b> <a href="../../dd/d6a/simulation_8h_source.html#l01078">simulation.h:1078</a></div></div>
<div class="ttc" id="aclassCSimulation_html_a8339da211b79a1bbac7061604218dd6e"><div class="ttname"><a href="../../d1/d98/classCSimulation.html#a8339da211b79a1bbac7061604218dd6e">CSimulation::m_nWavePropagationModel</a></div><div class="ttdeci">int m_nWavePropagationModel</div><div class="ttdoc">The wave propagation model used. Possible values are WAVE_MODEL_CSHORE and WAVE_MODEL_COVE.</div><div class="ttdef"><b>Definition</b> <a href="../../dd/d6a/simulation_8h_source.html#l00507">simulation.h:507</a></div></div>
<div class="ttc" id="aclassCSimulation_html_a8483ca176ba8397ba19f763e8406bf21"><div class="ttname"><a href="../../d1/d98/classCSimulation.html#a8483ca176ba8397ba19f763e8406bf21">CSimulation::m_dAllCellsDeepWaterWaveAngle</a></div><div class="ttdeci">double m_dAllCellsDeepWaterWaveAngle</div><div class="ttdoc">Deep water wave angle for all sea cells.</div><div class="ttdef"><b>Definition</b> <a href="../../dd/d6a/simulation_8h_source.html#l00713">simulation.h:713</a></div></div>
<div class="ttc" id="aclassCSimulation_html_a97046956fb2a262a0c5d493715067527"><div class="ttname"><a href="../../d1/d98/classCSimulation.html#a97046956fb2a262a0c5d493715067527">CSimulation::nSetAllCoastpointDeepWaterWaveValues</a></div><div class="ttdeci">int nSetAllCoastpointDeepWaterWaveValues(void)</div><div class="ttdoc">Give every coast point a value for deep water wave height and direction TODO 005 This may not be real...</div><div class="ttdef"><b>Definition</b> <a href="#l00062">calc_waves.cpp:62</a></div></div>
<div class="ttc" id="aclassCSimulation_html_abe93c25b27be66724952ffa6da7301fc"><div class="ttname"><a href="../../d1/d98/classCSimulation.html#abe93c25b27be66724952ffa6da7301fc">CSimulation::m_dTimeStep</a></div><div class="ttdeci">double m_dTimeStep</div><div class="ttdoc">The length of an iteration (a time step) in hours.</div><div class="ttdef"><b>Definition</b> <a href="../../dd/d6a/simulation_8h_source.html#l00632">simulation.h:632</a></div></div>
<div class="ttc" id="aclassCSimulation_html_ac723b53f5226b435cb6f6a617c531c04"><div class="ttname"><a href="../../d1/d98/classCSimulation.html#ac723b53f5226b435cb6f6a617c531c04">CSimulation::nGetThisProfileElevationsForCShore</a></div><div class="ttdeci">int nGetThisProfileElevationsForCShore(int const, CGeomProfile *, int const, vector&lt; double &gt; *, vector&lt; double &gt; *, vector&lt; double &gt; *)</div><div class="ttdoc">Get profile horizontal distance and bottom elevation vectors in CShore units.</div><div class="ttdef"><b>Definition</b> <a href="#l01478">calc_waves.cpp:1478</a></div></div>
<div class="ttc" id="aclassCSimulation_html_ac900a5701df97da22278fae928951f50"><div class="ttname"><a href="../../d1/d98/classCSimulation.html#ac900a5701df97da22278fae928951f50">CSimulation::bIsWithinValidGrid</a></div><div class="ttdeci">bool bIsWithinValidGrid(int const, int const) const</div><div class="ttdoc">Checks whether the supplied point (an x-y pair, in the grid CRS) is within the raster grid,...</div><div class="ttdef"><b>Definition</b> <a href="../../db/df7/gis__utils_8cpp_source.html#l00170">gis_utils.cpp:170</a></div></div>
<div class="ttc" id="aclassCSimulation_html_aca89a5d1f76e900ce10acc73294aa279"><div class="ttname"><a href="../../d1/d98/classCSimulation.html#aca89a5d1f76e900ce10acc73294aa279">CSimulation::ModifyBreakingWavePropertiesWithinShadowZoneToCoastline</a></div><div class="ttdeci">void ModifyBreakingWavePropertiesWithinShadowZoneToCoastline(int const, int const)</div><div class="ttdoc">Modifies the wave breaking properties at coastline points of profiles within the shadow zone.</div><div class="ttdef"><b>Definition</b> <a href="#l01796">calc_waves.cpp:1796</a></div></div>
<div class="ttc" id="aclassCSimulation_html_acb7418ac5450534bbaa9619554a9b20f"><div class="ttname"><a href="../../d1/d98/classCSimulation.html#acb7418ac5450534bbaa9619554a9b20f">CSimulation::m_dC_0</a></div><div class="ttdeci">double m_dC_0</div><div class="ttdoc">Deep water wave speed (m/s)</div><div class="ttdef"><b>Definition</b> <a href="../../dd/d6a/simulation_8h_source.html#l00698">simulation.h:698</a></div></div>
<div class="ttc" id="aclassCSimulation_html_ad67e8c5b30a0572f64ecfb5c062c2edc"><div class="ttname"><a href="../../d1/d98/classCSimulation.html#ad67e8c5b30a0572f64ecfb5c062c2edc">CSimulation::m_ulIter</a></div><div class="ttdeci">unsigned long m_ulIter</div><div class="ttdoc">The number of the current iteration (time step)</div><div class="ttdef"><b>Definition</b> <a href="../../dd/d6a/simulation_8h_source.html#l00554">simulation.h:554</a></div></div>
<div class="ttc" id="aclassCSimulation_html_ad79b925ac5f358c6f867b6e47dad74bd"><div class="ttname"><a href="../../d1/d98/classCSimulation.html#ad79b925ac5f358c6f867b6e47dad74bd">CSimulation::dGridCentroidXToExtCRSX</a></div><div class="ttdeci">double dGridCentroidXToExtCRSX(int const) const</div><div class="ttdoc">Given the integer X-axis ordinate of a cell in the raster grid CRS, returns the external CRS X-axis o...</div><div class="ttdef"><b>Definition</b> <a href="../../db/df7/gis__utils_8cpp_source.html#l00062">gis_utils.cpp:62</a></div></div>
<div class="ttc" id="aclassCSimulation_html_ad89a4ca2ea821f9853becbbce8af52b7"><div class="ttname"><a href="../../d1/d98/classCSimulation.html#ad89a4ca2ea821f9853becbbce8af52b7">CSimulation::m_nNumPolygonGlobal</a></div><div class="ttdeci">int m_nNumPolygonGlobal</div><div class="ttdoc">Number of global (all coasts) polygons.</div><div class="ttdef"><b>Definition</b> <a href="../../dd/d6a/simulation_8h_source.html#l00483">simulation.h:483</a></div></div>
<div class="ttc" id="aclassCSimulation_html_ae04e84f9461df12f7ee89764aad2ebcf"><div class="ttname"><a href="../../d1/d98/classCSimulation.html#ae04e84f9461df12f7ee89764aad2ebcf">CSimulation::nDoAllPropagateWaves</a></div><div class="ttdeci">int nDoAllPropagateWaves(void)</div><div class="ttdoc">Simulates wave propagation along all coastline-normal profiles.</div><div class="ttdef"><b>Definition</b> <a href="#l00148">calc_waves.cpp:148</a></div></div>
<div class="ttc" id="aclassCSimulation_html_aecac3135005148dc01ee8ba3871b7fbf"><div class="ttname"><a href="../../d1/d98/classCSimulation.html#aecac3135005148dc01ee8ba3871b7fbf">CSimulation::m_dDepthOfClosure</a></div><div class="ttdeci">double m_dDepthOfClosure</div><div class="ttdoc">Depth of closure (in m) TODO 007 can be calculated using Hallermeier, R.J. (1978) or Birkemeier (1985...</div><div class="ttdef"><b>Definition</b> <a href="../../dd/d6a/simulation_8h_source.html#l00773">simulation.h:773</a></div></div>
<div class="ttc" id="aclassCSimulation_html_af4c1d4172cbc1ef26d5cae02ffe03409"><div class="ttname"><a href="../../d1/d98/classCSimulation.html#af4c1d4172cbc1ef26d5cae02ffe03409">CSimulation::InterpolateWaveHeightToCoastPoints</a></div><div class="ttdeci">void InterpolateWaveHeightToCoastPoints(int const)</div><div class="ttdoc">Linearly interpolates wave properties from profiles to the coastline cells between two profiles.</div><div class="ttdef"><b>Definition</b> <a href="#l02049">calc_waves.cpp:2049</a></div></div>
<div class="ttc" id="aclassCSimulation_html_afa49724344dd8c5a4fd3d2733677dee2"><div class="ttname"><a href="../../d1/d98/classCSimulation.html#afa49724344dd8c5a4fd3d2733677dee2">CSimulation::VstrSplit</a></div><div class="ttdeci">static vector&lt; string &gt; * VstrSplit(string const *, char const, vector&lt; string &gt; *)</div><div class="ttdoc">From http://stackoverflow.com/questions/236129/split-a-string-in-c They implement (approximately) Pyt...</div><div class="ttdef"><b>Definition</b> <a href="../../de/d06/utils_8cpp_source.html#l02259">utils.cpp:2259</a></div></div>
<div class="ttc" id="aclassCSimulation_html_afc35aaa515595540ebadb58795abf4a2"><div class="ttname"><a href="../../d1/d98/classCSimulation.html#afc35aaa515595540ebadb58795abf4a2">CSimulation::dCalcWaveAngleToCoastNormal</a></div><div class="ttdeci">static double dCalcWaveAngleToCoastNormal(double const, double const, int const)</div><div class="ttdoc">Calculates the angle between the wave direction and a normal to the coastline tangent....</div><div class="ttdef"><b>Definition</b> <a href="#l00612">calc_waves.cpp:612</a></div></div>
<div class="ttc" id="acme_8h_html"><div class="ttname"><a href="../../d6/d2a/cme_8h.html">cme.h</a></div><div class="ttdoc">This file contains global definitions for CoastalME.</div></div>
<div class="ttc" id="acme_8h_html_a01522c1e8423c6586193dd5ca0c76171"><div class="ttname"><a href="../../d6/d2a/cme_8h.html#a01522c1e8423c6586193dd5ca0c76171">NO_NONZERO_THICKNESS_LAYERS</a></div><div class="ttdeci">int const NO_NONZERO_THICKNESS_LAYERS</div><div class="ttdef"><b>Definition</b> <a href="../../d6/d2a/cme_8h_source.html#l00655">cme.h:655</a></div></div>
<div class="ttc" id="acme_8h_html_a01aa8b423260b337ddff2016107b51a0"><div class="ttname"><a href="../../d6/d2a/cme_8h.html#a01aa8b423260b337ddff2016107b51a0">INT_NODATA</a></div><div class="ttdeci">int const INT_NODATA</div><div class="ttdef"><b>Definition</b> <a href="../../d6/d2a/cme_8h_source.html#l00365">cme.h:365</a></div></div>
<div class="ttc" id="acme_8h_html_a068017859403c0629d89f8d348f6c224"><div class="ttname"><a href="../../d6/d2a/cme_8h.html#a068017859403c0629d89f8d348f6c224">tMin</a></div><div class="ttdeci">T tMin(T a, T b)</div><div class="ttdef"><b>Definition</b> <a href="../../d6/d2a/cme_8h_source.html#l01138">cme.h:1138</a></div></div>
<div class="ttc" id="acme_8h_html_a06de4af92b990a0b1a90b06466dc0fd5"><div class="ttname"><a href="../../d6/d2a/cme_8h.html#a06de4af92b990a0b1a90b06466dc0fd5">WAVE_MODEL_COVE</a></div><div class="ttdeci">int const WAVE_MODEL_COVE</div><div class="ttdef"><b>Definition</b> <a href="../../d6/d2a/cme_8h_source.html#l00668">cme.h:668</a></div></div>
<div class="ttc" id="acme_8h_html_a08b1623863ee3bd4300a8892de323722"><div class="ttname"><a href="../../d6/d2a/cme_8h.html#a08b1623863ee3bd4300a8892de323722">TOLERANCE</a></div><div class="ttdeci">double const TOLERANCE</div><div class="ttdef"><b>Definition</b> <a href="../../d6/d2a/cme_8h_source.html#l00699">cme.h:699</a></div></div>
<div class="ttc" id="acme_8h_html_a0af2b64c1c33dbf4d223944b0bf234e6"><div class="ttname"><a href="../../d6/d2a/cme_8h.html#a0af2b64c1c33dbf4d223944b0bf234e6">RTN_ERR_NO_TOP_LAYER</a></div><div class="ttdeci">int const RTN_ERR_NO_TOP_LAYER</div><div class="ttdef"><b>Definition</b> <a href="../../d6/d2a/cme_8h_source.html#l00626">cme.h:626</a></div></div>
<div class="ttc" id="acme_8h_html_a17918dff623e9b5e2ca1d304c90619c9"><div class="ttname"><a href="../../d6/d2a/cme_8h.html#a17918dff623e9b5e2ca1d304c90619c9">CSHORE_DIR</a></div><div class="ttdeci">string const CSHORE_DIR</div><div class="ttdef"><b>Definition</b> <a href="../../d6/d2a/cme_8h_source.html#l00774">cme.h:774</a></div></div>
<div class="ttc" id="acme_8h_html_a206d98a82620d9512e62d54b0827a4f2"><div class="ttname"><a href="../../d6/d2a/cme_8h.html#a206d98a82620d9512e62d54b0827a4f2">RTN_ERR_CSHORE_FILE_INPUT</a></div><div class="ttdeci">int const RTN_ERR_CSHORE_FILE_INPUT</div><div class="ttdef"><b>Definition</b> <a href="../../d6/d2a/cme_8h_source.html#l00634">cme.h:634</a></div></div>
<div class="ttc" id="acme_8h_html_a292fc90846543ca4814daa9f759feb05"><div class="ttname"><a href="../../d6/d2a/cme_8h.html#a292fc90846543ca4814daa9f759feb05">ERR</a></div><div class="ttdeci">string const ERR</div><div class="ttdef"><b>Definition</b> <a href="../../d6/d2a/cme_8h_source.html#l00777">cme.h:777</a></div></div>
<div class="ttc" id="acme_8h_html_a3f997e237acb5d927bef6a375a4bf3f1"><div class="ttname"><a href="../../d6/d2a/cme_8h.html#a3f997e237acb5d927bef6a375a4bf3f1">CSHORE_FRICTION_FACTOR</a></div><div class="ttdeci">double const CSHORE_FRICTION_FACTOR</div><div class="ttdef"><b>Definition</b> <a href="../../d6/d2a/cme_8h_source.html#l00696">cme.h:696</a></div></div>
<div class="ttc" id="acme_8h_html_a4aa93bef3c450c95fa8d0251dac261e2"><div class="ttname"><a href="../../d6/d2a/cme_8h.html#a4aa93bef3c450c95fa8d0251dac261e2">WAVE_MODEL_CSHORE</a></div><div class="ttdeci">int const WAVE_MODEL_CSHORE</div><div class="ttdef"><b>Definition</b> <a href="../../d6/d2a/cme_8h_source.html#l00669">cme.h:669</a></div></div>
<div class="ttc" id="acme_8h_html_a540d8a94fc09b0b14fd8ab657445b67a"><div class="ttname"><a href="../../d6/d2a/cme_8h.html#a540d8a94fc09b0b14fd8ab657445b67a">LOG_FILE_MIDDLE_DETAIL</a></div><div class="ttdeci">int const LOG_FILE_MIDDLE_DETAIL</div><div class="ttdef"><b>Definition</b> <a href="../../d6/d2a/cme_8h_source.html#l00380">cme.h:380</a></div></div>
<div class="ttc" id="acme_8h_html_a5d502a06fdd71825be49e07c95496b16"><div class="ttname"><a href="../../d6/d2a/cme_8h.html#a5d502a06fdd71825be49e07c95496b16">PI</a></div><div class="ttdeci">double const PI</div><div class="ttdef"><b>Definition</b> <a href="../../d6/d2a/cme_8h_source.html#l00681">cme.h:681</a></div></div>
<div class="ttc" id="acme_8h_html_a60017818ee26e96bf8826ef74a3cf324"><div class="ttname"><a href="../../d6/d2a/cme_8h.html#a60017818ee26e96bf8826ef74a3cf324">RTN_ERR_CSHORE_ERROR</a></div><div class="ttdeci">int const RTN_ERR_CSHORE_ERROR</div><div class="ttdef"><b>Definition</b> <a href="../../d6/d2a/cme_8h_source.html#l00639">cme.h:639</a></div></div>
<div class="ttc" id="acme_8h_html_a61afa8560a3b39c80657661a1d8f76ab"><div class="ttname"><a href="../../d6/d2a/cme_8h.html#a61afa8560a3b39c80657661a1d8f76ab">bFPIsEqual</a></div><div class="ttdeci">bool bFPIsEqual(const T d1, const T d2, const T dEpsilon)</div><div class="ttdef"><b>Definition</b> <a href="../../d6/d2a/cme_8h_source.html#l01178">cme.h:1178</a></div></div>
<div class="ttc" id="acme_8h_html_a65a71870b31deafaa61220aa9b6fc9cb"><div class="ttname"><a href="../../d6/d2a/cme_8h.html#a65a71870b31deafaa61220aa9b6fc9cb">WALKDEN_HALL_PARAM_2</a></div><div class="ttdeci">double const WALKDEN_HALL_PARAM_2</div><div class="ttdef"><b>Definition</b> <a href="../../d6/d2a/cme_8h_source.html#l00689">cme.h:689</a></div></div>
<div class="ttc" id="acme_8h_html_a7e895b460cef877dec4d12ead0c74f15"><div class="ttname"><a href="../../d6/d2a/cme_8h.html#a7e895b460cef877dec4d12ead0c74f15">tMax</a></div><div class="ttdeci">T tMax(T a, T b)</div><div class="ttdef"><b>Definition</b> <a href="../../d6/d2a/cme_8h_source.html#l01125">cme.h:1125</a></div></div>
<div class="ttc" id="acme_8h_html_a8c80cf547c10a0d3868dcd81abdc8e62"><div class="ttname"><a href="../../d6/d2a/cme_8h.html#a8c80cf547c10a0d3868dcd81abdc8e62">RTN_ERR_READING_CSHORE_FILE_OUTPUT</a></div><div class="ttdeci">int const RTN_ERR_READING_CSHORE_FILE_OUTPUT</div><div class="ttdef"><b>Definition</b> <a href="../../d6/d2a/cme_8h_source.html#l00635">cme.h:635</a></div></div>
<div class="ttc" id="acme_8h_html_a8d58911dc3dd7eb3bdcf5af4efc9a16d"><div class="ttname"><a href="../../d6/d2a/cme_8h.html#a8d58911dc3dd7eb3bdcf5af4efc9a16d">CSHORE_SURGE_LEVEL</a></div><div class="ttdeci">double const CSHORE_SURGE_LEVEL</div><div class="ttdef"><b>Definition</b> <a href="../../d6/d2a/cme_8h_source.html#l00697">cme.h:697</a></div></div>
<div class="ttc" id="acme_8h_html_a957ca99e98618160534cafb0929f743d"><div class="ttname"><a href="../../d6/d2a/cme_8h.html#a957ca99e98618160534cafb0929f743d">WARN</a></div><div class="ttdeci">string const WARN</div><div class="ttdef"><b>Definition</b> <a href="../../d6/d2a/cme_8h_source.html#l00778">cme.h:778</a></div></div>
<div class="ttc" id="acme_8h_html_aa768cb14b5c6123ee95e6e4ebd9fe331"><div class="ttname"><a href="../../d6/d2a/cme_8h.html#aa768cb14b5c6123ee95e6e4ebd9fe331">RTN_OK</a></div><div class="ttdeci">int const RTN_OK</div><div class="ttdef"><b>Definition</b> <a href="../../d6/d2a/cme_8h_source.html#l00580">cme.h:580</a></div></div>
<div class="ttc" id="acme_8h_html_aaa9e0f47a8f6eeecd6754881d7e59016"><div class="ttname"><a href="../../d6/d2a/cme_8h.html#aaa9e0f47a8f6eeecd6754881d7e59016">SAVE_CSHORE_OUTPUT</a></div><div class="ttdeci">bool const SAVE_CSHORE_OUTPUT</div><div class="ttdef"><b>Definition</b> <a href="../../d6/d2a/cme_8h_source.html#l00348">cme.h:348</a></div></div>
<div class="ttc" id="acme_8h_html_ac003bdff958dca839f5d274f15786e07"><div class="ttname"><a href="../../d6/d2a/cme_8h.html#ac003bdff958dca839f5d274f15786e07">DBL_NODATA</a></div><div class="ttdeci">double const DBL_NODATA</div><div class="ttdef"><b>Definition</b> <a href="../../d6/d2a/cme_8h_source.html#l00709">cme.h:709</a></div></div>
<div class="ttc" id="acme_8h_html_ad86b7b66cd8d17fc248e90239a3dc4f5"><div class="ttname"><a href="../../d6/d2a/cme_8h.html#ad86b7b66cd8d17fc248e90239a3dc4f5">CSHOREARRAYOUTSIZE</a></div><div class="ttdeci">int const CSHOREARRAYOUTSIZE</div><div class="ttdoc">The size of the arrays output by CShore. If you change this, then you must also set the same value on...</div><div class="ttdef"><b>Definition</b> <a href="../../d6/d2a/cme_8h_source.html#l00361">cme.h:361</a></div></div>
<div class="ttc" id="acme_8h_html_add30b59022abb07bc55b76b57f1a60fb"><div class="ttname"><a href="../../d6/d2a/cme_8h.html#add30b59022abb07bc55b76b57f1a60fb">WALKDEN_HALL_PARAM_1</a></div><div class="ttdeci">double const WALKDEN_HALL_PARAM_1</div><div class="ttdef"><b>Definition</b> <a href="../../d6/d2a/cme_8h_source.html#l00688">cme.h:688</a></div></div>
<div class="ttc" id="acme_8h_html_ae3b6dc50cfc97050529faa5e0bd66136"><div class="ttname"><a href="../../d6/d2a/cme_8h.html#ae3b6dc50cfc97050529faa5e0bd66136">tAbs</a></div><div class="ttdeci">T tAbs(T a)</div><div class="ttdef"><b>Definition</b> <a href="../../d6/d2a/cme_8h_source.html#l01150">cme.h:1150</a></div></div>
<div class="ttc" id="acme_8h_html_ae511c9d9a1cb65ab8cce83412e51a77f"><div class="ttname"><a href="../../d6/d2a/cme_8h.html#ae511c9d9a1cb65ab8cce83412e51a77f">RTN_ERR_CSHORE_EMPTY_PROFILE</a></div><div class="ttdeci">int const RTN_ERR_CSHORE_EMPTY_PROFILE</div><div class="ttdef"><b>Definition</b> <a href="../../d6/d2a/cme_8h_source.html#l00633">cme.h:633</a></div></div>
<div class="ttc" id="acme_8h_html_afd188232c7637cf5943004f3eeacbb2b"><div class="ttname"><a href="../../d6/d2a/cme_8h.html#afd188232c7637cf5943004f3eeacbb2b">CSHORE_INFILE</a></div><div class="ttdeci">string const CSHORE_INFILE</div><div class="ttdef"><b>Definition</b> <a href="../../d6/d2a/cme_8h_source.html#l00775">cme.h:775</a></div></div>
<div class="ttc" id="acme_8h_html_afdd3411d0fa60c62522af14ea2a90570"><div class="ttname"><a href="../../d6/d2a/cme_8h.html#afdd3411d0fa60c62522af14ea2a90570">LEFT_HANDED</a></div><div class="ttdeci">int const LEFT_HANDED</div><div class="ttdef"><b>Definition</b> <a href="../../d6/d2a/cme_8h_source.html#l00401">cme.h:401</a></div></div>
<div class="ttc" id="acme_8h_html_aff09a9868303fc55a863e0553987dd25"><div class="ttname"><a href="../../d6/d2a/cme_8h.html#aff09a9868303fc55a863e0553987dd25">SPACE</a></div><div class="ttdeci">char const SPACE</div><div class="ttdef"><b>Definition</b> <a href="../../d6/d2a/cme_8h_source.html#l00342">cme.h:342</a></div></div>
<div class="ttc" id="acoast_8h_html"><div class="ttname"><a href="../../de/d65/coast_8h.html">coast.h</a></div><div class="ttdoc">Contains CRWCoast definitions.</div></div>
<div class="ttc" id="acshore_2cshore_8h_html_a35b5138685d79a9bcdd373699d48e390"><div class="ttname"><a href="../../d8/db0/cshore_2cshore_8h.html#a35b5138685d79a9bcdd373699d48e390">CShore</a></div><div class="ttdeci">void CShore(int *)</div></div>
<div class="ttc" id="acshore_2cshore_8h_html_a567f70b9e4f37a2ffe9edac6ad5a498e"><div class="ttname"><a href="../../d8/db0/cshore_2cshore_8h.html#a567f70b9e4f37a2ffe9edac6ad5a498e">CShoreWrapper</a></div><div class="ttdeci">void CShoreWrapper(int const *, int const *, int const *, int const *, int const *, int const *, int const *, int const *, int const *, int const *, int const *, double const *, double const *, double[], double[], double[], double[], double[], double[], int const *, double[], double[], double[], int *, int *, double[], double[], double[], double[], double[])</div></div>
<div class="ttc" id="ainterpolate_8cpp_html_a827d9b75395722acc9e19935195772be"><div class="ttname"><a href="../../d7/d62/interpolate_8cpp.html#a827d9b75395722acc9e19935195772be">VdInterpolateCShoreProfileOutput</a></div><div class="ttdeci">vector&lt; double &gt; VdInterpolateCShoreProfileOutput(vector&lt; double &gt; const *pVdX, vector&lt; double &gt; const *pVdY, vector&lt; double &gt; const *pVdXNew)</div><div class="ttdoc">Returns a linearly interpolated vector of doubles, to make CShore profile output compatible with CME....</div><div class="ttdef"><b>Definition</b> <a href="../../d7/d62/interpolate_8cpp_source.html#l00129">interpolate.cpp:129</a></div></div>
<div class="ttc" id="ainterpolate_8cpp_html_aec8942141bf8fa2a69bacd12ee72cbd2"><div class="ttname"><a href="../../d7/d62/interpolate_8cpp.html#aec8942141bf8fa2a69bacd12ee72cbd2">dGetInterpolatedValue</a></div><div class="ttdeci">double dGetInterpolatedValue(vector&lt; double &gt; const *pVdXdata, vector&lt; double &gt; const *pVdYdata, double dX, bool bExtrapolate)</div><div class="ttdef"><b>Definition</b> <a href="../../d7/d62/interpolate_8cpp_source.html#l00036">interpolate.cpp:36</a></div></div>
<div class="ttc" id="ainterpolate_8h_html"><div class="ttname"><a href="../../df/dd3/interpolate_8h.html">interpolate.h</a></div><div class="ttdoc">Definitions of routines which return interpolated value at x from parallel arrays.</div></div>
<div class="ttc" id="asimulation_8h_html"><div class="ttname"><a href="../../dd/d6a/simulation_8h.html">simulation.h</a></div><div class="ttdoc">Contains CSimulation definitions.</div></div>
<div class="ttc" id="autils__global_8cpp_html_a1432a707917cd3a9582796679f4d583f"><div class="ttname"><a href="../../d2/dfd/utils__global_8cpp.html#a1432a707917cd3a9582796679f4d583f">bIsStringValidInt</a></div><div class="ttdeci">bool bIsStringValidInt(string &amp;str)</div><div class="ttdoc">Checks to see if a string can be read as a valid integer, from https://stackoverflow....</div><div class="ttdef"><b>Definition</b> <a href="../../d2/dfd/utils__global_8cpp_source.html#l00085">utils_global.cpp:85</a></div></div>
<div class="ttc" id="autils__global_8cpp_html_a20842d0a19d0ca952c91f3e1eb175fee"><div class="ttname"><a href="../../d2/dfd/utils__global_8cpp.html#a20842d0a19d0ca952c91f3e1eb175fee">nRound</a></div><div class="ttdeci">int nRound(double const d)</div><div class="ttdoc">Version of the above that returns an int.</div><div class="ttdef"><b>Definition</b> <a href="../../d2/dfd/utils__global_8cpp_source.html#l00056">utils_global.cpp:56</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="../../d2/d24/calc__waves_8cpp.html">calc_waves.cpp</a></li>
    <li class="footer">Generated on Mon Apr 28 2025 15:48:43 for CoastalME (Coastal Modelling Environment) by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.13.2 </li>
  </ul>
</div>
</body>
</html>
