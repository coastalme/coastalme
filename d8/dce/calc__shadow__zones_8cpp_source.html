<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.13.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>CoastalME (Coastal Modelling Environment): calc_shadow_zones.cpp Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<script type="text/javascript" src="../../clipboard.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../cookie.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">CoastalME (Coastal Modelling Environment)
   </div>
   <div id="projectbrief">Simulates the long-term behaviour of complex coastlines</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(1); });
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('d8/dce/calc__shadow__zones_8cpp_source.html','../../'); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">calc_shadow_zones.cpp</div></div>
</div><!--header-->
<div class="contents">
<a href="../../d8/dce/calc__shadow__zones_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a id="l00001" name="l00001"></a><span class="lineno">    1</span></div>
<div class="line"><a id="l00010" name="l00010"></a><span class="lineno">   10</span> </div>
<div class="line"><a id="l00011" name="l00011"></a><span class="lineno">   11</span><span class="comment">/* ==============================================================================================================================</span></div>
<div class="line"><a id="l00012" name="l00012"></a><span class="lineno">   12</span><span class="comment"></span> </div>
<div class="line"><a id="l00013" name="l00013"></a><span class="lineno">   13</span><span class="comment">   This file is part of CoastalME, the Coastal Modelling Environment.</span></div>
<div class="line"><a id="l00014" name="l00014"></a><span class="lineno">   14</span><span class="comment"></span> </div>
<div class="line"><a id="l00015" name="l00015"></a><span class="lineno">   15</span><span class="comment">   CoastalME is free software; you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation; either version 3 of the License, or (at your option) any later version.</span></div>
<div class="line"><a id="l00016" name="l00016"></a><span class="lineno">   16</span><span class="comment"></span> </div>
<div class="line"><a id="l00017" name="l00017"></a><span class="lineno">   17</span><span class="comment">   This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for more details.</span></div>
<div class="line"><a id="l00018" name="l00018"></a><span class="lineno">   18</span><span class="comment"></span> </div>
<div class="line"><a id="l00019" name="l00019"></a><span class="lineno">   19</span><span class="comment">   You should have received a copy of the GNU General Public License along with this program; if not, write to the Free Software Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.</span></div>
<div class="line"><a id="l00020" name="l00020"></a><span class="lineno">   20</span><span class="comment"></span> </div>
<div class="line"><a id="l00021" name="l00021"></a><span class="lineno">   21</span><span class="comment">==============================================================================================================================*/</span></div>
<div class="line"><a id="l00022" name="l00022"></a><span class="lineno">   22</span><span class="preprocessor">#include &lt;assert.h&gt;</span></div>
<div class="line"><a id="l00023" name="l00023"></a><span class="lineno">   23</span><span class="preprocessor">#include &lt;cmath&gt;</span></div>
<div class="line"><a id="l00024" name="l00024"></a><span class="lineno">   24</span> </div>
<div class="line"><a id="l00025" name="l00025"></a><span class="lineno">   25</span><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"><a id="l00026" name="l00026"></a><span class="lineno">   26</span><span class="comment">// using std::cout;</span></div>
<div class="line"><a id="l00027" name="l00027"></a><span class="lineno">   27</span><span class="keyword">using </span>std::endl;</div>
<div class="line"><a id="l00028" name="l00028"></a><span class="lineno">   28</span> </div>
<div class="line"><a id="l00029" name="l00029"></a><span class="lineno">   29</span><span class="preprocessor">#include &lt;stack&gt;</span></div>
<div class="line"><a id="l00030" name="l00030"></a><span class="lineno">   30</span><span class="keyword">using </span>std::stack;</div>
<div class="line"><a id="l00031" name="l00031"></a><span class="lineno">   31</span> </div>
<div class="line"><a id="l00032" name="l00032"></a><span class="lineno">   32</span><span class="preprocessor">#include &lt;deque&gt;</span></div>
<div class="line"><a id="l00033" name="l00033"></a><span class="lineno">   33</span><span class="keyword">using </span>std::deque;</div>
<div class="line"><a id="l00034" name="l00034"></a><span class="lineno">   34</span> </div>
<div class="line"><a id="l00035" name="l00035"></a><span class="lineno">   35</span><span class="preprocessor">#include &lt;numeric&gt;</span></div>
<div class="line"><a id="l00036" name="l00036"></a><span class="lineno">   36</span><span class="keyword">using </span>std::accumulate;</div>
<div class="line"><a id="l00037" name="l00037"></a><span class="lineno">   37</span> </div>
<div class="line"><a id="l00038" name="l00038"></a><span class="lineno">   38</span><span class="preprocessor">#include &quot;<a class="code" href="../../d6/d2a/cme_8h.html">cme.h</a>&quot;</span></div>
<div class="line"><a id="l00039" name="l00039"></a><span class="lineno">   39</span><span class="preprocessor">#include &quot;<a class="code" href="../../de/d65/coast_8h.html">coast.h</a>&quot;</span></div>
<div class="line"><a id="l00040" name="l00040"></a><span class="lineno">   40</span><span class="preprocessor">#include &quot;<a class="code" href="../../dd/d6a/simulation_8h.html">simulation.h</a>&quot;</span></div>
<div class="line"><a id="l00041" name="l00041"></a><span class="lineno">   41</span><span class="preprocessor">#include &quot;<a class="code" href="../../db/d8c/raster__grid_8h.html">raster_grid.h</a>&quot;</span></div>
<div class="line"><a id="l00042" name="l00042"></a><span class="lineno">   42</span><span class="preprocessor">#include &quot;<a class="code" href="../../d0/dee/2d__point_8h.html">2d_point.h</a>&quot;</span></div>
<div class="line"><a id="l00043" name="l00043"></a><span class="lineno">   43</span><span class="preprocessor">#include &quot;<a class="code" href="../../d2/d66/2di__point_8h.html">2di_point.h</a>&quot;</span></div>
<div class="line"><a id="l00044" name="l00044"></a><span class="lineno">   44</span><span class="preprocessor">#include &quot;<a class="code" href="../../d7/d5d/line_8h.html">line.h</a>&quot;</span></div>
<div class="line"><a id="l00045" name="l00045"></a><span class="lineno">   45</span><span class="preprocessor">#include &quot;<a class="code" href="../../da/d11/i__line_8h.html">i_line.h</a>&quot;</span></div>
<div class="line"><a id="l00046" name="l00046"></a><span class="lineno">   46</span> </div>
<div class="line"><a id="l00047" name="l00047"></a><span class="lineno">   47</span><span class="comment">//===============================================================================================================================</span></div>
<div class="line"><a id="l00049" name="l00049"></a><span class="lineno">   49</span><span class="comment">//===============================================================================================================================</span></div>
<div class="foldopen" id="foldopen00050" data-start="{" data-end="}">
<div class="line"><a id="l00050" name="l00050"></a><span class="lineno"><a class="line" href="../../d1/d98/classCSimulation.html#a84d43443a65822540eafb0a23b9ae99c">   50</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="../../d1/d98/classCSimulation.html#a84d43443a65822540eafb0a23b9ae99c">CSimulation::bOnOrOffShoreAndUpOrDownCoast</a>(<span class="keywordtype">double</span> <span class="keyword">const</span> dCoastAngle, <span class="keywordtype">double</span> <span class="keyword">const</span> dWaveAngle, <span class="keywordtype">int</span> <span class="keyword">const</span> nSeaHand, <span class="keywordtype">bool</span>&amp; bDownCoast)</div>
<div class="line"><a id="l00051" name="l00051"></a><span class="lineno">   51</span>{</div>
<div class="line"><a id="l00052" name="l00052"></a><span class="lineno">   52</span>   <span class="keywordtype">bool</span> bOnShore;</div>
<div class="line"><a id="l00053" name="l00053"></a><span class="lineno">   53</span>   <span class="keywordtype">double</span> <span class="keyword">const</span> dWaveToCoastAngle = fmod((dWaveAngle - dCoastAngle + 360), 360);</div>
<div class="line"><a id="l00054" name="l00054"></a><span class="lineno">   54</span> </div>
<div class="line"><a id="l00055" name="l00055"></a><span class="lineno">   55</span>   bDownCoast = ((dWaveToCoastAngle &gt; 270) || (dWaveToCoastAngle &lt; 90)) ? <span class="keyword">true</span> : <span class="keyword">false</span>;</div>
<div class="line"><a id="l00056" name="l00056"></a><span class="lineno">   56</span> </div>
<div class="line"><a id="l00057" name="l00057"></a><span class="lineno">   57</span>   <span class="keywordflow">if</span> (nSeaHand == <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#ade186989e07cd54874887cd10d4a8465">RIGHT_HANDED</a>)</div>
<div class="line"><a id="l00058" name="l00058"></a><span class="lineno">   58</span>   {</div>
<div class="line"><a id="l00059" name="l00059"></a><span class="lineno">   59</span>      <span class="comment">// The sea is on the RHS when travelling down-coast (i.e. along the coast in the direction of increasing coastline point numbers)</span></div>
<div class="line"><a id="l00060" name="l00060"></a><span class="lineno">   60</span>      bOnShore = dWaveToCoastAngle &gt; 180 ? true : <span class="keyword">false</span>;</div>
<div class="line"><a id="l00061" name="l00061"></a><span class="lineno">   61</span>   }</div>
<div class="line"><a id="l00062" name="l00062"></a><span class="lineno">   62</span>   <span class="keywordflow">else</span></div>
<div class="line"><a id="l00063" name="l00063"></a><span class="lineno">   63</span>   {</div>
<div class="line"><a id="l00064" name="l00064"></a><span class="lineno">   64</span>      <span class="comment">// The sea is on the LHS when travelling down-coast (i.e. along the coast in the direction of increasing coastline point numbers)</span></div>
<div class="line"><a id="l00065" name="l00065"></a><span class="lineno">   65</span>      bOnShore = dWaveToCoastAngle &gt; 180 ? false : <span class="keyword">true</span>;</div>
<div class="line"><a id="l00066" name="l00066"></a><span class="lineno">   66</span>   }</div>
<div class="line"><a id="l00067" name="l00067"></a><span class="lineno">   67</span> </div>
<div class="line"><a id="l00068" name="l00068"></a><span class="lineno">   68</span>   <span class="keywordflow">return</span> bOnShore;</div>
<div class="line"><a id="l00069" name="l00069"></a><span class="lineno">   69</span>}</div>
</div>
<div class="line"><a id="l00070" name="l00070"></a><span class="lineno">   70</span> </div>
<div class="line"><a id="l00071" name="l00071"></a><span class="lineno">   71</span><span class="comment">//===============================================================================================================================</span></div>
<div class="line"><a id="l00073" name="l00073"></a><span class="lineno">   73</span><span class="comment">//===============================================================================================================================</span></div>
<div class="foldopen" id="foldopen00074" data-start="{" data-end="}">
<div class="line"><a id="l00074" name="l00074"></a><span class="lineno"><a class="line" href="../../d1/d98/classCSimulation.html#a9941423d85fd30f67adf5870c97da675">   74</a></span><a class="code hl_class" href="../../d6/d0d/classCGeom2DIPoint.html">CGeom2DIPoint</a> <a class="code hl_function" href="../../d1/d98/classCSimulation.html#a9941423d85fd30f67adf5870c97da675">CSimulation::PtiFollowWaveAngle</a>(<a class="code hl_class" href="../../d6/d0d/classCGeom2DIPoint.html">CGeom2DIPoint</a> <span class="keyword">const</span>* pPtiLast, <span class="keywordtype">double</span> <span class="keyword">const</span> dWaveAngleIn, <span class="keywordtype">double</span>&amp; dCorrection)</div>
<div class="line"><a id="l00075" name="l00075"></a><span class="lineno">   75</span>{</div>
<div class="line"><a id="l00076" name="l00076"></a><span class="lineno">   76</span>   <span class="keywordtype">int</span> <span class="keyword">const</span> nXLast = pPtiLast-&gt;<a class="code hl_function" href="../../d6/d0d/classCGeom2DIPoint.html#af84c687b2d0be01ab41cbcc0565f4f3f">nGetX</a>();</div>
<div class="line"><a id="l00077" name="l00077"></a><span class="lineno">   77</span>   <span class="keywordtype">int</span> <span class="keyword">const</span> nYLast = pPtiLast-&gt;<a class="code hl_function" href="../../d6/d0d/classCGeom2DIPoint.html#a4d9c20bcca90dcb9d519b664aba09cbd">nGetY</a>();</div>
<div class="line"><a id="l00078" name="l00078"></a><span class="lineno">   78</span>   <span class="keywordtype">int</span> nXNext = nXLast;</div>
<div class="line"><a id="l00079" name="l00079"></a><span class="lineno">   79</span>   <span class="keywordtype">int</span> nYNext = nYLast;</div>
<div class="line"><a id="l00080" name="l00080"></a><span class="lineno">   80</span> </div>
<div class="line"><a id="l00081" name="l00081"></a><span class="lineno">   81</span>   <span class="keywordtype">double</span> <span class="keyword">const</span> dWaveAngle = dWaveAngleIn - dCorrection;</div>
<div class="line"><a id="l00082" name="l00082"></a><span class="lineno">   82</span> </div>
<div class="line"><a id="l00083" name="l00083"></a><span class="lineno">   83</span>   <span class="keywordflow">if</span> (dWaveAngle &lt; 22.5)</div>
<div class="line"><a id="l00084" name="l00084"></a><span class="lineno">   84</span>   {</div>
<div class="line"><a id="l00085" name="l00085"></a><span class="lineno">   85</span>      nYNext--;</div>
<div class="line"><a id="l00086" name="l00086"></a><span class="lineno">   86</span>      dCorrection = 22.5 - dWaveAngle;</div>
<div class="line"><a id="l00087" name="l00087"></a><span class="lineno">   87</span>   }</div>
<div class="line"><a id="l00088" name="l00088"></a><span class="lineno">   88</span>   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dWaveAngle &lt; 67.5)</div>
<div class="line"><a id="l00089" name="l00089"></a><span class="lineno">   89</span>   {</div>
<div class="line"><a id="l00090" name="l00090"></a><span class="lineno">   90</span>      nYNext--;</div>
<div class="line"><a id="l00091" name="l00091"></a><span class="lineno">   91</span>      nXNext++;</div>
<div class="line"><a id="l00092" name="l00092"></a><span class="lineno">   92</span>      dCorrection = 67.5 - dWaveAngle;</div>
<div class="line"><a id="l00093" name="l00093"></a><span class="lineno">   93</span>   }</div>
<div class="line"><a id="l00094" name="l00094"></a><span class="lineno">   94</span>   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dWaveAngle &lt; 112.5)</div>
<div class="line"><a id="l00095" name="l00095"></a><span class="lineno">   95</span>   {</div>
<div class="line"><a id="l00096" name="l00096"></a><span class="lineno">   96</span>      nXNext++;</div>
<div class="line"><a id="l00097" name="l00097"></a><span class="lineno">   97</span>      dCorrection = 112.5 - dWaveAngle;</div>
<div class="line"><a id="l00098" name="l00098"></a><span class="lineno">   98</span>   }</div>
<div class="line"><a id="l00099" name="l00099"></a><span class="lineno">   99</span>   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dWaveAngle &lt; 157.5)</div>
<div class="line"><a id="l00100" name="l00100"></a><span class="lineno">  100</span>   {</div>
<div class="line"><a id="l00101" name="l00101"></a><span class="lineno">  101</span>      nXNext++;</div>
<div class="line"><a id="l00102" name="l00102"></a><span class="lineno">  102</span>      nYNext++;</div>
<div class="line"><a id="l00103" name="l00103"></a><span class="lineno">  103</span>      dCorrection = 157.5 - dWaveAngle;</div>
<div class="line"><a id="l00104" name="l00104"></a><span class="lineno">  104</span>   }</div>
<div class="line"><a id="l00105" name="l00105"></a><span class="lineno">  105</span>   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dWaveAngle &lt; 202.5)</div>
<div class="line"><a id="l00106" name="l00106"></a><span class="lineno">  106</span>   {</div>
<div class="line"><a id="l00107" name="l00107"></a><span class="lineno">  107</span>      nYNext++;</div>
<div class="line"><a id="l00108" name="l00108"></a><span class="lineno">  108</span>      dCorrection = 202.5 - dWaveAngle;</div>
<div class="line"><a id="l00109" name="l00109"></a><span class="lineno">  109</span>   }</div>
<div class="line"><a id="l00110" name="l00110"></a><span class="lineno">  110</span>   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dWaveAngle &lt; 247.5)</div>
<div class="line"><a id="l00111" name="l00111"></a><span class="lineno">  111</span>   {</div>
<div class="line"><a id="l00112" name="l00112"></a><span class="lineno">  112</span>      nXNext--;</div>
<div class="line"><a id="l00113" name="l00113"></a><span class="lineno">  113</span>      nYNext++;</div>
<div class="line"><a id="l00114" name="l00114"></a><span class="lineno">  114</span>      dCorrection = 247.5 - dWaveAngle;</div>
<div class="line"><a id="l00115" name="l00115"></a><span class="lineno">  115</span>   }</div>
<div class="line"><a id="l00116" name="l00116"></a><span class="lineno">  116</span>   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dWaveAngle &lt; 292.5)</div>
<div class="line"><a id="l00117" name="l00117"></a><span class="lineno">  117</span>   {</div>
<div class="line"><a id="l00118" name="l00118"></a><span class="lineno">  118</span>      nXNext--;</div>
<div class="line"><a id="l00119" name="l00119"></a><span class="lineno">  119</span>      dCorrection = 292.5 - dWaveAngle;</div>
<div class="line"><a id="l00120" name="l00120"></a><span class="lineno">  120</span>   }</div>
<div class="line"><a id="l00121" name="l00121"></a><span class="lineno">  121</span>   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dWaveAngle &lt; 337.5)</div>
<div class="line"><a id="l00122" name="l00122"></a><span class="lineno">  122</span>   {</div>
<div class="line"><a id="l00123" name="l00123"></a><span class="lineno">  123</span>      nXNext--;</div>
<div class="line"><a id="l00124" name="l00124"></a><span class="lineno">  124</span>      nYNext--;</div>
<div class="line"><a id="l00125" name="l00125"></a><span class="lineno">  125</span>      dCorrection = 337.5 - dWaveAngle;</div>
<div class="line"><a id="l00126" name="l00126"></a><span class="lineno">  126</span>   }</div>
<div class="line"><a id="l00127" name="l00127"></a><span class="lineno">  127</span>   <span class="keywordflow">else</span></div>
<div class="line"><a id="l00128" name="l00128"></a><span class="lineno">  128</span>   {</div>
<div class="line"><a id="l00129" name="l00129"></a><span class="lineno">  129</span>      nYNext--;</div>
<div class="line"><a id="l00130" name="l00130"></a><span class="lineno">  130</span>      dCorrection = 22.5 - dWaveAngle;</div>
<div class="line"><a id="l00131" name="l00131"></a><span class="lineno">  131</span>   }</div>
<div class="line"><a id="l00132" name="l00132"></a><span class="lineno">  132</span> </div>
<div class="line"><a id="l00133" name="l00133"></a><span class="lineno">  133</span>   dCorrection = <a class="code hl_function" href="../../d1/d98/classCSimulation.html#a425803ba4110668094dba54c0f9b91c8">dKeepWithin360</a>(dCorrection);</div>
<div class="line"><a id="l00134" name="l00134"></a><span class="lineno">  134</span> </div>
<div class="line"><a id="l00135" name="l00135"></a><span class="lineno">  135</span>   <span class="keywordflow">return</span> <a class="code hl_class" href="../../d6/d0d/classCGeom2DIPoint.html">CGeom2DIPoint</a>(nXNext, nYNext);</div>
<div class="line"><a id="l00136" name="l00136"></a><span class="lineno">  136</span>}</div>
</div>
<div class="line"><a id="l00137" name="l00137"></a><span class="lineno">  137</span> </div>
<div class="line"><a id="l00138" name="l00138"></a><span class="lineno">  138</span><span class="comment">//===============================================================================================================================</span></div>
<div class="line"><a id="l00140" name="l00140"></a><span class="lineno">  140</span><span class="comment">//===============================================================================================================================</span></div>
<div class="foldopen" id="foldopen00141" data-start="{" data-end="}">
<div class="line"><a id="l00141" name="l00141"></a><span class="lineno"><a class="line" href="../../d1/d98/classCSimulation.html#a4183ba0c6f5e8376ead62d0ded3e4c73">  141</a></span><span class="keywordtype">int</span> <a class="code hl_function" href="../../d1/d98/classCSimulation.html#a4183ba0c6f5e8376ead62d0ded3e4c73">CSimulation::nDoAllShadowZones</a>(<span class="keywordtype">void</span>)</div>
<div class="line"><a id="l00142" name="l00142"></a><span class="lineno">  142</span>{</div>
<div class="line"><a id="l00143" name="l00143"></a><span class="lineno">  143</span>   <span class="keywordflow">if</span> (<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a0245d3cbdd603fbeced6ca1465eb3f16">m_nLogFileDetail</a> &gt;= <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a540d8a94fc09b0b14fd8ab657445b67a">LOG_FILE_MIDDLE_DETAIL</a>)</div>
<div class="line"><a id="l00144" name="l00144"></a><span class="lineno">  144</span>      <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a222962121613613a48f518e0c2110f21">LogStream</a> &lt;&lt; endl &lt;&lt; <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#ad67e8c5b30a0572f64ecfb5c062c2edc">m_ulIter</a> &lt;&lt; <span class="stringliteral">&quot;: Finding shadow zones&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a id="l00145" name="l00145"></a><span class="lineno">  145</span> </div>
<div class="line"><a id="l00146" name="l00146"></a><span class="lineno">  146</span>   <span class="comment">// Do this once for each coastline</span></div>
<div class="line"><a id="l00147" name="l00147"></a><span class="lineno">  147</span>   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> nCoast = 0; nCoast &lt; static_cast&lt;int&gt;(<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>.size()); nCoast++)</div>
<div class="line"><a id="l00148" name="l00148"></a><span class="lineno">  148</span>   {</div>
<div class="line"><a id="l00149" name="l00149"></a><span class="lineno">  149</span>      <span class="comment">// =========================================================================================================================</span></div>
<div class="line"><a id="l00150" name="l00150"></a><span class="lineno">  150</span>      <span class="comment">// The first stage: find coastline start points for possible shadow zone boundaries by sweeping the coastline: first down-coast then up-coast</span></div>
<div class="line"><a id="l00151" name="l00151"></a><span class="lineno">  151</span>      <span class="keywordtype">int</span> <span class="keyword">const</span> nSeaHand = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].nGetSeaHandedness();</div>
<div class="line"><a id="l00152" name="l00152"></a><span class="lineno">  152</span>      <span class="keywordtype">int</span> <span class="keyword">const</span> nCoastSize = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].nGetCoastlineSize();</div>
<div class="line"><a id="l00153" name="l00153"></a><span class="lineno">  153</span>      vector&lt;int&gt; VnPossibleShadowBoundaryCoastPoint;</div>
<div class="line"><a id="l00154" name="l00154"></a><span class="lineno">  154</span> </div>
<div class="line"><a id="l00155" name="l00155"></a><span class="lineno">  155</span>      <span class="keywordflow">for</span> (<span class="keywordtype">bool</span> bDownCoast : {<span class="keyword">true</span>, <span class="keyword">false</span>})</div>
<div class="line"><a id="l00156" name="l00156"></a><span class="lineno">  156</span>      {</div>
<div class="line"><a id="l00157" name="l00157"></a><span class="lineno">  157</span>         <span class="keywordflow">if</span> (bDownCoast)</div>
<div class="line"><a id="l00158" name="l00158"></a><span class="lineno">  158</span>         {</div>
<div class="line"><a id="l00159" name="l00159"></a><span class="lineno">  159</span>            <span class="keywordtype">bool</span> bLastDownCoastAndOnshore = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00160" name="l00160"></a><span class="lineno">  160</span> </div>
<div class="line"><a id="l00161" name="l00161"></a><span class="lineno">  161</span>            <span class="comment">// Work along coast in down-coast direction</span></div>
<div class="line"><a id="l00162" name="l00162"></a><span class="lineno">  162</span>            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> nCoastPoint = 0; nCoastPoint &lt; nCoastSize; nCoastPoint++)</div>
<div class="line"><a id="l00163" name="l00163"></a><span class="lineno">  163</span>            {</div>
<div class="line"><a id="l00164" name="l00164"></a><span class="lineno">  164</span>               <span class="comment">// Get the coast&#39;s smoothed curvature at this point</span></div>
<div class="line"><a id="l00165" name="l00165"></a><span class="lineno">  165</span>               <span class="keywordtype">double</span> <span class="keyword">const</span> dCurvature = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].dGetSmoothCurvature(nCoastPoint);</div>
<div class="line"><a id="l00166" name="l00166"></a><span class="lineno">  166</span>               <span class="keywordflow">if</span> (dCurvature &lt;= 0)</div>
<div class="line"><a id="l00167" name="l00167"></a><span class="lineno">  167</span>               {</div>
<div class="line"><a id="l00168" name="l00168"></a><span class="lineno">  168</span>                  <span class="comment">// OK, the coast is convex (-ve) or straight (0) here, now get the flux orientation (a tangent to the coastline)</span></div>
<div class="line"><a id="l00169" name="l00169"></a><span class="lineno">  169</span>                  <span class="keywordtype">double</span> <span class="keyword">const</span> dFluxOrientation = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].dGetFluxOrientation(nCoastPoint);</div>
<div class="line"><a id="l00170" name="l00170"></a><span class="lineno">  170</span> </div>
<div class="line"><a id="l00171" name="l00171"></a><span class="lineno">  171</span>                  <span class="comment">// If this coast point is in the active zone, use the breaking wave orientation, otherwise use the deep water wave orientation</span></div>
<div class="line"><a id="l00172" name="l00172"></a><span class="lineno">  172</span>                  <span class="keywordtype">double</span> dWaveAngle;</div>
<div class="line"><a id="l00173" name="l00173"></a><span class="lineno">  173</span> </div>
<div class="line"><a id="l00174" name="l00174"></a><span class="lineno">  174</span>                  <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d6/d2a/cme_8h.html#a61afa8560a3b39c80657661a1d8f76ab">bFPIsEqual</a>(<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].dGetDepthOfBreaking(nCoastPoint), <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#ac003bdff958dca839f5d274f15786e07">DBL_NODATA</a>, <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a08b1623863ee3bd4300a8892de323722">TOLERANCE</a>))</div>
<div class="line"><a id="l00175" name="l00175"></a><span class="lineno">  175</span>                     <span class="comment">// Not in active zone</span></div>
<div class="line"><a id="l00176" name="l00176"></a><span class="lineno">  176</span>                     dWaveAngle = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].dGetCoastDeepWaterWaveAngle(nCoastPoint);</div>
<div class="line"><a id="l00177" name="l00177"></a><span class="lineno">  177</span>                  <span class="keywordflow">else</span></div>
<div class="line"><a id="l00178" name="l00178"></a><span class="lineno">  178</span>                     <span class="comment">// In active zone</span></div>
<div class="line"><a id="l00179" name="l00179"></a><span class="lineno">  179</span>                     dWaveAngle = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].dGetBreakingWaveAngle(nCoastPoint);</div>
<div class="line"><a id="l00180" name="l00180"></a><span class="lineno">  180</span> </div>
<div class="line"><a id="l00181" name="l00181"></a><span class="lineno">  181</span>                  <span class="comment">// At this point on the coast, are waves on- or off-shore, and up- or down-coast?</span></div>
<div class="line"><a id="l00182" name="l00182"></a><span class="lineno">  182</span>                  bDownCoast = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00183" name="l00183"></a><span class="lineno">  183</span>                  <span class="keywordtype">bool</span> <span class="keyword">const</span> bOnShore = <a class="code hl_function" href="../../d1/d98/classCSimulation.html#a84d43443a65822540eafb0a23b9ae99c">bOnOrOffShoreAndUpOrDownCoast</a>(dFluxOrientation, dWaveAngle, nSeaHand, bDownCoast);</div>
<div class="line"><a id="l00184" name="l00184"></a><span class="lineno">  184</span> </div>
<div class="line"><a id="l00185" name="l00185"></a><span class="lineno">  185</span>                  <span class="comment">// if (m_nLogFileDetail &gt;= LOG_FILE_ALL)</span></div>
<div class="line"><a id="l00186" name="l00186"></a><span class="lineno">  186</span>                  <span class="comment">// {</span></div>
<div class="line"><a id="l00187" name="l00187"></a><span class="lineno">  187</span>                  <span class="comment">//    CGeom2DPoint PtTmp1 = *m_VCoast[nCoast].pPtGetCoastlinePointExtCRS(nCoastPoint);</span></div>
<div class="line"><a id="l00188" name="l00188"></a><span class="lineno">  188</span>                  <span class="comment">//    LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: going down-coast along coast &quot; &lt;&lt; nCoast &lt;&lt; &quot; coast point &quot; &lt;&lt; nCoastPoint &lt;&lt; &quot; = {&quot; &lt;&lt; PtTmp1.dGetX() &lt;&lt; &quot;, &quot; &lt;&lt; PtTmp1.dGetY() &lt;&lt; &quot;} has &quot; &lt;&lt; (bDownCoast ? &quot;down-coast &quot; : &quot;up-coast &quot;) &lt;&lt; (bOnShore ? &quot;on-shore&quot; : &quot;off-shore&quot;) &lt;&lt; &quot; waves, dWaveAngle = &quot; &lt;&lt; dWaveAngle &lt;&lt; &quot; dFluxOrientation = &quot; &lt;&lt; dFluxOrientation &lt;&lt; endl;</span></div>
<div class="line"><a id="l00189" name="l00189"></a><span class="lineno">  189</span>                  <span class="comment">// }</span></div>
<div class="line"><a id="l00190" name="l00190"></a><span class="lineno">  190</span> </div>
<div class="line"><a id="l00191" name="l00191"></a><span class="lineno">  191</span>                  <span class="keywordflow">if</span> (bDownCoast &amp;&amp; (! bOnShore))</div>
<div class="line"><a id="l00192" name="l00192"></a><span class="lineno">  192</span>                  {</div>
<div class="line"><a id="l00193" name="l00193"></a><span class="lineno">  193</span>                     <span class="comment">// Waves are down-coast and off-shore</span></div>
<div class="line"><a id="l00194" name="l00194"></a><span class="lineno">  194</span>                     <span class="comment">// if (m_nLogFileDetail &gt;= LOG_FILE_ALL)</span></div>
<div class="line"><a id="l00195" name="l00195"></a><span class="lineno">  195</span>                     <span class="comment">// {</span></div>
<div class="line"><a id="l00196" name="l00196"></a><span class="lineno">  196</span>                     <span class="comment">//    CGeom2DPoint PtTmp1 = *m_VCoast[nCoast].pPtGetCoastlinePointExtCRS(nCoastPoint);</span></div>
<div class="line"><a id="l00197" name="l00197"></a><span class="lineno">  197</span>                     <span class="comment">//    LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: going down-coast along coast &quot; &lt;&lt; nCoast &lt;&lt; &quot; at coast point &quot; &lt;&lt; nCoastPoint &lt;&lt; &quot; = {&quot; &lt;&lt; PtTmp1.dGetX() &lt;&lt; &quot;, &quot; &lt;&lt; PtTmp1.dGetY() &lt;&lt; &quot;}, waves have off-shore and down-coast component&quot; &lt;&lt; endl;</span></div>
<div class="line"><a id="l00198" name="l00198"></a><span class="lineno">  198</span>                     <span class="comment">// }</span></div>
<div class="line"><a id="l00199" name="l00199"></a><span class="lineno">  199</span> </div>
<div class="line"><a id="l00200" name="l00200"></a><span class="lineno">  200</span>                     <span class="comment">// If the previous coast point had waves which were down-coast and on-shore, then this could be the boundary of a shadow zone</span></div>
<div class="line"><a id="l00201" name="l00201"></a><span class="lineno">  201</span>                     <span class="keywordflow">if</span> (bLastDownCoastAndOnshore)</div>
<div class="line"><a id="l00202" name="l00202"></a><span class="lineno">  202</span>                     {</div>
<div class="line"><a id="l00203" name="l00203"></a><span class="lineno">  203</span>                        VnPossibleShadowBoundaryCoastPoint.push_back(nCoastPoint);</div>
<div class="line"><a id="l00204" name="l00204"></a><span class="lineno">  204</span>                        bLastDownCoastAndOnshore = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00205" name="l00205"></a><span class="lineno">  205</span> </div>
<div class="line"><a id="l00206" name="l00206"></a><span class="lineno">  206</span>                        <span class="comment">// if (m_nLogFileDetail &gt;= LOG_FILE_ALL)</span></div>
<div class="line"><a id="l00207" name="l00207"></a><span class="lineno">  207</span>                        <span class="comment">// {</span></div>
<div class="line"><a id="l00208" name="l00208"></a><span class="lineno">  208</span>                        <span class="comment">//    CGeom2DPoint PtTmp = *m_VCoast[nCoast].pPtGetCoastlinePointExtCRS(nCoastPoint);</span></div>
<div class="line"><a id="l00209" name="l00209"></a><span class="lineno">  209</span>                        <span class="comment">//    LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: coast &quot; &lt;&lt; nCoast &lt;&lt; &quot; coast point &quot; &lt;&lt; nCoastPoint &lt;&lt; &quot; = {&quot; &lt;&lt; PtTmp.dGetX() &lt;&lt; &quot;, &quot; &lt;&lt; PtTmp.dGetY() &lt;&lt; &quot;} is possible shadow boundary start&quot; &lt;&lt; endl;</span></div>
<div class="line"><a id="l00210" name="l00210"></a><span class="lineno">  210</span>                        <span class="comment">// }</span></div>
<div class="line"><a id="l00211" name="l00211"></a><span class="lineno">  211</span>                     }</div>
<div class="line"><a id="l00212" name="l00212"></a><span class="lineno">  212</span>                  }</div>
<div class="line"><a id="l00213" name="l00213"></a><span class="lineno">  213</span>                  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bDownCoast &amp;&amp; bOnShore)</div>
<div class="line"><a id="l00214" name="l00214"></a><span class="lineno">  214</span>                  {</div>
<div class="line"><a id="l00215" name="l00215"></a><span class="lineno">  215</span>                     bLastDownCoastAndOnshore = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00216" name="l00216"></a><span class="lineno">  216</span>                  }</div>
<div class="line"><a id="l00217" name="l00217"></a><span class="lineno">  217</span>                  <span class="keywordflow">else</span></div>
<div class="line"><a id="l00218" name="l00218"></a><span class="lineno">  218</span>                  {</div>
<div class="line"><a id="l00219" name="l00219"></a><span class="lineno">  219</span>                     bLastDownCoastAndOnshore = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00220" name="l00220"></a><span class="lineno">  220</span>                  }</div>
<div class="line"><a id="l00221" name="l00221"></a><span class="lineno">  221</span>               }</div>
<div class="line"><a id="l00222" name="l00222"></a><span class="lineno">  222</span>            }</div>
<div class="line"><a id="l00223" name="l00223"></a><span class="lineno">  223</span>         }</div>
<div class="line"><a id="l00224" name="l00224"></a><span class="lineno">  224</span>         <span class="keywordflow">else</span></div>
<div class="line"><a id="l00225" name="l00225"></a><span class="lineno">  225</span>         {</div>
<div class="line"><a id="l00226" name="l00226"></a><span class="lineno">  226</span>            <span class="comment">// Moving along coast in up-coast direction</span></div>
<div class="line"><a id="l00227" name="l00227"></a><span class="lineno">  227</span>            <span class="keywordtype">bool</span> bLastUpCoastAndOnshore = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00228" name="l00228"></a><span class="lineno">  228</span> </div>
<div class="line"><a id="l00229" name="l00229"></a><span class="lineno">  229</span>            <span class="comment">// Work along coast in up-coast direction</span></div>
<div class="line"><a id="l00230" name="l00230"></a><span class="lineno">  230</span>            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> nCoastPoint = nCoastSize - 1; nCoastPoint &gt;= 0; nCoastPoint--)</div>
<div class="line"><a id="l00231" name="l00231"></a><span class="lineno">  231</span>            {</div>
<div class="line"><a id="l00232" name="l00232"></a><span class="lineno">  232</span>               <span class="comment">// Get the coast&#39;s smoothed curvature at this point</span></div>
<div class="line"><a id="l00233" name="l00233"></a><span class="lineno">  233</span>               <span class="keywordtype">double</span> <span class="keyword">const</span> dCurvature = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].dGetSmoothCurvature(nCoastPoint);</div>
<div class="line"><a id="l00234" name="l00234"></a><span class="lineno">  234</span>               <span class="keywordflow">if</span> (dCurvature &lt;= 0)</div>
<div class="line"><a id="l00235" name="l00235"></a><span class="lineno">  235</span>               {</div>
<div class="line"><a id="l00236" name="l00236"></a><span class="lineno">  236</span>                  <span class="comment">// OK, the coast is convex (-ve) or straight (0) here, now get the flux orientation (a tangent to the coastline)</span></div>
<div class="line"><a id="l00237" name="l00237"></a><span class="lineno">  237</span>                  <span class="keywordtype">double</span> <span class="keyword">const</span> dFluxOrientation = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].dGetFluxOrientation(nCoastPoint);</div>
<div class="line"><a id="l00238" name="l00238"></a><span class="lineno">  238</span> </div>
<div class="line"><a id="l00239" name="l00239"></a><span class="lineno">  239</span>                  <span class="comment">// If this coast point is in the active zone, use the breaking wave orientation, otherwise use the deep water wave orientation</span></div>
<div class="line"><a id="l00240" name="l00240"></a><span class="lineno">  240</span>                  <span class="keywordtype">double</span> dWaveAngle;</div>
<div class="line"><a id="l00241" name="l00241"></a><span class="lineno">  241</span> </div>
<div class="line"><a id="l00242" name="l00242"></a><span class="lineno">  242</span>                  <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d6/d2a/cme_8h.html#a61afa8560a3b39c80657661a1d8f76ab">bFPIsEqual</a>(<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].dGetDepthOfBreaking(nCoastPoint), <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#ac003bdff958dca839f5d274f15786e07">DBL_NODATA</a>, <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a08b1623863ee3bd4300a8892de323722">TOLERANCE</a>))</div>
<div class="line"><a id="l00243" name="l00243"></a><span class="lineno">  243</span>                     <span class="comment">// Not in active zone</span></div>
<div class="line"><a id="l00244" name="l00244"></a><span class="lineno">  244</span>                     dWaveAngle = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].dGetCoastDeepWaterWaveAngle(nCoastPoint);</div>
<div class="line"><a id="l00245" name="l00245"></a><span class="lineno">  245</span>                  <span class="keywordflow">else</span></div>
<div class="line"><a id="l00246" name="l00246"></a><span class="lineno">  246</span>                     <span class="comment">// In active zone</span></div>
<div class="line"><a id="l00247" name="l00247"></a><span class="lineno">  247</span>                     dWaveAngle = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].dGetBreakingWaveAngle(nCoastPoint);</div>
<div class="line"><a id="l00248" name="l00248"></a><span class="lineno">  248</span> </div>
<div class="line"><a id="l00249" name="l00249"></a><span class="lineno">  249</span>                  <span class="comment">// At this point on the coast, are waves on- or off-shore, and up- or down-coast?</span></div>
<div class="line"><a id="l00250" name="l00250"></a><span class="lineno">  250</span>                  bDownCoast = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00251" name="l00251"></a><span class="lineno">  251</span>                  <span class="keywordtype">bool</span> <span class="keyword">const</span> bOnShore = <a class="code hl_function" href="../../d1/d98/classCSimulation.html#a84d43443a65822540eafb0a23b9ae99c">bOnOrOffShoreAndUpOrDownCoast</a>(dFluxOrientation, dWaveAngle, nSeaHand, bDownCoast);</div>
<div class="line"><a id="l00252" name="l00252"></a><span class="lineno">  252</span> </div>
<div class="line"><a id="l00253" name="l00253"></a><span class="lineno">  253</span>                  <span class="comment">// if (m_nLogFileDetail &gt;= LOG_FILE_ALL)</span></div>
<div class="line"><a id="l00254" name="l00254"></a><span class="lineno">  254</span>                  <span class="comment">// {</span></div>
<div class="line"><a id="l00255" name="l00255"></a><span class="lineno">  255</span>                  <span class="comment">//    CGeom2DPoint PtTmp1 = *m_VCoast[nCoast].pPtGetCoastlinePointExtCRS(nCoastPoint);</span></div>
<div class="line"><a id="l00256" name="l00256"></a><span class="lineno">  256</span>                  <span class="comment">//    LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: going up-coast along coast &quot; &lt;&lt; nCoast &lt;&lt; &quot; coast point &quot; &lt;&lt; nCoastPoint &lt;&lt; &quot; = {&quot; &lt;&lt; PtTmp1.dGetX() &lt;&lt; &quot;, &quot; &lt;&lt; PtTmp1.dGetY() &lt;&lt; &quot;} has &quot; &lt;&lt; (bDownCoast ? &quot;down-coast &quot; : &quot;up-coast &quot;) &lt;&lt; (bOnShore ? &quot;on-shore&quot; : &quot;off-shore&quot;) &lt;&lt; &quot; waves, dWaveAngle = &quot; &lt;&lt; dWaveAngle &lt;&lt; &quot; dFluxOrientation = &quot; &lt;&lt; dFluxOrientation &lt;&lt; endl;</span></div>
<div class="line"><a id="l00257" name="l00257"></a><span class="lineno">  257</span>                  <span class="comment">// }</span></div>
<div class="line"><a id="l00258" name="l00258"></a><span class="lineno">  258</span> </div>
<div class="line"><a id="l00259" name="l00259"></a><span class="lineno">  259</span>                  <span class="keywordflow">if</span> ((! bDownCoast) &amp;&amp; (! bOnShore))</div>
<div class="line"><a id="l00260" name="l00260"></a><span class="lineno">  260</span>                  {</div>
<div class="line"><a id="l00261" name="l00261"></a><span class="lineno">  261</span>                     <span class="comment">// Waves are up-coast and off-shore</span></div>
<div class="line"><a id="l00262" name="l00262"></a><span class="lineno">  262</span>                     <span class="comment">// if (m_nLogFileDetail &gt;= LOG_FILE_ALL)</span></div>
<div class="line"><a id="l00263" name="l00263"></a><span class="lineno">  263</span>                     <span class="comment">// {</span></div>
<div class="line"><a id="l00264" name="l00264"></a><span class="lineno">  264</span>                     <span class="comment">//    CGeom2DPoint PtTmp1 = *m_VCoast[nCoast].pPtGetCoastlinePointExtCRS(nCoastPoint);</span></div>
<div class="line"><a id="l00265" name="l00265"></a><span class="lineno">  265</span>                     <span class="comment">//    LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: going up-coast along coast &quot; &lt;&lt; nCoast &lt;&lt; &quot; coast point &quot; &lt;&lt; nCoastPoint &lt;&lt; &quot; = {&quot; &lt;&lt; PtTmp1.dGetX() &lt;&lt; &quot;, &quot; &lt;&lt; PtTmp1.dGetY() &lt;&lt; &quot; has waves with off-shore and up-coast component&quot; &lt;&lt; endl;</span></div>
<div class="line"><a id="l00266" name="l00266"></a><span class="lineno">  266</span>                     <span class="comment">// }</span></div>
<div class="line"><a id="l00267" name="l00267"></a><span class="lineno">  267</span> </div>
<div class="line"><a id="l00268" name="l00268"></a><span class="lineno">  268</span>                     <span class="comment">// If the previous coast point had waves which were up-coast and on-shore, then this could be the boundary of a shadow zone</span></div>
<div class="line"><a id="l00269" name="l00269"></a><span class="lineno">  269</span>                     <span class="keywordflow">if</span> (bLastUpCoastAndOnshore)</div>
<div class="line"><a id="l00270" name="l00270"></a><span class="lineno">  270</span>                     {</div>
<div class="line"><a id="l00271" name="l00271"></a><span class="lineno">  271</span>                        VnPossibleShadowBoundaryCoastPoint.push_back(nCoastPoint);</div>
<div class="line"><a id="l00272" name="l00272"></a><span class="lineno">  272</span>                        bLastUpCoastAndOnshore = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00273" name="l00273"></a><span class="lineno">  273</span> </div>
<div class="line"><a id="l00274" name="l00274"></a><span class="lineno">  274</span>                        <span class="comment">// if (m_nLogFileDetail &gt;= LOG_FILE_ALL)</span></div>
<div class="line"><a id="l00275" name="l00275"></a><span class="lineno">  275</span>                        <span class="comment">// {</span></div>
<div class="line"><a id="l00276" name="l00276"></a><span class="lineno">  276</span>                        <span class="comment">//    CGeom2DPoint PtTmp = *m_VCoast[nCoast].pPtGetCoastlinePointExtCRS(nCoastPoint);</span></div>
<div class="line"><a id="l00277" name="l00277"></a><span class="lineno">  277</span>                        <span class="comment">//    LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: going up-coast long &quot; &lt;&lt; nCoast &lt;&lt; &quot; at coast point &quot; &lt;&lt; nCoastPoint &lt;&lt; &quot; = {&quot; &lt;&lt; PtTmp.dGetX() &lt;&lt; &quot;, &quot; &lt;&lt; PtTmp.dGetY() &lt;&lt; &quot;} is possible shadow boundary start&quot; &lt;&lt; endl;</span></div>
<div class="line"><a id="l00278" name="l00278"></a><span class="lineno">  278</span>                        <span class="comment">// }</span></div>
<div class="line"><a id="l00279" name="l00279"></a><span class="lineno">  279</span>                     }</div>
<div class="line"><a id="l00280" name="l00280"></a><span class="lineno">  280</span>                  }</div>
<div class="line"><a id="l00281" name="l00281"></a><span class="lineno">  281</span>                  <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((! bDownCoast) &amp;&amp; bOnShore)</div>
<div class="line"><a id="l00282" name="l00282"></a><span class="lineno">  282</span>                  {</div>
<div class="line"><a id="l00283" name="l00283"></a><span class="lineno">  283</span>                     bLastUpCoastAndOnshore = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00284" name="l00284"></a><span class="lineno">  284</span>                  }</div>
<div class="line"><a id="l00285" name="l00285"></a><span class="lineno">  285</span>                  <span class="keywordflow">else</span></div>
<div class="line"><a id="l00286" name="l00286"></a><span class="lineno">  286</span>                  {</div>
<div class="line"><a id="l00287" name="l00287"></a><span class="lineno">  287</span>                     bLastUpCoastAndOnshore = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00288" name="l00288"></a><span class="lineno">  288</span>                  }</div>
<div class="line"><a id="l00289" name="l00289"></a><span class="lineno">  289</span>               }</div>
<div class="line"><a id="l00290" name="l00290"></a><span class="lineno">  290</span>            }</div>
<div class="line"><a id="l00291" name="l00291"></a><span class="lineno">  291</span>         }</div>
<div class="line"><a id="l00292" name="l00292"></a><span class="lineno">  292</span>      }</div>
<div class="line"><a id="l00293" name="l00293"></a><span class="lineno">  293</span> </div>
<div class="line"><a id="l00294" name="l00294"></a><span class="lineno">  294</span>      <span class="keywordflow">if</span> (VnPossibleShadowBoundaryCoastPoint.size() == 0)</div>
<div class="line"><a id="l00295" name="l00295"></a><span class="lineno">  295</span>      {</div>
<div class="line"><a id="l00296" name="l00296"></a><span class="lineno">  296</span>         <span class="keywordflow">if</span> (<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a0245d3cbdd603fbeced6ca1465eb3f16">m_nLogFileDetail</a> &gt;= <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a85da1142fa4655ec66f1e391444a6d9a">LOG_FILE_HIGH_DETAIL</a>)</div>
<div class="line"><a id="l00297" name="l00297"></a><span class="lineno">  297</span>            <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a222962121613613a48f518e0c2110f21">LogStream</a> &lt;&lt; <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#ad67e8c5b30a0572f64ecfb5c062c2edc">m_ulIter</a> &lt;&lt; <span class="stringliteral">&quot;: no shadow boundary start points found&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a id="l00298" name="l00298"></a><span class="lineno">  298</span> </div>
<div class="line"><a id="l00299" name="l00299"></a><span class="lineno">  299</span>         <span class="keywordflow">return</span> <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#aa768cb14b5c6123ee95e6e4ebd9fe331">RTN_OK</a>;</div>
<div class="line"><a id="l00300" name="l00300"></a><span class="lineno">  300</span>      }</div>
<div class="line"><a id="l00301" name="l00301"></a><span class="lineno">  301</span> </div>
<div class="line"><a id="l00302" name="l00302"></a><span class="lineno">  302</span>      <span class="comment">// =========================================================================================================================</span></div>
<div class="line"><a id="l00303" name="l00303"></a><span class="lineno">  303</span>      <span class="comment">// The second stage: we have a list of possible shadow zone start points, trace each of these &#39;up-wave&#39; to identify valid shadow zones</span></div>
<div class="line"><a id="l00304" name="l00304"></a><span class="lineno">  304</span>      <span class="comment">// LogStream &lt;&lt; VnPossibleShadowBoundaryCoastPoint.size() &lt;&lt; &quot; start points&quot; &lt;&lt; endl;</span></div>
<div class="line"><a id="l00305" name="l00305"></a><span class="lineno">  305</span> </div>
<div class="line"><a id="l00306" name="l00306"></a><span class="lineno">  306</span>      vector&lt;CGeomILine&gt; VILShadowBoundary;</div>
<div class="line"><a id="l00307" name="l00307"></a><span class="lineno">  307</span>      vector&lt;int&gt; VnShadowBoundaryStartCoastPoint;</div>
<div class="line"><a id="l00308" name="l00308"></a><span class="lineno">  308</span>      vector&lt;int&gt; VnShadowBoundaryEndCoastPoint;</div>
<div class="line"><a id="l00309" name="l00309"></a><span class="lineno">  309</span> </div>
<div class="line"><a id="l00310" name="l00310"></a><span class="lineno">  310</span>      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> nStartPoint = 0; nStartPoint &lt; static_cast&lt;int&gt;(VnPossibleShadowBoundaryCoastPoint.size()); nStartPoint++)</div>
<div class="line"><a id="l00311" name="l00311"></a><span class="lineno">  311</span>      {</div>
<div class="line"><a id="l00312" name="l00312"></a><span class="lineno">  312</span>         <span class="comment">// if (m_nLogFileDetail &gt;= LOG_FILE_ALL)</span></div>
<div class="line"><a id="l00313" name="l00313"></a><span class="lineno">  313</span>         <span class="comment">//    LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: coast &quot; &lt;&lt; nCoast &lt;&lt; &quot; processing possible shadow boundary start point &quot; &lt;&lt; nStartPoint &lt;&lt; &quot; of &quot; &lt;&lt; VnPossibleShadowBoundaryCoastPoint.size() &lt;&lt; endl;</span></div>
<div class="line"><a id="l00314" name="l00314"></a><span class="lineno">  314</span> </div>
<div class="line"><a id="l00315" name="l00315"></a><span class="lineno">  315</span>         <span class="keywordtype">bool</span> bHitEdge = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00316" name="l00316"></a><span class="lineno">  316</span>         <span class="keywordtype">bool</span> bHitCoast = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00317" name="l00317"></a><span class="lineno">  317</span>         <span class="keywordtype">bool</span> bHitSea = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00318" name="l00318"></a><span class="lineno">  318</span>         <span class="keywordtype">bool</span> bInLoop = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00319" name="l00319"></a><span class="lineno">  319</span>         <span class="keywordtype">bool</span> bStillInland = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00320" name="l00320"></a><span class="lineno">  320</span> </div>
<div class="line"><a id="l00321" name="l00321"></a><span class="lineno">  321</span>         <span class="comment">// From each start point, follow the wave direction</span></div>
<div class="line"><a id="l00322" name="l00322"></a><span class="lineno">  322</span>         <a class="code hl_class" href="../../dd/dc1/classCGeomILine.html">CGeomILine</a> ILShadowBoundary;</div>
<div class="line"><a id="l00323" name="l00323"></a><span class="lineno">  323</span> </div>
<div class="line"><a id="l00324" name="l00324"></a><span class="lineno">  324</span>         <span class="comment">// If this coast point is in the active zone, start with the breaking wave orientation, otherwise use the deep water wave orientation</span></div>
<div class="line"><a id="l00325" name="l00325"></a><span class="lineno">  325</span>         <span class="keywordtype">double</span> dPrevWaveAngle;</div>
<div class="line"><a id="l00326" name="l00326"></a><span class="lineno">  326</span> </div>
<div class="line"><a id="l00327" name="l00327"></a><span class="lineno">  327</span>         <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d6/d2a/cme_8h.html#a61afa8560a3b39c80657661a1d8f76ab">bFPIsEqual</a>(<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].dGetDepthOfBreaking(nStartPoint), <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#ac003bdff958dca839f5d274f15786e07">DBL_NODATA</a>, <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a08b1623863ee3bd4300a8892de323722">TOLERANCE</a>))</div>
<div class="line"><a id="l00328" name="l00328"></a><span class="lineno">  328</span>         {</div>
<div class="line"><a id="l00329" name="l00329"></a><span class="lineno">  329</span>            <span class="comment">// Not in active zone</span></div>
<div class="line"><a id="l00330" name="l00330"></a><span class="lineno">  330</span>            dPrevWaveAngle = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].dGetCoastDeepWaterWaveAngle(nStartPoint);</div>
<div class="line"><a id="l00331" name="l00331"></a><span class="lineno">  331</span>         }</div>
<div class="line"><a id="l00332" name="l00332"></a><span class="lineno">  332</span>         <span class="keywordflow">else</span></div>
<div class="line"><a id="l00333" name="l00333"></a><span class="lineno">  333</span>         {</div>
<div class="line"><a id="l00334" name="l00334"></a><span class="lineno">  334</span>            <span class="comment">// In active zone</span></div>
<div class="line"><a id="l00335" name="l00335"></a><span class="lineno">  335</span>            dPrevWaveAngle = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].dGetBreakingWaveAngle(nStartPoint);</div>
<div class="line"><a id="l00336" name="l00336"></a><span class="lineno">  336</span>         }</div>
<div class="line"><a id="l00337" name="l00337"></a><span class="lineno">  337</span> </div>
<div class="line"><a id="l00338" name="l00338"></a><span class="lineno">  338</span>         <a class="code hl_class" href="../../d6/d0d/classCGeom2DIPoint.html">CGeom2DIPoint</a> PtiPrev = *<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].pPtiGetCellMarkedAsCoastline(VnPossibleShadowBoundaryCoastPoint[nStartPoint]);</div>
<div class="line"><a id="l00339" name="l00339"></a><span class="lineno">  339</span>         ILShadowBoundary.<a class="code hl_function" href="../../d2/d0f/classCA2DIShape.html#ab181578766d0cacb30c7ad0d695bf595">Append</a>(&amp;PtiPrev);</div>
<div class="line"><a id="l00340" name="l00340"></a><span class="lineno">  340</span> </div>
<div class="line"><a id="l00341" name="l00341"></a><span class="lineno">  341</span>         <span class="keywordtype">int</span> nDist = 0;</div>
<div class="line"><a id="l00342" name="l00342"></a><span class="lineno">  342</span>         <span class="keywordtype">double</span> dCorrection = 0;</div>
<div class="line"><a id="l00343" name="l00343"></a><span class="lineno">  343</span>         deque&lt;double&gt; DQdPrevOrientations;</div>
<div class="line"><a id="l00344" name="l00344"></a><span class="lineno">  344</span> </div>
<div class="line"><a id="l00345" name="l00345"></a><span class="lineno">  345</span>         <span class="keywordflow">while</span> ((! bHitEdge) &amp;&amp; (! bHitCoast))</div>
<div class="line"><a id="l00346" name="l00346"></a><span class="lineno">  346</span>         {</div>
<div class="line"><a id="l00347" name="l00347"></a><span class="lineno">  347</span>            <span class="comment">// int nShadowBoundaryCoastPoint = -1;</span></div>
<div class="line"><a id="l00348" name="l00348"></a><span class="lineno">  348</span> </div>
<div class="line"><a id="l00349" name="l00349"></a><span class="lineno">  349</span>            <span class="keywordflow">if</span> (nDist &gt; 0)</div>
<div class="line"><a id="l00350" name="l00350"></a><span class="lineno">  350</span>            {</div>
<div class="line"><a id="l00351" name="l00351"></a><span class="lineno">  351</span>               <span class="keywordtype">int</span> <span class="keyword">const</span> nXPrev = PtiPrev.<a class="code hl_function" href="../../d6/d0d/classCGeom2DIPoint.html#af84c687b2d0be01ab41cbcc0565f4f3f">nGetX</a>();</div>
<div class="line"><a id="l00352" name="l00352"></a><span class="lineno">  352</span>               <span class="keywordtype">int</span> <span class="keyword">const</span> nYPrev = PtiPrev.<a class="code hl_function" href="../../d6/d0d/classCGeom2DIPoint.html#a4d9c20bcca90dcb9d519b664aba09cbd">nGetY</a>();</div>
<div class="line"><a id="l00353" name="l00353"></a><span class="lineno">  353</span> </div>
<div class="line"><a id="l00354" name="l00354"></a><span class="lineno">  354</span>               <span class="keywordflow">if</span> (! <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nXPrev][nYPrev].bIsInActiveZone())</div>
<div class="line"><a id="l00355" name="l00355"></a><span class="lineno">  355</span>               {</div>
<div class="line"><a id="l00356" name="l00356"></a><span class="lineno">  356</span>                  <span class="comment">// The previous cell was outside the active zone, so use its wave orientation value</span></div>
<div class="line"><a id="l00357" name="l00357"></a><span class="lineno">  357</span>                  dPrevWaveAngle = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nXPrev][nYPrev].dGetWaveAngle();</div>
<div class="line"><a id="l00358" name="l00358"></a><span class="lineno">  358</span>               }</div>
<div class="line"><a id="l00359" name="l00359"></a><span class="lineno">  359</span>               <span class="keywordflow">else</span></div>
<div class="line"><a id="l00360" name="l00360"></a><span class="lineno">  360</span>               {</div>
<div class="line"><a id="l00361" name="l00361"></a><span class="lineno">  361</span>                  <span class="comment">// The previous cell was in the active zone</span></div>
<div class="line"><a id="l00362" name="l00362"></a><span class="lineno">  362</span>                  <span class="keywordflow">if</span> (bHitSea)</div>
<div class="line"><a id="l00363" name="l00363"></a><span class="lineno">  363</span>                  {</div>
<div class="line"><a id="l00364" name="l00364"></a><span class="lineno">  364</span>                     <span class="comment">// If this shadow boundary has already hit sea, then we must be getting near a coast: use the average-so-far wave orientation</span></div>
<div class="line"><a id="l00365" name="l00365"></a><span class="lineno">  365</span>                     <span class="keywordtype">double</span> <span class="keyword">const</span> dAvgOrientationSoFar = accumulate(DQdPrevOrientations.begin(), DQdPrevOrientations.end(), 0.0) / <span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>(DQdPrevOrientations.size());</div>
<div class="line"><a id="l00366" name="l00366"></a><span class="lineno">  366</span> </div>
<div class="line"><a id="l00367" name="l00367"></a><span class="lineno">  367</span>                     dPrevWaveAngle = dAvgOrientationSoFar;</div>
<div class="line"><a id="l00368" name="l00368"></a><span class="lineno">  368</span>                  }</div>
<div class="line"><a id="l00369" name="l00369"></a><span class="lineno">  369</span>                  <span class="keywordflow">else</span></div>
<div class="line"><a id="l00370" name="l00370"></a><span class="lineno">  370</span>                  {</div>
<div class="line"><a id="l00371" name="l00371"></a><span class="lineno">  371</span>                     <span class="comment">// This shadow boundary has not already hit sea, just use the wave orientation from the previous cell</span></div>
<div class="line"><a id="l00372" name="l00372"></a><span class="lineno">  372</span>                     dPrevWaveAngle = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nXPrev][nYPrev].dGetWaveAngle();</div>
<div class="line"><a id="l00373" name="l00373"></a><span class="lineno">  373</span> </div>
<div class="line"><a id="l00374" name="l00374"></a><span class="lineno">  374</span>                     <span class="comment">// LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: not already hit sea, using previous cell&#39;s wave orientation for cell [&quot; &lt;&lt; nXPrev &lt;&lt; &quot;][&quot; &lt;&lt; nYPrev &lt;&lt; &quot;] = {&quot; &lt;&lt; dGridCentroidXToExtCRSX(nXPrev) &lt;&lt; &quot;, &quot; &lt;&lt; dGridCentroidYToExtCRSY(nYPrev) &lt;&lt; &quot;}&quot; &lt;&lt; endl;</span></div>
<div class="line"><a id="l00375" name="l00375"></a><span class="lineno">  375</span>                  }</div>
<div class="line"><a id="l00376" name="l00376"></a><span class="lineno">  376</span>               }</div>
<div class="line"><a id="l00377" name="l00377"></a><span class="lineno">  377</span> </div>
<div class="line"><a id="l00378" name="l00378"></a><span class="lineno">  378</span>               <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d6/d2a/cme_8h.html#a61afa8560a3b39c80657661a1d8f76ab">bFPIsEqual</a>(dPrevWaveAngle, <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#ac003bdff958dca839f5d274f15786e07">DBL_NODATA</a>, <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a08b1623863ee3bd4300a8892de323722">TOLERANCE</a>))</div>
<div class="line"><a id="l00379" name="l00379"></a><span class="lineno">  379</span>               {</div>
<div class="line"><a id="l00380" name="l00380"></a><span class="lineno">  380</span>                  <span class="comment">// LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: dPrevWaveAngle == DBL_NODATA for cell [&quot; &lt;&lt; nXPrev &lt;&lt; &quot;][&quot; &lt;&lt; nYPrev &lt;&lt; &quot;] = {&quot; &lt;&lt; dGridCentroidXToExtCRSX(nXPrev) &lt;&lt; &quot;, &quot; &lt;&lt; dGridCentroidYToExtCRSY(nYPrev) &lt;&lt; &quot;}&quot; &lt;&lt; endl;</span></div>
<div class="line"><a id="l00381" name="l00381"></a><span class="lineno">  381</span> </div>
<div class="line"><a id="l00382" name="l00382"></a><span class="lineno">  382</span>                  <span class="keywordflow">if</span> (! <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nXPrev][nYPrev].bIsInContiguousSea())</div>
<div class="line"><a id="l00383" name="l00383"></a><span class="lineno">  383</span>                  {</div>
<div class="line"><a id="l00384" name="l00384"></a><span class="lineno">  384</span>                     <span class="comment">// The previous cell was an inland cell, so use the deep water wave orientation</span></div>
<div class="line"><a id="l00385" name="l00385"></a><span class="lineno">  385</span>                     dPrevWaveAngle = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nXPrev][nYPrev].dGetCellDeepWaterWaveAngle();</div>
<div class="line"><a id="l00386" name="l00386"></a><span class="lineno">  386</span>                  }</div>
<div class="line"><a id="l00387" name="l00387"></a><span class="lineno">  387</span>                  <span class="keywordflow">else</span></div>
<div class="line"><a id="l00388" name="l00388"></a><span class="lineno">  388</span>                  {</div>
<div class="line"><a id="l00389" name="l00389"></a><span class="lineno">  389</span>                     <span class="keywordtype">double</span> <span class="keyword">const</span> dAvgOrientationSoFar = accumulate(DQdPrevOrientations.begin(), DQdPrevOrientations.end(), 0.0) / <span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>(DQdPrevOrientations.size());</div>
<div class="line"><a id="l00390" name="l00390"></a><span class="lineno">  390</span> </div>
<div class="line"><a id="l00391" name="l00391"></a><span class="lineno">  391</span>                     dPrevWaveAngle = dAvgOrientationSoFar;</div>
<div class="line"><a id="l00392" name="l00392"></a><span class="lineno">  392</span>                  }</div>
<div class="line"><a id="l00393" name="l00393"></a><span class="lineno">  393</span>               }</div>
<div class="line"><a id="l00394" name="l00394"></a><span class="lineno">  394</span> </div>
<div class="line"><a id="l00395" name="l00395"></a><span class="lineno">  395</span>               <span class="keywordflow">if</span> (DQdPrevOrientations.size() == <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a44a80b23b966b8f1aa8a620bceb50b2b">MAX_NUM_PREV_ORIENTATION_VALUES</a>)</div>
<div class="line"><a id="l00396" name="l00396"></a><span class="lineno">  396</span>                  DQdPrevOrientations.pop_front();</div>
<div class="line"><a id="l00397" name="l00397"></a><span class="lineno">  397</span> </div>
<div class="line"><a id="l00398" name="l00398"></a><span class="lineno">  398</span>               DQdPrevOrientations.push_back(dPrevWaveAngle);</div>
<div class="line"><a id="l00399" name="l00399"></a><span class="lineno">  399</span>            }</div>
<div class="line"><a id="l00400" name="l00400"></a><span class="lineno">  400</span> </div>
<div class="line"><a id="l00401" name="l00401"></a><span class="lineno">  401</span>            <span class="comment">// Go upwave along the previous cell&#39;s wave orientation to find the new boundary cell</span></div>
<div class="line"><a id="l00402" name="l00402"></a><span class="lineno">  402</span>            <a class="code hl_class" href="../../d6/d0d/classCGeom2DIPoint.html">CGeom2DIPoint</a> <span class="keyword">const</span> PtiNew = <a class="code hl_function" href="../../d1/d98/classCSimulation.html#a9941423d85fd30f67adf5870c97da675">PtiFollowWaveAngle</a>(&amp;PtiPrev, dPrevWaveAngle, dCorrection);</div>
<div class="line"><a id="l00403" name="l00403"></a><span class="lineno">  403</span> </div>
<div class="line"><a id="l00404" name="l00404"></a><span class="lineno">  404</span>            <span class="comment">// Get the coordinates of &#39;this&#39; cell</span></div>
<div class="line"><a id="l00405" name="l00405"></a><span class="lineno">  405</span>            <span class="keywordtype">int</span> <span class="keyword">const</span> nX = PtiNew.<a class="code hl_function" href="../../d6/d0d/classCGeom2DIPoint.html#af84c687b2d0be01ab41cbcc0565f4f3f">nGetX</a>();</div>
<div class="line"><a id="l00406" name="l00406"></a><span class="lineno">  406</span>            <span class="keywordtype">int</span> <span class="keyword">const</span> nY = PtiNew.<a class="code hl_function" href="../../d6/d0d/classCGeom2DIPoint.html#a4d9c20bcca90dcb9d519b664aba09cbd">nGetY</a>();</div>
<div class="line"><a id="l00407" name="l00407"></a><span class="lineno">  407</span> </div>
<div class="line"><a id="l00408" name="l00408"></a><span class="lineno">  408</span>            <span class="comment">// Have we hit the edge of the valid part of the grid?</span></div>
<div class="line"><a id="l00409" name="l00409"></a><span class="lineno">  409</span>            <span class="keywordflow">if</span> ((! <a class="code hl_function" href="../../d1/d98/classCSimulation.html#ac900a5701df97da22278fae928951f50">bIsWithinValidGrid</a>(&amp;PtiNew)) || (<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nX][nY].bIsBoundingBoxEdge()))</div>
<div class="line"><a id="l00410" name="l00410"></a><span class="lineno">  410</span>            {</div>
<div class="line"><a id="l00411" name="l00411"></a><span class="lineno">  411</span>               <span class="comment">// Yes we have</span></div>
<div class="line"><a id="l00412" name="l00412"></a><span class="lineno">  412</span>               bHitEdge = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00413" name="l00413"></a><span class="lineno">  413</span> </div>
<div class="line"><a id="l00414" name="l00414"></a><span class="lineno">  414</span>               <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a222962121613613a48f518e0c2110f21">LogStream</a> &lt;&lt; <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#ad67e8c5b30a0572f64ecfb5c062c2edc">m_ulIter</a> &lt;&lt; <span class="stringliteral">&quot;: shadow boundary &quot;</span> &lt;&lt; nStartPoint &lt;&lt; <span class="stringliteral">&quot; hit edge cell at [&quot;</span> &lt;&lt; nX &lt;&lt; <span class="stringliteral">&quot;][&quot;</span> &lt;&lt; nY &lt;&lt; <span class="stringliteral">&quot;] = {&quot;</span> &lt;&lt; <a class="code hl_function" href="../../d1/d98/classCSimulation.html#ad79b925ac5f358c6f867b6e47dad74bd">dGridCentroidXToExtCRSX</a>(nX) &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; <a class="code hl_function" href="../../d1/d98/classCSimulation.html#a7e2a4bd69ce79377fee86aa5598903f8">dGridCentroidYToExtCRSY</a>(nY) &lt;&lt; <span class="stringliteral">&quot;}&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a id="l00415" name="l00415"></a><span class="lineno">  415</span> </div>
<div class="line"><a id="l00416" name="l00416"></a><span class="lineno">  416</span>               <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l00417" name="l00417"></a><span class="lineno">  417</span>            }</div>
<div class="line"><a id="l00418" name="l00418"></a><span class="lineno">  418</span> </div>
<div class="line"><a id="l00419" name="l00419"></a><span class="lineno">  419</span>            <span class="comment">// Have we been to this cell before?</span></div>
<div class="line"><a id="l00420" name="l00420"></a><span class="lineno">  420</span>            <span class="keywordflow">if</span> (ILShadowBoundary.<a class="code hl_function" href="../../dd/dc1/classCGeomILine.html#a5129fc96323c094fe52487ad428ce546">bIsPresent</a>(nX, nY))</div>
<div class="line"><a id="l00421" name="l00421"></a><span class="lineno">  421</span>            {</div>
<div class="line"><a id="l00422" name="l00422"></a><span class="lineno">  422</span>               <span class="comment">// We have, so we are in a loop. Abandon this shadow line</span></div>
<div class="line"><a id="l00423" name="l00423"></a><span class="lineno">  423</span>               bInLoop = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00424" name="l00424"></a><span class="lineno">  424</span>               <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00425" name="l00425"></a><span class="lineno">  425</span>            }</div>
<div class="line"><a id="l00426" name="l00426"></a><span class="lineno">  426</span> </div>
<div class="line"><a id="l00427" name="l00427"></a><span class="lineno">  427</span>            <span class="comment">// OK so far. Have we hit a sea cell yet?</span></div>
<div class="line"><a id="l00428" name="l00428"></a><span class="lineno">  428</span>            <span class="keywordflow">if</span> ((nDist &gt; <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#ac45b8f6cf8276514853c55bb394a10b5">MAX_LAND_LENGTH_OF_SHADOW_ZONE_LINE</a>) &amp;&amp; (! bHitSea))</div>
<div class="line"><a id="l00429" name="l00429"></a><span class="lineno">  429</span>            {</div>
<div class="line"><a id="l00430" name="l00430"></a><span class="lineno">  430</span>               <span class="keywordflow">if</span> (<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nX][nY].bIsInContiguousSea())</div>
<div class="line"><a id="l00431" name="l00431"></a><span class="lineno">  431</span>                  bHitSea = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00432" name="l00432"></a><span class="lineno">  432</span>               <span class="keywordflow">else</span></div>
<div class="line"><a id="l00433" name="l00433"></a><span class="lineno">  433</span>               {</div>
<div class="line"><a id="l00434" name="l00434"></a><span class="lineno">  434</span>                  <span class="keywordflow">if</span> (nDist &gt;= <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#ac45b8f6cf8276514853c55bb394a10b5">MAX_LAND_LENGTH_OF_SHADOW_ZONE_LINE</a>)</div>
<div class="line"><a id="l00435" name="l00435"></a><span class="lineno">  435</span>                  {</div>
<div class="line"><a id="l00436" name="l00436"></a><span class="lineno">  436</span>                     <span class="comment">// If we have travelled MAX_LAND_LENGTH_OF_SHADOW_ZONE_LINE cells without hitting sea, then abandon this shadow boundary</span></div>
<div class="line"><a id="l00437" name="l00437"></a><span class="lineno">  437</span>                     bStillInland = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00438" name="l00438"></a><span class="lineno">  438</span>                     <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00439" name="l00439"></a><span class="lineno">  439</span>                  }</div>
<div class="line"><a id="l00440" name="l00440"></a><span class="lineno">  440</span>               }</div>
<div class="line"><a id="l00441" name="l00441"></a><span class="lineno">  441</span>            }</div>
<div class="line"><a id="l00442" name="l00442"></a><span class="lineno">  442</span> </div>
<div class="line"><a id="l00443" name="l00443"></a><span class="lineno">  443</span>            <span class="comment">// Store the coordinates of every cell which we cross</span></div>
<div class="line"><a id="l00444" name="l00444"></a><span class="lineno">  444</span>            ILShadowBoundary.<a class="code hl_function" href="../../d2/d0f/classCA2DIShape.html#ab181578766d0cacb30c7ad0d695bf595">Append</a>(&amp;PtiNew);</div>
<div class="line"><a id="l00445" name="l00445"></a><span class="lineno">  445</span> </div>
<div class="line"><a id="l00446" name="l00446"></a><span class="lineno">  446</span>            <span class="comment">// LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: at [&quot; &lt;&lt; nX &lt;&lt; &quot;][&quot; &lt;&lt; nY &lt;&lt; &quot;] = {&quot; &lt;&lt; dGridCentroidXToExtCRSX(nX) &lt;&lt; &quot;, &quot; &lt;&lt; dGridCentroidYToExtCRSY(nY) &lt;&lt; &quot;}&quot; &lt;&lt; endl;</span></div>
<div class="line"><a id="l00447" name="l00447"></a><span class="lineno">  447</span> </div>
<div class="line"><a id="l00448" name="l00448"></a><span class="lineno">  448</span>            <span class="comment">// Having hit sea, have we now hit we hit a coast point? Note that two diagonal(ish) raster lines can cross each other without any intersection, so must also test an adjacent cell for intersection (does not matter which adjacent cell)</span></div>
<div class="line"><a id="l00449" name="l00449"></a><span class="lineno">  449</span>            <span class="keywordflow">if</span> (bHitSea)</div>
<div class="line"><a id="l00450" name="l00450"></a><span class="lineno">  450</span>            {</div>
<div class="line"><a id="l00451" name="l00451"></a><span class="lineno">  451</span>               <span class="keywordflow">if</span> (<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nX][nY].bIsCoastline() || (<a class="code hl_function" href="../../d1/d98/classCSimulation.html#ac900a5701df97da22278fae928951f50">bIsWithinValidGrid</a>(nX, nY + 1) &amp;&amp; <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nX][nY + 1].bIsCoastline()))</div>
<div class="line"><a id="l00452" name="l00452"></a><span class="lineno">  452</span>               {</div>
<div class="line"><a id="l00453" name="l00453"></a><span class="lineno">  453</span>                  bHitCoast = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00454" name="l00454"></a><span class="lineno">  454</span> </div>
<div class="line"><a id="l00455" name="l00455"></a><span class="lineno">  455</span>                  <span class="comment">// if (m_nLogFileDetail &gt;= LOG_FILE_ALL)</span></div>
<div class="line"><a id="l00456" name="l00456"></a><span class="lineno">  456</span>                  <span class="comment">//    LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: coast &quot; &lt;&lt; nCoast &lt;&lt; &quot;, possible shadow boundary from start point &quot; &lt;&lt; nStartPoint &lt;&lt; &quot; hit the coast at [&quot; &lt;&lt; nX &lt;&lt; &quot;][&quot; &lt;&lt; nY &lt;&lt; &quot;] = {&quot; &lt;&lt; dGridCentroidXToExtCRSX(nX) &lt;&lt; &quot;, &quot; &lt;&lt; dGridCentroidYToExtCRSY(nY) &lt;&lt; &quot;}&quot; &lt;&lt; endl;</span></div>
<div class="line"><a id="l00457" name="l00457"></a><span class="lineno">  457</span>               }</div>
<div class="line"><a id="l00458" name="l00458"></a><span class="lineno">  458</span>            }</div>
<div class="line"><a id="l00459" name="l00459"></a><span class="lineno">  459</span> </div>
<div class="line"><a id="l00460" name="l00460"></a><span class="lineno">  460</span>            <span class="comment">// For next time</span></div>
<div class="line"><a id="l00461" name="l00461"></a><span class="lineno">  461</span>            PtiPrev = PtiNew;</div>
<div class="line"><a id="l00462" name="l00462"></a><span class="lineno">  462</span>            nDist++;</div>
<div class="line"><a id="l00463" name="l00463"></a><span class="lineno">  463</span>         }</div>
<div class="line"><a id="l00464" name="l00464"></a><span class="lineno">  464</span> </div>
<div class="line"><a id="l00465" name="l00465"></a><span class="lineno">  465</span>         <span class="keywordflow">if</span> (bInLoop)</div>
<div class="line"><a id="l00466" name="l00466"></a><span class="lineno">  466</span>         {</div>
<div class="line"><a id="l00467" name="l00467"></a><span class="lineno">  467</span>            <span class="comment">// Shadow line loops, so abandon it</span></div>
<div class="line"><a id="l00468" name="l00468"></a><span class="lineno">  468</span>            <span class="keywordflow">if</span> (<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a0245d3cbdd603fbeced6ca1465eb3f16">m_nLogFileDetail</a> &gt;= <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#aa58b13ad2e88aaa20449bfea242396a4">LOG_FILE_ALL</a>)</div>
<div class="line"><a id="l00469" name="l00469"></a><span class="lineno">  469</span>               <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a222962121613613a48f518e0c2110f21">LogStream</a> &lt;&lt; <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#ad67e8c5b30a0572f64ecfb5c062c2edc">m_ulIter</a> &lt;&lt; <span class="stringliteral">&quot;: coast &quot;</span> &lt;&lt; nCoast &lt;&lt; <span class="stringliteral">&quot;, possible shadow boundary from start point &quot;</span> &lt;&lt; nStartPoint &lt;&lt; <span class="stringliteral">&quot; forms a loop, abandoning. It starts at [&quot;</span> &lt;&lt; ILShadowBoundary[0].nGetX() &lt;&lt; <span class="stringliteral">&quot;][&quot;</span> &lt;&lt; ILShadowBoundary[0].nGetY() &lt;&lt; <span class="stringliteral">&quot;] = {&quot;</span> &lt;&lt; <a class="code hl_function" href="../../d1/d98/classCSimulation.html#ad79b925ac5f358c6f867b6e47dad74bd">dGridCentroidXToExtCRSX</a>(ILShadowBoundary[0].nGetX()) &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; <a class="code hl_function" href="../../d1/d98/classCSimulation.html#a7e2a4bd69ce79377fee86aa5598903f8">dGridCentroidYToExtCRSY</a>(ILShadowBoundary[0].nGetY()) &lt;&lt; <span class="stringliteral">&quot;} and was abandoned at [&quot;</span> &lt;&lt; ILShadowBoundary.<a class="code hl_function" href="../../d2/d0f/classCA2DIShape.html#a704d22f3d9c5b553861947c6500e6fb7">Back</a>().<a class="code hl_function" href="../../d6/d0d/classCGeom2DIPoint.html#af84c687b2d0be01ab41cbcc0565f4f3f">nGetX</a>() &lt;&lt; <span class="stringliteral">&quot;][&quot;</span> &lt;&lt; ILShadowBoundary.<a class="code hl_function" href="../../d2/d0f/classCA2DIShape.html#a704d22f3d9c5b553861947c6500e6fb7">Back</a>().<a class="code hl_function" href="../../d6/d0d/classCGeom2DIPoint.html#a4d9c20bcca90dcb9d519b664aba09cbd">nGetY</a>() &lt;&lt; <span class="stringliteral">&quot;] = {&quot;</span> &lt;&lt; <a class="code hl_function" href="../../d1/d98/classCSimulation.html#ad79b925ac5f358c6f867b6e47dad74bd">dGridCentroidXToExtCRSX</a>(ILShadowBoundary.<a class="code hl_function" href="../../d2/d0f/classCA2DIShape.html#a704d22f3d9c5b553861947c6500e6fb7">Back</a>().<a class="code hl_function" href="../../d6/d0d/classCGeom2DIPoint.html#af84c687b2d0be01ab41cbcc0565f4f3f">nGetX</a>()) &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; <a class="code hl_function" href="../../d1/d98/classCSimulation.html#a7e2a4bd69ce79377fee86aa5598903f8">dGridCentroidYToExtCRSY</a>(ILShadowBoundary.<a class="code hl_function" href="../../d2/d0f/classCA2DIShape.html#a704d22f3d9c5b553861947c6500e6fb7">Back</a>().<a class="code hl_function" href="../../d6/d0d/classCGeom2DIPoint.html#a4d9c20bcca90dcb9d519b664aba09cbd">nGetY</a>()) &lt;&lt; <span class="stringliteral">&quot;}&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a id="l00470" name="l00470"></a><span class="lineno">  470</span> </div>
<div class="line"><a id="l00471" name="l00471"></a><span class="lineno">  471</span>            <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l00472" name="l00472"></a><span class="lineno">  472</span>         }</div>
<div class="line"><a id="l00473" name="l00473"></a><span class="lineno">  473</span> </div>
<div class="line"><a id="l00474" name="l00474"></a><span class="lineno">  474</span>         <span class="keywordflow">if</span> (bStillInland)</div>
<div class="line"><a id="l00475" name="l00475"></a><span class="lineno">  475</span>         {</div>
<div class="line"><a id="l00476" name="l00476"></a><span class="lineno">  476</span>            <span class="comment">// Shadow line is still inland after crossing MAX_LAND_LENGTH_OF_SHADOW_ZONE_LINE calls</span></div>
<div class="line"><a id="l00477" name="l00477"></a><span class="lineno">  477</span>            <span class="comment">// if (m_nLogFileDetail &gt;= LOG_FILE_ALL)</span></div>
<div class="line"><a id="l00478" name="l00478"></a><span class="lineno">  478</span>            <span class="comment">//    LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: coast &quot; &lt;&lt; nCoast &lt;&lt; &quot;, possible shadow boundary from start point &quot; &lt;&lt; nStartPoint &lt;&lt; &quot; is still inland after crossing &quot; &lt;&lt; MAX_LAND_LENGTH_OF_SHADOW_ZONE_LINE &lt;&lt; &quot; cells, abandoning. It starts at [&quot; &lt;&lt; ILShadowBoundary[0].nGetX() &lt;&lt; &quot;][&quot; &lt;&lt; ILShadowBoundary[0].nGetY() &lt;&lt; &quot;] = {&quot; &lt;&lt; dGridCentroidXToExtCRSX(ILShadowBoundary[0].nGetX()) &lt;&lt; &quot;, &quot; &lt;&lt; dGridCentroidYToExtCRSY(ILShadowBoundary[0].nGetY()) &lt;&lt; &quot;} and was abandoned at [&quot; &lt;&lt; ILShadowBoundary.Back().nGetX() &lt;&lt; &quot;][&quot; &lt;&lt; ILShadowBoundary.Back().nGetY() &lt;&lt; &quot;] = {&quot; &lt;&lt; dGridCentroidXToExtCRSX(ILShadowBoundary.Back().nGetX()) &lt;&lt; &quot;, &quot; &lt;&lt; dGridCentroidYToExtCRSY(ILShadowBoundary.Back().nGetY()) &lt;&lt; &quot;}&quot; &lt;&lt; endl;</span></div>
<div class="line"><a id="l00479" name="l00479"></a><span class="lineno">  479</span> </div>
<div class="line"><a id="l00480" name="l00480"></a><span class="lineno">  480</span>            <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l00481" name="l00481"></a><span class="lineno">  481</span>         }</div>
<div class="line"><a id="l00482" name="l00482"></a><span class="lineno">  482</span> </div>
<div class="line"><a id="l00483" name="l00483"></a><span class="lineno">  483</span>         <span class="keywordflow">if</span> (bHitCoast)</div>
<div class="line"><a id="l00484" name="l00484"></a><span class="lineno">  484</span>         {</div>
<div class="line"><a id="l00485" name="l00485"></a><span class="lineno">  485</span>            <span class="comment">// The shadow zone boundary has hit a coast, but is the shadow zone line trivially short?</span></div>
<div class="line"><a id="l00486" name="l00486"></a><span class="lineno">  486</span>            <span class="keywordtype">double</span> <span class="keyword">const</span> dShadowLen = <a class="code hl_function" href="../../d1/d98/classCSimulation.html#a407e01ecfd7c564c74f4474216ce2e16">dGetDistanceBetween</a>(&amp;ILShadowBoundary[0], &amp;ILShadowBoundary.<a class="code hl_function" href="../../d2/d0f/classCA2DIShape.html#a704d22f3d9c5b553861947c6500e6fb7">Back</a>()) * <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#ae0de69c3d3acd6d52dc2ec2f456c0eb5">m_dCellSide</a>;</div>
<div class="line"><a id="l00487" name="l00487"></a><span class="lineno">  487</span> </div>
<div class="line"><a id="l00488" name="l00488"></a><span class="lineno">  488</span>            <span class="keywordflow">if</span> (dShadowLen &lt; <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a93ac0c692cfeb8082f10c7b5064a4c6a">MIN_LENGTH_OF_SHADOW_ZONE_LINE</a>)</div>
<div class="line"><a id="l00489" name="l00489"></a><span class="lineno">  489</span>            {</div>
<div class="line"><a id="l00490" name="l00490"></a><span class="lineno">  490</span>               <span class="comment">// Too short, so forget about it</span></div>
<div class="line"><a id="l00491" name="l00491"></a><span class="lineno">  491</span>               <span class="keywordflow">if</span> (<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a0245d3cbdd603fbeced6ca1465eb3f16">m_nLogFileDetail</a> &gt;= <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#aa58b13ad2e88aaa20449bfea242396a4">LOG_FILE_ALL</a>)</div>
<div class="line"><a id="l00492" name="l00492"></a><span class="lineno">  492</span>                  <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a222962121613613a48f518e0c2110f21">LogStream</a> &lt;&lt; <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#ad67e8c5b30a0572f64ecfb5c062c2edc">m_ulIter</a> &lt;&lt; <span class="stringliteral">&quot;: coast &quot;</span> &lt;&lt; nCoast &lt;&lt; <span class="stringliteral">&quot;, possible shadow boundary from start point &quot;</span> &lt;&lt; nStartPoint &lt;&lt; <span class="stringliteral">&quot; is too short, has length &quot;</span> &lt;&lt; dShadowLen &lt;&lt; <span class="stringliteral">&quot; m but the minimum length is &quot;</span> &lt;&lt; <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a93ac0c692cfeb8082f10c7b5064a4c6a">MIN_LENGTH_OF_SHADOW_ZONE_LINE</a> &lt;&lt; <span class="stringliteral">&quot; m. It starts at [&quot;</span> &lt;&lt; ILShadowBoundary[0].nGetX() &lt;&lt; <span class="stringliteral">&quot;][&quot;</span> &lt;&lt; ILShadowBoundary[0].nGetY() &lt;&lt; <span class="stringliteral">&quot;] = {&quot;</span> &lt;&lt; <a class="code hl_function" href="../../d1/d98/classCSimulation.html#ad79b925ac5f358c6f867b6e47dad74bd">dGridCentroidXToExtCRSX</a>(ILShadowBoundary[0].nGetX()) &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; <a class="code hl_function" href="../../d1/d98/classCSimulation.html#a7e2a4bd69ce79377fee86aa5598903f8">dGridCentroidYToExtCRSY</a>(ILShadowBoundary[0].nGetY()) &lt;&lt; <span class="stringliteral">&quot;} and hits coast at [&quot;</span> &lt;&lt; ILShadowBoundary.<a class="code hl_function" href="../../d2/d0f/classCA2DIShape.html#a704d22f3d9c5b553861947c6500e6fb7">Back</a>().<a class="code hl_function" href="../../d6/d0d/classCGeom2DIPoint.html#af84c687b2d0be01ab41cbcc0565f4f3f">nGetX</a>() &lt;&lt; <span class="stringliteral">&quot;][&quot;</span> &lt;&lt; ILShadowBoundary.<a class="code hl_function" href="../../d2/d0f/classCA2DIShape.html#a704d22f3d9c5b553861947c6500e6fb7">Back</a>().<a class="code hl_function" href="../../d6/d0d/classCGeom2DIPoint.html#a4d9c20bcca90dcb9d519b664aba09cbd">nGetY</a>() &lt;&lt; <span class="stringliteral">&quot;] = {&quot;</span> &lt;&lt; <a class="code hl_function" href="../../d1/d98/classCSimulation.html#ad79b925ac5f358c6f867b6e47dad74bd">dGridCentroidXToExtCRSX</a>(ILShadowBoundary.<a class="code hl_function" href="../../d2/d0f/classCA2DIShape.html#a704d22f3d9c5b553861947c6500e6fb7">Back</a>().<a class="code hl_function" href="../../d6/d0d/classCGeom2DIPoint.html#af84c687b2d0be01ab41cbcc0565f4f3f">nGetX</a>()) &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; <a class="code hl_function" href="../../d1/d98/classCSimulation.html#a7e2a4bd69ce79377fee86aa5598903f8">dGridCentroidYToExtCRSY</a>(ILShadowBoundary.<a class="code hl_function" href="../../d2/d0f/classCA2DIShape.html#a704d22f3d9c5b553861947c6500e6fb7">Back</a>().<a class="code hl_function" href="../../d6/d0d/classCGeom2DIPoint.html#a4d9c20bcca90dcb9d519b664aba09cbd">nGetY</a>()) &lt;&lt; <span class="stringliteral">&quot;}&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a id="l00493" name="l00493"></a><span class="lineno">  493</span> </div>
<div class="line"><a id="l00494" name="l00494"></a><span class="lineno">  494</span>               <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l00495" name="l00495"></a><span class="lineno">  495</span>            }</div>
<div class="line"><a id="l00496" name="l00496"></a><span class="lineno">  496</span> </div>
<div class="line"><a id="l00497" name="l00497"></a><span class="lineno">  497</span>            <span class="comment">// We&#39;ve found a valid shadow zone. Check the last point in the shadow boundary. Note that occasionally this last cell is not &#39;above&#39; a cell but is above one of its neighbouring cells is: in which case, replace the last point in the shadow boundary with the coordinates of this neighbouring cell</span></div>
<div class="line"><a id="l00498" name="l00498"></a><span class="lineno">  498</span>            <span class="keywordtype">int</span> <span class="keyword">const</span> nShadowBoundaryCoastPoint = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].nGetCoastPointGivenCell(&amp;ILShadowBoundary.<a class="code hl_function" href="../../d2/d0f/classCA2DIShape.html#a704d22f3d9c5b553861947c6500e6fb7">Back</a>());</div>
<div class="line"><a id="l00499" name="l00499"></a><span class="lineno">  499</span> </div>
<div class="line"><a id="l00500" name="l00500"></a><span class="lineno">  500</span>            <span class="keywordflow">if</span> (nShadowBoundaryCoastPoint == <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a01aa8b423260b337ddff2016107b51a0">INT_NODATA</a>)</div>
<div class="line"><a id="l00501" name="l00501"></a><span class="lineno">  501</span>            {</div>
<div class="line"><a id="l00502" name="l00502"></a><span class="lineno">  502</span>               <span class="comment">// // Could not find a neighbouring cell which is &#39;under&#39; the coastline</span></div>
<div class="line"><a id="l00503" name="l00503"></a><span class="lineno">  503</span>               <span class="comment">// if (m_nLogFileDetail &gt;= LOG_FILE_ALL)</span></div>
<div class="line"><a id="l00504" name="l00504"></a><span class="lineno">  504</span>               <span class="comment">//    LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: coast &quot; &lt;&lt; nCoast &lt;&lt; &quot;, no coast point under {&quot; &lt;&lt; dGridCentroidXToExtCRSX(ILShadowBoundary.Back().nGetX()) &lt;&lt; &quot;, &quot; &lt;&lt; dGridCentroidYToExtCRSY(ILShadowBoundary.Back().nGetY()) &lt;&lt; &quot;}&quot; &lt;&lt; endl;</span></div>
<div class="line"><a id="l00505" name="l00505"></a><span class="lineno">  505</span> </div>
<div class="line"><a id="l00506" name="l00506"></a><span class="lineno">  506</span>               <span class="comment">// TODO 004 Need to fix this, for the moment just abandon this shadow zone and carry on</span></div>
<div class="line"><a id="l00507" name="l00507"></a><span class="lineno">  507</span>               <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l00508" name="l00508"></a><span class="lineno">  508</span>               <span class="comment">// return RTN_ERR_NO_CELL_UNDER_COASTLINE;</span></div>
<div class="line"><a id="l00509" name="l00509"></a><span class="lineno">  509</span>            }</div>
<div class="line"><a id="l00510" name="l00510"></a><span class="lineno">  510</span> </div>
<div class="line"><a id="l00511" name="l00511"></a><span class="lineno">  511</span>            <span class="comment">// Now store the shadow zone boundary information</span></div>
<div class="line"><a id="l00512" name="l00512"></a><span class="lineno">  512</span>            VILShadowBoundary.push_back(ILShadowBoundary);</div>
<div class="line"><a id="l00513" name="l00513"></a><span class="lineno">  513</span>            VnShadowBoundaryStartCoastPoint.push_back(VnPossibleShadowBoundaryCoastPoint[nStartPoint]);</div>
<div class="line"><a id="l00514" name="l00514"></a><span class="lineno">  514</span>            VnShadowBoundaryEndCoastPoint.push_back(nShadowBoundaryCoastPoint);</div>
<div class="line"><a id="l00515" name="l00515"></a><span class="lineno">  515</span> </div>
<div class="line"><a id="l00516" name="l00516"></a><span class="lineno">  516</span>            <span class="keywordflow">if</span> (<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a0245d3cbdd603fbeced6ca1465eb3f16">m_nLogFileDetail</a> &gt;= <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#aa58b13ad2e88aaa20449bfea242396a4">LOG_FILE_ALL</a>)</div>
<div class="line"><a id="l00517" name="l00517"></a><span class="lineno">  517</span>               <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a222962121613613a48f518e0c2110f21">LogStream</a> &lt;&lt; <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#ad67e8c5b30a0572f64ecfb5c062c2edc">m_ulIter</a> &lt;&lt; <span class="stringliteral">&quot;: coast &quot;</span> &lt;&lt; nCoast &lt;&lt; <span class="stringliteral">&quot;, coast &quot;</span> &lt;&lt; nCoast &lt;&lt; <span class="stringliteral">&quot;, possible shadow boundary from start point &quot;</span> &lt;&lt; nStartPoint &lt;&lt; <span class="stringliteral">&quot; defines a valid shadow zone. Start point [&quot;</span> &lt;&lt; ILShadowBoundary[0].nGetX() &lt;&lt; <span class="stringliteral">&quot;][&quot;</span> &lt;&lt; ILShadowBoundary[0].nGetY() &lt;&lt; <span class="stringliteral">&quot;] = {&quot;</span> &lt;&lt; <a class="code hl_function" href="../../d1/d98/classCSimulation.html#ad79b925ac5f358c6f867b6e47dad74bd">dGridCentroidXToExtCRSX</a>(ILShadowBoundary[0].nGetX()) &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; <a class="code hl_function" href="../../d1/d98/classCSimulation.html#a7e2a4bd69ce79377fee86aa5598903f8">dGridCentroidYToExtCRSY</a>(ILShadowBoundary[0].nGetY()) &lt;&lt; <span class="stringliteral">&quot;}, hits coast at [&quot;</span> &lt;&lt; ILShadowBoundary.<a class="code hl_function" href="../../d2/d0f/classCA2DIShape.html#a704d22f3d9c5b553861947c6500e6fb7">Back</a>().<a class="code hl_function" href="../../d6/d0d/classCGeom2DIPoint.html#af84c687b2d0be01ab41cbcc0565f4f3f">nGetX</a>() &lt;&lt; <span class="stringliteral">&quot;][&quot;</span> &lt;&lt; ILShadowBoundary.<a class="code hl_function" href="../../d2/d0f/classCA2DIShape.html#a704d22f3d9c5b553861947c6500e6fb7">Back</a>().<a class="code hl_function" href="../../d6/d0d/classCGeom2DIPoint.html#a4d9c20bcca90dcb9d519b664aba09cbd">nGetY</a>() &lt;&lt; <span class="stringliteral">&quot;] = {&quot;</span> &lt;&lt; <a class="code hl_function" href="../../d1/d98/classCSimulation.html#ad79b925ac5f358c6f867b6e47dad74bd">dGridCentroidXToExtCRSX</a>(ILShadowBoundary.<a class="code hl_function" href="../../d2/d0f/classCA2DIShape.html#a704d22f3d9c5b553861947c6500e6fb7">Back</a>().<a class="code hl_function" href="../../d6/d0d/classCGeom2DIPoint.html#af84c687b2d0be01ab41cbcc0565f4f3f">nGetX</a>()) &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; <a class="code hl_function" href="../../d1/d98/classCSimulation.html#a7e2a4bd69ce79377fee86aa5598903f8">dGridCentroidYToExtCRSY</a>(ILShadowBoundary.<a class="code hl_function" href="../../d2/d0f/classCA2DIShape.html#a704d22f3d9c5b553861947c6500e6fb7">Back</a>().<a class="code hl_function" href="../../d6/d0d/classCGeom2DIPoint.html#a4d9c20bcca90dcb9d519b664aba09cbd">nGetY</a>()) &lt;&lt; <span class="stringliteral">&quot;} which is coast point (&quot;</span> &lt;&lt; nShadowBoundaryCoastPoint &lt;&lt; <span class="stringliteral">&quot;). Will be shadow zone &quot;</span> &lt;&lt; VnShadowBoundaryEndCoastPoint.size() - 1 &lt;&lt; endl;</div>
<div class="line"><a id="l00518" name="l00518"></a><span class="lineno">  518</span>         }</div>
<div class="line"><a id="l00519" name="l00519"></a><span class="lineno">  519</span> </div>
<div class="line"><a id="l00520" name="l00520"></a><span class="lineno">  520</span>         <span class="keywordflow">if</span> (bHitEdge)</div>
<div class="line"><a id="l00521" name="l00521"></a><span class="lineno">  521</span>         {</div>
<div class="line"><a id="l00522" name="l00522"></a><span class="lineno">  522</span>            <span class="keywordflow">if</span> (<a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a2f39c393cbe19710d077797fdf2a843d">CREATE_SHADOW_ZONE_IF_HITS_GRID_EDGE</a>)</div>
<div class="line"><a id="l00523" name="l00523"></a><span class="lineno">  523</span>            {</div>
<div class="line"><a id="l00524" name="l00524"></a><span class="lineno">  524</span>               <span class="comment">// We are creating shadow zones if we hit the grid edge. But is the shadow zone line trivially short?</span></div>
<div class="line"><a id="l00525" name="l00525"></a><span class="lineno">  525</span>               <span class="keywordtype">double</span> <span class="keyword">const</span> dShadowLen = <a class="code hl_function" href="../../d1/d98/classCSimulation.html#a407e01ecfd7c564c74f4474216ce2e16">dGetDistanceBetween</a>(&amp;ILShadowBoundary[0], &amp;ILShadowBoundary.<a class="code hl_function" href="../../d2/d0f/classCA2DIShape.html#a704d22f3d9c5b553861947c6500e6fb7">Back</a>()) * <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#ae0de69c3d3acd6d52dc2ec2f456c0eb5">m_dCellSide</a>;</div>
<div class="line"><a id="l00526" name="l00526"></a><span class="lineno">  526</span> </div>
<div class="line"><a id="l00527" name="l00527"></a><span class="lineno">  527</span>               <span class="keywordflow">if</span> (dShadowLen &lt; <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a93ac0c692cfeb8082f10c7b5064a4c6a">MIN_LENGTH_OF_SHADOW_ZONE_LINE</a>)</div>
<div class="line"><a id="l00528" name="l00528"></a><span class="lineno">  528</span>               {</div>
<div class="line"><a id="l00529" name="l00529"></a><span class="lineno">  529</span>                  <span class="comment">// Too short, so forget about it</span></div>
<div class="line"><a id="l00530" name="l00530"></a><span class="lineno">  530</span>                  <span class="keywordflow">if</span> (<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a0245d3cbdd603fbeced6ca1465eb3f16">m_nLogFileDetail</a> &gt;= <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#aa58b13ad2e88aaa20449bfea242396a4">LOG_FILE_ALL</a>)</div>
<div class="line"><a id="l00531" name="l00531"></a><span class="lineno">  531</span>                     <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a222962121613613a48f518e0c2110f21">LogStream</a> &lt;&lt; <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#ad67e8c5b30a0572f64ecfb5c062c2edc">m_ulIter</a> &lt;&lt; <span class="stringliteral">&quot;: Possible shadow boundary from start point &quot;</span> &lt;&lt; nStartPoint &lt;&lt; <span class="stringliteral">&quot; is too short, has length &quot;</span> &lt;&lt; dShadowLen &lt;&lt; <span class="stringliteral">&quot; m but the minimum length is &quot;</span> &lt;&lt; <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a93ac0c692cfeb8082f10c7b5064a4c6a">MIN_LENGTH_OF_SHADOW_ZONE_LINE</a> &lt;&lt; <span class="stringliteral">&quot; m. It starts at [&quot;</span> &lt;&lt; ILShadowBoundary[0].nGetX() &lt;&lt; <span class="stringliteral">&quot;][&quot;</span> &lt;&lt; ILShadowBoundary[0].nGetY() &lt;&lt; <span class="stringliteral">&quot;] = {&quot;</span> &lt;&lt; <a class="code hl_function" href="../../d1/d98/classCSimulation.html#ad79b925ac5f358c6f867b6e47dad74bd">dGridCentroidXToExtCRSX</a>(ILShadowBoundary[0].nGetX()) &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; <a class="code hl_function" href="../../d1/d98/classCSimulation.html#a7e2a4bd69ce79377fee86aa5598903f8">dGridCentroidYToExtCRSY</a>(ILShadowBoundary[0].nGetY()) &lt;&lt; <span class="stringliteral">&quot;} and hits the grid edge at [&quot;</span> &lt;&lt; ILShadowBoundary.<a class="code hl_function" href="../../d2/d0f/classCA2DIShape.html#a704d22f3d9c5b553861947c6500e6fb7">Back</a>().<a class="code hl_function" href="../../d6/d0d/classCGeom2DIPoint.html#af84c687b2d0be01ab41cbcc0565f4f3f">nGetX</a>() &lt;&lt; <span class="stringliteral">&quot;][&quot;</span> &lt;&lt; ILShadowBoundary.<a class="code hl_function" href="../../d2/d0f/classCA2DIShape.html#a704d22f3d9c5b553861947c6500e6fb7">Back</a>().<a class="code hl_function" href="../../d6/d0d/classCGeom2DIPoint.html#a4d9c20bcca90dcb9d519b664aba09cbd">nGetY</a>() &lt;&lt; <span class="stringliteral">&quot;] = {&quot;</span> &lt;&lt; <a class="code hl_function" href="../../d1/d98/classCSimulation.html#ad79b925ac5f358c6f867b6e47dad74bd">dGridCentroidXToExtCRSX</a>(ILShadowBoundary.<a class="code hl_function" href="../../d2/d0f/classCA2DIShape.html#a704d22f3d9c5b553861947c6500e6fb7">Back</a>().<a class="code hl_function" href="../../d6/d0d/classCGeom2DIPoint.html#af84c687b2d0be01ab41cbcc0565f4f3f">nGetX</a>()) &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; <a class="code hl_function" href="../../d1/d98/classCSimulation.html#a7e2a4bd69ce79377fee86aa5598903f8">dGridCentroidYToExtCRSY</a>(ILShadowBoundary.<a class="code hl_function" href="../../d2/d0f/classCA2DIShape.html#a704d22f3d9c5b553861947c6500e6fb7">Back</a>().<a class="code hl_function" href="../../d6/d0d/classCGeom2DIPoint.html#a4d9c20bcca90dcb9d519b664aba09cbd">nGetY</a>()) &lt;&lt; <span class="stringliteral">&quot;}&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a id="l00532" name="l00532"></a><span class="lineno">  532</span> </div>
<div class="line"><a id="l00533" name="l00533"></a><span class="lineno">  533</span>                  <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l00534" name="l00534"></a><span class="lineno">  534</span>               }</div>
<div class="line"><a id="l00535" name="l00535"></a><span class="lineno">  535</span> </div>
<div class="line"><a id="l00536" name="l00536"></a><span class="lineno">  536</span>               <span class="comment">// We&#39;ve found a valid grid-edge shadow zone, but we need a distance (in cells) between the shadow boundary start and the &#39;virtual&#39; shadow boundary end: this is the off-grid point where the shadow boundary would have intersected the coastline, if the grid were big enough. This is of course unknowable. So as a best guess, we choose the shorter of the two distances between the point where the shadow boundary hits the valid edge of the grid, and the start or end of the coast</span></div>
<div class="line"><a id="l00537" name="l00537"></a><span class="lineno">  537</span>               <span class="comment">// int nCoastSize = m_VCoast[nCoast].nGetCoastlineSize();</span></div>
<div class="line"><a id="l00538" name="l00538"></a><span class="lineno">  538</span>               <a class="code hl_class" href="../../d6/d0d/classCGeom2DIPoint.html">CGeom2DIPoint</a> <span class="keyword">const</span> PtiCoastStart = *<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].pPtiGetCellMarkedAsCoastline(0);</div>
<div class="line"><a id="l00539" name="l00539"></a><span class="lineno">  539</span>               <a class="code hl_class" href="../../d6/d0d/classCGeom2DIPoint.html">CGeom2DIPoint</a> <span class="keyword">const</span> PtiCoastEnd = *<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].pPtiGetCellMarkedAsCoastline(nCoastSize - 1);</div>
<div class="line"><a id="l00540" name="l00540"></a><span class="lineno">  540</span> </div>
<div class="line"><a id="l00541" name="l00541"></a><span class="lineno">  541</span>               <span class="keywordtype">int</span> <span class="keyword">const</span> nDistance = <a class="code hl_function" href="../../d2/dfd/utils__global_8cpp.html#a20842d0a19d0ca952c91f3e1eb175fee">nRound</a>(<a class="code hl_function" href="../../d6/d2a/cme_8h.html#a068017859403c0629d89f8d348f6c224">tMin</a>(<a class="code hl_function" href="../../d1/d98/classCSimulation.html#a407e01ecfd7c564c74f4474216ce2e16">dGetDistanceBetween</a>(&amp;ILShadowBoundary.<a class="code hl_function" href="../../d2/d0f/classCA2DIShape.html#a704d22f3d9c5b553861947c6500e6fb7">Back</a>(), &amp;PtiCoastStart), <a class="code hl_function" href="../../d1/d98/classCSimulation.html#a407e01ecfd7c564c74f4474216ce2e16">dGetDistanceBetween</a>(&amp;ILShadowBoundary.<a class="code hl_function" href="../../d2/d0f/classCA2DIShape.html#a704d22f3d9c5b553861947c6500e6fb7">Back</a>(), &amp;PtiCoastEnd)));</div>
<div class="line"><a id="l00542" name="l00542"></a><span class="lineno">  542</span> </div>
<div class="line"><a id="l00543" name="l00543"></a><span class="lineno">  543</span>               <span class="comment">// Now store the shadow zone boundary information</span></div>
<div class="line"><a id="l00544" name="l00544"></a><span class="lineno">  544</span>               VILShadowBoundary.push_back(ILShadowBoundary);</div>
<div class="line"><a id="l00545" name="l00545"></a><span class="lineno">  545</span>               VnShadowBoundaryStartCoastPoint.push_back(VnPossibleShadowBoundaryCoastPoint[nStartPoint]);</div>
<div class="line"><a id="l00546" name="l00546"></a><span class="lineno">  546</span>               VnShadowBoundaryEndCoastPoint.push_back(nDistance);</div>
<div class="line"><a id="l00547" name="l00547"></a><span class="lineno">  547</span> </div>
<div class="line"><a id="l00548" name="l00548"></a><span class="lineno">  548</span>               <span class="comment">// if (m_nLogFileDetail &gt;= LOG_FILE_ALL)</span></div>
<div class="line"><a id="l00549" name="l00549"></a><span class="lineno">  549</span>               <span class="comment">//    LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: coast &quot; &lt;&lt; nCoast &lt;&lt; &quot;, possible shadow boundary from start point &quot; &lt;&lt; nStartPoint &lt;&lt; &quot; defines a valid shadow zone. Start point [&quot; &lt;&lt; ILShadowBoundary[0].nGetX() &lt;&lt; &quot;][&quot; &lt;&lt; ILShadowBoundary[0].nGetY() &lt;&lt; &quot;] = {&quot; &lt;&lt; dGridCentroidXToExtCRSX(ILShadowBoundary[0].nGetX()) &lt;&lt; &quot;, &quot; &lt;&lt; dGridCentroidYToExtCRSY(ILShadowBoundary[0].nGetY()) &lt;&lt; &quot;}, hit the grid edge at [&quot; &lt;&lt; ILShadowBoundary.Back().nGetX() &lt;&lt; &quot;][&quot; &lt;&lt; ILShadowBoundary.Back().nGetY() &lt;&lt; &quot;] = {&quot; &lt;&lt; dGridCentroidXToExtCRSX(ILShadowBoundary.Back().nGetX()) &lt;&lt; &quot;, &quot; &lt;&lt; dGridCentroidYToExtCRSY(ILShadowBoundary.Back().nGetY()) &lt;&lt; &quot;}. Best-guess length of the shadow boundary is &quot; &lt;&lt; nDistance &lt;&lt; &quot; cells. Will be shadow zone &quot; &lt;&lt; VnShadowBoundaryEndCoastPoint.size() - 1 &lt;&lt; endl;</span></div>
<div class="line"><a id="l00550" name="l00550"></a><span class="lineno">  550</span>            }</div>
<div class="line"><a id="l00551" name="l00551"></a><span class="lineno">  551</span>            <span class="keywordflow">else</span></div>
<div class="line"><a id="l00552" name="l00552"></a><span class="lineno">  552</span>            {</div>
<div class="line"><a id="l00553" name="l00553"></a><span class="lineno">  553</span>               <span class="comment">// We are not creating shadow zones if we hit the grid edge</span></div>
<div class="line"><a id="l00554" name="l00554"></a><span class="lineno">  554</span>               <span class="keywordflow">if</span> (<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a0245d3cbdd603fbeced6ca1465eb3f16">m_nLogFileDetail</a> &gt;= <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#aa58b13ad2e88aaa20449bfea242396a4">LOG_FILE_ALL</a>)</div>
<div class="line"><a id="l00555" name="l00555"></a><span class="lineno">  555</span>                  <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a222962121613613a48f518e0c2110f21">LogStream</a> &lt;&lt; <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#ad67e8c5b30a0572f64ecfb5c062c2edc">m_ulIter</a> &lt;&lt; <span class="stringliteral">&quot;: coast &quot;</span> &lt;&lt; nCoast &lt;&lt; <span class="stringliteral">&quot;, possible shadow boundary from start point &quot;</span> &lt;&lt; nStartPoint &lt;&lt; <span class="stringliteral">&quot; hits a grid edge: ignored. It starts at [&quot;</span> &lt;&lt; ILShadowBoundary[0].nGetX() &lt;&lt; <span class="stringliteral">&quot;][&quot;</span> &lt;&lt; ILShadowBoundary[0].nGetY() &lt;&lt; <span class="stringliteral">&quot;]&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a id="l00556" name="l00556"></a><span class="lineno">  556</span>            }</div>
<div class="line"><a id="l00557" name="l00557"></a><span class="lineno">  557</span>         }</div>
<div class="line"><a id="l00558" name="l00558"></a><span class="lineno">  558</span>      }</div>
<div class="line"><a id="l00559" name="l00559"></a><span class="lineno">  559</span> </div>
<div class="line"><a id="l00560" name="l00560"></a><span class="lineno">  560</span>      <span class="comment">// =========================================================================================================================</span></div>
<div class="line"><a id="l00561" name="l00561"></a><span class="lineno">  561</span>      <span class="comment">// The third stage: store the shadow zone boundary, cell-by-cell fill the shadow zone, then change wave properties by sweeping the shadow zone and the area downdrift from the shadow zone</span></div>
<div class="line"><a id="l00562" name="l00562"></a><span class="lineno">  562</span>      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nZone = 0; nZone &lt; VILShadowBoundary.size(); nZone++)</div>
<div class="line"><a id="l00563" name="l00563"></a><span class="lineno">  563</span>      {</div>
<div class="line"><a id="l00564" name="l00564"></a><span class="lineno">  564</span>         <span class="comment">// if (m_nLogFileDetail &gt;= LOG_FILE_HIGH_DETAIL)</span></div>
<div class="line"><a id="l00565" name="l00565"></a><span class="lineno">  565</span>         <span class="comment">//    LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: coast &quot; &lt;&lt; nCoast &lt;&lt; &quot;, processing shadow zone &quot; &lt;&lt; nZone &lt;&lt; &quot; of &quot; &lt;&lt; VILShadowBoundary.size() &lt;&lt; endl;</span></div>
<div class="line"><a id="l00566" name="l00566"></a><span class="lineno">  566</span> </div>
<div class="line"><a id="l00567" name="l00567"></a><span class="lineno">  567</span>         <span class="keywordtype">int</span> <span class="keyword">const</span> nShadowLineLen = VILShadowBoundary[nZone].nGetSize();</div>
<div class="line"><a id="l00568" name="l00568"></a><span class="lineno">  568</span> </div>
<div class="line"><a id="l00569" name="l00569"></a><span class="lineno">  569</span>         <span class="comment">// The vector shadow boundary (external CRS)</span></div>
<div class="line"><a id="l00570" name="l00570"></a><span class="lineno">  570</span>         <a class="code hl_class" href="../../d7/dd3/classCGeomLine.html">CGeomLine</a> LBoundary;</div>
<div class="line"><a id="l00571" name="l00571"></a><span class="lineno">  571</span> </div>
<div class="line"><a id="l00572" name="l00572"></a><span class="lineno">  572</span>         <span class="comment">// And the same with grid CRS</span></div>
<div class="line"><a id="l00573" name="l00573"></a><span class="lineno">  573</span>         <a class="code hl_class" href="../../dd/dc1/classCGeomILine.html">CGeomILine</a> LIBoundary;</div>
<div class="line"><a id="l00574" name="l00574"></a><span class="lineno">  574</span> </div>
<div class="line"><a id="l00575" name="l00575"></a><span class="lineno">  575</span>         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> nn = 0; nn &lt; nShadowLineLen; nn++)</div>
<div class="line"><a id="l00576" name="l00576"></a><span class="lineno">  576</span>         {</div>
<div class="line"><a id="l00577" name="l00577"></a><span class="lineno">  577</span>            <span class="keywordtype">int</span> <span class="keyword">const</span> nTmpX = VILShadowBoundary[nZone][nn].nGetX();</div>
<div class="line"><a id="l00578" name="l00578"></a><span class="lineno">  578</span>            <span class="keywordtype">int</span> <span class="keyword">const</span> nTmpY = VILShadowBoundary[nZone][nn].nGetY();</div>
<div class="line"><a id="l00579" name="l00579"></a><span class="lineno">  579</span> </div>
<div class="line"><a id="l00580" name="l00580"></a><span class="lineno">  580</span>            <span class="comment">// Mark the cells as shadow zone boundary</span></div>
<div class="line"><a id="l00581" name="l00581"></a><span class="lineno">  581</span>            <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nTmpX][nTmpY].SetShadowZoneBoundary();</div>
<div class="line"><a id="l00582" name="l00582"></a><span class="lineno">  582</span> </div>
<div class="line"><a id="l00583" name="l00583"></a><span class="lineno">  583</span>            <span class="comment">// If this is a sea cell, mark the shadow zone boundary cell as being in the shadow zone, but not yet processed (a -ve number)</span></div>
<div class="line"><a id="l00584" name="l00584"></a><span class="lineno">  584</span>            <span class="keywordflow">if</span> (<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nTmpX][nTmpY].bIsInContiguousSea())</div>
<div class="line"><a id="l00585" name="l00585"></a><span class="lineno">  585</span>               <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nTmpX][nTmpY].SetShadowZoneNumber(-(nZone + 1));</div>
<div class="line"><a id="l00586" name="l00586"></a><span class="lineno">  586</span> </div>
<div class="line"><a id="l00587" name="l00587"></a><span class="lineno">  587</span>            <span class="comment">// If not already there, append this values to the two shadow boundary vectors</span></div>
<div class="line"><a id="l00588" name="l00588"></a><span class="lineno">  588</span>            LBoundary.<a class="code hl_function" href="../../d9/d0e/classCA2DShape.html#aaa15397a5761d17635afdaddbec35c8a">AppendIfNotAlready</a>(<a class="code hl_function" href="../../d1/d98/classCSimulation.html#ad79b925ac5f358c6f867b6e47dad74bd">dGridCentroidXToExtCRSX</a>(nTmpX), <a class="code hl_function" href="../../d1/d98/classCSimulation.html#a7e2a4bd69ce79377fee86aa5598903f8">dGridCentroidYToExtCRSY</a>(nTmpY));</div>
<div class="line"><a id="l00589" name="l00589"></a><span class="lineno">  589</span>            LIBoundary.<a class="code hl_function" href="../../d2/d0f/classCA2DIShape.html#a9d97e2e53a6e13b56664cced2d6e4f6a">AppendIfNotAlready</a>(nTmpX, nTmpY);</div>
<div class="line"><a id="l00590" name="l00590"></a><span class="lineno">  590</span> </div>
<div class="line"><a id="l00591" name="l00591"></a><span class="lineno">  591</span>            <span class="comment">// LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: coast &quot; &lt;&lt; nCoast &lt;&lt; &quot; shadow zone &quot; &lt;&lt; nZone &lt;&lt; &quot;, which starts at [&quot; &lt;&lt; nTmpX &lt;&lt; &quot;][&quot; &lt;&lt; nTmpY &lt;&lt; &quot;] = {&quot; &lt;&lt; dGridCentroidXToExtCRSX(nTmpX) &lt;&lt; &quot;, &quot; &lt;&lt; dGridCentroidYToExtCRSY(nTmpY) &lt;&lt; &quot;} has cell [&quot; &lt;&lt; nTmpX &lt;&lt; &quot;][&quot; &lt;&lt; nTmpY &lt;&lt; &quot;] marked as shadow zone boundary&quot; &lt;&lt; endl;</span></div>
<div class="line"><a id="l00592" name="l00592"></a><span class="lineno">  592</span>         }</div>
<div class="line"><a id="l00593" name="l00593"></a><span class="lineno">  593</span> </div>
<div class="line"><a id="l00594" name="l00594"></a><span class="lineno">  594</span>         <span class="comment">// Put the ext CRS vector shadow boundary into reverse sequence (i.e. start point is last)</span></div>
<div class="line"><a id="l00595" name="l00595"></a><span class="lineno">  595</span>         LBoundary.<a class="code hl_function" href="../../d9/d0e/classCA2DShape.html#a54eb0a2ab77aa22b8d1af5f8f1f40383">Reverse</a>();</div>
<div class="line"><a id="l00596" name="l00596"></a><span class="lineno">  596</span> </div>
<div class="line"><a id="l00597" name="l00597"></a><span class="lineno">  597</span>         <span class="comment">// Store the reversed ext CRS shadow zone boundary</span></div>
<div class="line"><a id="l00598" name="l00598"></a><span class="lineno">  598</span>         <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].AppendShadowBoundary(&amp;LBoundary);</div>
<div class="line"><a id="l00599" name="l00599"></a><span class="lineno">  599</span> </div>
<div class="line"><a id="l00600" name="l00600"></a><span class="lineno">  600</span>         <span class="keywordtype">int</span> <span class="keyword">const</span> nStartX = VILShadowBoundary[nZone][0].nGetX();</div>
<div class="line"><a id="l00601" name="l00601"></a><span class="lineno">  601</span>         <span class="keywordtype">int</span> <span class="keyword">const</span> nStartY = VILShadowBoundary[nZone][0].nGetY();</div>
<div class="line"><a id="l00602" name="l00602"></a><span class="lineno">  602</span>         <span class="keywordtype">int</span> <span class="keyword">const</span> nEndX = VILShadowBoundary[nZone][nShadowLineLen - 1].nGetX();</div>
<div class="line"><a id="l00603" name="l00603"></a><span class="lineno">  603</span>         <span class="keywordtype">int</span> <span class="keyword">const</span> nEndY = VILShadowBoundary[nZone][nShadowLineLen - 1].nGetY();</div>
<div class="line"><a id="l00604" name="l00604"></a><span class="lineno">  604</span> </div>
<div class="line"><a id="l00605" name="l00605"></a><span class="lineno">  605</span>         <span class="comment">// Grid CRS</span></div>
<div class="line"><a id="l00606" name="l00606"></a><span class="lineno">  606</span>         <a class="code hl_class" href="../../d6/d0d/classCGeom2DIPoint.html">CGeom2DIPoint</a> <span class="keyword">const</span> PtiStart(nStartX, nStartY);</div>
<div class="line"><a id="l00607" name="l00607"></a><span class="lineno">  607</span>         <a class="code hl_class" href="../../d6/d0d/classCGeom2DIPoint.html">CGeom2DIPoint</a> <span class="keyword">const</span> PtiEnd(nEndX, nEndY);</div>
<div class="line"><a id="l00608" name="l00608"></a><span class="lineno">  608</span> </div>
<div class="line"><a id="l00609" name="l00609"></a><span class="lineno">  609</span>         <span class="comment">// Cell-by-cell fill the shadow zone: start by finding the centroid</span></div>
<div class="line"><a id="l00610" name="l00610"></a><span class="lineno">  610</span>         <span class="keywordflow">if</span> (VnShadowBoundaryEndCoastPoint[nZone] &gt; VnShadowBoundaryStartCoastPoint[nZone])</div>
<div class="line"><a id="l00611" name="l00611"></a><span class="lineno">  611</span>         {</div>
<div class="line"><a id="l00612" name="l00612"></a><span class="lineno">  612</span>            <span class="comment">// The shadow boundary endpoint is down-coast from the shadow boundary start point</span></div>
<div class="line"><a id="l00613" name="l00613"></a><span class="lineno">  613</span>            <span class="keywordtype">int</span> <span class="keyword">const</span> nStart = <a class="code hl_function" href="../../d6/d2a/cme_8h.html#a7e895b460cef877dec4d12ead0c74f15">tMax</a>(VnShadowBoundaryStartCoastPoint[nZone], 0);</div>
<div class="line"><a id="l00614" name="l00614"></a><span class="lineno">  614</span>            <span class="keywordtype">int</span> <span class="keyword">const</span> nEnd = <a class="code hl_function" href="../../d6/d2a/cme_8h.html#a068017859403c0629d89f8d348f6c224">tMin</a>(VnShadowBoundaryEndCoastPoint[nZone], <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].nGetCoastlineSize());</div>
<div class="line"><a id="l00615" name="l00615"></a><span class="lineno">  615</span> </div>
<div class="line"><a id="l00616" name="l00616"></a><span class="lineno">  616</span>            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> nn = nStart; nn &lt; nEnd; nn++)</div>
<div class="line"><a id="l00617" name="l00617"></a><span class="lineno">  617</span>            {</div>
<div class="line"><a id="l00618" name="l00618"></a><span class="lineno">  618</span>               <span class="comment">// Append the coastal portion of the shadow zone boundary to the grid CRS vector</span></div>
<div class="line"><a id="l00619" name="l00619"></a><span class="lineno">  619</span>               LIBoundary.<a class="code hl_function" href="../../d2/d0f/classCA2DIShape.html#ab181578766d0cacb30c7ad0d695bf595">Append</a>(<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].pPtiGetCellMarkedAsCoastline(nn));</div>
<div class="line"><a id="l00620" name="l00620"></a><span class="lineno">  620</span>               <span class="comment">// LogStream &lt;&lt; &quot;Coast point A &quot; &lt;&lt; nn &lt;&lt; &quot; [&quot; &lt;&lt; m_VCoast[nCoast].pPtiGetCellMarkedAsCoastline(nn)-&gt;nGetX() &lt;&lt; &quot;][&quot; &lt;&lt; m_VCoast[nCoast].pPtiGetCellMarkedAsCoastline(nn)-&gt;nGetY() &lt;&lt; &quot;]&quot; &lt;&lt; endl;</span></div>
<div class="line"><a id="l00621" name="l00621"></a><span class="lineno">  621</span>            }</div>
<div class="line"><a id="l00622" name="l00622"></a><span class="lineno">  622</span>         }</div>
<div class="line"><a id="l00623" name="l00623"></a><span class="lineno">  623</span> </div>
<div class="line"><a id="l00624" name="l00624"></a><span class="lineno">  624</span>         <span class="keywordflow">else</span></div>
<div class="line"><a id="l00625" name="l00625"></a><span class="lineno">  625</span>         {</div>
<div class="line"><a id="l00626" name="l00626"></a><span class="lineno">  626</span>            <span class="comment">// The shadow boundary endpoint is up-coast from the shadow boundary start point</span></div>
<div class="line"><a id="l00627" name="l00627"></a><span class="lineno">  627</span>            <span class="keywordtype">int</span> <span class="keyword">const</span> nStart = <a class="code hl_function" href="../../d6/d2a/cme_8h.html#a068017859403c0629d89f8d348f6c224">tMin</a>(VnShadowBoundaryEndCoastPoint[nZone], <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].nGetCoastlineSize() - 1);</div>
<div class="line"><a id="l00628" name="l00628"></a><span class="lineno">  628</span>            <span class="keywordtype">int</span> <span class="keyword">const</span> nEnd = <a class="code hl_function" href="../../d6/d2a/cme_8h.html#a7e895b460cef877dec4d12ead0c74f15">tMax</a>(VnShadowBoundaryStartCoastPoint[nZone], 0);</div>
<div class="line"><a id="l00629" name="l00629"></a><span class="lineno">  629</span> </div>
<div class="line"><a id="l00630" name="l00630"></a><span class="lineno">  630</span>            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> nn = nStart; nn &gt;= nEnd; nn--)</div>
<div class="line"><a id="l00631" name="l00631"></a><span class="lineno">  631</span>            {</div>
<div class="line"><a id="l00632" name="l00632"></a><span class="lineno">  632</span>               <span class="comment">// Append the coastal portion of the shadow zone boundary to the grid CRS vector</span></div>
<div class="line"><a id="l00633" name="l00633"></a><span class="lineno">  633</span>               LIBoundary.<a class="code hl_function" href="../../d2/d0f/classCA2DIShape.html#ab181578766d0cacb30c7ad0d695bf595">Append</a>(<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].pPtiGetCellMarkedAsCoastline(nn));</div>
<div class="line"><a id="l00634" name="l00634"></a><span class="lineno">  634</span>               <span class="comment">// LogStream &lt;&lt; &quot;Coast point B &quot; &lt;&lt; nn &lt;&lt; &quot; [&quot; &lt;&lt; m_VCoast[nCoast].pPtiGetCellMarkedAsCoastline(nn)-&gt;nGetX() &lt;&lt; &quot;][&quot; &lt;&lt; m_VCoast[nCoast].pPtiGetCellMarkedAsCoastline(nn)-&gt;nGetY() &lt;&lt; &quot;]&quot; &lt;&lt; endl;</span></div>
<div class="line"><a id="l00635" name="l00635"></a><span class="lineno">  635</span>            }</div>
<div class="line"><a id="l00636" name="l00636"></a><span class="lineno">  636</span>         }</div>
<div class="line"><a id="l00637" name="l00637"></a><span class="lineno">  637</span> </div>
<div class="line"><a id="l00638" name="l00638"></a><span class="lineno">  638</span>         <span class="comment">//          // DEBUG CODE =======================================================================================================================</span></div>
<div class="line"><a id="l00639" name="l00639"></a><span class="lineno">  639</span>         <span class="comment">// LogStream &lt;&lt; &quot;FIRST&quot; &lt;&lt; endl;</span></div>
<div class="line"><a id="l00640" name="l00640"></a><span class="lineno">  640</span>         <span class="comment">// for (int k = 0; k &lt; LIBoundary.nGetSize(); k++)</span></div>
<div class="line"><a id="l00641" name="l00641"></a><span class="lineno">  641</span>         <span class="comment">// {</span></div>
<div class="line"><a id="l00642" name="l00642"></a><span class="lineno">  642</span>         <span class="comment">// CGeom2DIPoint PtiTmp = *LIBoundary.pPtiGetAt(k);</span></div>
<div class="line"><a id="l00643" name="l00643"></a><span class="lineno">  643</span>         <span class="comment">// LogStream &lt;&lt; k &lt;&lt; &quot; [&quot; &lt;&lt; PtiTmp.nGetX() &lt;&lt; &quot;][&quot; &lt;&lt; PtiTmp.nGetY() &lt;&lt; &quot;]&quot; &lt;&lt; endl;</span></div>
<div class="line"><a id="l00644" name="l00644"></a><span class="lineno">  644</span>         <span class="comment">// }</span></div>
<div class="line"><a id="l00645" name="l00645"></a><span class="lineno">  645</span>         <span class="comment">// LogStream &lt;&lt; endl;</span></div>
<div class="line"><a id="l00646" name="l00646"></a><span class="lineno">  646</span>         <span class="comment">//          // DEBUG CODE =======================================================================================================================</span></div>
<div class="line"><a id="l00647" name="l00647"></a><span class="lineno">  647</span> </div>
<div class="line"><a id="l00648" name="l00648"></a><span class="lineno">  648</span>         <span class="comment">// Calculate the centroid</span></div>
<div class="line"><a id="l00649" name="l00649"></a><span class="lineno">  649</span>         <a class="code hl_class" href="../../d6/d0d/classCGeom2DIPoint.html">CGeom2DIPoint</a> <span class="keyword">const</span> PtiCentroid = <a class="code hl_function" href="../../d1/d98/classCSimulation.html#af41bf8d03921360b6bfc27a14ae7afd2">PtiPolygonCentroid</a>(LIBoundary.<a class="code hl_function" href="../../d2/d0f/classCA2DIShape.html#ae149d229c6313db4f4435fa104f40a90">pPtiVGetPoints</a>());</div>
<div class="line"><a id="l00650" name="l00650"></a><span class="lineno">  650</span> </div>
<div class="line"><a id="l00651" name="l00651"></a><span class="lineno">  651</span>         <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d1/d98/classCSimulation.html#ac900a5701df97da22278fae928951f50">bIsWithinValidGrid</a>(&amp;PtiCentroid)) <span class="comment">// Safety check</span></div>
<div class="line"><a id="l00652" name="l00652"></a><span class="lineno">  652</span>         {</div>
<div class="line"><a id="l00653" name="l00653"></a><span class="lineno">  653</span>            <span class="keywordtype">int</span> <span class="keyword">const</span> nRet = <a class="code hl_function" href="../../d1/d98/classCSimulation.html#a190ca0d855be5530fa013c468a868393">nFloodFillShadowZone</a>(nZone, &amp;PtiCentroid, &amp;PtiStart, &amp;PtiEnd);</div>
<div class="line"><a id="l00654" name="l00654"></a><span class="lineno">  654</span> </div>
<div class="line"><a id="l00655" name="l00655"></a><span class="lineno">  655</span>            <span class="keywordflow">if</span> (nRet != <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#aa768cb14b5c6123ee95e6e4ebd9fe331">RTN_OK</a>)</div>
<div class="line"><a id="l00656" name="l00656"></a><span class="lineno">  656</span>            {</div>
<div class="line"><a id="l00657" name="l00657"></a><span class="lineno">  657</span>               <span class="comment">// Could not find start point for cell-by-cell fill. How serious we judge this to be depends on the length of the shadow zone line</span></div>
<div class="line"><a id="l00658" name="l00658"></a><span class="lineno">  658</span>               <span class="keywordflow">if</span> (nShadowLineLen &lt; <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a052095c3f746a887244b9818d181696c">MAX_LEN_SHADOW_LINE_TO_IGNORE</a>)</div>
<div class="line"><a id="l00659" name="l00659"></a><span class="lineno">  659</span>               {</div>
<div class="line"><a id="l00660" name="l00660"></a><span class="lineno">  660</span>                  <span class="keywordflow">if</span> (<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a0245d3cbdd603fbeced6ca1465eb3f16">m_nLogFileDetail</a> &gt;= <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#aa58b13ad2e88aaa20449bfea242396a4">LOG_FILE_ALL</a>)</div>
<div class="line"><a id="l00661" name="l00661"></a><span class="lineno">  661</span>                     <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a222962121613613a48f518e0c2110f21">LogStream</a> &lt;&lt; <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#ad67e8c5b30a0572f64ecfb5c062c2edc">m_ulIter</a> &lt;&lt; <span class="stringliteral">&quot;: &quot;</span> &lt;&lt; <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a957ca99e98618160534cafb0929f743d">WARN</a> &lt;&lt; <span class="stringliteral">&quot;could not find start point for cell-by-cell fill of shadow zone &quot;</span> &lt;&lt; nZone &lt;&lt; <span class="stringliteral">&quot; but continuing simulation because this is a small shadow zone (shadow line length = &quot;</span> &lt;&lt; nShadowLineLen &lt;&lt; <span class="stringliteral">&quot; cells)&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a id="l00662" name="l00662"></a><span class="lineno">  662</span> </div>
<div class="line"><a id="l00663" name="l00663"></a><span class="lineno">  663</span>                  <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l00664" name="l00664"></a><span class="lineno">  664</span>               }</div>
<div class="line"><a id="l00665" name="l00665"></a><span class="lineno">  665</span> </div>
<div class="line"><a id="l00666" name="l00666"></a><span class="lineno">  666</span>               <span class="keywordflow">else</span></div>
<div class="line"><a id="l00667" name="l00667"></a><span class="lineno">  667</span>               {</div>
<div class="line"><a id="l00668" name="l00668"></a><span class="lineno">  668</span>                  <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a222962121613613a48f518e0c2110f21">LogStream</a> &lt;&lt; <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#ad67e8c5b30a0572f64ecfb5c062c2edc">m_ulIter</a> &lt;&lt; <span class="stringliteral">&quot;: &quot;</span> &lt;&lt; <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a292fc90846543ca4814daa9f759feb05">ERR</a> &lt;&lt; <span class="stringliteral">&quot;could not find start point for cell-by-cell fill of shadow zone &quot;</span> &lt;&lt; nZone &lt;&lt; <span class="stringliteral">&quot; (shadow line length = &quot;</span> &lt;&lt; nShadowLineLen &lt;&lt; <span class="stringliteral">&quot; cells)&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a id="l00669" name="l00669"></a><span class="lineno">  669</span>                  <span class="keywordflow">return</span> nRet;</div>
<div class="line"><a id="l00670" name="l00670"></a><span class="lineno">  670</span>               }</div>
<div class="line"><a id="l00671" name="l00671"></a><span class="lineno">  671</span>            }</div>
<div class="line"><a id="l00672" name="l00672"></a><span class="lineno">  672</span> </div>
<div class="line"><a id="l00673" name="l00673"></a><span class="lineno">  673</span>            <span class="comment">// Sweep the shadow zone, changing wave orientation and height</span></div>
<div class="line"><a id="l00674" name="l00674"></a><span class="lineno">  674</span>            <a class="code hl_function" href="../../d1/d98/classCSimulation.html#ad0916f582b3252101f9dbd6445d43c80">DoShadowZoneAndDownDriftZone</a>(nCoast, nZone, VnShadowBoundaryStartCoastPoint[nZone], VnShadowBoundaryEndCoastPoint[nZone]);</div>
<div class="line"><a id="l00675" name="l00675"></a><span class="lineno">  675</span>         }</div>
<div class="line"><a id="l00676" name="l00676"></a><span class="lineno">  676</span>      }</div>
<div class="line"><a id="l00677" name="l00677"></a><span class="lineno">  677</span>   }</div>
<div class="line"><a id="l00678" name="l00678"></a><span class="lineno">  678</span> </div>
<div class="line"><a id="l00679" name="l00679"></a><span class="lineno">  679</span>   <span class="keywordflow">return</span> <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#aa768cb14b5c6123ee95e6e4ebd9fe331">RTN_OK</a>;</div>
<div class="line"><a id="l00680" name="l00680"></a><span class="lineno">  680</span>}</div>
</div>
<div class="line"><a id="l00681" name="l00681"></a><span class="lineno">  681</span> </div>
<div class="line"><a id="l00682" name="l00682"></a><span class="lineno">  682</span><span class="comment">//===============================================================================================================================</span></div>
<div class="line"><a id="l00684" name="l00684"></a><span class="lineno">  684</span><span class="comment">//===============================================================================================================================</span></div>
<div class="foldopen" id="foldopen00685" data-start="{" data-end="}">
<div class="line"><a id="l00685" name="l00685"></a><span class="lineno"><a class="line" href="../../d1/d98/classCSimulation.html#a190ca0d855be5530fa013c468a868393">  685</a></span><span class="keywordtype">int</span> <a class="code hl_function" href="../../d1/d98/classCSimulation.html#a190ca0d855be5530fa013c468a868393">CSimulation::nFloodFillShadowZone</a>(<span class="keywordtype">int</span> <span class="keyword">const</span> nZone, <a class="code hl_class" href="../../d6/d0d/classCGeom2DIPoint.html">CGeom2DIPoint</a> <span class="keyword">const</span>* pPtiCentroid, <a class="code hl_class" href="../../d6/d0d/classCGeom2DIPoint.html">CGeom2DIPoint</a> <span class="keyword">const</span>* pPtiShadowBoundaryStart, <a class="code hl_class" href="../../d6/d0d/classCGeom2DIPoint.html">CGeom2DIPoint</a> <span class="keyword">const</span>* pPtiShadowBoundaryEnd)</div>
<div class="line"><a id="l00686" name="l00686"></a><span class="lineno">  686</span>{</div>
<div class="line"><a id="l00687" name="l00687"></a><span class="lineno">  687</span>   <span class="comment">// Is the centroid a sea cell?</span></div>
<div class="line"><a id="l00688" name="l00688"></a><span class="lineno">  688</span>   <span class="keywordtype">bool</span> bStartPointOK = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00689" name="l00689"></a><span class="lineno">  689</span>   <span class="keywordtype">bool</span> bAllPointNotSea = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00690" name="l00690"></a><span class="lineno">  690</span>   <a class="code hl_class" href="../../d6/d0d/classCGeom2DIPoint.html">CGeom2DIPoint</a> PtiFloodFillStart = *pPtiCentroid;</div>
<div class="line"><a id="l00691" name="l00691"></a><span class="lineno">  691</span> </div>
<div class="line"><a id="l00692" name="l00692"></a><span class="lineno">  692</span>   <span class="keywordflow">if</span> (! <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[PtiFloodFillStart.<a class="code hl_function" href="../../d6/d0d/classCGeom2DIPoint.html#af84c687b2d0be01ab41cbcc0565f4f3f">nGetX</a>()][PtiFloodFillStart.<a class="code hl_function" href="../../d6/d0d/classCGeom2DIPoint.html#a4d9c20bcca90dcb9d519b664aba09cbd">nGetY</a>()].bIsInContiguousSea())</div>
<div class="line"><a id="l00693" name="l00693"></a><span class="lineno">  693</span>   {</div>
<div class="line"><a id="l00694" name="l00694"></a><span class="lineno">  694</span>      <span class="comment">// No it isn&#39;t: so try to find a cell that is</span></div>
<div class="line"><a id="l00695" name="l00695"></a><span class="lineno">  695</span>      bStartPointOK = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00696" name="l00696"></a><span class="lineno">  696</span>      <span class="keywordtype">double</span> dWeight = 0.05;</div>
<div class="line"><a id="l00697" name="l00697"></a><span class="lineno">  697</span> </div>
<div class="line"><a id="l00698" name="l00698"></a><span class="lineno">  698</span>      <span class="keywordflow">while</span> ((! bStartPointOK) &amp;&amp; (dWeight &lt; 1))</div>
<div class="line"><a id="l00699" name="l00699"></a><span class="lineno">  699</span>      {</div>
<div class="line"><a id="l00700" name="l00700"></a><span class="lineno">  700</span>         <span class="comment">// Find a start point for the Cell-by-cell fill. Because shadow zones are generally triangular, start by choosing a low weighting so that the start point is close to the centroid, but a bit towards the coast. If this doesn&#39;t work, go further coastwards</span></div>
<div class="line"><a id="l00701" name="l00701"></a><span class="lineno">  701</span>         PtiFloodFillStart = <a class="code hl_function" href="../../d1/d98/classCSimulation.html#aab00c3ffdc6a62988fc500ca1d4eac9b">PtiWeightedAverage</a>(pPtiShadowBoundaryEnd, pPtiCentroid, dWeight);</div>
<div class="line"><a id="l00702" name="l00702"></a><span class="lineno">  702</span> </div>
<div class="line"><a id="l00703" name="l00703"></a><span class="lineno">  703</span>         <span class="comment">// Safety check</span></div>
<div class="line"><a id="l00704" name="l00704"></a><span class="lineno">  704</span>         <span class="keywordflow">if</span> (PtiFloodFillStart == *pPtiCentroid)</div>
<div class="line"><a id="l00705" name="l00705"></a><span class="lineno">  705</span>         {</div>
<div class="line"><a id="l00706" name="l00706"></a><span class="lineno">  706</span>            dWeight += 0.05;</div>
<div class="line"><a id="l00707" name="l00707"></a><span class="lineno">  707</span>            <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l00708" name="l00708"></a><span class="lineno">  708</span>         }</div>
<div class="line"><a id="l00709" name="l00709"></a><span class="lineno">  709</span> </div>
<div class="line"><a id="l00710" name="l00710"></a><span class="lineno">  710</span>         <span class="comment">// Safety check</span></div>
<div class="line"><a id="l00711" name="l00711"></a><span class="lineno">  711</span>         <span class="keywordflow">if</span> (! <a class="code hl_function" href="../../d1/d98/classCSimulation.html#ac900a5701df97da22278fae928951f50">bIsWithinValidGrid</a>(&amp;PtiFloodFillStart))</div>
<div class="line"><a id="l00712" name="l00712"></a><span class="lineno">  712</span>         {</div>
<div class="line"><a id="l00713" name="l00713"></a><span class="lineno">  713</span>            <span class="keywordflow">if</span> (<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a0245d3cbdd603fbeced6ca1465eb3f16">m_nLogFileDetail</a> &gt;= <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a85da1142fa4655ec66f1e391444a6d9a">LOG_FILE_HIGH_DETAIL</a>)</div>
<div class="line"><a id="l00714" name="l00714"></a><span class="lineno">  714</span>               <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a222962121613613a48f518e0c2110f21">LogStream</a> &lt;&lt; <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#ad67e8c5b30a0572f64ecfb5c062c2edc">m_ulIter</a> &lt;&lt; <span class="stringliteral">&quot;: &quot;</span> &lt;&lt; <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a292fc90846543ca4814daa9f759feb05">ERR</a> &lt;&lt; <span class="stringliteral">&quot;start point [&quot;</span> &lt;&lt; PtiFloodFillStart.<a class="code hl_function" href="../../d6/d0d/classCGeom2DIPoint.html#af84c687b2d0be01ab41cbcc0565f4f3f">nGetX</a>() &lt;&lt; <span class="stringliteral">&quot;][&quot;</span> &lt;&lt; PtiFloodFillStart.<a class="code hl_function" href="../../d6/d0d/classCGeom2DIPoint.html#a4d9c20bcca90dcb9d519b664aba09cbd">nGetY</a>() &lt;&lt; <span class="stringliteral">&quot;] = {&quot;</span> &lt;&lt; <a class="code hl_function" href="../../d1/d98/classCSimulation.html#ad79b925ac5f358c6f867b6e47dad74bd">dGridCentroidXToExtCRSX</a>(PtiFloodFillStart.<a class="code hl_function" href="../../d6/d0d/classCGeom2DIPoint.html#af84c687b2d0be01ab41cbcc0565f4f3f">nGetX</a>()) &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; <a class="code hl_function" href="../../d1/d98/classCSimulation.html#a7e2a4bd69ce79377fee86aa5598903f8">dGridCentroidYToExtCRSY</a>(PtiFloodFillStart.<a class="code hl_function" href="../../d6/d0d/classCGeom2DIPoint.html#a4d9c20bcca90dcb9d519b664aba09cbd">nGetY</a>()) &lt;&lt; <span class="stringliteral">&quot;} for cell-by-cell fill of shadow zone is outside grid&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a id="l00715" name="l00715"></a><span class="lineno">  715</span> </div>
<div class="line"><a id="l00716" name="l00716"></a><span class="lineno">  716</span>            <span class="keywordflow">return</span> <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a4c7934393517cd814fe5ead496fa15b9">RTN_ERR_SHADOW_ZONE_FLOOD_FILL_NOGRID</a>;</div>
<div class="line"><a id="l00717" name="l00717"></a><span class="lineno">  717</span>         }</div>
<div class="line"><a id="l00718" name="l00718"></a><span class="lineno">  718</span> </div>
<div class="line"><a id="l00719" name="l00719"></a><span class="lineno">  719</span>         <span class="keywordflow">if</span> (<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[PtiFloodFillStart.<a class="code hl_function" href="../../d6/d0d/classCGeom2DIPoint.html#af84c687b2d0be01ab41cbcc0565f4f3f">nGetX</a>()][PtiFloodFillStart.<a class="code hl_function" href="../../d6/d0d/classCGeom2DIPoint.html#a4d9c20bcca90dcb9d519b664aba09cbd">nGetY</a>()].bIsInContiguousSea())</div>
<div class="line"><a id="l00720" name="l00720"></a><span class="lineno">  720</span>         {</div>
<div class="line"><a id="l00721" name="l00721"></a><span class="lineno">  721</span>            <span class="comment">// Start point is a sea cell, all OK</span></div>
<div class="line"><a id="l00722" name="l00722"></a><span class="lineno">  722</span>            bStartPointOK = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00723" name="l00723"></a><span class="lineno">  723</span>            bAllPointNotSea = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00724" name="l00724"></a><span class="lineno">  724</span>         }</div>
<div class="line"><a id="l00725" name="l00725"></a><span class="lineno">  725</span> </div>
<div class="line"><a id="l00726" name="l00726"></a><span class="lineno">  726</span>         <span class="keywordflow">else</span></div>
<div class="line"><a id="l00727" name="l00727"></a><span class="lineno">  727</span>         {</div>
<div class="line"><a id="l00728" name="l00728"></a><span class="lineno">  728</span>            <span class="comment">// Start point is not a sea cell</span></div>
<div class="line"><a id="l00729" name="l00729"></a><span class="lineno">  729</span>            <span class="keywordflow">if</span> (<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a0245d3cbdd603fbeced6ca1465eb3f16">m_nLogFileDetail</a> &gt;= <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a85da1142fa4655ec66f1e391444a6d9a">LOG_FILE_HIGH_DETAIL</a>)</div>
<div class="line"><a id="l00730" name="l00730"></a><span class="lineno">  730</span>               <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a222962121613613a48f518e0c2110f21">LogStream</a> &lt;&lt; <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#ad67e8c5b30a0572f64ecfb5c062c2edc">m_ulIter</a> &lt;&lt; <span class="stringliteral">&quot;: shadow zone cell-by-cell fill start point [&quot;</span> &lt;&lt; PtiFloodFillStart.<a class="code hl_function" href="../../d6/d0d/classCGeom2DIPoint.html#af84c687b2d0be01ab41cbcc0565f4f3f">nGetX</a>() &lt;&lt; <span class="stringliteral">&quot;][&quot;</span> &lt;&lt; PtiFloodFillStart.<a class="code hl_function" href="../../d6/d0d/classCGeom2DIPoint.html#a4d9c20bcca90dcb9d519b664aba09cbd">nGetY</a>() &lt;&lt; <span class="stringliteral">&quot;] = {&quot;</span> &lt;&lt; <a class="code hl_function" href="../../d1/d98/classCSimulation.html#ad79b925ac5f358c6f867b6e47dad74bd">dGridCentroidXToExtCRSX</a>(PtiFloodFillStart.<a class="code hl_function" href="../../d6/d0d/classCGeom2DIPoint.html#af84c687b2d0be01ab41cbcc0565f4f3f">nGetX</a>()) &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; <a class="code hl_function" href="../../d1/d98/classCSimulation.html#a7e2a4bd69ce79377fee86aa5598903f8">dGridCentroidYToExtCRSY</a>(PtiFloodFillStart.<a class="code hl_function" href="../../d6/d0d/classCGeom2DIPoint.html#a4d9c20bcca90dcb9d519b664aba09cbd">nGetY</a>()) &lt;&lt; <span class="stringliteral">&quot;} is NOT a sea cell for shadow boundary from cape point [&quot;</span> &lt;&lt; pPtiShadowBoundaryStart-&gt;<a class="code hl_function" href="../../d6/d0d/classCGeom2DIPoint.html#af84c687b2d0be01ab41cbcc0565f4f3f">nGetX</a>() &lt;&lt; <span class="stringliteral">&quot;][&quot;</span> &lt;&lt; pPtiShadowBoundaryStart-&gt;<a class="code hl_function" href="../../d6/d0d/classCGeom2DIPoint.html#a4d9c20bcca90dcb9d519b664aba09cbd">nGetY</a>() &lt;&lt; <span class="stringliteral">&quot;] = {&quot;</span> &lt;&lt; <a class="code hl_function" href="../../d1/d98/classCSimulation.html#ad79b925ac5f358c6f867b6e47dad74bd">dGridCentroidXToExtCRSX</a>(pPtiShadowBoundaryStart-&gt;<a class="code hl_function" href="../../d6/d0d/classCGeom2DIPoint.html#af84c687b2d0be01ab41cbcc0565f4f3f">nGetX</a>()) &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; <a class="code hl_function" href="../../d1/d98/classCSimulation.html#a7e2a4bd69ce79377fee86aa5598903f8">dGridCentroidYToExtCRSY</a>(pPtiShadowBoundaryStart-&gt;<a class="code hl_function" href="../../d6/d0d/classCGeom2DIPoint.html#a4d9c20bcca90dcb9d519b664aba09cbd">nGetY</a>()) &lt;&lt; <span class="stringliteral">&quot;} to [&quot;</span> &lt;&lt; pPtiShadowBoundaryEnd-&gt;<a class="code hl_function" href="../../d6/d0d/classCGeom2DIPoint.html#af84c687b2d0be01ab41cbcc0565f4f3f">nGetX</a>() &lt;&lt; <span class="stringliteral">&quot;][&quot;</span> &lt;&lt; pPtiShadowBoundaryEnd-&gt;<a class="code hl_function" href="../../d6/d0d/classCGeom2DIPoint.html#a4d9c20bcca90dcb9d519b664aba09cbd">nGetY</a>() &lt;&lt; <span class="stringliteral">&quot;] = {&quot;</span> &lt;&lt; <a class="code hl_function" href="../../d1/d98/classCSimulation.html#ad79b925ac5f358c6f867b6e47dad74bd">dGridCentroidXToExtCRSX</a>(pPtiShadowBoundaryEnd-&gt;<a class="code hl_function" href="../../d6/d0d/classCGeom2DIPoint.html#af84c687b2d0be01ab41cbcc0565f4f3f">nGetX</a>()) &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; <a class="code hl_function" href="../../d1/d98/classCSimulation.html#a7e2a4bd69ce79377fee86aa5598903f8">dGridCentroidYToExtCRSY</a>(pPtiShadowBoundaryEnd-&gt;<a class="code hl_function" href="../../d6/d0d/classCGeom2DIPoint.html#a4d9c20bcca90dcb9d519b664aba09cbd">nGetY</a>()) &lt;&lt; <span class="stringliteral">&quot;}, dWeight = &quot;</span> &lt;&lt; dWeight &lt;&lt; endl;</div>
<div class="line"><a id="l00731" name="l00731"></a><span class="lineno">  731</span> </div>
<div class="line"><a id="l00732" name="l00732"></a><span class="lineno">  732</span>            dWeight += 0.05;</div>
<div class="line"><a id="l00733" name="l00733"></a><span class="lineno">  733</span>         }</div>
<div class="line"><a id="l00734" name="l00734"></a><span class="lineno">  734</span>      }</div>
<div class="line"><a id="l00735" name="l00735"></a><span class="lineno">  735</span>   }</div>
<div class="line"><a id="l00736" name="l00736"></a><span class="lineno">  736</span> </div>
<div class="line"><a id="l00737" name="l00737"></a><span class="lineno">  737</span>   <span class="keywordflow">if</span> ((! bStartPointOK) &amp;&amp; (! bAllPointNotSea))</div>
<div class="line"><a id="l00738" name="l00738"></a><span class="lineno">  738</span>   {</div>
<div class="line"><a id="l00739" name="l00739"></a><span class="lineno">  739</span>      <span class="keywordflow">if</span> (<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a0245d3cbdd603fbeced6ca1465eb3f16">m_nLogFileDetail</a> &gt;= <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a85da1142fa4655ec66f1e391444a6d9a">LOG_FILE_HIGH_DETAIL</a>)</div>
<div class="line"><a id="l00740" name="l00740"></a><span class="lineno">  740</span>         <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a222962121613613a48f518e0c2110f21">LogStream</a> &lt;&lt; <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#ad67e8c5b30a0572f64ecfb5c062c2edc">m_ulIter</a> &lt;&lt; <span class="stringliteral">&quot;: &quot;</span> &lt;&lt; <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a292fc90846543ca4814daa9f759feb05">ERR</a> &lt;&lt; <span class="stringliteral">&quot;could not find shadow zone cell-by-cell fill start point&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a id="l00741" name="l00741"></a><span class="lineno">  741</span> </div>
<div class="line"><a id="l00742" name="l00742"></a><span class="lineno">  742</span>      <span class="keywordflow">return</span> <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a368ba64a15504bd62f1711a5d11d78a6">RTN_ERR_SHADOW_ZONE_FLOOD_START_POINT</a>;</div>
<div class="line"><a id="l00743" name="l00743"></a><span class="lineno">  743</span>   }</div>
<div class="line"><a id="l00744" name="l00744"></a><span class="lineno">  744</span> </div>
<div class="line"><a id="l00745" name="l00745"></a><span class="lineno">  745</span>   <span class="keywordflow">if</span> (<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a0245d3cbdd603fbeced6ca1465eb3f16">m_nLogFileDetail</a> &gt;= <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#aa58b13ad2e88aaa20449bfea242396a4">LOG_FILE_ALL</a>)</div>
<div class="line"><a id="l00746" name="l00746"></a><span class="lineno">  746</span>      <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a222962121613613a48f518e0c2110f21">LogStream</a> &lt;&lt; <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#ad67e8c5b30a0572f64ecfb5c062c2edc">m_ulIter</a> &lt;&lt; <span class="stringliteral">&quot;: shadow zone cell-by-cell fill start point [&quot;</span> &lt;&lt; PtiFloodFillStart.<a class="code hl_function" href="../../d6/d0d/classCGeom2DIPoint.html#af84c687b2d0be01ab41cbcc0565f4f3f">nGetX</a>() &lt;&lt; <span class="stringliteral">&quot;][&quot;</span> &lt;&lt; PtiFloodFillStart.<a class="code hl_function" href="../../d6/d0d/classCGeom2DIPoint.html#a4d9c20bcca90dcb9d519b664aba09cbd">nGetY</a>() &lt;&lt; <span class="stringliteral">&quot;] = {&quot;</span> &lt;&lt; <a class="code hl_function" href="../../d1/d98/classCSimulation.html#ad79b925ac5f358c6f867b6e47dad74bd">dGridCentroidXToExtCRSX</a>(PtiFloodFillStart.<a class="code hl_function" href="../../d6/d0d/classCGeom2DIPoint.html#af84c687b2d0be01ab41cbcc0565f4f3f">nGetX</a>()) &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; <a class="code hl_function" href="../../d1/d98/classCSimulation.html#a7e2a4bd69ce79377fee86aa5598903f8">dGridCentroidYToExtCRSY</a>(PtiFloodFillStart.<a class="code hl_function" href="../../d6/d0d/classCGeom2DIPoint.html#a4d9c20bcca90dcb9d519b664aba09cbd">nGetY</a>()) &lt;&lt; <span class="stringliteral">&quot;} is OK for shadow boundary from [&quot;</span> &lt;&lt; pPtiShadowBoundaryStart-&gt;<a class="code hl_function" href="../../d6/d0d/classCGeom2DIPoint.html#af84c687b2d0be01ab41cbcc0565f4f3f">nGetX</a>() &lt;&lt; <span class="stringliteral">&quot;][&quot;</span> &lt;&lt; pPtiShadowBoundaryStart-&gt;<a class="code hl_function" href="../../d6/d0d/classCGeom2DIPoint.html#a4d9c20bcca90dcb9d519b664aba09cbd">nGetY</a>() &lt;&lt; <span class="stringliteral">&quot;] = {&quot;</span> &lt;&lt; <a class="code hl_function" href="../../d1/d98/classCSimulation.html#ad79b925ac5f358c6f867b6e47dad74bd">dGridCentroidXToExtCRSX</a>(pPtiShadowBoundaryStart-&gt;<a class="code hl_function" href="../../d6/d0d/classCGeom2DIPoint.html#af84c687b2d0be01ab41cbcc0565f4f3f">nGetX</a>()) &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; <a class="code hl_function" href="../../d1/d98/classCSimulation.html#a7e2a4bd69ce79377fee86aa5598903f8">dGridCentroidYToExtCRSY</a>(pPtiShadowBoundaryStart-&gt;<a class="code hl_function" href="../../d6/d0d/classCGeom2DIPoint.html#a4d9c20bcca90dcb9d519b664aba09cbd">nGetY</a>()) &lt;&lt; <span class="stringliteral">&quot;} to [&quot;</span> &lt;&lt; pPtiShadowBoundaryEnd-&gt;<a class="code hl_function" href="../../d6/d0d/classCGeom2DIPoint.html#af84c687b2d0be01ab41cbcc0565f4f3f">nGetX</a>() &lt;&lt; <span class="stringliteral">&quot;][&quot;</span> &lt;&lt; pPtiShadowBoundaryEnd-&gt;<a class="code hl_function" href="../../d6/d0d/classCGeom2DIPoint.html#a4d9c20bcca90dcb9d519b664aba09cbd">nGetY</a>() &lt;&lt; <span class="stringliteral">&quot;] = {&quot;</span> &lt;&lt; <a class="code hl_function" href="../../d1/d98/classCSimulation.html#ad79b925ac5f358c6f867b6e47dad74bd">dGridCentroidXToExtCRSX</a>(pPtiShadowBoundaryEnd-&gt;<a class="code hl_function" href="../../d6/d0d/classCGeom2DIPoint.html#af84c687b2d0be01ab41cbcc0565f4f3f">nGetX</a>()) &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; <a class="code hl_function" href="../../d1/d98/classCSimulation.html#a7e2a4bd69ce79377fee86aa5598903f8">dGridCentroidYToExtCRSY</a>(pPtiShadowBoundaryEnd-&gt;<a class="code hl_function" href="../../d6/d0d/classCGeom2DIPoint.html#a4d9c20bcca90dcb9d519b664aba09cbd">nGetY</a>()) &lt;&lt; <span class="stringliteral">&quot;}&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a id="l00747" name="l00747"></a><span class="lineno">  747</span> </div>
<div class="line"><a id="l00748" name="l00748"></a><span class="lineno">  748</span>   <span class="comment">// All OK, so create an empty stack</span></div>
<div class="line"><a id="l00749" name="l00749"></a><span class="lineno">  749</span>   stack&lt;CGeom2DIPoint&gt; PtiStack;</div>
<div class="line"><a id="l00750" name="l00750"></a><span class="lineno">  750</span> </div>
<div class="line"><a id="l00751" name="l00751"></a><span class="lineno">  751</span>   <span class="comment">// We have a cell-by-cell fill start point so push this point onto the stack</span></div>
<div class="line"><a id="l00752" name="l00752"></a><span class="lineno">  752</span>   PtiStack.push(PtiFloodFillStart);</div>
<div class="line"><a id="l00753" name="l00753"></a><span class="lineno">  753</span> </div>
<div class="line"><a id="l00754" name="l00754"></a><span class="lineno">  754</span>   <span class="comment">// Then do the cell-by-cell fill: loop until there are no more cell coordinates on the stack</span></div>
<div class="line"><a id="l00755" name="l00755"></a><span class="lineno">  755</span>   <span class="keywordflow">while</span> (! PtiStack.empty())</div>
<div class="line"><a id="l00756" name="l00756"></a><span class="lineno">  756</span>   {</div>
<div class="line"><a id="l00757" name="l00757"></a><span class="lineno">  757</span>      <a class="code hl_class" href="../../d6/d0d/classCGeom2DIPoint.html">CGeom2DIPoint</a> <span class="keyword">const</span> Pti = PtiStack.top();</div>
<div class="line"><a id="l00758" name="l00758"></a><span class="lineno">  758</span>      PtiStack.pop();</div>
<div class="line"><a id="l00759" name="l00759"></a><span class="lineno">  759</span> </div>
<div class="line"><a id="l00760" name="l00760"></a><span class="lineno">  760</span>      <span class="keywordtype">int</span></div>
<div class="line"><a id="l00761" name="l00761"></a><span class="lineno">  761</span>          nX = Pti.<a class="code hl_function" href="../../d6/d0d/classCGeom2DIPoint.html#af84c687b2d0be01ab41cbcc0565f4f3f">nGetX</a>(),</div>
<div class="line"><a id="l00762" name="l00762"></a><span class="lineno">  762</span>          nY = Pti.<a class="code hl_function" href="../../d6/d0d/classCGeom2DIPoint.html#a4d9c20bcca90dcb9d519b664aba09cbd">nGetY</a>();</div>
<div class="line"><a id="l00763" name="l00763"></a><span class="lineno">  763</span> </div>
<div class="line"><a id="l00764" name="l00764"></a><span class="lineno">  764</span>      <span class="keywordflow">while</span> ((nX &gt;= 0) &amp;&amp; <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nX][nY].bIsInContiguousSea() &amp;&amp; (!<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nX][nY].bIsinThisShadowZone(-nZone - 1)) &amp;&amp; (!<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nX][nY].bIsShadowZoneBoundary()) &amp;&amp; (!<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nX][nY].bIsCoastline()))</div>
<div class="line"><a id="l00765" name="l00765"></a><span class="lineno">  765</span>         nX--;</div>
<div class="line"><a id="l00766" name="l00766"></a><span class="lineno">  766</span> </div>
<div class="line"><a id="l00767" name="l00767"></a><span class="lineno">  767</span>      nX++;</div>
<div class="line"><a id="l00768" name="l00768"></a><span class="lineno">  768</span> </div>
<div class="line"><a id="l00769" name="l00769"></a><span class="lineno">  769</span>      <span class="keywordtype">bool</span></div>
<div class="line"><a id="l00770" name="l00770"></a><span class="lineno">  770</span>          bSpanAbove = <span class="keyword">false</span>,</div>
<div class="line"><a id="l00771" name="l00771"></a><span class="lineno">  771</span>          bSpanBelow = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00772" name="l00772"></a><span class="lineno">  772</span> </div>
<div class="line"><a id="l00773" name="l00773"></a><span class="lineno">  773</span>      <span class="keywordflow">while</span> ((nX &lt; <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1652253500dab35e6f6f9f734207e20b">m_nXGridSize</a>) &amp;&amp; <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nX][nY].bIsInContiguousSea() &amp;&amp; (!<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nX][nY].bIsinThisShadowZone(-nZone - 1)) &amp;&amp; (!<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nX][nY].bIsShadowZoneBoundary()) &amp;&amp; (!<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nX][nY].bIsCoastline()))</div>
<div class="line"><a id="l00774" name="l00774"></a><span class="lineno">  774</span>      {</div>
<div class="line"><a id="l00775" name="l00775"></a><span class="lineno">  775</span>         <span class="comment">// Mark the cell as being in the shadow zone but not yet processed (a -ve number, with -1 being zone 1)</span></div>
<div class="line"><a id="l00776" name="l00776"></a><span class="lineno">  776</span>         <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nX][nY].SetShadowZoneNumber(-nZone - 1);</div>
<div class="line"><a id="l00777" name="l00777"></a><span class="lineno">  777</span> </div>
<div class="line"><a id="l00778" name="l00778"></a><span class="lineno">  778</span>         <span class="comment">// LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: [&quot; &lt;&lt; nX &lt;&lt; &quot;][&quot; &lt;&lt; nY &lt;&lt; &quot;] = {&quot; &lt;&lt; dGridCentroidXToExtCRSX(nX) &lt;&lt; &quot;, &quot; &lt;&lt; dGridCentroidYToExtCRSY(nY) &lt;&lt; &quot;} marked as shadow zone&quot; &lt;&lt; endl;</span></div>
<div class="line"><a id="l00779" name="l00779"></a><span class="lineno">  779</span> </div>
<div class="line"><a id="l00780" name="l00780"></a><span class="lineno">  780</span>         <span class="keywordflow">if</span> ((! bSpanAbove) &amp;&amp; (nY &gt; 0) &amp;&amp; <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nX][nY].bIsInContiguousSea() &amp;&amp; (!<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nX][nY - 1].bIsinThisShadowZone(-nZone - 1)) &amp;&amp; (!<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nX][nY - 1].bIsShadowZoneBoundary()) &amp;&amp; (!<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nX][nY - 1].bIsCoastline()))</div>
<div class="line"><a id="l00781" name="l00781"></a><span class="lineno">  781</span>         {</div>
<div class="line"><a id="l00782" name="l00782"></a><span class="lineno">  782</span>            PtiStack.push(<a class="code hl_class" href="../../d6/d0d/classCGeom2DIPoint.html">CGeom2DIPoint</a>(nX, nY - 1));</div>
<div class="line"><a id="l00783" name="l00783"></a><span class="lineno">  783</span>            bSpanAbove = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00784" name="l00784"></a><span class="lineno">  784</span>         }</div>
<div class="line"><a id="l00785" name="l00785"></a><span class="lineno">  785</span> </div>
<div class="line"><a id="l00786" name="l00786"></a><span class="lineno">  786</span>         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bSpanAbove &amp;&amp; (nY &gt; 0) &amp;&amp; ((!<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nX][nY - 1].bIsInContiguousSea()) || <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nX][nY - 1].bIsinThisShadowZone(-nZone - 1) || <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nX][nY - 1].bIsShadowZoneBoundary() || <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nX][nY - 1].bIsCoastline()))</div>
<div class="line"><a id="l00787" name="l00787"></a><span class="lineno">  787</span>         {</div>
<div class="line"><a id="l00788" name="l00788"></a><span class="lineno">  788</span>            bSpanAbove = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00789" name="l00789"></a><span class="lineno">  789</span>         }</div>
<div class="line"><a id="l00790" name="l00790"></a><span class="lineno">  790</span> </div>
<div class="line"><a id="l00791" name="l00791"></a><span class="lineno">  791</span>         <span class="keywordflow">if</span> ((! bSpanBelow) &amp;&amp; <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nX][nY].bIsInContiguousSea() &amp;&amp; (nY &lt; <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a3755fdc07c0ac9f2ce6c2237cfef50ce">m_nYGridSize</a> - 1) &amp;&amp; (!<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nX][nY + 1].bIsinThisShadowZone(-nZone - 1)) &amp;&amp; (!<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nX][nY + 1].bIsShadowZoneBoundary()) &amp;&amp; (!<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nX][nY + 1].bIsCoastline()))</div>
<div class="line"><a id="l00792" name="l00792"></a><span class="lineno">  792</span>         {</div>
<div class="line"><a id="l00793" name="l00793"></a><span class="lineno">  793</span>            PtiStack.push(<a class="code hl_class" href="../../d6/d0d/classCGeom2DIPoint.html">CGeom2DIPoint</a>(nX, nY + 1));</div>
<div class="line"><a id="l00794" name="l00794"></a><span class="lineno">  794</span>            bSpanBelow = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00795" name="l00795"></a><span class="lineno">  795</span>         }</div>
<div class="line"><a id="l00796" name="l00796"></a><span class="lineno">  796</span> </div>
<div class="line"><a id="l00797" name="l00797"></a><span class="lineno">  797</span>         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bSpanBelow &amp;&amp; (nY &lt; <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a3755fdc07c0ac9f2ce6c2237cfef50ce">m_nYGridSize</a> - 1) &amp;&amp; ((!<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nX][nY + 1].bIsInContiguousSea()) || <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nX][nY + 1].bIsinThisShadowZone(-nZone - 1) || <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nX][nY + 1].bIsShadowZoneBoundary() || <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nX][nY + 1].bIsCoastline()))</div>
<div class="line"><a id="l00798" name="l00798"></a><span class="lineno">  798</span>         {</div>
<div class="line"><a id="l00799" name="l00799"></a><span class="lineno">  799</span>            bSpanBelow = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00800" name="l00800"></a><span class="lineno">  800</span>         }</div>
<div class="line"><a id="l00801" name="l00801"></a><span class="lineno">  801</span> </div>
<div class="line"><a id="l00802" name="l00802"></a><span class="lineno">  802</span>         nX++;</div>
<div class="line"><a id="l00803" name="l00803"></a><span class="lineno">  803</span>      }</div>
<div class="line"><a id="l00804" name="l00804"></a><span class="lineno">  804</span>   }</div>
<div class="line"><a id="l00805" name="l00805"></a><span class="lineno">  805</span> </div>
<div class="line"><a id="l00806" name="l00806"></a><span class="lineno">  806</span>   <span class="keywordflow">return</span> <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#aa768cb14b5c6123ee95e6e4ebd9fe331">RTN_OK</a>;</div>
<div class="line"><a id="l00807" name="l00807"></a><span class="lineno">  807</span>}</div>
</div>
<div class="line"><a id="l00808" name="l00808"></a><span class="lineno">  808</span> </div>
<div class="line"><a id="l00809" name="l00809"></a><span class="lineno">  809</span><span class="comment">//===============================================================================================================================</span></div>
<div class="line"><a id="l00811" name="l00811"></a><span class="lineno">  811</span><span class="comment">//===============================================================================================================================</span></div>
<div class="foldopen" id="foldopen00812" data-start="{" data-end="}">
<div class="line"><a id="l00812" name="l00812"></a><span class="lineno"><a class="line" href="../../d1/d98/classCSimulation.html#ad0916f582b3252101f9dbd6445d43c80">  812</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../d1/d98/classCSimulation.html#ad0916f582b3252101f9dbd6445d43c80">CSimulation::DoShadowZoneAndDownDriftZone</a>(<span class="keywordtype">int</span> <span class="keyword">const</span> nCoast, <span class="keywordtype">int</span> <span class="keyword">const</span> nZone, <span class="keywordtype">int</span> <span class="keyword">const</span> nShadowBoundaryStartPoint, <span class="keywordtype">int</span> <span class="keyword">const</span> nShadowBoundaryEndPoint)</div>
<div class="line"><a id="l00813" name="l00813"></a><span class="lineno">  813</span>{</div>
<div class="line"><a id="l00814" name="l00814"></a><span class="lineno">  814</span>   <span class="keywordtype">int</span> <span class="keyword">const</span> nCoastSeaHand = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].nGetSeaHandedness();</div>
<div class="line"><a id="l00815" name="l00815"></a><span class="lineno">  815</span>   <span class="keywordtype">int</span> nShadowZoneCoastToCapeSeaHand;</div>
<div class="line"><a id="l00816" name="l00816"></a><span class="lineno">  816</span> </div>
<div class="line"><a id="l00817" name="l00817"></a><span class="lineno">  817</span>   <span class="keywordflow">if</span> (nCoastSeaHand == <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#afdd3411d0fa60c62522af14ea2a90570">LEFT_HANDED</a>)</div>
<div class="line"><a id="l00818" name="l00818"></a><span class="lineno">  818</span>      nShadowZoneCoastToCapeSeaHand = <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#ade186989e07cd54874887cd10d4a8465">RIGHT_HANDED</a>;</div>
<div class="line"><a id="l00819" name="l00819"></a><span class="lineno">  819</span> </div>
<div class="line"><a id="l00820" name="l00820"></a><span class="lineno">  820</span>   <span class="keywordflow">else</span></div>
<div class="line"><a id="l00821" name="l00821"></a><span class="lineno">  821</span>      nShadowZoneCoastToCapeSeaHand = <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#afdd3411d0fa60c62522af14ea2a90570">LEFT_HANDED</a>;</div>
<div class="line"><a id="l00822" name="l00822"></a><span class="lineno">  822</span> </div>
<div class="line"><a id="l00823" name="l00823"></a><span class="lineno">  823</span>   <span class="comment">// We will traverse the coastline from the start point of the shadow zone line, going toward the end point. Which direction is this?</span></div>
<div class="line"><a id="l00824" name="l00824"></a><span class="lineno">  824</span>   <span class="keywordtype">bool</span> bSweepDownCoast = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00825" name="l00825"></a><span class="lineno">  825</span> </div>
<div class="line"><a id="l00826" name="l00826"></a><span class="lineno">  826</span>   <span class="keywordflow">if</span> (nShadowBoundaryEndPoint &lt; nShadowBoundaryStartPoint)</div>
<div class="line"><a id="l00827" name="l00827"></a><span class="lineno">  827</span>      bSweepDownCoast = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00828" name="l00828"></a><span class="lineno">  828</span> </div>
<div class="line"><a id="l00829" name="l00829"></a><span class="lineno">  829</span>   <span class="comment">// Get the distance (in cells) from the shadow boundary start point to the shadow boundary end point, going along the coast</span></div>
<div class="line"><a id="l00830" name="l00830"></a><span class="lineno">  830</span>   <span class="keywordtype">int</span> <span class="keyword">const</span> nAlongCoastDistanceToShadowEndpoint = <a class="code hl_function" href="../../d6/d2a/cme_8h.html#ae3b6dc50cfc97050529faa5e0bd66136">tAbs</a>(nShadowBoundaryEndPoint - nShadowBoundaryStartPoint - 1);</div>
<div class="line"><a id="l00831" name="l00831"></a><span class="lineno">  831</span> </div>
<div class="line"><a id="l00832" name="l00832"></a><span class="lineno">  832</span>   <span class="comment">// Calculate the point on the coastline which is 2 * nAlongCoastDistanceToShadowEndpoint from the shadow boundary start point, this will be the end point of the downdrift zone. This point may be beyond the end of the coastline in either direction</span></div>
<div class="line"><a id="l00833" name="l00833"></a><span class="lineno">  833</span>   <span class="keywordtype">int</span> nDownDriftEndPoint;</div>
<div class="line"><a id="l00834" name="l00834"></a><span class="lineno">  834</span>   <span class="keywordtype">int</span> <span class="keyword">const</span> nTotAlongCoastDistanceToDownDriftEndpoint = 2 * nAlongCoastDistanceToShadowEndpoint;</div>
<div class="line"><a id="l00835" name="l00835"></a><span class="lineno">  835</span> </div>
<div class="line"><a id="l00836" name="l00836"></a><span class="lineno">  836</span>   <span class="keywordflow">if</span> (bSweepDownCoast)</div>
<div class="line"><a id="l00837" name="l00837"></a><span class="lineno">  837</span>      nDownDriftEndPoint = nShadowBoundaryStartPoint + nTotAlongCoastDistanceToDownDriftEndpoint;</div>
<div class="line"><a id="l00838" name="l00838"></a><span class="lineno">  838</span> </div>
<div class="line"><a id="l00839" name="l00839"></a><span class="lineno">  839</span>   <span class="keywordflow">else</span></div>
<div class="line"><a id="l00840" name="l00840"></a><span class="lineno">  840</span>      nDownDriftEndPoint = nShadowBoundaryStartPoint - nTotAlongCoastDistanceToDownDriftEndpoint;</div>
<div class="line"><a id="l00841" name="l00841"></a><span class="lineno">  841</span> </div>
<div class="line"><a id="l00842" name="l00842"></a><span class="lineno">  842</span>   <span class="comment">// Next find the actual (i.e. within-grid) end of the downdrift line</span></div>
<div class="line"><a id="l00843" name="l00843"></a><span class="lineno">  843</span>   <a class="code hl_class" href="../../d6/d0d/classCGeom2DIPoint.html">CGeom2DIPoint</a> PtiDownDriftEndPoint;</div>
<div class="line"><a id="l00844" name="l00844"></a><span class="lineno">  844</span> </div>
<div class="line"><a id="l00845" name="l00845"></a><span class="lineno">  845</span>   <span class="comment">// Is the downdrift end point beyond the start or end of the coastline?</span></div>
<div class="line"><a id="l00846" name="l00846"></a><span class="lineno">  846</span>   <span class="keywordflow">if</span> (nDownDriftEndPoint &lt; 0)</div>
<div class="line"><a id="l00847" name="l00847"></a><span class="lineno">  847</span>   {</div>
<div class="line"><a id="l00848" name="l00848"></a><span class="lineno">  848</span>      <span class="comment">// Is beyond the start of the coastline</span></div>
<div class="line"><a id="l00849" name="l00849"></a><span class="lineno">  849</span>      <span class="keywordtype">int</span> <span class="keyword">const</span> nStartEdge = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].nGetStartEdge();</div>
<div class="line"><a id="l00850" name="l00850"></a><span class="lineno">  850</span> </div>
<div class="line"><a id="l00851" name="l00851"></a><span class="lineno">  851</span>      <span class="keywordflow">if</span> (nStartEdge == <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#af8f1a513adfc4d40f536ff45f704e654">NORTH</a>)</div>
<div class="line"><a id="l00852" name="l00852"></a><span class="lineno">  852</span>      {</div>
<div class="line"><a id="l00853" name="l00853"></a><span class="lineno">  853</span>         PtiDownDriftEndPoint.<a class="code hl_function" href="../../d6/d0d/classCGeom2DIPoint.html#a84c27fdfdfca1e5222a141717ab8f6e4">SetX</a>(<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].pPtiGetCellMarkedAsCoastline(0)-&gt;nGetX());</div>
<div class="line"><a id="l00854" name="l00854"></a><span class="lineno">  854</span>         PtiDownDriftEndPoint.<a class="code hl_function" href="../../d6/d0d/classCGeom2DIPoint.html#a4350a3410e098a2cb27fbeaa6b12b5e5">SetY</a>(nDownDriftEndPoint);</div>
<div class="line"><a id="l00855" name="l00855"></a><span class="lineno">  855</span>      }</div>
<div class="line"><a id="l00856" name="l00856"></a><span class="lineno">  856</span> </div>
<div class="line"><a id="l00857" name="l00857"></a><span class="lineno">  857</span>      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (nStartEdge == <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#aa0ace1cae356bfb79245b65c0ae979d0">SOUTH</a>)</div>
<div class="line"><a id="l00858" name="l00858"></a><span class="lineno">  858</span>      {</div>
<div class="line"><a id="l00859" name="l00859"></a><span class="lineno">  859</span>         PtiDownDriftEndPoint.<a class="code hl_function" href="../../d6/d0d/classCGeom2DIPoint.html#a84c27fdfdfca1e5222a141717ab8f6e4">SetX</a>(<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].pPtiGetCellMarkedAsCoastline(0)-&gt;nGetX());</div>
<div class="line"><a id="l00860" name="l00860"></a><span class="lineno">  860</span>         PtiDownDriftEndPoint.<a class="code hl_function" href="../../d6/d0d/classCGeom2DIPoint.html#a4350a3410e098a2cb27fbeaa6b12b5e5">SetY</a>(<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a3755fdc07c0ac9f2ce6c2237cfef50ce">m_nYGridSize</a> - nDownDriftEndPoint - 1);</div>
<div class="line"><a id="l00861" name="l00861"></a><span class="lineno">  861</span>      }</div>
<div class="line"><a id="l00862" name="l00862"></a><span class="lineno">  862</span> </div>
<div class="line"><a id="l00863" name="l00863"></a><span class="lineno">  863</span>      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (nStartEdge == <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#afeb3cef570a9344c7074258f3601b582">WEST</a>)</div>
<div class="line"><a id="l00864" name="l00864"></a><span class="lineno">  864</span>      {</div>
<div class="line"><a id="l00865" name="l00865"></a><span class="lineno">  865</span>         PtiDownDriftEndPoint.<a class="code hl_function" href="../../d6/d0d/classCGeom2DIPoint.html#a84c27fdfdfca1e5222a141717ab8f6e4">SetX</a>(nDownDriftEndPoint);</div>
<div class="line"><a id="l00866" name="l00866"></a><span class="lineno">  866</span>         PtiDownDriftEndPoint.<a class="code hl_function" href="../../d6/d0d/classCGeom2DIPoint.html#a4350a3410e098a2cb27fbeaa6b12b5e5">SetY</a>(<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].pPtiGetCellMarkedAsCoastline(0)-&gt;nGetY());</div>
<div class="line"><a id="l00867" name="l00867"></a><span class="lineno">  867</span>      }</div>
<div class="line"><a id="l00868" name="l00868"></a><span class="lineno">  868</span> </div>
<div class="line"><a id="l00869" name="l00869"></a><span class="lineno">  869</span>      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (nStartEdge == <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#aa5fa4b2d0efc2ff0f4e02e27ea50208a">EAST</a>)</div>
<div class="line"><a id="l00870" name="l00870"></a><span class="lineno">  870</span>      {</div>
<div class="line"><a id="l00871" name="l00871"></a><span class="lineno">  871</span>         PtiDownDriftEndPoint.<a class="code hl_function" href="../../d6/d0d/classCGeom2DIPoint.html#a84c27fdfdfca1e5222a141717ab8f6e4">SetX</a>(<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1652253500dab35e6f6f9f734207e20b">m_nXGridSize</a> - nDownDriftEndPoint - 1);</div>
<div class="line"><a id="l00872" name="l00872"></a><span class="lineno">  872</span>         PtiDownDriftEndPoint.<a class="code hl_function" href="../../d6/d0d/classCGeom2DIPoint.html#a4350a3410e098a2cb27fbeaa6b12b5e5">SetY</a>(<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].pPtiGetCellMarkedAsCoastline(0)-&gt;nGetY());</div>
<div class="line"><a id="l00873" name="l00873"></a><span class="lineno">  873</span>      }</div>
<div class="line"><a id="l00874" name="l00874"></a><span class="lineno">  874</span>   }</div>
<div class="line"><a id="l00875" name="l00875"></a><span class="lineno">  875</span> </div>
<div class="line"><a id="l00876" name="l00876"></a><span class="lineno">  876</span>   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (nDownDriftEndPoint &gt;= <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].nGetCoastlineSize())</div>
<div class="line"><a id="l00877" name="l00877"></a><span class="lineno">  877</span>   {</div>
<div class="line"><a id="l00878" name="l00878"></a><span class="lineno">  878</span>      <span class="comment">// Is beyond the end of the coastline</span></div>
<div class="line"><a id="l00879" name="l00879"></a><span class="lineno">  879</span>      <span class="keywordtype">int</span> <span class="keyword">const</span> nEndEdge = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].nGetEndEdge();</div>
<div class="line"><a id="l00880" name="l00880"></a><span class="lineno">  880</span>      <span class="keywordtype">int</span> <span class="keyword">const</span> nCoastSize = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].nGetCoastlineSize();</div>
<div class="line"><a id="l00881" name="l00881"></a><span class="lineno">  881</span> </div>
<div class="line"><a id="l00882" name="l00882"></a><span class="lineno">  882</span>      <span class="keywordflow">if</span> (nEndEdge == <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#af8f1a513adfc4d40f536ff45f704e654">NORTH</a>)</div>
<div class="line"><a id="l00883" name="l00883"></a><span class="lineno">  883</span>      {</div>
<div class="line"><a id="l00884" name="l00884"></a><span class="lineno">  884</span>         PtiDownDriftEndPoint.<a class="code hl_function" href="../../d6/d0d/classCGeom2DIPoint.html#a84c27fdfdfca1e5222a141717ab8f6e4">SetX</a>(<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].pPtiGetCellMarkedAsCoastline(nCoastSize - 1)-&gt;nGetX());</div>
<div class="line"><a id="l00885" name="l00885"></a><span class="lineno">  885</span>         PtiDownDriftEndPoint.<a class="code hl_function" href="../../d6/d0d/classCGeom2DIPoint.html#a4350a3410e098a2cb27fbeaa6b12b5e5">SetY</a>(-nDownDriftEndPoint);</div>
<div class="line"><a id="l00886" name="l00886"></a><span class="lineno">  886</span>      }</div>
<div class="line"><a id="l00887" name="l00887"></a><span class="lineno">  887</span> </div>
<div class="line"><a id="l00888" name="l00888"></a><span class="lineno">  888</span>      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (nEndEdge == <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#aa0ace1cae356bfb79245b65c0ae979d0">SOUTH</a>)</div>
<div class="line"><a id="l00889" name="l00889"></a><span class="lineno">  889</span>      {</div>
<div class="line"><a id="l00890" name="l00890"></a><span class="lineno">  890</span>         PtiDownDriftEndPoint.<a class="code hl_function" href="../../d6/d0d/classCGeom2DIPoint.html#a84c27fdfdfca1e5222a141717ab8f6e4">SetX</a>(<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].pPtiGetCellMarkedAsCoastline(nCoastSize - 1)-&gt;nGetX());</div>
<div class="line"><a id="l00891" name="l00891"></a><span class="lineno">  891</span>         PtiDownDriftEndPoint.<a class="code hl_function" href="../../d6/d0d/classCGeom2DIPoint.html#a4350a3410e098a2cb27fbeaa6b12b5e5">SetY</a>(<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a3755fdc07c0ac9f2ce6c2237cfef50ce">m_nYGridSize</a> + nDownDriftEndPoint);</div>
<div class="line"><a id="l00892" name="l00892"></a><span class="lineno">  892</span>      }</div>
<div class="line"><a id="l00893" name="l00893"></a><span class="lineno">  893</span> </div>
<div class="line"><a id="l00894" name="l00894"></a><span class="lineno">  894</span>      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (nEndEdge == <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#afeb3cef570a9344c7074258f3601b582">WEST</a>)</div>
<div class="line"><a id="l00895" name="l00895"></a><span class="lineno">  895</span>      {</div>
<div class="line"><a id="l00896" name="l00896"></a><span class="lineno">  896</span>         PtiDownDriftEndPoint.<a class="code hl_function" href="../../d6/d0d/classCGeom2DIPoint.html#a84c27fdfdfca1e5222a141717ab8f6e4">SetX</a>(-nDownDriftEndPoint);</div>
<div class="line"><a id="l00897" name="l00897"></a><span class="lineno">  897</span>         PtiDownDriftEndPoint.<a class="code hl_function" href="../../d6/d0d/classCGeom2DIPoint.html#a4350a3410e098a2cb27fbeaa6b12b5e5">SetY</a>(<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].pPtiGetCellMarkedAsCoastline(nCoastSize - 1)-&gt;nGetY());</div>
<div class="line"><a id="l00898" name="l00898"></a><span class="lineno">  898</span>      }</div>
<div class="line"><a id="l00899" name="l00899"></a><span class="lineno">  899</span> </div>
<div class="line"><a id="l00900" name="l00900"></a><span class="lineno">  900</span>      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (nEndEdge == <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#aa5fa4b2d0efc2ff0f4e02e27ea50208a">EAST</a>)</div>
<div class="line"><a id="l00901" name="l00901"></a><span class="lineno">  901</span>      {</div>
<div class="line"><a id="l00902" name="l00902"></a><span class="lineno">  902</span>         PtiDownDriftEndPoint.<a class="code hl_function" href="../../d6/d0d/classCGeom2DIPoint.html#a84c27fdfdfca1e5222a141717ab8f6e4">SetX</a>(<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1652253500dab35e6f6f9f734207e20b">m_nXGridSize</a> + nDownDriftEndPoint);</div>
<div class="line"><a id="l00903" name="l00903"></a><span class="lineno">  903</span>         PtiDownDriftEndPoint.<a class="code hl_function" href="../../d6/d0d/classCGeom2DIPoint.html#a4350a3410e098a2cb27fbeaa6b12b5e5">SetY</a>(<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].pPtiGetCellMarkedAsCoastline(nCoastSize - 1)-&gt;nGetY());</div>
<div class="line"><a id="l00904" name="l00904"></a><span class="lineno">  904</span>      }</div>
<div class="line"><a id="l00905" name="l00905"></a><span class="lineno">  905</span>   }</div>
<div class="line"><a id="l00906" name="l00906"></a><span class="lineno">  906</span> </div>
<div class="line"><a id="l00907" name="l00907"></a><span class="lineno">  907</span>   <span class="keywordflow">else</span></div>
<div class="line"><a id="l00908" name="l00908"></a><span class="lineno">  908</span>   {</div>
<div class="line"><a id="l00909" name="l00909"></a><span class="lineno">  909</span>      <span class="comment">// Is on the coastline, so get the location (grid CRS)</span></div>
<div class="line"><a id="l00910" name="l00910"></a><span class="lineno">  910</span>      PtiDownDriftEndPoint = *<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].pPtiGetCellMarkedAsCoastline(nDownDriftEndPoint);</div>
<div class="line"><a id="l00911" name="l00911"></a><span class="lineno">  911</span>   }</div>
<div class="line"><a id="l00912" name="l00912"></a><span class="lineno">  912</span> </div>
<div class="line"><a id="l00913" name="l00913"></a><span class="lineno">  913</span>   <span class="comment">// Get the location (grid CRS) of the shadow boundary start point: this is also the start point of the downdrift boundary</span></div>
<div class="line"><a id="l00914" name="l00914"></a><span class="lineno">  914</span>   <a class="code hl_class" href="../../d6/d0d/classCGeom2DIPoint.html">CGeom2DIPoint</a> <span class="keyword">const</span>* pPtiDownDriftBoundaryStartPoint = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].pPtiGetCellMarkedAsCoastline(nShadowBoundaryStartPoint);</div>
<div class="line"><a id="l00915" name="l00915"></a><span class="lineno">  915</span> </div>
<div class="line"><a id="l00916" name="l00916"></a><span class="lineno">  916</span>   <span class="comment">// Now trace the down-drift boundary line: interpolate between cells by a simple DDA line algorithm, see http://en.wikipedia.org/wiki/Digital_differential_analyzer_(graphics_algorithm) Note that Bresenham&#39;s algorithm gave occasional gaps</span></div>
<div class="line"><a id="l00917" name="l00917"></a><span class="lineno">  917</span>   <span class="keywordtype">int</span> <span class="keyword">const</span> nXStart = pPtiDownDriftBoundaryStartPoint-&gt;<a class="code hl_function" href="../../d6/d0d/classCGeom2DIPoint.html#af84c687b2d0be01ab41cbcc0565f4f3f">nGetX</a>();</div>
<div class="line"><a id="l00918" name="l00918"></a><span class="lineno">  918</span>   <span class="keywordtype">int</span> <span class="keyword">const</span> nYStart = pPtiDownDriftBoundaryStartPoint-&gt;<a class="code hl_function" href="../../d6/d0d/classCGeom2DIPoint.html#a4d9c20bcca90dcb9d519b664aba09cbd">nGetY</a>();</div>
<div class="line"><a id="l00919" name="l00919"></a><span class="lineno">  919</span>   <span class="keywordtype">int</span> <span class="keyword">const</span> nXEnd = PtiDownDriftEndPoint.<a class="code hl_function" href="../../d6/d0d/classCGeom2DIPoint.html#af84c687b2d0be01ab41cbcc0565f4f3f">nGetX</a>();</div>
<div class="line"><a id="l00920" name="l00920"></a><span class="lineno">  920</span>   <span class="keywordtype">int</span> <span class="keyword">const</span> nYEnd = PtiDownDriftEndPoint.<a class="code hl_function" href="../../d6/d0d/classCGeom2DIPoint.html#a4d9c20bcca90dcb9d519b664aba09cbd">nGetY</a>();</div>
<div class="line"><a id="l00921" name="l00921"></a><span class="lineno">  921</span> </div>
<div class="line"><a id="l00922" name="l00922"></a><span class="lineno">  922</span>   <span class="comment">// Safety check</span></div>
<div class="line"><a id="l00923" name="l00923"></a><span class="lineno">  923</span>   <span class="keywordflow">if</span> ((nXStart == nXEnd) &amp;&amp; (nYStart == nYEnd))</div>
<div class="line"><a id="l00924" name="l00924"></a><span class="lineno">  924</span>      <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00925" name="l00925"></a><span class="lineno">  925</span> </div>
<div class="line"><a id="l00926" name="l00926"></a><span class="lineno">  926</span>   <span class="keywordtype">double</span> <span class="keyword">const</span> dXStart = <a class="code hl_function" href="../../d1/d98/classCSimulation.html#ad79b925ac5f358c6f867b6e47dad74bd">dGridCentroidXToExtCRSX</a>(nXStart);</div>
<div class="line"><a id="l00927" name="l00927"></a><span class="lineno">  927</span>   <span class="keywordtype">double</span> <span class="keyword">const</span> dYStart = <a class="code hl_function" href="../../d1/d98/classCSimulation.html#a7e2a4bd69ce79377fee86aa5598903f8">dGridCentroidYToExtCRSY</a>(nYStart);</div>
<div class="line"><a id="l00928" name="l00928"></a><span class="lineno">  928</span>   <span class="keywordtype">double</span> <span class="keyword">const</span> dXEnd = <a class="code hl_function" href="../../d1/d98/classCSimulation.html#ad79b925ac5f358c6f867b6e47dad74bd">dGridCentroidXToExtCRSX</a>(nXEnd);</div>
<div class="line"><a id="l00929" name="l00929"></a><span class="lineno">  929</span>   <span class="keywordtype">double</span> <span class="keyword">const</span> dYEnd = <a class="code hl_function" href="../../d1/d98/classCSimulation.html#a7e2a4bd69ce79377fee86aa5598903f8">dGridCentroidYToExtCRSY</a>(nYEnd);</div>
<div class="line"><a id="l00930" name="l00930"></a><span class="lineno">  930</span>   <span class="keywordtype">double</span> dXInc = dXEnd - dXStart;</div>
<div class="line"><a id="l00931" name="l00931"></a><span class="lineno">  931</span>   <span class="keywordtype">double</span> dYInc = dYEnd - dYStart;</div>
<div class="line"><a id="l00932" name="l00932"></a><span class="lineno">  932</span>   <span class="keywordtype">double</span> <span class="keyword">const</span> dLength = <a class="code hl_function" href="../../d6/d2a/cme_8h.html#a7e895b460cef877dec4d12ead0c74f15">tMax</a>(<a class="code hl_function" href="../../d6/d2a/cme_8h.html#ae3b6dc50cfc97050529faa5e0bd66136">tAbs</a>(dXInc), <a class="code hl_function" href="../../d6/d2a/cme_8h.html#ae3b6dc50cfc97050529faa5e0bd66136">tAbs</a>(dYInc));</div>
<div class="line"><a id="l00933" name="l00933"></a><span class="lineno">  933</span> </div>
<div class="line"><a id="l00934" name="l00934"></a><span class="lineno">  934</span>   dXInc /= dLength;</div>
<div class="line"><a id="l00935" name="l00935"></a><span class="lineno">  935</span>   dYInc /= dLength;</div>
<div class="line"><a id="l00936" name="l00936"></a><span class="lineno">  936</span> </div>
<div class="line"><a id="l00937" name="l00937"></a><span class="lineno">  937</span>   <span class="keywordtype">int</span> nTotDownDriftBoundaryDistance = 0;</div>
<div class="line"><a id="l00938" name="l00938"></a><span class="lineno">  938</span>   <span class="keywordtype">double</span> dX = nXStart;</div>
<div class="line"><a id="l00939" name="l00939"></a><span class="lineno">  939</span>   <span class="keywordtype">double</span> dY = nYStart;</div>
<div class="line"><a id="l00940" name="l00940"></a><span class="lineno">  940</span> </div>
<div class="line"><a id="l00941" name="l00941"></a><span class="lineno">  941</span>   <a class="code hl_class" href="../../d7/dd3/classCGeomLine.html">CGeomLine</a> LDownDriftBoundary;</div>
<div class="line"><a id="l00942" name="l00942"></a><span class="lineno">  942</span> </div>
<div class="line"><a id="l00943" name="l00943"></a><span class="lineno">  943</span>   <span class="comment">// Process each interpolated point</span></div>
<div class="line"><a id="l00944" name="l00944"></a><span class="lineno">  944</span>   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> m = 0; m &lt;= <a class="code hl_function" href="../../d2/dfd/utils__global_8cpp.html#a20842d0a19d0ca952c91f3e1eb175fee">nRound</a>(dLength); m++)</div>
<div class="line"><a id="l00945" name="l00945"></a><span class="lineno">  945</span>   {</div>
<div class="line"><a id="l00946" name="l00946"></a><span class="lineno">  946</span>      <span class="keywordtype">int</span> <span class="keyword">const</span> nX = <a class="code hl_function" href="../../d2/dfd/utils__global_8cpp.html#a20842d0a19d0ca952c91f3e1eb175fee">nRound</a>(dX);</div>
<div class="line"><a id="l00947" name="l00947"></a><span class="lineno">  947</span>      <span class="keywordtype">int</span> <span class="keyword">const</span> nY = <a class="code hl_function" href="../../d2/dfd/utils__global_8cpp.html#a20842d0a19d0ca952c91f3e1eb175fee">nRound</a>(dY);</div>
<div class="line"><a id="l00948" name="l00948"></a><span class="lineno">  948</span> </div>
<div class="line"><a id="l00949" name="l00949"></a><span class="lineno">  949</span>      <span class="keywordflow">if</span> (! <a class="code hl_function" href="../../d1/d98/classCSimulation.html#ac900a5701df97da22278fae928951f50">bIsWithinValidGrid</a>(nX, nY))</div>
<div class="line"><a id="l00950" name="l00950"></a><span class="lineno">  950</span>      {</div>
<div class="line"><a id="l00951" name="l00951"></a><span class="lineno">  951</span>         <span class="comment">// Safety check</span></div>
<div class="line"><a id="l00952" name="l00952"></a><span class="lineno">  952</span>         <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00953" name="l00953"></a><span class="lineno">  953</span>      }</div>
<div class="line"><a id="l00954" name="l00954"></a><span class="lineno">  954</span> </div>
<div class="line"><a id="l00955" name="l00955"></a><span class="lineno">  955</span>      <span class="comment">// OK, this is part of the downdrift boundary so store this coordinate and mark the cell</span></div>
<div class="line"><a id="l00956" name="l00956"></a><span class="lineno">  956</span>      <a class="code hl_class" href="../../d5/d4e/classCGeom2DPoint.html">CGeom2DPoint</a> <span class="keyword">const</span> PtThis(<a class="code hl_function" href="../../d1/d98/classCSimulation.html#ad79b925ac5f358c6f867b6e47dad74bd">dGridCentroidXToExtCRSX</a>(nX), <a class="code hl_function" href="../../d1/d98/classCSimulation.html#a7e2a4bd69ce79377fee86aa5598903f8">dGridCentroidYToExtCRSY</a>(nY));</div>
<div class="line"><a id="l00957" name="l00957"></a><span class="lineno">  957</span> </div>
<div class="line"><a id="l00958" name="l00958"></a><span class="lineno">  958</span>      <span class="comment">// Make sure we have not already stored this coordinate (can happen, due to rounding)</span></div>
<div class="line"><a id="l00959" name="l00959"></a><span class="lineno">  959</span>      <span class="keywordflow">if</span> ((LDownDriftBoundary.<a class="code hl_function" href="../../d9/d0e/classCA2DShape.html#ac220b8554a95ebe15b345ef2bd04177b">nGetSize</a>() == 0) || (PtThis != LDownDriftBoundary.<a class="code hl_function" href="../../d9/d0e/classCA2DShape.html#a7f8d2942affd69f8de65e36f9c6acd3c">pPtBack</a>()))</div>
<div class="line"><a id="l00960" name="l00960"></a><span class="lineno">  960</span>      {</div>
<div class="line"><a id="l00961" name="l00961"></a><span class="lineno">  961</span>         <span class="comment">// Store this coordinate</span></div>
<div class="line"><a id="l00962" name="l00962"></a><span class="lineno">  962</span>         LDownDriftBoundary.<a class="code hl_function" href="../../d9/d0e/classCA2DShape.html#a089f43fb767f120e2bffbfc40b8dc0ac">Append</a>(&amp;PtThis);</div>
<div class="line"><a id="l00963" name="l00963"></a><span class="lineno">  963</span> </div>
<div class="line"><a id="l00964" name="l00964"></a><span class="lineno">  964</span>         <span class="comment">// Mark the cell (a +ve number, same as the associated shadow zone number i.e. starting from 1)</span></div>
<div class="line"><a id="l00965" name="l00965"></a><span class="lineno">  965</span>         <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nX][nY].SetDownDriftZoneNumber(nZone + 1);</div>
<div class="line"><a id="l00966" name="l00966"></a><span class="lineno">  966</span> </div>
<div class="line"><a id="l00967" name="l00967"></a><span class="lineno">  967</span>         <span class="comment">// Increment the boundary length</span></div>
<div class="line"><a id="l00968" name="l00968"></a><span class="lineno">  968</span>         nTotDownDriftBoundaryDistance++;</div>
<div class="line"><a id="l00969" name="l00969"></a><span class="lineno">  969</span> </div>
<div class="line"><a id="l00970" name="l00970"></a><span class="lineno">  970</span>         <span class="comment">// LogStream &lt;&lt; &quot;DownDrift boundary [&quot; &lt;&lt; nX &lt;&lt; &quot;][&quot; &lt;&lt; nY &lt;&lt; &quot;] = {&quot; &lt;&lt; dGridCentroidXToExtCRSX(nX) &lt;&lt; &quot;, &quot; &lt;&lt; dGridCentroidYToExtCRSY(nY) &lt;&lt; &quot;}&quot; &lt;&lt; endl;</span></div>
<div class="line"><a id="l00971" name="l00971"></a><span class="lineno">  971</span> </div>
<div class="line"><a id="l00972" name="l00972"></a><span class="lineno">  972</span>         <span class="comment">// And increment for next time</span></div>
<div class="line"><a id="l00973" name="l00973"></a><span class="lineno">  973</span>         <span class="keywordflow">if</span> (dXEnd &gt; dXStart)</div>
<div class="line"><a id="l00974" name="l00974"></a><span class="lineno">  974</span>            dX -= dXInc;</div>
<div class="line"><a id="l00975" name="l00975"></a><span class="lineno">  975</span> </div>
<div class="line"><a id="l00976" name="l00976"></a><span class="lineno">  976</span>         <span class="keywordflow">else</span></div>
<div class="line"><a id="l00977" name="l00977"></a><span class="lineno">  977</span>            dX += dXInc;</div>
<div class="line"><a id="l00978" name="l00978"></a><span class="lineno">  978</span> </div>
<div class="line"><a id="l00979" name="l00979"></a><span class="lineno">  979</span>         <span class="keywordflow">if</span> (dYEnd &gt; dYStart)</div>
<div class="line"><a id="l00980" name="l00980"></a><span class="lineno">  980</span>            dY += dYInc;</div>
<div class="line"><a id="l00981" name="l00981"></a><span class="lineno">  981</span> </div>
<div class="line"><a id="l00982" name="l00982"></a><span class="lineno">  982</span>         <span class="keywordflow">else</span></div>
<div class="line"><a id="l00983" name="l00983"></a><span class="lineno">  983</span>            dY -= dYInc;</div>
<div class="line"><a id="l00984" name="l00984"></a><span class="lineno">  984</span>      }</div>
<div class="line"><a id="l00985" name="l00985"></a><span class="lineno">  985</span>   }</div>
<div class="line"><a id="l00986" name="l00986"></a><span class="lineno">  986</span> </div>
<div class="line"><a id="l00987" name="l00987"></a><span class="lineno">  987</span>   <span class="comment">// Store the downdrift boundary (external CRS), with the start point first</span></div>
<div class="line"><a id="l00988" name="l00988"></a><span class="lineno">  988</span>   <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].AppendShadowDowndriftBoundary(&amp;LDownDriftBoundary);</div>
<div class="line"><a id="l00989" name="l00989"></a><span class="lineno">  989</span> </div>
<div class="line"><a id="l00990" name="l00990"></a><span class="lineno">  990</span>   <span class="comment">// Compare the lengths of the along-coast and the along-downdrift boundaries. The increment will be 1 for the smaller of the two, will be &gt; 1 for the larger of the two</span></div>
<div class="line"><a id="l00991" name="l00991"></a><span class="lineno">  991</span>   <span class="keywordtype">int</span> nMaxDistance;</div>
<div class="line"><a id="l00992" name="l00992"></a><span class="lineno">  992</span>   <span class="keywordtype">double</span> dAlongCoastIncrement = 1;</div>
<div class="line"><a id="l00993" name="l00993"></a><span class="lineno">  993</span>   <span class="keywordtype">double</span> dDownDriftBoundaryIncrement = 1;</div>
<div class="line"><a id="l00994" name="l00994"></a><span class="lineno">  994</span> </div>
<div class="line"><a id="l00995" name="l00995"></a><span class="lineno">  995</span>   <span class="keywordflow">if</span> (nTotAlongCoastDistanceToDownDriftEndpoint &lt; nTotDownDriftBoundaryDistance)</div>
<div class="line"><a id="l00996" name="l00996"></a><span class="lineno">  996</span>   {</div>
<div class="line"><a id="l00997" name="l00997"></a><span class="lineno">  997</span>      <span class="comment">// The downdrift boundary distance is the larger, so change it</span></div>
<div class="line"><a id="l00998" name="l00998"></a><span class="lineno">  998</span>      dDownDriftBoundaryIncrement = <span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>(nTotDownDriftBoundaryDistance) / nTotAlongCoastDistanceToDownDriftEndpoint;</div>
<div class="line"><a id="l00999" name="l00999"></a><span class="lineno">  999</span>      nMaxDistance = nTotDownDriftBoundaryDistance;</div>
<div class="line"><a id="l01000" name="l01000"></a><span class="lineno"> 1000</span>   }</div>
<div class="line"><a id="l01001" name="l01001"></a><span class="lineno"> 1001</span> </div>
<div class="line"><a id="l01002" name="l01002"></a><span class="lineno"> 1002</span>   <span class="keywordflow">else</span></div>
<div class="line"><a id="l01003" name="l01003"></a><span class="lineno"> 1003</span>   {</div>
<div class="line"><a id="l01004" name="l01004"></a><span class="lineno"> 1004</span>      <span class="comment">// The along-coast distance is the larger, so change it</span></div>
<div class="line"><a id="l01005" name="l01005"></a><span class="lineno"> 1005</span>      dAlongCoastIncrement = <span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>(nTotAlongCoastDistanceToDownDriftEndpoint) / nTotDownDriftBoundaryDistance;</div>
<div class="line"><a id="l01006" name="l01006"></a><span class="lineno"> 1006</span>      nMaxDistance = nTotAlongCoastDistanceToDownDriftEndpoint;</div>
<div class="line"><a id="l01007" name="l01007"></a><span class="lineno"> 1007</span>   }</div>
<div class="line"><a id="l01008" name="l01008"></a><span class="lineno"> 1008</span> </div>
<div class="line"><a id="l01009" name="l01009"></a><span class="lineno"> 1009</span>   <span class="keywordtype">double</span> dCoastDistSoFar = 0;</div>
<div class="line"><a id="l01010" name="l01010"></a><span class="lineno"> 1010</span>   <span class="keywordtype">double</span> dDownDriftBoundaryDistSoFar = 0;</div>
<div class="line"><a id="l01011" name="l01011"></a><span class="lineno"> 1011</span> </div>
<div class="line"><a id="l01012" name="l01012"></a><span class="lineno"> 1012</span>   <span class="comment">// Now traverse the along-coast line and the down-drift boundary line, but with different increments for each</span></div>
<div class="line"><a id="l01013" name="l01013"></a><span class="lineno"> 1013</span>   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> n = 1; n &lt; nMaxDistance - 1; n++)</div>
<div class="line"><a id="l01014" name="l01014"></a><span class="lineno"> 1014</span>   {</div>
<div class="line"><a id="l01015" name="l01015"></a><span class="lineno"> 1015</span>      dCoastDistSoFar += dAlongCoastIncrement;</div>
<div class="line"><a id="l01016" name="l01016"></a><span class="lineno"> 1016</span>      dDownDriftBoundaryDistSoFar += dDownDriftBoundaryIncrement;</div>
<div class="line"><a id="l01017" name="l01017"></a><span class="lineno"> 1017</span> </div>
<div class="line"><a id="l01018" name="l01018"></a><span class="lineno"> 1018</span>      <span class="comment">// LogStream &lt;&lt; &quot;dDownDriftBoundaryDistSoFar = &quot; &lt;&lt; dDownDriftBoundaryDistSoFar &lt;&lt; &quot; nTotDownDriftBoundaryDistance = &quot; &lt;&lt; nTotDownDriftBoundaryDistance &lt;&lt; endl;</span></div>
<div class="line"><a id="l01019" name="l01019"></a><span class="lineno"> 1019</span> </div>
<div class="line"><a id="l01020" name="l01020"></a><span class="lineno"> 1020</span>      <span class="keywordflow">if</span> ((dCoastDistSoFar &gt;= nTotAlongCoastDistanceToDownDriftEndpoint) || (dDownDriftBoundaryDistSoFar &gt;= nTotDownDriftBoundaryDistance))</div>
<div class="line"><a id="l01021" name="l01021"></a><span class="lineno"> 1021</span>         <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01022" name="l01022"></a><span class="lineno"> 1022</span> </div>
<div class="line"><a id="l01023" name="l01023"></a><span class="lineno"> 1023</span>      <span class="keywordtype">bool</span> bPastShadowEnd = <span class="keyword">false</span>;</div>
<div class="line"><a id="l01024" name="l01024"></a><span class="lineno"> 1024</span>      <span class="keywordtype">int</span> nAlongCoast;</div>
<div class="line"><a id="l01025" name="l01025"></a><span class="lineno"> 1025</span> </div>
<div class="line"><a id="l01026" name="l01026"></a><span class="lineno"> 1026</span>      <span class="keywordflow">if</span> (bSweepDownCoast)</div>
<div class="line"><a id="l01027" name="l01027"></a><span class="lineno"> 1027</span>      {</div>
<div class="line"><a id="l01028" name="l01028"></a><span class="lineno"> 1028</span>         nAlongCoast = nShadowBoundaryStartPoint + <a class="code hl_function" href="../../d2/dfd/utils__global_8cpp.html#a20842d0a19d0ca952c91f3e1eb175fee">nRound</a>(dCoastDistSoFar);</div>
<div class="line"><a id="l01029" name="l01029"></a><span class="lineno"> 1029</span> </div>
<div class="line"><a id="l01030" name="l01030"></a><span class="lineno"> 1030</span>         <span class="keywordflow">if</span> (nAlongCoast &gt;= <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].nGetCoastlineSize())</div>
<div class="line"><a id="l01031" name="l01031"></a><span class="lineno"> 1031</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01032" name="l01032"></a><span class="lineno"> 1032</span> </div>
<div class="line"><a id="l01033" name="l01033"></a><span class="lineno"> 1033</span>         <span class="keywordflow">if</span> (nAlongCoast &gt;= nShadowBoundaryEndPoint)</div>
<div class="line"><a id="l01034" name="l01034"></a><span class="lineno"> 1034</span>            bPastShadowEnd = <span class="keyword">true</span>;</div>
<div class="line"><a id="l01035" name="l01035"></a><span class="lineno"> 1035</span>      }</div>
<div class="line"><a id="l01036" name="l01036"></a><span class="lineno"> 1036</span> </div>
<div class="line"><a id="l01037" name="l01037"></a><span class="lineno"> 1037</span>      <span class="keywordflow">else</span></div>
<div class="line"><a id="l01038" name="l01038"></a><span class="lineno"> 1038</span>      {</div>
<div class="line"><a id="l01039" name="l01039"></a><span class="lineno"> 1039</span>         nAlongCoast = nShadowBoundaryStartPoint - <a class="code hl_function" href="../../d2/dfd/utils__global_8cpp.html#a20842d0a19d0ca952c91f3e1eb175fee">nRound</a>(dCoastDistSoFar);</div>
<div class="line"><a id="l01040" name="l01040"></a><span class="lineno"> 1040</span> </div>
<div class="line"><a id="l01041" name="l01041"></a><span class="lineno"> 1041</span>         <span class="keywordflow">if</span> (nAlongCoast &lt; 0)</div>
<div class="line"><a id="l01042" name="l01042"></a><span class="lineno"> 1042</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01043" name="l01043"></a><span class="lineno"> 1043</span> </div>
<div class="line"><a id="l01044" name="l01044"></a><span class="lineno"> 1044</span>         <span class="keywordflow">if</span> (nAlongCoast &lt;= nShadowBoundaryEndPoint)</div>
<div class="line"><a id="l01045" name="l01045"></a><span class="lineno"> 1045</span>            bPastShadowEnd = <span class="keyword">true</span>;</div>
<div class="line"><a id="l01046" name="l01046"></a><span class="lineno"> 1046</span>      }</div>
<div class="line"><a id="l01047" name="l01047"></a><span class="lineno"> 1047</span> </div>
<div class="line"><a id="l01048" name="l01048"></a><span class="lineno"> 1048</span>      <span class="keywordtype">int</span> <span class="keyword">const</span> nAlongDownDriftBoundary = <a class="code hl_function" href="../../d2/dfd/utils__global_8cpp.html#a20842d0a19d0ca952c91f3e1eb175fee">nRound</a>(dDownDriftBoundaryDistSoFar);</div>
<div class="line"><a id="l01049" name="l01049"></a><span class="lineno"> 1049</span> </div>
<div class="line"><a id="l01050" name="l01050"></a><span class="lineno"> 1050</span>      <span class="comment">// LogStream &lt;&lt; endl &lt;&lt; m_ulIter &lt;&lt; &quot;: dCoastDistSoFar = &quot; &lt;&lt; dCoastDistSoFar &lt;&lt; &quot; (nTotAlongCoastDistanceToDownDriftEndpoint = &quot; &lt;&lt; nTotAlongCoastDistanceToDownDriftEndpoint &lt;&lt; &quot;) dDownDriftBoundaryDistSoFar = &quot; &lt;&lt; dDownDriftBoundaryDistSoFar &lt;&lt; &quot; (nTotDownDriftBoundaryDistance = &quot; &lt;&lt; nTotDownDriftBoundaryDistance &lt;&lt; &quot;)&quot; &lt;&lt; endl;</span></div>
<div class="line"><a id="l01051" name="l01051"></a><span class="lineno"> 1051</span> </div>
<div class="line"><a id="l01052" name="l01052"></a><span class="lineno"> 1052</span>      <span class="comment">// nAlongCoast = &quot; &lt;&lt; nAlongCoast &lt;&lt; &quot;, nShadowBoundaryEndPoint = &quot; &lt;&lt; nShadowBoundaryEndPoint &lt;&lt; &quot;,  &lt;&lt; &quot;, nAlongDownDriftBoundary = &quot; &lt;&lt; nAlongDownDriftBoundary &lt;&lt; &quot;, &lt;&lt; endl;</span></div>
<div class="line"><a id="l01053" name="l01053"></a><span class="lineno"> 1053</span> </div>
<div class="line"><a id="l01054" name="l01054"></a><span class="lineno"> 1054</span>      <span class="comment">// Get the two endpoints of the linking line</span></div>
<div class="line"><a id="l01055" name="l01055"></a><span class="lineno"> 1055</span>      <a class="code hl_class" href="../../d6/d0d/classCGeom2DIPoint.html">CGeom2DIPoint</a> <span class="keyword">const</span>* pPtiCoast = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">m_VCoast</a>[nCoast].pPtiGetCellMarkedAsCoastline(nAlongCoast);</div>
<div class="line"><a id="l01056" name="l01056"></a><span class="lineno"> 1056</span>      <span class="keywordtype">int</span> <span class="keyword">const</span> nCoastX = pPtiCoast-&gt;<a class="code hl_function" href="../../d6/d0d/classCGeom2DIPoint.html#af84c687b2d0be01ab41cbcc0565f4f3f">nGetX</a>();</div>
<div class="line"><a id="l01057" name="l01057"></a><span class="lineno"> 1057</span>      <span class="keywordtype">int</span> <span class="keyword">const</span> nCoastY = pPtiCoast-&gt;<a class="code hl_function" href="../../d6/d0d/classCGeom2DIPoint.html#a4d9c20bcca90dcb9d519b664aba09cbd">nGetY</a>();</div>
<div class="line"><a id="l01058" name="l01058"></a><span class="lineno"> 1058</span> </div>
<div class="line"><a id="l01059" name="l01059"></a><span class="lineno"> 1059</span>      <span class="keywordtype">int</span> <span class="keyword">const</span> nDownDriftX = <a class="code hl_function" href="../../d2/dfd/utils__global_8cpp.html#a20842d0a19d0ca952c91f3e1eb175fee">nRound</a>(<a class="code hl_function" href="../../d1/d98/classCSimulation.html#a9fbe52d4e0f26ad432f12b7154c599e4">dExtCRSXToGridX</a>(LDownDriftBoundary[nAlongDownDriftBoundary].dGetX()));</div>
<div class="line"><a id="l01060" name="l01060"></a><span class="lineno"> 1060</span> </div>
<div class="line"><a id="l01061" name="l01061"></a><span class="lineno"> 1061</span>      <span class="comment">// Safety check</span></div>
<div class="line"><a id="l01062" name="l01062"></a><span class="lineno"> 1062</span>      <span class="keywordflow">if</span> (nCoastX &gt;= <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1652253500dab35e6f6f9f734207e20b">m_nXGridSize</a>)</div>
<div class="line"><a id="l01063" name="l01063"></a><span class="lineno"> 1063</span>         <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l01064" name="l01064"></a><span class="lineno"> 1064</span> </div>
<div class="line"><a id="l01065" name="l01065"></a><span class="lineno"> 1065</span>      <span class="keywordtype">int</span> <span class="keyword">const</span> nDownDriftY = <a class="code hl_function" href="../../d2/dfd/utils__global_8cpp.html#a20842d0a19d0ca952c91f3e1eb175fee">nRound</a>(<a class="code hl_function" href="../../d1/d98/classCSimulation.html#ac2e7e204d9e9b527d0a4c941f2e525ad">dExtCRSYToGridY</a>(LDownDriftBoundary[nAlongDownDriftBoundary].dGetY()));</div>
<div class="line"><a id="l01066" name="l01066"></a><span class="lineno"> 1066</span> </div>
<div class="line"><a id="l01067" name="l01067"></a><span class="lineno"> 1067</span>      <span class="comment">// Safety check</span></div>
<div class="line"><a id="l01068" name="l01068"></a><span class="lineno"> 1068</span>      <span class="keywordflow">if</span> (nCoastY &gt;= <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a3755fdc07c0ac9f2ce6c2237cfef50ce">m_nYGridSize</a>)</div>
<div class="line"><a id="l01069" name="l01069"></a><span class="lineno"> 1069</span>         <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l01070" name="l01070"></a><span class="lineno"> 1070</span> </div>
<div class="line"><a id="l01071" name="l01071"></a><span class="lineno"> 1071</span>      <span class="comment">// Safety check, in case the two points are identical (can happen due to rounding)</span></div>
<div class="line"><a id="l01072" name="l01072"></a><span class="lineno"> 1072</span>      <span class="keywordflow">if</span> ((nCoastX == nDownDriftX) &amp;&amp; (nCoastY == nDownDriftY))</div>
<div class="line"><a id="l01073" name="l01073"></a><span class="lineno"> 1073</span>      {</div>
<div class="line"><a id="l01074" name="l01074"></a><span class="lineno"> 1074</span>         <span class="keywordflow">if</span> (<a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a0245d3cbdd603fbeced6ca1465eb3f16">m_nLogFileDetail</a> &gt;= <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a85da1142fa4655ec66f1e391444a6d9a">LOG_FILE_HIGH_DETAIL</a>)</div>
<div class="line"><a id="l01075" name="l01075"></a><span class="lineno"> 1075</span>            <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a222962121613613a48f518e0c2110f21">LogStream</a> &lt;&lt; <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#ad67e8c5b30a0572f64ecfb5c062c2edc">m_ulIter</a> &lt;&lt; <span class="stringliteral">&quot;: coast point and downdrift boundary point [&quot;</span> &lt;&lt; nCoastX &lt;&lt; <span class="stringliteral">&quot;][&quot;</span> &lt;&lt; nCoastY &lt;&lt; <span class="stringliteral">&quot;] = {&quot;</span> &lt;&lt; <a class="code hl_function" href="../../d1/d98/classCSimulation.html#ad79b925ac5f358c6f867b6e47dad74bd">dGridCentroidXToExtCRSX</a>(nCoastX) &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; <a class="code hl_function" href="../../d1/d98/classCSimulation.html#a7e2a4bd69ce79377fee86aa5598903f8">dGridCentroidYToExtCRSY</a>(nCoastY) &lt;&lt; <span class="stringliteral">&quot;} are identical, ignoring&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a id="l01076" name="l01076"></a><span class="lineno"> 1076</span> </div>
<div class="line"><a id="l01077" name="l01077"></a><span class="lineno"> 1077</span>         <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l01078" name="l01078"></a><span class="lineno"> 1078</span>      }</div>
<div class="line"><a id="l01079" name="l01079"></a><span class="lineno"> 1079</span> </div>
<div class="line"><a id="l01080" name="l01080"></a><span class="lineno"> 1080</span>      <span class="comment">// Traverse the linking line, interpolating between cells by a simple DDA line algorithm, see http://en.wikipedia.org/wiki/Digital_differential_analyzer_(graphics_algorithm)</span></div>
<div class="line"><a id="l01081" name="l01081"></a><span class="lineno"> 1081</span>      dXInc = nDownDriftX - nCoastX;</div>
<div class="line"><a id="l01082" name="l01082"></a><span class="lineno"> 1082</span>      dYInc = nDownDriftY - nCoastY;</div>
<div class="line"><a id="l01083" name="l01083"></a><span class="lineno"> 1083</span>      <span class="keywordtype">double</span> <span class="keyword">const</span> dLinkingLineLength = <a class="code hl_function" href="../../d6/d2a/cme_8h.html#a7e895b460cef877dec4d12ead0c74f15">tMax</a>(<a class="code hl_function" href="../../d6/d2a/cme_8h.html#ae3b6dc50cfc97050529faa5e0bd66136">tAbs</a>(dXInc), <a class="code hl_function" href="../../d6/d2a/cme_8h.html#ae3b6dc50cfc97050529faa5e0bd66136">tAbs</a>(dYInc));</div>
<div class="line"><a id="l01084" name="l01084"></a><span class="lineno"> 1084</span> </div>
<div class="line"><a id="l01085" name="l01085"></a><span class="lineno"> 1085</span>      dXInc /= dLinkingLineLength;</div>
<div class="line"><a id="l01086" name="l01086"></a><span class="lineno"> 1086</span>      dYInc /= dLinkingLineLength;</div>
<div class="line"><a id="l01087" name="l01087"></a><span class="lineno"> 1087</span> </div>
<div class="line"><a id="l01088" name="l01088"></a><span class="lineno"> 1088</span>      dX = nCoastX,</div>
<div class="line"><a id="l01089" name="l01089"></a><span class="lineno"> 1089</span>      dY = nCoastY;</div>
<div class="line"><a id="l01090" name="l01090"></a><span class="lineno"> 1090</span> </div>
<div class="line"><a id="l01091" name="l01091"></a><span class="lineno"> 1091</span>      <span class="comment">// Process each interpolated point along the linking line</span></div>
<div class="line"><a id="l01092" name="l01092"></a><span class="lineno"> 1092</span>      <span class="keywordtype">int</span> nXLast = -1;</div>
<div class="line"><a id="l01093" name="l01093"></a><span class="lineno"> 1093</span>      <span class="keywordtype">int</span> nYLast = -1;</div>
<div class="line"><a id="l01094" name="l01094"></a><span class="lineno"> 1094</span>      <span class="keywordtype">int</span> nShadowZoneLength = 0;</div>
<div class="line"><a id="l01095" name="l01095"></a><span class="lineno"> 1095</span>      vector&lt;int&gt; VnShadowCellX, VnShadowCellY;</div>
<div class="line"><a id="l01096" name="l01096"></a><span class="lineno"> 1096</span> </div>
<div class="line"><a id="l01097" name="l01097"></a><span class="lineno"> 1097</span>      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> m = 0; m &lt; dLinkingLineLength; m++)</div>
<div class="line"><a id="l01098" name="l01098"></a><span class="lineno"> 1098</span>      {</div>
<div class="line"><a id="l01099" name="l01099"></a><span class="lineno"> 1099</span>         <span class="keywordtype">int</span> <span class="keyword">const</span> nX = <a class="code hl_function" href="../../d2/dfd/utils__global_8cpp.html#a20842d0a19d0ca952c91f3e1eb175fee">nRound</a>(dX);</div>
<div class="line"><a id="l01100" name="l01100"></a><span class="lineno"> 1100</span>         <span class="keywordtype">int</span> <span class="keyword">const</span> nY = <a class="code hl_function" href="../../d2/dfd/utils__global_8cpp.html#a20842d0a19d0ca952c91f3e1eb175fee">nRound</a>(dY);</div>
<div class="line"><a id="l01101" name="l01101"></a><span class="lineno"> 1101</span> </div>
<div class="line"><a id="l01102" name="l01102"></a><span class="lineno"> 1102</span>         <span class="comment">// Check to see if we just processed this point, can happen due to rounding</span></div>
<div class="line"><a id="l01103" name="l01103"></a><span class="lineno"> 1103</span>         <span class="keywordflow">if</span> ((nX == nXLast) &amp;&amp; (nY == nYLast))</div>
<div class="line"><a id="l01104" name="l01104"></a><span class="lineno"> 1104</span>         {</div>
<div class="line"><a id="l01105" name="l01105"></a><span class="lineno"> 1105</span>            <span class="comment">// LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: n = &quot; &lt;&lt; n &lt;&lt; &quot;, m = &quot; &lt;&lt; m &lt;&lt; &quot;, dLinkingLineLength = &quot; &lt;&lt; dLinkingLineLength &lt;&lt; &quot;, dCoastDistSoFar = &quot; &lt;&lt; dCoastDistSoFar &lt;&lt; &quot; (nTotAlongCoastDistanceToDownDriftEndpoint = &quot; &lt;&lt; nTotAlongCoastDistanceToDownDriftEndpoint &lt;&lt; &quot;), dDownDriftBoundaryDistSoFar = &quot; &lt;&lt; dDownDriftBoundaryDistSoFar &lt;&lt; &quot; (nTotDownDriftBoundaryDistance = &quot; &lt;&lt; nTotDownDriftBoundaryDistance &lt;&lt; &quot;) same as last point at [&quot; &lt;&lt; nX &lt;&lt; &quot;][&quot; &lt;&lt; nY &lt;&lt; &quot;] = {&quot; &lt;&lt; dGridCentroidXToExtCRSX(nX) &lt;&lt; &quot;, &quot; &lt;&lt; dGridCentroidYToExtCRSY(nY) &lt;&lt; &quot;}&quot; &lt;&lt; endl;</span></div>
<div class="line"><a id="l01106" name="l01106"></a><span class="lineno"> 1106</span> </div>
<div class="line"><a id="l01107" name="l01107"></a><span class="lineno"> 1107</span>            <span class="comment">// Set for next time</span></div>
<div class="line"><a id="l01108" name="l01108"></a><span class="lineno"> 1108</span>            <span class="comment">// nXLast = nX;</span></div>
<div class="line"><a id="l01109" name="l01109"></a><span class="lineno"> 1109</span>            <span class="comment">// nYLast = nY;</span></div>
<div class="line"><a id="l01110" name="l01110"></a><span class="lineno"> 1110</span>            dX += dXInc;</div>
<div class="line"><a id="l01111" name="l01111"></a><span class="lineno"> 1111</span>            dY += dYInc;</div>
<div class="line"><a id="l01112" name="l01112"></a><span class="lineno"> 1112</span> </div>
<div class="line"><a id="l01113" name="l01113"></a><span class="lineno"> 1113</span>            <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l01114" name="l01114"></a><span class="lineno"> 1114</span>         }</div>
<div class="line"><a id="l01115" name="l01115"></a><span class="lineno"> 1115</span> </div>
<div class="line"><a id="l01116" name="l01116"></a><span class="lineno"> 1116</span>         <span class="comment">// Outside valid grid?</span></div>
<div class="line"><a id="l01117" name="l01117"></a><span class="lineno"> 1117</span>         <span class="keywordflow">if</span> (! <a class="code hl_function" href="../../d1/d98/classCSimulation.html#ac900a5701df97da22278fae928951f50">bIsWithinValidGrid</a>(nX, nY))</div>
<div class="line"><a id="l01118" name="l01118"></a><span class="lineno"> 1118</span>         {</div>
<div class="line"><a id="l01119" name="l01119"></a><span class="lineno"> 1119</span>            <span class="comment">// LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: n = &quot; &lt;&lt; n &lt;&lt; &quot;, m = &quot; &lt;&lt; m &lt;&lt; &quot;, dLinkingLineLength = &quot; &lt;&lt; dLinkingLineLength &lt;&lt; &quot;, dCoastDistSoFar = &quot; &lt;&lt; dCoastDistSoFar &lt;&lt; &quot; (nTotAlongCoastDistanceToDownDriftEndpoint = &quot; &lt;&lt; nTotAlongCoastDistanceToDownDriftEndpoint &lt;&lt; &quot;), dDownDriftBoundaryDistSoFar = &quot; &lt;&lt; dDownDriftBoundaryDistSoFar &lt;&lt; &quot; (nTotDownDriftBoundaryDistance = &quot; &lt;&lt; nTotDownDriftBoundaryDistance &lt;&lt; &quot;) outside valid grid at [&quot; &lt;&lt; nX &lt;&lt; &quot;][&quot; &lt;&lt; nY &lt;&lt; &quot;] = {&quot; &lt;&lt; dGridCentroidXToExtCRSX(nX) &lt;&lt; &quot;, &quot; &lt;&lt; dGridCentroidYToExtCRSY(nY) &lt;&lt; &quot;}&quot; &lt;&lt; endl;</span></div>
<div class="line"><a id="l01120" name="l01120"></a><span class="lineno"> 1120</span> </div>
<div class="line"><a id="l01121" name="l01121"></a><span class="lineno"> 1121</span>            <span class="comment">// Set for next time</span></div>
<div class="line"><a id="l01122" name="l01122"></a><span class="lineno"> 1122</span>            nXLast = nX;</div>
<div class="line"><a id="l01123" name="l01123"></a><span class="lineno"> 1123</span>            nYLast = nY;</div>
<div class="line"><a id="l01124" name="l01124"></a><span class="lineno"> 1124</span>            dX += dXInc;</div>
<div class="line"><a id="l01125" name="l01125"></a><span class="lineno"> 1125</span>            dY += dYInc;</div>
<div class="line"><a id="l01126" name="l01126"></a><span class="lineno"> 1126</span> </div>
<div class="line"><a id="l01127" name="l01127"></a><span class="lineno"> 1127</span>            <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l01128" name="l01128"></a><span class="lineno"> 1128</span>         }</div>
<div class="line"><a id="l01129" name="l01129"></a><span class="lineno"> 1129</span> </div>
<div class="line"><a id="l01130" name="l01130"></a><span class="lineno"> 1130</span>         <span class="comment">// Not a sea cell?</span></div>
<div class="line"><a id="l01131" name="l01131"></a><span class="lineno"> 1131</span>         <span class="keywordflow">if</span> (! <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nX][nY].bIsInContiguousSea())</div>
<div class="line"><a id="l01132" name="l01132"></a><span class="lineno"> 1132</span>         {</div>
<div class="line"><a id="l01133" name="l01133"></a><span class="lineno"> 1133</span>            <span class="comment">// Not a sea cell</span></div>
<div class="line"><a id="l01134" name="l01134"></a><span class="lineno"> 1134</span>            <span class="comment">// LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: n = &quot; &lt;&lt; n &lt;&lt; &quot;, m = &quot; &lt;&lt; m &lt;&lt; &quot;, dLinkingLineLength = &quot; &lt;&lt; dLinkingLineLength &lt;&lt; &quot;, dCoastDistSoFar = &quot; &lt;&lt; dCoastDistSoFar &lt;&lt; &quot; (nTotAlongCoastDistanceToDownDriftEndpoint = &quot; &lt;&lt; nTotAlongCoastDistanceToDownDriftEndpoint &lt;&lt; &quot;), dDownDriftBoundaryDistSoFar = &quot; &lt;&lt; dDownDriftBoundaryDistSoFar &lt;&lt; &quot; (nTotDownDriftBoundaryDistance = &quot; &lt;&lt; nTotDownDriftBoundaryDistance &lt;&lt; &quot;) not a sea cell at [&quot; &lt;&lt; nX &lt;&lt; &quot;][&quot; &lt;&lt; nY &lt;&lt; &quot;] = {&quot; &lt;&lt; dGridCentroidXToExtCRSX(nX) &lt;&lt; &quot;, &quot; &lt;&lt; dGridCentroidYToExtCRSY(nY) &lt;&lt; &quot;}&quot; &lt;&lt; endl;</span></div>
<div class="line"><a id="l01135" name="l01135"></a><span class="lineno"> 1135</span> </div>
<div class="line"><a id="l01136" name="l01136"></a><span class="lineno"> 1136</span>            <span class="comment">// Set for next time</span></div>
<div class="line"><a id="l01137" name="l01137"></a><span class="lineno"> 1137</span>            nXLast = nX;</div>
<div class="line"><a id="l01138" name="l01138"></a><span class="lineno"> 1138</span>            nYLast = nY;</div>
<div class="line"><a id="l01139" name="l01139"></a><span class="lineno"> 1139</span>            dX += dXInc;</div>
<div class="line"><a id="l01140" name="l01140"></a><span class="lineno"> 1140</span>            dY += dYInc;</div>
<div class="line"><a id="l01141" name="l01141"></a><span class="lineno"> 1141</span> </div>
<div class="line"><a id="l01142" name="l01142"></a><span class="lineno"> 1142</span>            <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l01143" name="l01143"></a><span class="lineno"> 1143</span>         }</div>
<div class="line"><a id="l01144" name="l01144"></a><span class="lineno"> 1144</span> </div>
<div class="line"><a id="l01145" name="l01145"></a><span class="lineno"> 1145</span>         <span class="comment">// Have we gone past the point where the shadow boundary meets the coast (i.e. the shadow boundary end point)?</span></div>
<div class="line"><a id="l01146" name="l01146"></a><span class="lineno"> 1146</span>         <span class="keywordflow">if</span> (! bPastShadowEnd)</div>
<div class="line"><a id="l01147" name="l01147"></a><span class="lineno"> 1147</span>         {</div>
<div class="line"><a id="l01148" name="l01148"></a><span class="lineno"> 1148</span>            <span class="comment">// We have not, so the linking line has two parts: one between the coast and the shadow boundary, one between the shadow boundary and the downdrift boundary</span></div>
<div class="line"><a id="l01149" name="l01149"></a><span class="lineno"> 1149</span>            <span class="keywordtype">bool</span> bInShadowZone = <span class="keyword">true</span>;</div>
<div class="line"><a id="l01150" name="l01150"></a><span class="lineno"> 1150</span> </div>
<div class="line"><a id="l01151" name="l01151"></a><span class="lineno"> 1151</span>            <span class="keywordflow">if</span> (! <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nX][nY].bIsinAnyShadowZone())</div>
<div class="line"><a id="l01152" name="l01152"></a><span class="lineno"> 1152</span>            {</div>
<div class="line"><a id="l01153" name="l01153"></a><span class="lineno"> 1153</span>               <span class="comment">// We have left the shadow zone</span></div>
<div class="line"><a id="l01154" name="l01154"></a><span class="lineno"> 1154</span>               <span class="comment">// LogStream &lt;&lt; &quot;[&quot; &lt;&lt; nX &lt;&lt; &quot;][&quot; &lt;&lt; nY &lt;&lt; &quot;] = {&quot; &lt;&lt; dGridCentroidXToExtCRSX(nX) &lt;&lt; &quot;, &quot; &lt;&lt; dGridCentroidYToExtCRSY(nY) &lt;&lt; &quot;} LEFT SHADOW ZONE&quot; &lt;&lt; endl;</span></div>
<div class="line"><a id="l01155" name="l01155"></a><span class="lineno"> 1155</span> </div>
<div class="line"><a id="l01156" name="l01156"></a><span class="lineno"> 1156</span>               bInShadowZone = <span class="keyword">false</span>;</div>
<div class="line"><a id="l01157" name="l01157"></a><span class="lineno"> 1157</span> </div>
<div class="line"><a id="l01158" name="l01158"></a><span class="lineno"> 1158</span>               <span class="comment">// Go back over stored cell coords and set their wave properties</span></div>
<div class="line"><a id="l01159" name="l01159"></a><span class="lineno"> 1159</span>               <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> mm = 0; mm &lt; VnShadowCellX.size(); mm++)</div>
<div class="line"><a id="l01160" name="l01160"></a><span class="lineno"> 1160</span>               {</div>
<div class="line"><a id="l01161" name="l01161"></a><span class="lineno"> 1161</span>                  <span class="comment">// Process this shadow zone cell</span></div>
<div class="line"><a id="l01162" name="l01162"></a><span class="lineno"> 1162</span>                  <a class="code hl_function" href="../../d1/d98/classCSimulation.html#a3ec4fa2a5d2c77b776dcc0d53b748bb8">ProcessShadowZoneCell</a>(VnShadowCellX[mm], VnShadowCellY[mm], nShadowZoneCoastToCapeSeaHand, pPtiCoast, VnShadowCellX.back(), VnShadowCellY.back(), nZone);</div>
<div class="line"><a id="l01163" name="l01163"></a><span class="lineno"> 1163</span> </div>
<div class="line"><a id="l01164" name="l01164"></a><span class="lineno"> 1164</span>                  <span class="comment">// Also process adjacent cells</span></div>
<div class="line"><a id="l01165" name="l01165"></a><span class="lineno"> 1165</span>                  <span class="keywordflow">if</span> (mm &gt; 0)</div>
<div class="line"><a id="l01166" name="l01166"></a><span class="lineno"> 1166</span>                  {</div>
<div class="line"><a id="l01167" name="l01167"></a><span class="lineno"> 1167</span>                     <a class="code hl_class" href="../../d6/d0d/classCGeom2DIPoint.html">CGeom2DIPoint</a> <span class="keyword">const</span> PtiLeft = <a class="code hl_function" href="../../d1/d98/classCSimulation.html#a3d8b585c586578b5227d9e95c10eba6a">PtiGetPerpendicular</a>(VnShadowCellX[mm], VnShadowCellY[mm], VnShadowCellX[mm - 1], VnShadowCellY[mm - 1], 1, <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#ade186989e07cd54874887cd10d4a8465">RIGHT_HANDED</a>);</div>
<div class="line"><a id="l01168" name="l01168"></a><span class="lineno"> 1168</span>                     <a class="code hl_class" href="../../d6/d0d/classCGeom2DIPoint.html">CGeom2DIPoint</a> <span class="keyword">const</span> PtiRight = <a class="code hl_function" href="../../d1/d98/classCSimulation.html#a3d8b585c586578b5227d9e95c10eba6a">PtiGetPerpendicular</a>(VnShadowCellX[mm], VnShadowCellY[mm], VnShadowCellX[mm - 1], VnShadowCellY[mm - 1], 1, <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#afdd3411d0fa60c62522af14ea2a90570">LEFT_HANDED</a>);</div>
<div class="line"><a id="l01169" name="l01169"></a><span class="lineno"> 1169</span> </div>
<div class="line"><a id="l01170" name="l01170"></a><span class="lineno"> 1170</span>                     <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d1/d98/classCSimulation.html#ac900a5701df97da22278fae928951f50">bIsWithinValidGrid</a>(&amp;PtiLeft))</div>
<div class="line"><a id="l01171" name="l01171"></a><span class="lineno"> 1171</span>                        <a class="code hl_function" href="../../d1/d98/classCSimulation.html#a3ec4fa2a5d2c77b776dcc0d53b748bb8">ProcessShadowZoneCell</a>(PtiLeft.<a class="code hl_function" href="../../d6/d0d/classCGeom2DIPoint.html#af84c687b2d0be01ab41cbcc0565f4f3f">nGetX</a>(), PtiLeft.<a class="code hl_function" href="../../d6/d0d/classCGeom2DIPoint.html#a4d9c20bcca90dcb9d519b664aba09cbd">nGetY</a>(), nShadowZoneCoastToCapeSeaHand, pPtiCoast, VnShadowCellX.back(), VnShadowCellY.back(), nZone);</div>
<div class="line"><a id="l01172" name="l01172"></a><span class="lineno"> 1172</span> </div>
<div class="line"><a id="l01173" name="l01173"></a><span class="lineno"> 1173</span>                     <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d1/d98/classCSimulation.html#ac900a5701df97da22278fae928951f50">bIsWithinValidGrid</a>(&amp;PtiRight))</div>
<div class="line"><a id="l01174" name="l01174"></a><span class="lineno"> 1174</span>                        <a class="code hl_function" href="../../d1/d98/classCSimulation.html#a3ec4fa2a5d2c77b776dcc0d53b748bb8">ProcessShadowZoneCell</a>(PtiRight.<a class="code hl_function" href="../../d6/d0d/classCGeom2DIPoint.html#af84c687b2d0be01ab41cbcc0565f4f3f">nGetX</a>(), PtiRight.<a class="code hl_function" href="../../d6/d0d/classCGeom2DIPoint.html#a4d9c20bcca90dcb9d519b664aba09cbd">nGetY</a>(), nShadowZoneCoastToCapeSeaHand, pPtiCoast, VnShadowCellX.back(), VnShadowCellY.back(), nZone);</div>
<div class="line"><a id="l01175" name="l01175"></a><span class="lineno"> 1175</span>                  }</div>
<div class="line"><a id="l01176" name="l01176"></a><span class="lineno"> 1176</span>               }</div>
<div class="line"><a id="l01177" name="l01177"></a><span class="lineno"> 1177</span>            }</div>
<div class="line"><a id="l01178" name="l01178"></a><span class="lineno"> 1178</span> </div>
<div class="line"><a id="l01179" name="l01179"></a><span class="lineno"> 1179</span>            <span class="keywordflow">if</span> (bInShadowZone)</div>
<div class="line"><a id="l01180" name="l01180"></a><span class="lineno"> 1180</span>            {</div>
<div class="line"><a id="l01181" name="l01181"></a><span class="lineno"> 1181</span>               <span class="comment">// Save coords for later</span></div>
<div class="line"><a id="l01182" name="l01182"></a><span class="lineno"> 1182</span>               VnShadowCellX.push_back(nX);</div>
<div class="line"><a id="l01183" name="l01183"></a><span class="lineno"> 1183</span>               VnShadowCellY.push_back(nY);</div>
<div class="line"><a id="l01184" name="l01184"></a><span class="lineno"> 1184</span> </div>
<div class="line"><a id="l01185" name="l01185"></a><span class="lineno"> 1185</span>               nShadowZoneLength++;</div>
<div class="line"><a id="l01186" name="l01186"></a><span class="lineno"> 1186</span>            }</div>
<div class="line"><a id="l01187" name="l01187"></a><span class="lineno"> 1187</span> </div>
<div class="line"><a id="l01188" name="l01188"></a><span class="lineno"> 1188</span>            <span class="keywordflow">else</span></div>
<div class="line"><a id="l01189" name="l01189"></a><span class="lineno"> 1189</span>            {</div>
<div class="line"><a id="l01190" name="l01190"></a><span class="lineno"> 1190</span>               <span class="comment">// In downdrift zone</span></div>
<div class="line"><a id="l01191" name="l01191"></a><span class="lineno"> 1191</span> </div>
<div class="line"><a id="l01192" name="l01192"></a><span class="lineno"> 1192</span>               <span class="comment">// LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: n = &quot; &lt;&lt; n &lt;&lt; &quot;, m = &quot; &lt;&lt; m &lt;&lt; &quot;, dLinkingLineLength = &quot; &lt;&lt; dLinkingLineLength &lt;&lt; &quot;, dCoastDistSoFar = &quot; &lt;&lt; dCoastDistSoFar &lt;&lt; &quot; (nTotAlongCoastDistanceToDownDriftEndpoint = &quot; &lt;&lt; nTotAlongCoastDistanceToDownDriftEndpoint &lt;&lt; &quot;), dDownDriftBoundaryDistSoFar = &quot; &lt;&lt; dDownDriftBoundaryDistSoFar &lt;&lt; &quot; (nTotDownDriftBoundaryDistance = &quot; &lt;&lt; nTotDownDriftBoundaryDistance &lt;&lt; &quot;) has [&quot; &lt;&lt; nX &lt;&lt; &quot;][&quot; &lt;&lt; nY &lt;&lt; &quot;] = {&quot; &lt;&lt; dGridCentroidXToExtCRSX(nX) &lt;&lt; &quot;, &quot; &lt;&lt; dGridCentroidYToExtCRSY(nY) &lt;&lt; &quot;} in downdrift zone&quot; &lt;&lt; endl;</span></div>
<div class="line"><a id="l01193" name="l01193"></a><span class="lineno"> 1193</span> </div>
<div class="line"><a id="l01194" name="l01194"></a><span class="lineno"> 1194</span>               <span class="comment">// Process this downdrift cell</span></div>
<div class="line"><a id="l01195" name="l01195"></a><span class="lineno"> 1195</span>               <a class="code hl_function" href="../../d1/d98/classCSimulation.html#adf8e75ca379e22f9b98c956e3a7fc8e8">ProcessDownDriftCell</a>(nX, nY, (m - nShadowZoneLength), (dLinkingLineLength - nShadowZoneLength), nZone);</div>
<div class="line"><a id="l01196" name="l01196"></a><span class="lineno"> 1196</span> </div>
<div class="line"><a id="l01197" name="l01197"></a><span class="lineno"> 1197</span>               <span class="comment">// Also process adjacent cells</span></div>
<div class="line"><a id="l01198" name="l01198"></a><span class="lineno"> 1198</span>               <a class="code hl_class" href="../../d6/d0d/classCGeom2DIPoint.html">CGeom2DIPoint</a> <span class="keyword">const</span> PtiLeft = <a class="code hl_function" href="../../d1/d98/classCSimulation.html#a3d8b585c586578b5227d9e95c10eba6a">PtiGetPerpendicular</a>(nX, nY, nXLast, nYLast, 1, <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#ade186989e07cd54874887cd10d4a8465">RIGHT_HANDED</a>);</div>
<div class="line"><a id="l01199" name="l01199"></a><span class="lineno"> 1199</span>               <a class="code hl_class" href="../../d6/d0d/classCGeom2DIPoint.html">CGeom2DIPoint</a> <span class="keyword">const</span> PtiRight = <a class="code hl_function" href="../../d1/d98/classCSimulation.html#a3d8b585c586578b5227d9e95c10eba6a">PtiGetPerpendicular</a>(nX, nY, nXLast, nYLast, 1, <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#afdd3411d0fa60c62522af14ea2a90570">LEFT_HANDED</a>);</div>
<div class="line"><a id="l01200" name="l01200"></a><span class="lineno"> 1200</span> </div>
<div class="line"><a id="l01201" name="l01201"></a><span class="lineno"> 1201</span>               <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d1/d98/classCSimulation.html#ac900a5701df97da22278fae928951f50">bIsWithinValidGrid</a>(&amp;PtiLeft))</div>
<div class="line"><a id="l01202" name="l01202"></a><span class="lineno"> 1202</span>                  <a class="code hl_function" href="../../d1/d98/classCSimulation.html#adf8e75ca379e22f9b98c956e3a7fc8e8">ProcessDownDriftCell</a>(PtiLeft.<a class="code hl_function" href="../../d6/d0d/classCGeom2DIPoint.html#af84c687b2d0be01ab41cbcc0565f4f3f">nGetX</a>(), PtiLeft.<a class="code hl_function" href="../../d6/d0d/classCGeom2DIPoint.html#a4d9c20bcca90dcb9d519b664aba09cbd">nGetY</a>(), (m - nShadowZoneLength), (dLinkingLineLength - nShadowZoneLength), nZone);</div>
<div class="line"><a id="l01203" name="l01203"></a><span class="lineno"> 1203</span> </div>
<div class="line"><a id="l01204" name="l01204"></a><span class="lineno"> 1204</span>               <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d1/d98/classCSimulation.html#ac900a5701df97da22278fae928951f50">bIsWithinValidGrid</a>(&amp;PtiRight))</div>
<div class="line"><a id="l01205" name="l01205"></a><span class="lineno"> 1205</span>                  <a class="code hl_function" href="../../d1/d98/classCSimulation.html#adf8e75ca379e22f9b98c956e3a7fc8e8">ProcessDownDriftCell</a>(PtiRight.<a class="code hl_function" href="../../d6/d0d/classCGeom2DIPoint.html#af84c687b2d0be01ab41cbcc0565f4f3f">nGetX</a>(), PtiRight.<a class="code hl_function" href="../../d6/d0d/classCGeom2DIPoint.html#a4d9c20bcca90dcb9d519b664aba09cbd">nGetY</a>(), (m - nShadowZoneLength), (dLinkingLineLength - nShadowZoneLength), nZone);</div>
<div class="line"><a id="l01206" name="l01206"></a><span class="lineno"> 1206</span>            }</div>
<div class="line"><a id="l01207" name="l01207"></a><span class="lineno"> 1207</span>         }</div>
<div class="line"><a id="l01208" name="l01208"></a><span class="lineno"> 1208</span> </div>
<div class="line"><a id="l01209" name="l01209"></a><span class="lineno"> 1209</span>         <span class="keywordflow">else</span></div>
<div class="line"><a id="l01210" name="l01210"></a><span class="lineno"> 1210</span>         {</div>
<div class="line"><a id="l01211" name="l01211"></a><span class="lineno"> 1211</span>            <span class="comment">// We have, so the linking line has only one part: between the coast and the downdrift boundary.</span></div>
<div class="line"><a id="l01212" name="l01212"></a><span class="lineno"> 1212</span> </div>
<div class="line"><a id="l01213" name="l01213"></a><span class="lineno"> 1213</span>            <span class="comment">// LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: n = &quot; &lt;&lt; n &lt;&lt; &quot;, m = &quot; &lt;&lt; m &lt;&lt; &quot;, dLinkingLineLength = &quot; &lt;&lt; dLinkingLineLength &lt;&lt; &quot;, dCoastDistSoFar = &quot; &lt;&lt; dCoastDistSoFar &lt;&lt; &quot; (nTotAlongCoastDistanceToDownDriftEndpoint = &quot; &lt;&lt; nTotAlongCoastDistanceToDownDriftEndpoint &lt;&lt; &quot;), dDownDriftBoundaryDistSoFar = &quot; &lt;&lt; dDownDriftBoundaryDistSoFar &lt;&lt; &quot; (nTotDownDriftBoundaryDistance = &quot; &lt;&lt; nTotDownDriftBoundaryDistance &lt;&lt; &quot;) has [&quot; &lt;&lt; nX &lt;&lt; &quot;][&quot; &lt;&lt; nY &lt;&lt; &quot;] = {&quot; &lt;&lt; dGridCentroidXToExtCRSX(nX) &lt;&lt; &quot;, &quot; &lt;&lt; dGridCentroidYToExtCRSY(nY) &lt;&lt; &quot;} in downdrift zone&quot; &lt;&lt; endl;</span></div>
<div class="line"><a id="l01214" name="l01214"></a><span class="lineno"> 1214</span> </div>
<div class="line"><a id="l01215" name="l01215"></a><span class="lineno"> 1215</span>            <span class="comment">// Process this downdrift cell</span></div>
<div class="line"><a id="l01216" name="l01216"></a><span class="lineno"> 1216</span>            <a class="code hl_function" href="../../d1/d98/classCSimulation.html#adf8e75ca379e22f9b98c956e3a7fc8e8">ProcessDownDriftCell</a>(nX, nY, m, dLinkingLineLength, nZone);</div>
<div class="line"><a id="l01217" name="l01217"></a><span class="lineno"> 1217</span> </div>
<div class="line"><a id="l01218" name="l01218"></a><span class="lineno"> 1218</span>            <span class="comment">// Also process adjacent cells</span></div>
<div class="line"><a id="l01219" name="l01219"></a><span class="lineno"> 1219</span>            <span class="keywordflow">if</span> ((nXLast != -1) &amp;&amp; (nYLast != -1))</div>
<div class="line"><a id="l01220" name="l01220"></a><span class="lineno"> 1220</span>            {</div>
<div class="line"><a id="l01221" name="l01221"></a><span class="lineno"> 1221</span>               <a class="code hl_class" href="../../d6/d0d/classCGeom2DIPoint.html">CGeom2DIPoint</a> <span class="keyword">const</span> PtiLeft = <a class="code hl_function" href="../../d1/d98/classCSimulation.html#a3d8b585c586578b5227d9e95c10eba6a">PtiGetPerpendicular</a>(nX, nY, nXLast, nYLast, 1, <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#ade186989e07cd54874887cd10d4a8465">RIGHT_HANDED</a>);</div>
<div class="line"><a id="l01222" name="l01222"></a><span class="lineno"> 1222</span>               <a class="code hl_class" href="../../d6/d0d/classCGeom2DIPoint.html">CGeom2DIPoint</a> <span class="keyword">const</span> PtiRight = <a class="code hl_function" href="../../d1/d98/classCSimulation.html#a3d8b585c586578b5227d9e95c10eba6a">PtiGetPerpendicular</a>(nX, nY, nXLast, nYLast, 1, <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#afdd3411d0fa60c62522af14ea2a90570">LEFT_HANDED</a>);</div>
<div class="line"><a id="l01223" name="l01223"></a><span class="lineno"> 1223</span> </div>
<div class="line"><a id="l01224" name="l01224"></a><span class="lineno"> 1224</span>               <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d1/d98/classCSimulation.html#ac900a5701df97da22278fae928951f50">bIsWithinValidGrid</a>(&amp;PtiLeft))</div>
<div class="line"><a id="l01225" name="l01225"></a><span class="lineno"> 1225</span>                  <a class="code hl_function" href="../../d1/d98/classCSimulation.html#adf8e75ca379e22f9b98c956e3a7fc8e8">ProcessDownDriftCell</a>(PtiLeft.<a class="code hl_function" href="../../d6/d0d/classCGeom2DIPoint.html#af84c687b2d0be01ab41cbcc0565f4f3f">nGetX</a>(), PtiLeft.<a class="code hl_function" href="../../d6/d0d/classCGeom2DIPoint.html#a4d9c20bcca90dcb9d519b664aba09cbd">nGetY</a>(), m, dLinkingLineLength, nZone);</div>
<div class="line"><a id="l01226" name="l01226"></a><span class="lineno"> 1226</span> </div>
<div class="line"><a id="l01227" name="l01227"></a><span class="lineno"> 1227</span>               <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d1/d98/classCSimulation.html#ac900a5701df97da22278fae928951f50">bIsWithinValidGrid</a>(&amp;PtiRight))</div>
<div class="line"><a id="l01228" name="l01228"></a><span class="lineno"> 1228</span>                  <a class="code hl_function" href="../../d1/d98/classCSimulation.html#adf8e75ca379e22f9b98c956e3a7fc8e8">ProcessDownDriftCell</a>(PtiRight.<a class="code hl_function" href="../../d6/d0d/classCGeom2DIPoint.html#af84c687b2d0be01ab41cbcc0565f4f3f">nGetX</a>(), PtiRight.<a class="code hl_function" href="../../d6/d0d/classCGeom2DIPoint.html#a4d9c20bcca90dcb9d519b664aba09cbd">nGetY</a>(), m, dLinkingLineLength, nZone);</div>
<div class="line"><a id="l01229" name="l01229"></a><span class="lineno"> 1229</span>            }</div>
<div class="line"><a id="l01230" name="l01230"></a><span class="lineno"> 1230</span>         }</div>
<div class="line"><a id="l01231" name="l01231"></a><span class="lineno"> 1231</span> </div>
<div class="line"><a id="l01232" name="l01232"></a><span class="lineno"> 1232</span>         <span class="comment">// Set for next time</span></div>
<div class="line"><a id="l01233" name="l01233"></a><span class="lineno"> 1233</span>         nXLast = nX;</div>
<div class="line"><a id="l01234" name="l01234"></a><span class="lineno"> 1234</span>         nYLast = nY;</div>
<div class="line"><a id="l01235" name="l01235"></a><span class="lineno"> 1235</span>         dX += dXInc;</div>
<div class="line"><a id="l01236" name="l01236"></a><span class="lineno"> 1236</span>         dY += dYInc;</div>
<div class="line"><a id="l01237" name="l01237"></a><span class="lineno"> 1237</span>      }</div>
<div class="line"><a id="l01238" name="l01238"></a><span class="lineno"> 1238</span>   }</div>
<div class="line"><a id="l01239" name="l01239"></a><span class="lineno"> 1239</span>}</div>
</div>
<div class="line"><a id="l01240" name="l01240"></a><span class="lineno"> 1240</span> </div>
<div class="line"><a id="l01241" name="l01241"></a><span class="lineno"> 1241</span><span class="comment">//===============================================================================================================================</span></div>
<div class="line"><a id="l01243" name="l01243"></a><span class="lineno"> 1243</span><span class="comment">//===============================================================================================================================</span></div>
<div class="foldopen" id="foldopen01244" data-start="{" data-end="}">
<div class="line"><a id="l01244" name="l01244"></a><span class="lineno"><a class="line" href="../../d1/d98/classCSimulation.html#adf8e75ca379e22f9b98c956e3a7fc8e8"> 1244</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../d1/d98/classCSimulation.html#adf8e75ca379e22f9b98c956e3a7fc8e8">CSimulation::ProcessDownDriftCell</a>(<span class="keywordtype">int</span> <span class="keyword">const</span> nX, <span class="keywordtype">int</span> <span class="keyword">const</span> nY, <span class="keywordtype">int</span> <span class="keyword">const</span> nTraversed, <span class="keywordtype">double</span> <span class="keyword">const</span> dTotalToTraverse, <span class="keywordtype">int</span> <span class="keyword">const</span> nZone)</div>
<div class="line"><a id="l01245" name="l01245"></a><span class="lineno"> 1245</span>{</div>
<div class="line"><a id="l01246" name="l01246"></a><span class="lineno"> 1246</span>   <span class="comment">// Get the pre-existing (i.e. shore-parallel) wave height</span></div>
<div class="line"><a id="l01247" name="l01247"></a><span class="lineno"> 1247</span>   <span class="keywordtype">double</span> <span class="keyword">const</span> dWaveHeight = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nX][nY].dGetWaveHeight();</div>
<div class="line"><a id="l01248" name="l01248"></a><span class="lineno"> 1248</span> </div>
<div class="line"><a id="l01249" name="l01249"></a><span class="lineno"> 1249</span>   <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d6/d2a/cme_8h.html#a61afa8560a3b39c80657661a1d8f76ab">bFPIsEqual</a>(dWaveHeight, <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#ac003bdff958dca839f5d274f15786e07">DBL_NODATA</a>, <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a08b1623863ee3bd4300a8892de323722">TOLERANCE</a>))</div>
<div class="line"><a id="l01250" name="l01250"></a><span class="lineno"> 1250</span>   {</div>
<div class="line"><a id="l01251" name="l01251"></a><span class="lineno"> 1251</span>      <span class="comment">// Is not a sea cell</span></div>
<div class="line"><a id="l01252" name="l01252"></a><span class="lineno"> 1252</span>      <span class="comment">// LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: [&quot; &lt;&lt; nX &lt;&lt; &quot;][&quot; &lt;&lt; nY &lt;&lt; &quot;] = {&quot; &lt;&lt; dGridCentroidXToExtCRSX(nX) &lt;&lt; &quot;, &quot; &lt;&lt; dGridCentroidYToExtCRSY(nY) &lt;&lt; &quot;} ignored, not a sea cell&quot; &lt;&lt; endl;</span></div>
<div class="line"><a id="l01253" name="l01253"></a><span class="lineno"> 1253</span> </div>
<div class="line"><a id="l01254" name="l01254"></a><span class="lineno"> 1254</span>      <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l01255" name="l01255"></a><span class="lineno"> 1255</span>   }</div>
<div class="line"><a id="l01256" name="l01256"></a><span class="lineno"> 1256</span> </div>
<div class="line"><a id="l01257" name="l01257"></a><span class="lineno"> 1257</span>   <span class="keywordtype">int</span> nZoneCode = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nX][nY].nGetShadowZoneNumber();</div>
<div class="line"><a id="l01258" name="l01258"></a><span class="lineno"> 1258</span> </div>
<div class="line"><a id="l01259" name="l01259"></a><span class="lineno"> 1259</span>   <span class="keywordflow">if</span> (nZoneCode == (nZone + 1))</div>
<div class="line"><a id="l01260" name="l01260"></a><span class="lineno"> 1260</span>   {</div>
<div class="line"><a id="l01261" name="l01261"></a><span class="lineno"> 1261</span>      <span class="comment">// This cell is in the associated shadow zone, so don&#39;t change it</span></div>
<div class="line"><a id="l01262" name="l01262"></a><span class="lineno"> 1262</span>      <span class="comment">// LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: [&quot; &lt;&lt; nX &lt;&lt; &quot;][&quot; &lt;&lt; nY &lt;&lt; &quot;] = {&quot; &lt;&lt; dGridCentroidXToExtCRSX(nX) &lt;&lt; &quot;, &quot; &lt;&lt; dGridCentroidYToExtCRSY(nY) &lt;&lt; &quot;} ignored, is in associated shadow zone (&quot; &lt;&lt; nZone+1 &lt;&lt; &quot;)&quot; &lt;&lt; endl;</span></div>
<div class="line"><a id="l01263" name="l01263"></a><span class="lineno"> 1263</span> </div>
<div class="line"><a id="l01264" name="l01264"></a><span class="lineno"> 1264</span>      <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l01265" name="l01265"></a><span class="lineno"> 1265</span>   }</div>
<div class="line"><a id="l01266" name="l01266"></a><span class="lineno"> 1266</span> </div>
<div class="line"><a id="l01267" name="l01267"></a><span class="lineno"> 1267</span>   <span class="keywordflow">if</span> (nZoneCode &lt; 0)</div>
<div class="line"><a id="l01268" name="l01268"></a><span class="lineno"> 1268</span>   {</div>
<div class="line"><a id="l01269" name="l01269"></a><span class="lineno"> 1269</span>      <span class="comment">// This cell is in a shadow zone but is not yet processed, so don&#39;t change it</span></div>
<div class="line"><a id="l01270" name="l01270"></a><span class="lineno"> 1270</span>      <span class="comment">// LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: [&quot; &lt;&lt; nX &lt;&lt; &quot;][&quot; &lt;&lt; nY &lt;&lt; &quot;] = {&quot; &lt;&lt; dGridCentroidXToExtCRSX(nX) &lt;&lt; &quot;, &quot; &lt;&lt; dGridCentroidYToExtCRSY(nY) &lt;&lt; &quot;} ignored, is an unprocessed cell in shadow zone &quot; &lt;&lt; nZoneCode &lt;&lt; endl;</span></div>
<div class="line"><a id="l01271" name="l01271"></a><span class="lineno"> 1271</span> </div>
<div class="line"><a id="l01272" name="l01272"></a><span class="lineno"> 1272</span>      <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l01273" name="l01273"></a><span class="lineno"> 1273</span>   }</div>
<div class="line"><a id="l01274" name="l01274"></a><span class="lineno"> 1274</span> </div>
<div class="line"><a id="l01275" name="l01275"></a><span class="lineno"> 1275</span>   nZoneCode = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nX][nY].nGetDownDriftZoneNumber();</div>
<div class="line"><a id="l01276" name="l01276"></a><span class="lineno"> 1276</span> </div>
<div class="line"><a id="l01277" name="l01277"></a><span class="lineno"> 1277</span>   <span class="keywordflow">if</span> (nZoneCode == (nZone + 1))</div>
<div class="line"><a id="l01278" name="l01278"></a><span class="lineno"> 1278</span>   {</div>
<div class="line"><a id="l01279" name="l01279"></a><span class="lineno"> 1279</span>      <span class="comment">// We have already processed this cell for this downdrift zone</span></div>
<div class="line"><a id="l01280" name="l01280"></a><span class="lineno"> 1280</span>      <span class="comment">// LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: [&quot; &lt;&lt; nX &lt;&lt; &quot;][&quot; &lt;&lt; nY &lt;&lt; &quot;] = {&quot; &lt;&lt; dGridCentroidXToExtCRSX(nX) &lt;&lt; &quot;, &quot; &lt;&lt; dGridCentroidYToExtCRSY(nY) &lt;&lt; &quot;} ignored, already done for this down-drift zone &quot; &lt;&lt; nZone+1 &lt;&lt; endl;</span></div>
<div class="line"><a id="l01281" name="l01281"></a><span class="lineno"> 1281</span> </div>
<div class="line"><a id="l01282" name="l01282"></a><span class="lineno"> 1282</span>      <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l01283" name="l01283"></a><span class="lineno"> 1283</span>   }</div>
<div class="line"><a id="l01284" name="l01284"></a><span class="lineno"> 1284</span> </div>
<div class="line"><a id="l01285" name="l01285"></a><span class="lineno"> 1285</span>   <span class="comment">// OK, we are downdrift of the shadow zone area and have not yet processed this cell for this zone, so mark it</span></div>
<div class="line"><a id="l01286" name="l01286"></a><span class="lineno"> 1286</span>   <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nX][nY].SetDownDriftZoneNumber(nZone + 1);</div>
<div class="line"><a id="l01287" name="l01287"></a><span class="lineno"> 1287</span> </div>
<div class="line"><a id="l01288" name="l01288"></a><span class="lineno"> 1288</span>   <span class="comment">// Equation 14 from Hurst et al. TODO 056 Check this! Could not get this to work (typo in paper?), so used the equation below instead</span></div>
<div class="line"><a id="l01289" name="l01289"></a><span class="lineno"> 1289</span>   <span class="comment">// double dKp = 0.5 * (1.0 - sin((PI * 90.0 * nSweep) / (180.0 * nSweepLength)));</span></div>
<div class="line"><a id="l01290" name="l01290"></a><span class="lineno"> 1290</span>   <span class="keywordtype">double</span> <span class="keyword">const</span> dKp = 0.5 + (0.5 * sin((<a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a5d502a06fdd71825be49e07c95496b16">PI</a> * nTraversed) / (2.0 * dTotalToTraverse)));</div>
<div class="line"><a id="l01291" name="l01291"></a><span class="lineno"> 1291</span> </div>
<div class="line"><a id="l01292" name="l01292"></a><span class="lineno"> 1292</span>   <span class="comment">// Set the modified wave height</span></div>
<div class="line"><a id="l01293" name="l01293"></a><span class="lineno"> 1293</span>   <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nX][nY].SetWaveHeight(dKp * dWaveHeight);</div>
<div class="line"><a id="l01294" name="l01294"></a><span class="lineno"> 1294</span> </div>
<div class="line"><a id="l01295" name="l01295"></a><span class="lineno"> 1295</span>   <span class="comment">// LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: [&quot; &lt;&lt; nX &lt;&lt; &quot;][&quot; &lt;&lt; nY &lt;&lt; &quot;] = {&quot; &lt;&lt; dGridCentroidXToExtCRSX(nX) &lt;&lt; &quot;, &quot; &lt;&lt; dGridCentroidYToExtCRSY(nY) &lt;&lt; &quot;}, nTraversed = &quot; &lt;&lt; nTraversed &lt;&lt; &quot; dTotalToTraverse = &quot; &lt;&lt; dTotalToTraverse &lt;&lt; &quot; fraction traversed = &quot; &lt;&lt; nTraversed / dTotalToTraverse &lt;&lt; endl &lt;&lt; &quot;m_pRasterGrid-&gt;m_Cell[&quot; &lt;&lt; nX &lt;&lt; &quot;][&quot; &lt;&lt; nY &lt;&lt; &quot;].dGetCellDeepWaterWaveHeight() = &quot; &lt;&lt; m_pRasterGrid-&gt;m_Cell[nX][nY].dGetCellDeepWaterWaveHeight() &lt;&lt; &quot; m, original dWaveHeight = &quot; &lt;&lt; dWaveHeight &lt;&lt; &quot; m, dKp = &quot; &lt;&lt; dKp &lt;&lt; &quot;, modified wave height = &quot; &lt;&lt; dKp * dWaveHeight &lt;&lt; &quot; m&quot; &lt;&lt; endl &lt;&lt; endl;</span></div>
<div class="line"><a id="l01296" name="l01296"></a><span class="lineno"> 1296</span>}</div>
</div>
<div class="line"><a id="l01297" name="l01297"></a><span class="lineno"> 1297</span> </div>
<div class="line"><a id="l01298" name="l01298"></a><span class="lineno"> 1298</span><span class="comment">//===============================================================================================================================</span></div>
<div class="line"><a id="l01300" name="l01300"></a><span class="lineno"> 1300</span><span class="comment">//===============================================================================================================================</span></div>
<div class="foldopen" id="foldopen01301" data-start="{" data-end="}">
<div class="line"><a id="l01301" name="l01301"></a><span class="lineno"><a class="line" href="../../d1/d98/classCSimulation.html#a3ec4fa2a5d2c77b776dcc0d53b748bb8"> 1301</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../d1/d98/classCSimulation.html#a3ec4fa2a5d2c77b776dcc0d53b748bb8">CSimulation::ProcessShadowZoneCell</a>(<span class="keywordtype">int</span> <span class="keyword">const</span> nX, <span class="keywordtype">int</span> <span class="keyword">const</span> nY, <span class="keywordtype">int</span> <span class="keyword">const</span> nShadowZoneCoastToCapeSeaHand, <a class="code hl_class" href="../../d6/d0d/classCGeom2DIPoint.html">CGeom2DIPoint</a> <span class="keyword">const</span>* pPtiCoast, <span class="keywordtype">int</span> <span class="keyword">const</span> nShadowEndX, <span class="keywordtype">int</span> <span class="keyword">const</span> nShadowEndY, <span class="keywordtype">int</span> <span class="keyword">const</span> nZone)</div>
<div class="line"><a id="l01302" name="l01302"></a><span class="lineno"> 1302</span>{</div>
<div class="line"><a id="l01303" name="l01303"></a><span class="lineno"> 1303</span>   <span class="keywordtype">int</span> <span class="keyword">const</span> nZoneCode = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nX][nY].nGetShadowZoneNumber();</div>
<div class="line"><a id="l01304" name="l01304"></a><span class="lineno"> 1304</span> </div>
<div class="line"><a id="l01305" name="l01305"></a><span class="lineno"> 1305</span>   <span class="keywordflow">if</span> (nZoneCode == (-nZone - 1))</div>
<div class="line"><a id="l01306" name="l01306"></a><span class="lineno"> 1306</span>   {</div>
<div class="line"><a id="l01307" name="l01307"></a><span class="lineno"> 1307</span>      <span class="comment">// OK, we are in the shadow zone and have not already processed this cell, so mark it (a +ve number, starting from 1)</span></div>
<div class="line"><a id="l01308" name="l01308"></a><span class="lineno"> 1308</span>      <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nX][nY].SetShadowZoneNumber(nZone + 1);</div>
<div class="line"><a id="l01309" name="l01309"></a><span class="lineno"> 1309</span> </div>
<div class="line"><a id="l01310" name="l01310"></a><span class="lineno"> 1310</span>      <span class="comment">// Next calculate wave angle here: first calculate dOmega, the signed angle subtended between this end point and the start point, and this end point and the end of the shadow boundary</span></div>
<div class="line"><a id="l01311" name="l01311"></a><span class="lineno"> 1311</span>      <a class="code hl_class" href="../../d6/d0d/classCGeom2DIPoint.html">CGeom2DIPoint</a> <span class="keyword">const</span> PtiThis(nX, nY);</div>
<div class="line"><a id="l01312" name="l01312"></a><span class="lineno"> 1312</span>      <a class="code hl_class" href="../../d6/d0d/classCGeom2DIPoint.html">CGeom2DIPoint</a> <span class="keyword">const</span> PtiShadowBoundary(nShadowEndX, nShadowEndY);</div>
<div class="line"><a id="l01313" name="l01313"></a><span class="lineno"> 1313</span>      <span class="keywordtype">double</span> <span class="keyword">const</span> dOmega = 180 * <a class="code hl_function" href="../../d1/d98/classCSimulation.html#a9ca0040fbbf23a491d21d5248ab0eb77">dAngleSubtended</a>(pPtiCoast, &amp;PtiThis, &amp;PtiShadowBoundary) / <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a5d502a06fdd71825be49e07c95496b16">PI</a>;</div>
<div class="line"><a id="l01314" name="l01314"></a><span class="lineno"> 1314</span> </div>
<div class="line"><a id="l01315" name="l01315"></a><span class="lineno"> 1315</span>      <span class="comment">// If dOmega is 90 degrees or more in either direction, set both wave angle and wave height to zero</span></div>
<div class="line"><a id="l01316" name="l01316"></a><span class="lineno"> 1316</span>      <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d6/d2a/cme_8h.html#ae3b6dc50cfc97050529faa5e0bd66136">tAbs</a>(dOmega) &gt;= 90)</div>
<div class="line"><a id="l01317" name="l01317"></a><span class="lineno"> 1317</span>      {</div>
<div class="line"><a id="l01318" name="l01318"></a><span class="lineno"> 1318</span>         <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nX][nY].SetWaveAngle(0);</div>
<div class="line"><a id="l01319" name="l01319"></a><span class="lineno"> 1319</span>         <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nX][nY].SetWaveHeight(0);</div>
<div class="line"><a id="l01320" name="l01320"></a><span class="lineno"> 1320</span> </div>
<div class="line"><a id="l01321" name="l01321"></a><span class="lineno"> 1321</span>         <span class="comment">// LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: on shadow linking line with coast end [&quot; &lt;&lt; pPtiCoast-&gt;nGetX() &lt;&lt; &quot;][&quot; &lt;&lt; pPtiCoast-&gt;nGetY() &lt;&lt; &quot;] = {&quot; &lt;&lt; dGridCentroidXToExtCRSX(pPtiCoast-&gt;nGetX()) &lt;&lt; &quot;, &quot; &lt;&lt; dGridCentroidYToExtCRSY(pPtiCoast-&gt;nGetY()) &lt;&lt; &quot;} and shadow boundary end [&quot; &lt;&lt; PtiShadowBoundary.nGetX() &lt;&lt; &quot;][&quot; &lt;&lt; PtiShadowBoundary.nGetY() &lt;&lt; &quot;] = {&quot; &lt;&lt; dGridCentroidXToExtCRSX(PtiShadowBoundary.nGetX()) &lt;&lt; &quot;, &quot; &lt;&lt; dGridCentroidYToExtCRSY(PtiShadowBoundary.nGetY()) &lt;&lt; &quot;}, this point [&quot; &lt;&lt; nX &lt;&lt; &quot;][&quot; &lt;&lt; nY &lt;&lt; &quot;] = {&quot; &lt;&lt; dGridCentroidXToExtCRSX(nX) &lt;&lt; &quot;, &quot; &lt;&lt; dGridCentroidYToExtCRSY(nY) &lt;&lt; &quot;}&quot; &lt;&lt; endl &lt;&lt; &quot;angle subtended = &quot; &lt;&lt; dOmega &lt;&lt; &quot; degrees, m_pRasterGrid-&gt;m_Cell[&quot; &lt;&lt; nX &lt;&lt; &quot;][&quot; &lt;&lt; nY &lt;&lt; &quot;].dGetCellDeepWaterWaveHeight() = &quot; &lt;&lt; m_pRasterGrid-&gt;m_Cell[nX][nY].dGetCellDeepWaterWaveHeight() &lt;&lt; &quot; degrees, wave orientation = 0 degrees, wave height = 0 m&quot; &lt;&lt; endl;</span></div>
<div class="line"><a id="l01322" name="l01322"></a><span class="lineno"> 1322</span>      }</div>
<div class="line"><a id="l01323" name="l01323"></a><span class="lineno"> 1323</span> </div>
<div class="line"><a id="l01324" name="l01324"></a><span class="lineno"> 1324</span>      <span class="keywordflow">else</span></div>
<div class="line"><a id="l01325" name="l01325"></a><span class="lineno"> 1325</span>      {</div>
<div class="line"><a id="l01326" name="l01326"></a><span class="lineno"> 1326</span>         <span class="comment">// Adapted from equation 12 in Hurst et al.</span></div>
<div class="line"><a id="l01327" name="l01327"></a><span class="lineno"> 1327</span>         <span class="keywordtype">double</span> <span class="keyword">const</span> dDeltaShadowWaveAngle = 1.5 * dOmega;</div>
<div class="line"><a id="l01328" name="l01328"></a><span class="lineno"> 1328</span> </div>
<div class="line"><a id="l01329" name="l01329"></a><span class="lineno"> 1329</span>         <span class="comment">// Get the pre-existing (i.e. shore-parallel) wave orientation</span></div>
<div class="line"><a id="l01330" name="l01330"></a><span class="lineno"> 1330</span>         <span class="keywordtype">double</span> <span class="keyword">const</span> dWaveAngle = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nX][nY].dGetWaveAngle();</div>
<div class="line"><a id="l01331" name="l01331"></a><span class="lineno"> 1331</span> </div>
<div class="line"><a id="l01332" name="l01332"></a><span class="lineno"> 1332</span>         <span class="keywordtype">double</span> dShadowWaveAngle;</div>
<div class="line"><a id="l01333" name="l01333"></a><span class="lineno"> 1333</span> </div>
<div class="line"><a id="l01334" name="l01334"></a><span class="lineno"> 1334</span>         <span class="keywordflow">if</span> (nShadowZoneCoastToCapeSeaHand == <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#afdd3411d0fa60c62522af14ea2a90570">LEFT_HANDED</a>)</div>
<div class="line"><a id="l01335" name="l01335"></a><span class="lineno"> 1335</span>            dShadowWaveAngle = dWaveAngle + dDeltaShadowWaveAngle;</div>
<div class="line"><a id="l01336" name="l01336"></a><span class="lineno"> 1336</span> </div>
<div class="line"><a id="l01337" name="l01337"></a><span class="lineno"> 1337</span>         <span class="keywordflow">else</span></div>
<div class="line"><a id="l01338" name="l01338"></a><span class="lineno"> 1338</span>            dShadowWaveAngle = dWaveAngle - dDeltaShadowWaveAngle;</div>
<div class="line"><a id="l01339" name="l01339"></a><span class="lineno"> 1339</span> </div>
<div class="line"><a id="l01340" name="l01340"></a><span class="lineno"> 1340</span>         <span class="comment">// Set the shadow zone wave orientation</span></div>
<div class="line"><a id="l01341" name="l01341"></a><span class="lineno"> 1341</span>         <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nX][nY].SetWaveAngle(<a class="code hl_function" href="../../d1/d98/classCSimulation.html#a425803ba4110668094dba54c0f9b91c8">dKeepWithin360</a>(dShadowWaveAngle));</div>
<div class="line"><a id="l01342" name="l01342"></a><span class="lineno"> 1342</span> </div>
<div class="line"><a id="l01343" name="l01343"></a><span class="lineno"> 1343</span>         <span class="comment">// Now calculate wave height within the shadow zone, use equation 13 from Hurst et al.</span></div>
<div class="line"><a id="l01344" name="l01344"></a><span class="lineno"> 1344</span>         <span class="keywordtype">double</span> <span class="keyword">const</span> dKp = 0.5 * cos(dOmega * <a class="code hl_variable" href="../../d6/d2a/cme_8h.html#a5d502a06fdd71825be49e07c95496b16">PI</a> / 180);</div>
<div class="line"><a id="l01345" name="l01345"></a><span class="lineno"> 1345</span> </div>
<div class="line"><a id="l01346" name="l01346"></a><span class="lineno"> 1346</span>         <span class="comment">// Get the pre-existing (i.e. shore-parallel) wave height</span></div>
<div class="line"><a id="l01347" name="l01347"></a><span class="lineno"> 1347</span>         <span class="keywordtype">double</span> <span class="keyword">const</span> dWaveHeight = <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nX][nY].dGetWaveHeight();</div>
<div class="line"><a id="l01348" name="l01348"></a><span class="lineno"> 1348</span> </div>
<div class="line"><a id="l01349" name="l01349"></a><span class="lineno"> 1349</span>         <span class="comment">// Set the shadow zone wave height</span></div>
<div class="line"><a id="l01350" name="l01350"></a><span class="lineno"> 1350</span>         <a class="code hl_variable" href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">m_pRasterGrid</a>-&gt;m_Cell[nX][nY].SetWaveHeight(dKp * dWaveHeight);</div>
<div class="line"><a id="l01351" name="l01351"></a><span class="lineno"> 1351</span> </div>
<div class="line"><a id="l01352" name="l01352"></a><span class="lineno"> 1352</span>         <span class="comment">// LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: on shadow linking line with coast end [&quot; &lt;&lt; pPtiCoast-&gt;nGetX() &lt;&lt; &quot;][&quot; &lt;&lt; pPtiCoast-&gt;nGetY() &lt;&lt; &quot;] = {&quot; &lt;&lt; dGridCentroidXToExtCRSX(pPtiCoast-&gt;nGetX()) &lt;&lt; &quot;, &quot; &lt;&lt; dGridCentroidYToExtCRSY(pPtiCoast-&gt;nGetY()) &lt;&lt; &quot;} and shadow boundary end [&quot; &lt;&lt; PtiShadowBoundary.nGetX() &lt;&lt; &quot;][&quot; &lt;&lt; PtiShadowBoundary.nGetY() &lt;&lt; &quot;] = {&quot; &lt;&lt; dGridCentroidXToExtCRSX(PtiShadowBoundary.nGetX()) &lt;&lt; &quot;, &quot; &lt;&lt; dGridCentroidYToExtCRSY(PtiShadowBoundary.nGetY()) &lt;&lt; &quot;}, this point [&quot; &lt;&lt; nX &lt;&lt; &quot;][&quot; &lt;&lt; nY &lt;&lt; &quot;] = {&quot; &lt;&lt; dGridCentroidXToExtCRSX(nX) &lt;&lt; &quot;, &quot; &lt;&lt; dGridCentroidYToExtCRSY(nY) &lt;&lt; &quot;}, angle subtended = &quot; &lt;&lt; dOmega &lt;&lt; &quot; degrees, m_pRasterGrid-&gt;m_Cell[&quot; &lt;&lt; nX &lt;&lt; &quot;][&quot; &lt;&lt; nY &lt;&lt; &quot;].dGetCellDeepWaterWaveHeight() = &quot; &lt;&lt; m_pRasterGrid-&gt;m_Cell[nX][nY].dGetCellDeepWaterWaveHeight() &lt;&lt; &quot; m, dDeltaShadowWaveAngle = &quot; &lt;&lt; dDeltaShadowWaveAngle &lt;&lt; &quot; degrees, dWaveAngle = &quot; &lt;&lt; dWaveAngle &lt;&lt; &quot; degrees, dShadowWaveAngle = &quot; &lt;&lt; dShadowWaveAngle &lt;&lt; &quot; degrees, dWaveHeight = &quot; &lt;&lt; dWaveHeight &lt;&lt; &quot; m, dKp = &quot; &lt;&lt; dKp &lt;&lt; &quot;, shadow zone wave height = &quot; &lt;&lt; dKp * dWaveHeight &lt;&lt; &quot; m&quot; &lt;&lt; endl;</span></div>
<div class="line"><a id="l01353" name="l01353"></a><span class="lineno"> 1353</span>      }</div>
<div class="line"><a id="l01354" name="l01354"></a><span class="lineno"> 1354</span>   }</div>
<div class="line"><a id="l01355" name="l01355"></a><span class="lineno"> 1355</span>}</div>
</div>
<div class="ttc" id="a2d__point_8h_html"><div class="ttname"><a href="../../d0/dee/2d__point_8h.html">2d_point.h</a></div><div class="ttdoc">Contains CGeom2DPoint definitions.</div></div>
<div class="ttc" id="a2di__point_8h_html"><div class="ttname"><a href="../../d2/d66/2di__point_8h.html">2di_point.h</a></div><div class="ttdoc">Contains CGeom2DIPoint definitions.</div></div>
<div class="ttc" id="aclassCA2DIShape_html_a704d22f3d9c5b553861947c6500e6fb7"><div class="ttname"><a href="../../d2/d0f/classCA2DIShape.html#a704d22f3d9c5b553861947c6500e6fb7">CA2DIShape::Back</a></div><div class="ttdeci">CGeom2DIPoint &amp; Back(void)</div><div class="ttdoc">Returns the last integer point from the vector which represents this 2D shape.</div><div class="ttdef"><b>Definition</b> <a href="../../da/d9e/2di__shape_8cpp_source.html#l00045">2di_shape.cpp:45</a></div></div>
<div class="ttc" id="aclassCA2DIShape_html_a9d97e2e53a6e13b56664cced2d6e4f6a"><div class="ttname"><a href="../../d2/d0f/classCA2DIShape.html#a9d97e2e53a6e13b56664cced2d6e4f6a">CA2DIShape::AppendIfNotAlready</a></div><div class="ttdeci">void AppendIfNotAlready(int const, int const)</div><div class="ttdoc">Appends a new integer point to the vector which represents this 2D shape, but only if the point is no...</div><div class="ttdef"><b>Definition</b> <a href="../../da/d9e/2di__shape_8cpp_source.html#l00092">2di_shape.cpp:92</a></div></div>
<div class="ttc" id="aclassCA2DIShape_html_ab181578766d0cacb30c7ad0d695bf595"><div class="ttname"><a href="../../d2/d0f/classCA2DIShape.html#ab181578766d0cacb30c7ad0d695bf595">CA2DIShape::Append</a></div><div class="ttdeci">void Append(CGeom2DIPoint const *)</div><div class="ttdoc">Appends a new integer point to the vector which represents this 2D shape.</div><div class="ttdef"><b>Definition</b> <a href="../../da/d9e/2di__shape_8cpp_source.html#l00080">2di_shape.cpp:80</a></div></div>
<div class="ttc" id="aclassCA2DIShape_html_ae149d229c6313db4f4435fa104f40a90"><div class="ttname"><a href="../../d2/d0f/classCA2DIShape.html#ae149d229c6313db4f4435fa104f40a90">CA2DIShape::pPtiVGetPoints</a></div><div class="ttdeci">vector&lt; CGeom2DIPoint &gt; * pPtiVGetPoints(void)</div><div class="ttdoc">Returns the address of the vector which represents this 2D shape.</div><div class="ttdef"><b>Definition</b> <a href="../../da/d9e/2di__shape_8cpp_source.html#l00051">2di_shape.cpp:51</a></div></div>
<div class="ttc" id="aclassCA2DShape_html_a089f43fb767f120e2bffbfc40b8dc0ac"><div class="ttname"><a href="../../d9/d0e/classCA2DShape.html#a089f43fb767f120e2bffbfc40b8dc0ac">CA2DShape::Append</a></div><div class="ttdeci">void Append(CGeom2DPoint const *)</div><div class="ttdoc">Appends a point to this 2D shape.</div><div class="ttdef"><b>Definition</b> <a href="../../da/dfd/2d__shape_8cpp_source.html#l00067">2d_shape.cpp:67</a></div></div>
<div class="ttc" id="aclassCA2DShape_html_a54eb0a2ab77aa22b8d1af5f8f1f40383"><div class="ttname"><a href="../../d9/d0e/classCA2DShape.html#a54eb0a2ab77aa22b8d1af5f8f1f40383">CA2DShape::Reverse</a></div><div class="ttdeci">void Reverse(void)</div><div class="ttdoc">Reverses the sequence of points in the vector which represents this 2D polygon.</div><div class="ttdef"><b>Definition</b> <a href="../../da/dfd/2d__shape_8cpp_source.html#l00166">2d_shape.cpp:166</a></div></div>
<div class="ttc" id="aclassCA2DShape_html_a7f8d2942affd69f8de65e36f9c6acd3c"><div class="ttname"><a href="../../d9/d0e/classCA2DShape.html#a7f8d2942affd69f8de65e36f9c6acd3c">CA2DShape::pPtBack</a></div><div class="ttdeci">CGeom2DPoint * pPtBack(void)</div><div class="ttdoc">Returns the last element of this 2D shape.</div><div class="ttdef"><b>Definition</b> <a href="../../da/dfd/2d__shape_8cpp_source.html#l00091">2d_shape.cpp:91</a></div></div>
<div class="ttc" id="aclassCA2DShape_html_aaa15397a5761d17635afdaddbec35c8a"><div class="ttname"><a href="../../d9/d0e/classCA2DShape.html#aaa15397a5761d17635afdaddbec35c8a">CA2DShape::AppendIfNotAlready</a></div><div class="ttdeci">void AppendIfNotAlready(double const, double const)</div><div class="ttdoc">Appends a point to this 2D shape only if it isn&#39;t already in the shape vector.</div><div class="ttdef"><b>Definition</b> <a href="../../da/dfd/2d__shape_8cpp_source.html#l00079">2d_shape.cpp:79</a></div></div>
<div class="ttc" id="aclassCA2DShape_html_ac220b8554a95ebe15b345ef2bd04177b"><div class="ttname"><a href="../../d9/d0e/classCA2DShape.html#ac220b8554a95ebe15b345ef2bd04177b">CA2DShape::nGetSize</a></div><div class="ttdeci">int nGetSize(void) const</div><div class="ttdef"><b>Definition</b> <a href="../../da/dfd/2d__shape_8cpp_source.html#l00056">2d_shape.cpp:56</a></div></div>
<div class="ttc" id="aclassCGeom2DIPoint_html"><div class="ttname"><a href="../../d6/d0d/classCGeom2DIPoint.html">CGeom2DIPoint</a></div><div class="ttdoc">Geometry class used to represent 2D point objects with integer coordinates.</div><div class="ttdef"><b>Definition</b> <a href="../../d2/d66/2di__point_8h_source.html#l00028">2di_point.h:29</a></div></div>
<div class="ttc" id="aclassCGeom2DIPoint_html_a4350a3410e098a2cb27fbeaa6b12b5e5"><div class="ttname"><a href="../../d6/d0d/classCGeom2DIPoint.html#a4350a3410e098a2cb27fbeaa6b12b5e5">CGeom2DIPoint::SetY</a></div><div class="ttdeci">void SetY(int const)</div><div class="ttdoc">The integer parameter sets a value for the CGeom2DIPoint object&#39;s Y coordinate.</div><div class="ttdef"><b>Definition</b> <a href="../../d8/dc5/2di__point_8cpp_source.html#l00079">2di_point.cpp:79</a></div></div>
<div class="ttc" id="aclassCGeom2DIPoint_html_a4d9c20bcca90dcb9d519b664aba09cbd"><div class="ttname"><a href="../../d6/d0d/classCGeom2DIPoint.html#a4d9c20bcca90dcb9d519b664aba09cbd">CGeom2DIPoint::nGetY</a></div><div class="ttdeci">int nGetY(void) const</div><div class="ttdoc">Returns the CGeom2DIPoint object&#39;s integer Y coordinate.</div><div class="ttdef"><b>Definition</b> <a href="../../d8/dc5/2di__point_8cpp_source.html#l00055">2di_point.cpp:55</a></div></div>
<div class="ttc" id="aclassCGeom2DIPoint_html_a84c27fdfdfca1e5222a141717ab8f6e4"><div class="ttname"><a href="../../d6/d0d/classCGeom2DIPoint.html#a84c27fdfdfca1e5222a141717ab8f6e4">CGeom2DIPoint::SetX</a></div><div class="ttdeci">void SetX(int const)</div><div class="ttdoc">The integer parameter sets a value for the CGeom2DIPoint object&#39;s X coordinate.</div><div class="ttdef"><b>Definition</b> <a href="../../d8/dc5/2di__point_8cpp_source.html#l00073">2di_point.cpp:73</a></div></div>
<div class="ttc" id="aclassCGeom2DIPoint_html_af84c687b2d0be01ab41cbcc0565f4f3f"><div class="ttname"><a href="../../d6/d0d/classCGeom2DIPoint.html#af84c687b2d0be01ab41cbcc0565f4f3f">CGeom2DIPoint::nGetX</a></div><div class="ttdeci">int nGetX(void) const</div><div class="ttdoc">Returns the CGeom2DIPoint object&#39;s integer X coordinate.</div><div class="ttdef"><b>Definition</b> <a href="../../d8/dc5/2di__point_8cpp_source.html#l00049">2di_point.cpp:49</a></div></div>
<div class="ttc" id="aclassCGeom2DPoint_html"><div class="ttname"><a href="../../d5/d4e/classCGeom2DPoint.html">CGeom2DPoint</a></div><div class="ttdoc">Geometry class used to represent 2D point objects with floating-point coordinates.</div><div class="ttdef"><b>Definition</b> <a href="../../d0/dee/2d__point_8h_source.html#l00026">2d_point.h:27</a></div></div>
<div class="ttc" id="aclassCGeomILine_html"><div class="ttname"><a href="../../dd/dc1/classCGeomILine.html">CGeomILine</a></div><div class="ttdoc">Geometry class used to represent 2D vector integer line objects.</div><div class="ttdef"><b>Definition</b> <a href="../../da/d11/i__line_8h_source.html#l00030">i_line.h:31</a></div></div>
<div class="ttc" id="aclassCGeomILine_html_a5129fc96323c094fe52487ad428ce546"><div class="ttname"><a href="../../dd/dc1/classCGeomILine.html#a5129fc96323c094fe52487ad428ce546">CGeomILine::bIsPresent</a></div><div class="ttdeci">bool bIsPresent(int const, int const)</div><div class="ttdoc">Returns true if the point is present in the line.</div><div class="ttdef"><b>Definition</b> <a href="../../d4/d83/i__line_8cpp_source.html#l00068">i_line.cpp:68</a></div></div>
<div class="ttc" id="aclassCGeomLine_html"><div class="ttname"><a href="../../d7/dd3/classCGeomLine.html">CGeomLine</a></div><div class="ttdoc">Geometry class used to represent 2D vector line objects.</div><div class="ttdef"><b>Definition</b> <a href="../../d7/d5d/line_8h_source.html#l00031">line.h:32</a></div></div>
<div class="ttc" id="aclassCSimulation_html_a0245d3cbdd603fbeced6ca1465eb3f16"><div class="ttname"><a href="../../d1/d98/classCSimulation.html#a0245d3cbdd603fbeced6ca1465eb3f16">CSimulation::m_nLogFileDetail</a></div><div class="ttdeci">int m_nLogFileDetail</div><div class="ttdoc">The level of detail in the log file output. Can be LOG_FILE_LOW_DETAIL, LOG_FILE_MIDDLE_DETAIL,...</div><div class="ttdef"><b>Definition</b> <a href="../../dd/d6a/simulation_8h_source.html#l00570">simulation.h:570</a></div></div>
<div class="ttc" id="aclassCSimulation_html_a1312f0ac2c93a6cb2bc41c23eb01c293"><div class="ttname"><a href="../../d1/d98/classCSimulation.html#a1312f0ac2c93a6cb2bc41c23eb01c293">CSimulation::m_pRasterGrid</a></div><div class="ttdeci">CGeomRasterGrid * m_pRasterGrid</div><div class="ttdoc">Pointer to the raster grid object.</div><div class="ttdef"><b>Definition</b> <a href="../../dd/d6a/simulation_8h_source.html#l01534">simulation.h:1534</a></div></div>
<div class="ttc" id="aclassCSimulation_html_a1652253500dab35e6f6f9f734207e20b"><div class="ttname"><a href="../../d1/d98/classCSimulation.html#a1652253500dab35e6f6f9f734207e20b">CSimulation::m_nXGridSize</a></div><div class="ttdeci">int m_nXGridSize</div><div class="ttdoc">The size of the grid in the x direction.</div><div class="ttdef"><b>Definition</b> <a href="../../dd/d6a/simulation_8h_source.html#l00456">simulation.h:456</a></div></div>
<div class="ttc" id="aclassCSimulation_html_a190ca0d855be5530fa013c468a868393"><div class="ttname"><a href="../../d1/d98/classCSimulation.html#a190ca0d855be5530fa013c468a868393">CSimulation::nFloodFillShadowZone</a></div><div class="ttdeci">int nFloodFillShadowZone(int const, CGeom2DIPoint const *, CGeom2DIPoint const *, CGeom2DIPoint const *)</div><div class="ttdoc">Cell-by-cell fills a shadow zone from the centroid.</div><div class="ttdef"><b>Definition</b> <a href="#l00685">calc_shadow_zones.cpp:685</a></div></div>
<div class="ttc" id="aclassCSimulation_html_a222962121613613a48f518e0c2110f21"><div class="ttname"><a href="../../d1/d98/classCSimulation.html#a222962121613613a48f518e0c2110f21">CSimulation::LogStream</a></div><div class="ttdeci">ofstream LogStream</div><div class="ttdef"><b>Definition</b> <a href="../../dd/d6a/simulation_8h_source.html#l01853">simulation.h:1853</a></div></div>
<div class="ttc" id="aclassCSimulation_html_a25ada8139c82ca7beab3f279cff83184"><div class="ttname"><a href="../../d1/d98/classCSimulation.html#a25ada8139c82ca7beab3f279cff83184">CSimulation::m_VCoast</a></div><div class="ttdeci">vector&lt; CRWCoast &gt; m_VCoast</div><div class="ttdoc">The coastline objects.</div><div class="ttdef"><b>Definition</b> <a href="../../dd/d6a/simulation_8h_source.html#l01537">simulation.h:1537</a></div></div>
<div class="ttc" id="aclassCSimulation_html_a3755fdc07c0ac9f2ce6c2237cfef50ce"><div class="ttname"><a href="../../d1/d98/classCSimulation.html#a3755fdc07c0ac9f2ce6c2237cfef50ce">CSimulation::m_nYGridSize</a></div><div class="ttdeci">int m_nYGridSize</div><div class="ttdoc">The size of the grid in the y direction.</div><div class="ttdef"><b>Definition</b> <a href="../../dd/d6a/simulation_8h_source.html#l00459">simulation.h:459</a></div></div>
<div class="ttc" id="aclassCSimulation_html_a3d8b585c586578b5227d9e95c10eba6a"><div class="ttname"><a href="../../d1/d98/classCSimulation.html#a3d8b585c586578b5227d9e95c10eba6a">CSimulation::PtiGetPerpendicular</a></div><div class="ttdeci">static CGeom2DIPoint PtiGetPerpendicular(CGeom2DIPoint const *, CGeom2DIPoint const *, double const, int const)</div><div class="ttdoc">Returns a CGeom2DIPoint (grid CRS) which is the &#39;other&#39; point of a two-point vector passing through P...</div><div class="ttdef"><b>Definition</b> <a href="../../db/df7/gis__utils_8cpp_source.html#l00621">gis_utils.cpp:621</a></div></div>
<div class="ttc" id="aclassCSimulation_html_a3ec4fa2a5d2c77b776dcc0d53b748bb8"><div class="ttname"><a href="../../d1/d98/classCSimulation.html#a3ec4fa2a5d2c77b776dcc0d53b748bb8">CSimulation::ProcessShadowZoneCell</a></div><div class="ttdeci">void ProcessShadowZoneCell(int const, int const, int const, CGeom2DIPoint const *, int const, int const, int const)</div><div class="ttdoc">Process a single cell which is in the shadow zone, changing its wave height and orientation.</div><div class="ttdef"><b>Definition</b> <a href="#l01301">calc_shadow_zones.cpp:1301</a></div></div>
<div class="ttc" id="aclassCSimulation_html_a407e01ecfd7c564c74f4474216ce2e16"><div class="ttname"><a href="../../d1/d98/classCSimulation.html#a407e01ecfd7c564c74f4474216ce2e16">CSimulation::dGetDistanceBetween</a></div><div class="ttdeci">static double dGetDistanceBetween(CGeom2DPoint const *, CGeom2DPoint const *)</div><div class="ttdoc">Returns the distance (in external CRS) between two points.</div><div class="ttdef"><b>Definition</b> <a href="../../db/df7/gis__utils_8cpp_source.html#l00145">gis_utils.cpp:145</a></div></div>
<div class="ttc" id="aclassCSimulation_html_a4183ba0c6f5e8376ead62d0ded3e4c73"><div class="ttname"><a href="../../d1/d98/classCSimulation.html#a4183ba0c6f5e8376ead62d0ded3e4c73">CSimulation::nDoAllShadowZones</a></div><div class="ttdeci">int nDoAllShadowZones(void)</div><div class="ttdoc">Finds wave shadow zones and modifies waves in and near them. Note that where up-coast and down-coast ...</div><div class="ttdef"><b>Definition</b> <a href="#l00141">calc_shadow_zones.cpp:141</a></div></div>
<div class="ttc" id="aclassCSimulation_html_a425803ba4110668094dba54c0f9b91c8"><div class="ttname"><a href="../../d1/d98/classCSimulation.html#a425803ba4110668094dba54c0f9b91c8">CSimulation::dKeepWithin360</a></div><div class="ttdeci">static double dKeepWithin360(double const)</div><div class="ttdoc">Constrains the supplied angle to be within 0 and 360 degrees.</div><div class="ttdef"><b>Definition</b> <a href="../../db/df7/gis__utils_8cpp_source.html#l00393">gis_utils.cpp:393</a></div></div>
<div class="ttc" id="aclassCSimulation_html_a7e2a4bd69ce79377fee86aa5598903f8"><div class="ttname"><a href="../../d1/d98/classCSimulation.html#a7e2a4bd69ce79377fee86aa5598903f8">CSimulation::dGridCentroidYToExtCRSY</a></div><div class="ttdeci">double dGridCentroidYToExtCRSY(int const) const</div><div class="ttdoc">Given the integer Y-axis ordinate of a cell in the raster grid CRS, returns the external CRS Y-axis o...</div><div class="ttdef"><b>Definition</b> <a href="../../db/df7/gis__utils_8cpp_source.html#l00076">gis_utils.cpp:76</a></div></div>
<div class="ttc" id="aclassCSimulation_html_a84d43443a65822540eafb0a23b9ae99c"><div class="ttname"><a href="../../d1/d98/classCSimulation.html#a84d43443a65822540eafb0a23b9ae99c">CSimulation::bOnOrOffShoreAndUpOrDownCoast</a></div><div class="ttdeci">static bool bOnOrOffShoreAndUpOrDownCoast(double const, double const, int const, bool &amp;)</div><div class="ttdoc">Determines whether the wave orientation at this point on a coast is onshore or offshore,...</div><div class="ttdef"><b>Definition</b> <a href="#l00050">calc_shadow_zones.cpp:50</a></div></div>
<div class="ttc" id="aclassCSimulation_html_a9941423d85fd30f67adf5870c97da675"><div class="ttname"><a href="../../d1/d98/classCSimulation.html#a9941423d85fd30f67adf5870c97da675">CSimulation::PtiFollowWaveAngle</a></div><div class="ttdeci">static CGeom2DIPoint PtiFollowWaveAngle(CGeom2DIPoint const *, double const, double &amp;)</div><div class="ttdoc">Given a cell and a wave orientation, finds the &#39;upwave&#39; cell.</div><div class="ttdef"><b>Definition</b> <a href="#l00074">calc_shadow_zones.cpp:74</a></div></div>
<div class="ttc" id="aclassCSimulation_html_a9ca0040fbbf23a491d21d5248ab0eb77"><div class="ttname"><a href="../../d1/d98/classCSimulation.html#a9ca0040fbbf23a491d21d5248ab0eb77">CSimulation::dAngleSubtended</a></div><div class="ttdeci">static double dAngleSubtended(CGeom2DIPoint const *, CGeom2DIPoint const *, CGeom2DIPoint const *)</div><div class="ttdoc">Returns the signed angle BAC (in radians) subtended between three CGeom2DIPoints B A C....</div><div class="ttdef"><b>Definition</b> <a href="../../db/df7/gis__utils_8cpp_source.html#l00697">gis_utils.cpp:697</a></div></div>
<div class="ttc" id="aclassCSimulation_html_a9fbe52d4e0f26ad432f12b7154c599e4"><div class="ttname"><a href="../../d1/d98/classCSimulation.html#a9fbe52d4e0f26ad432f12b7154c599e4">CSimulation::dExtCRSXToGridX</a></div><div class="ttdeci">double dExtCRSXToGridX(double const) const</div><div class="ttdoc">Transforms an X-axis ordinate in the external CRS to the equivalent X-axis ordinate in the raster gri...</div><div class="ttdef"><b>Definition</b> <a href="../../db/df7/gis__utils_8cpp_source.html#l00115">gis_utils.cpp:115</a></div></div>
<div class="ttc" id="aclassCSimulation_html_aab00c3ffdc6a62988fc500ca1d4eac9b"><div class="ttname"><a href="../../d1/d98/classCSimulation.html#aab00c3ffdc6a62988fc500ca1d4eac9b">CSimulation::PtiWeightedAverage</a></div><div class="ttdeci">static CGeom2DIPoint PtiWeightedAverage(CGeom2DIPoint const *, CGeom2DIPoint const *, double const)</div><div class="ttdoc">Returns an integer point (grid CRS) which is the weighted average of two other grid CRS integer point...</div><div class="ttdef"><b>Definition</b> <a href="../../db/df7/gis__utils_8cpp_source.html#l00441">gis_utils.cpp:441</a></div></div>
<div class="ttc" id="aclassCSimulation_html_ac2e7e204d9e9b527d0a4c941f2e525ad"><div class="ttname"><a href="../../d1/d98/classCSimulation.html#ac2e7e204d9e9b527d0a4c941f2e525ad">CSimulation::dExtCRSYToGridY</a></div><div class="ttdeci">double dExtCRSYToGridY(double const) const</div><div class="ttdoc">Transforms a Y-axis ordinate in the external CRS to the equivalent Y-axis ordinate in the raster grid...</div><div class="ttdef"><b>Definition</b> <a href="../../db/df7/gis__utils_8cpp_source.html#l00124">gis_utils.cpp:124</a></div></div>
<div class="ttc" id="aclassCSimulation_html_ac900a5701df97da22278fae928951f50"><div class="ttname"><a href="../../d1/d98/classCSimulation.html#ac900a5701df97da22278fae928951f50">CSimulation::bIsWithinValidGrid</a></div><div class="ttdeci">bool bIsWithinValidGrid(int const, int const) const</div><div class="ttdoc">Checks whether the supplied point (an x-y pair, in the grid CRS) is within the raster grid,...</div><div class="ttdef"><b>Definition</b> <a href="../../db/df7/gis__utils_8cpp_source.html#l00186">gis_utils.cpp:186</a></div></div>
<div class="ttc" id="aclassCSimulation_html_ad0916f582b3252101f9dbd6445d43c80"><div class="ttname"><a href="../../d1/d98/classCSimulation.html#ad0916f582b3252101f9dbd6445d43c80">CSimulation::DoShadowZoneAndDownDriftZone</a></div><div class="ttdeci">void DoShadowZoneAndDownDriftZone(int const, int const, int const, int const)</div><div class="ttdoc">Traverse the shadow zone, changing wave orientation and height, and the down-drift zone,...</div><div class="ttdef"><b>Definition</b> <a href="#l00812">calc_shadow_zones.cpp:812</a></div></div>
<div class="ttc" id="aclassCSimulation_html_ad67e8c5b30a0572f64ecfb5c062c2edc"><div class="ttname"><a href="../../d1/d98/classCSimulation.html#ad67e8c5b30a0572f64ecfb5c062c2edc">CSimulation::m_ulIter</a></div><div class="ttdeci">unsigned long m_ulIter</div><div class="ttdoc">The number of the current iteration (time step)</div><div class="ttdef"><b>Definition</b> <a href="../../dd/d6a/simulation_8h_source.html#l00594">simulation.h:594</a></div></div>
<div class="ttc" id="aclassCSimulation_html_ad79b925ac5f358c6f867b6e47dad74bd"><div class="ttname"><a href="../../d1/d98/classCSimulation.html#ad79b925ac5f358c6f867b6e47dad74bd">CSimulation::dGridCentroidXToExtCRSX</a></div><div class="ttdeci">double dGridCentroidXToExtCRSX(int const) const</div><div class="ttdoc">Given the integer X-axis ordinate of a cell in the raster grid CRS, returns the external CRS X-axis o...</div><div class="ttdef"><b>Definition</b> <a href="../../db/df7/gis__utils_8cpp_source.html#l00067">gis_utils.cpp:67</a></div></div>
<div class="ttc" id="aclassCSimulation_html_adf8e75ca379e22f9b98c956e3a7fc8e8"><div class="ttname"><a href="../../d1/d98/classCSimulation.html#adf8e75ca379e22f9b98c956e3a7fc8e8">CSimulation::ProcessDownDriftCell</a></div><div class="ttdeci">void ProcessDownDriftCell(int const, int const, int const, double const, int const)</div><div class="ttdoc">Process a single cell which is in the downdrift zone, changing its wave height.</div><div class="ttdef"><b>Definition</b> <a href="#l01244">calc_shadow_zones.cpp:1244</a></div></div>
<div class="ttc" id="aclassCSimulation_html_ae0de69c3d3acd6d52dc2ec2f456c0eb5"><div class="ttname"><a href="../../d1/d98/classCSimulation.html#ae0de69c3d3acd6d52dc2ec2f456c0eb5">CSimulation::m_dCellSide</a></div><div class="ttdeci">double m_dCellSide</div><div class="ttdoc">Length of a cell side (in external CRS units)</div><div class="ttdef"><b>Definition</b> <a href="../../dd/d6a/simulation_8h_source.html#l00654">simulation.h:654</a></div></div>
<div class="ttc" id="aclassCSimulation_html_af41bf8d03921360b6bfc27a14ae7afd2"><div class="ttname"><a href="../../d1/d98/classCSimulation.html#af41bf8d03921360b6bfc27a14ae7afd2">CSimulation::PtiPolygonCentroid</a></div><div class="ttdeci">static CGeom2DIPoint PtiPolygonCentroid(vector&lt; CGeom2DIPoint &gt; *)</div><div class="ttdoc">Returns an integer point (grid CRS) which is the centroid of a polygon, given by a vector of grid CRS...</div><div class="ttdef"><b>Definition</b> <a href="../../db/df7/gis__utils_8cpp_source.html#l00507">gis_utils.cpp:507</a></div></div>
<div class="ttc" id="acme_8h_html"><div class="ttname"><a href="../../d6/d2a/cme_8h.html">cme.h</a></div><div class="ttdoc">This file contains global definitions for CoastalME.</div></div>
<div class="ttc" id="acme_8h_html_a01aa8b423260b337ddff2016107b51a0"><div class="ttname"><a href="../../d6/d2a/cme_8h.html#a01aa8b423260b337ddff2016107b51a0">INT_NODATA</a></div><div class="ttdeci">int const INT_NODATA</div><div class="ttdef"><b>Definition</b> <a href="../../d6/d2a/cme_8h_source.html#l00368">cme.h:368</a></div></div>
<div class="ttc" id="acme_8h_html_a052095c3f746a887244b9818d181696c"><div class="ttname"><a href="../../d6/d2a/cme_8h.html#a052095c3f746a887244b9818d181696c">MAX_LEN_SHADOW_LINE_TO_IGNORE</a></div><div class="ttdeci">int const MAX_LEN_SHADOW_LINE_TO_IGNORE</div><div class="ttdef"><b>Definition</b> <a href="../../d6/d2a/cme_8h_source.html#l00371">cme.h:371</a></div></div>
<div class="ttc" id="acme_8h_html_a068017859403c0629d89f8d348f6c224"><div class="ttname"><a href="../../d6/d2a/cme_8h.html#a068017859403c0629d89f8d348f6c224">tMin</a></div><div class="ttdeci">T tMin(T a, T b)</div><div class="ttdef"><b>Definition</b> <a href="../../d6/d2a/cme_8h_source.html#l01156">cme.h:1156</a></div></div>
<div class="ttc" id="acme_8h_html_a08b1623863ee3bd4300a8892de323722"><div class="ttname"><a href="../../d6/d2a/cme_8h.html#a08b1623863ee3bd4300a8892de323722">TOLERANCE</a></div><div class="ttdeci">double const TOLERANCE</div><div class="ttdef"><b>Definition</b> <a href="../../d6/d2a/cme_8h_source.html#l00723">cme.h:723</a></div></div>
<div class="ttc" id="acme_8h_html_a292fc90846543ca4814daa9f759feb05"><div class="ttname"><a href="../../d6/d2a/cme_8h.html#a292fc90846543ca4814daa9f759feb05">ERR</a></div><div class="ttdeci">string const ERR</div><div class="ttdef"><b>Definition</b> <a href="../../d6/d2a/cme_8h_source.html#l00801">cme.h:801</a></div></div>
<div class="ttc" id="acme_8h_html_a2f39c393cbe19710d077797fdf2a843d"><div class="ttname"><a href="../../d6/d2a/cme_8h.html#a2f39c393cbe19710d077797fdf2a843d">CREATE_SHADOW_ZONE_IF_HITS_GRID_EDGE</a></div><div class="ttdeci">bool const CREATE_SHADOW_ZONE_IF_HITS_GRID_EDGE</div><div class="ttdef"><b>Definition</b> <a href="../../d6/d2a/cme_8h_source.html#l00350">cme.h:350</a></div></div>
<div class="ttc" id="acme_8h_html_a368ba64a15504bd62f1711a5d11d78a6"><div class="ttname"><a href="../../d6/d2a/cme_8h.html#a368ba64a15504bd62f1711a5d11d78a6">RTN_ERR_SHADOW_ZONE_FLOOD_START_POINT</a></div><div class="ttdeci">int const RTN_ERR_SHADOW_ZONE_FLOOD_START_POINT</div><div class="ttdef"><b>Definition</b> <a href="../../d6/d2a/cme_8h_source.html#l00638">cme.h:638</a></div></div>
<div class="ttc" id="acme_8h_html_a44a80b23b966b8f1aa8a620bceb50b2b"><div class="ttname"><a href="../../d6/d2a/cme_8h.html#a44a80b23b966b8f1aa8a620bceb50b2b">MAX_NUM_PREV_ORIENTATION_VALUES</a></div><div class="ttdeci">int const MAX_NUM_PREV_ORIENTATION_VALUES</div><div class="ttdef"><b>Definition</b> <a href="../../d6/d2a/cme_8h_source.html#l00372">cme.h:372</a></div></div>
<div class="ttc" id="acme_8h_html_a4c7934393517cd814fe5ead496fa15b9"><div class="ttname"><a href="../../d6/d2a/cme_8h.html#a4c7934393517cd814fe5ead496fa15b9">RTN_ERR_SHADOW_ZONE_FLOOD_FILL_NOGRID</a></div><div class="ttdeci">int const RTN_ERR_SHADOW_ZONE_FLOOD_FILL_NOGRID</div><div class="ttdef"><b>Definition</b> <a href="../../d6/d2a/cme_8h_source.html#l00637">cme.h:637</a></div></div>
<div class="ttc" id="acme_8h_html_a540d8a94fc09b0b14fd8ab657445b67a"><div class="ttname"><a href="../../d6/d2a/cme_8h.html#a540d8a94fc09b0b14fd8ab657445b67a">LOG_FILE_MIDDLE_DETAIL</a></div><div class="ttdeci">int const LOG_FILE_MIDDLE_DETAIL</div><div class="ttdef"><b>Definition</b> <a href="../../d6/d2a/cme_8h_source.html#l00383">cme.h:383</a></div></div>
<div class="ttc" id="acme_8h_html_a5d502a06fdd71825be49e07c95496b16"><div class="ttname"><a href="../../d6/d2a/cme_8h.html#a5d502a06fdd71825be49e07c95496b16">PI</a></div><div class="ttdeci">double const PI</div><div class="ttdef"><b>Definition</b> <a href="../../d6/d2a/cme_8h_source.html#l00705">cme.h:705</a></div></div>
<div class="ttc" id="acme_8h_html_a61afa8560a3b39c80657661a1d8f76ab"><div class="ttname"><a href="../../d6/d2a/cme_8h.html#a61afa8560a3b39c80657661a1d8f76ab">bFPIsEqual</a></div><div class="ttdeci">bool bFPIsEqual(const T d1, const T d2, const T dEpsilon)</div><div class="ttdef"><b>Definition</b> <a href="../../d6/d2a/cme_8h_source.html#l01194">cme.h:1194</a></div></div>
<div class="ttc" id="acme_8h_html_a7e895b460cef877dec4d12ead0c74f15"><div class="ttname"><a href="../../d6/d2a/cme_8h.html#a7e895b460cef877dec4d12ead0c74f15">tMax</a></div><div class="ttdeci">T tMax(T a, T b)</div><div class="ttdef"><b>Definition</b> <a href="../../d6/d2a/cme_8h_source.html#l01143">cme.h:1143</a></div></div>
<div class="ttc" id="acme_8h_html_a85da1142fa4655ec66f1e391444a6d9a"><div class="ttname"><a href="../../d6/d2a/cme_8h.html#a85da1142fa4655ec66f1e391444a6d9a">LOG_FILE_HIGH_DETAIL</a></div><div class="ttdeci">int const LOG_FILE_HIGH_DETAIL</div><div class="ttdef"><b>Definition</b> <a href="../../d6/d2a/cme_8h_source.html#l00384">cme.h:384</a></div></div>
<div class="ttc" id="acme_8h_html_a93ac0c692cfeb8082f10c7b5064a4c6a"><div class="ttname"><a href="../../d6/d2a/cme_8h.html#a93ac0c692cfeb8082f10c7b5064a4c6a">MIN_LENGTH_OF_SHADOW_ZONE_LINE</a></div><div class="ttdeci">double const MIN_LENGTH_OF_SHADOW_ZONE_LINE</div><div class="ttdef"><b>Definition</b> <a href="../../d6/d2a/cme_8h_source.html#l00728">cme.h:728</a></div></div>
<div class="ttc" id="acme_8h_html_a957ca99e98618160534cafb0929f743d"><div class="ttname"><a href="../../d6/d2a/cme_8h.html#a957ca99e98618160534cafb0929f743d">WARN</a></div><div class="ttdeci">string const WARN</div><div class="ttdef"><b>Definition</b> <a href="../../d6/d2a/cme_8h_source.html#l00802">cme.h:802</a></div></div>
<div class="ttc" id="acme_8h_html_aa0ace1cae356bfb79245b65c0ae979d0"><div class="ttname"><a href="../../d6/d2a/cme_8h.html#aa0ace1cae356bfb79245b65c0ae979d0">SOUTH</a></div><div class="ttdeci">int const SOUTH</div><div class="ttdef"><b>Definition</b> <a href="../../d6/d2a/cme_8h_source.html#l00393">cme.h:393</a></div></div>
<div class="ttc" id="acme_8h_html_aa58b13ad2e88aaa20449bfea242396a4"><div class="ttname"><a href="../../d6/d2a/cme_8h.html#aa58b13ad2e88aaa20449bfea242396a4">LOG_FILE_ALL</a></div><div class="ttdeci">int const LOG_FILE_ALL</div><div class="ttdef"><b>Definition</b> <a href="../../d6/d2a/cme_8h_source.html#l00385">cme.h:385</a></div></div>
<div class="ttc" id="acme_8h_html_aa5fa4b2d0efc2ff0f4e02e27ea50208a"><div class="ttname"><a href="../../d6/d2a/cme_8h.html#aa5fa4b2d0efc2ff0f4e02e27ea50208a">EAST</a></div><div class="ttdeci">int const EAST</div><div class="ttdef"><b>Definition</b> <a href="../../d6/d2a/cme_8h_source.html#l00391">cme.h:391</a></div></div>
<div class="ttc" id="acme_8h_html_aa768cb14b5c6123ee95e6e4ebd9fe331"><div class="ttname"><a href="../../d6/d2a/cme_8h.html#aa768cb14b5c6123ee95e6e4ebd9fe331">RTN_OK</a></div><div class="ttdeci">int const RTN_OK</div><div class="ttdef"><b>Definition</b> <a href="../../d6/d2a/cme_8h_source.html#l00588">cme.h:588</a></div></div>
<div class="ttc" id="acme_8h_html_ac003bdff958dca839f5d274f15786e07"><div class="ttname"><a href="../../d6/d2a/cme_8h.html#ac003bdff958dca839f5d274f15786e07">DBL_NODATA</a></div><div class="ttdeci">double const DBL_NODATA</div><div class="ttdef"><b>Definition</b> <a href="../../d6/d2a/cme_8h_source.html#l00733">cme.h:733</a></div></div>
<div class="ttc" id="acme_8h_html_ac45b8f6cf8276514853c55bb394a10b5"><div class="ttname"><a href="../../d6/d2a/cme_8h.html#ac45b8f6cf8276514853c55bb394a10b5">MAX_LAND_LENGTH_OF_SHADOW_ZONE_LINE</a></div><div class="ttdeci">double const MAX_LAND_LENGTH_OF_SHADOW_ZONE_LINE</div><div class="ttdef"><b>Definition</b> <a href="../../d6/d2a/cme_8h_source.html#l00729">cme.h:729</a></div></div>
<div class="ttc" id="acme_8h_html_ade186989e07cd54874887cd10d4a8465"><div class="ttname"><a href="../../d6/d2a/cme_8h.html#ade186989e07cd54874887cd10d4a8465">RIGHT_HANDED</a></div><div class="ttdeci">int const RIGHT_HANDED</div><div class="ttdef"><b>Definition</b> <a href="../../d6/d2a/cme_8h_source.html#l00403">cme.h:403</a></div></div>
<div class="ttc" id="acme_8h_html_ae3b6dc50cfc97050529faa5e0bd66136"><div class="ttname"><a href="../../d6/d2a/cme_8h.html#ae3b6dc50cfc97050529faa5e0bd66136">tAbs</a></div><div class="ttdeci">T tAbs(T a)</div><div class="ttdef"><b>Definition</b> <a href="../../d6/d2a/cme_8h_source.html#l01168">cme.h:1168</a></div></div>
<div class="ttc" id="acme_8h_html_af8f1a513adfc4d40f536ff45f704e654"><div class="ttname"><a href="../../d6/d2a/cme_8h.html#af8f1a513adfc4d40f536ff45f704e654">NORTH</a></div><div class="ttdeci">int const NORTH</div><div class="ttdef"><b>Definition</b> <a href="../../d6/d2a/cme_8h_source.html#l00389">cme.h:389</a></div></div>
<div class="ttc" id="acme_8h_html_afdd3411d0fa60c62522af14ea2a90570"><div class="ttname"><a href="../../d6/d2a/cme_8h.html#afdd3411d0fa60c62522af14ea2a90570">LEFT_HANDED</a></div><div class="ttdeci">int const LEFT_HANDED</div><div class="ttdef"><b>Definition</b> <a href="../../d6/d2a/cme_8h_source.html#l00404">cme.h:404</a></div></div>
<div class="ttc" id="acme_8h_html_afeb3cef570a9344c7074258f3601b582"><div class="ttname"><a href="../../d6/d2a/cme_8h.html#afeb3cef570a9344c7074258f3601b582">WEST</a></div><div class="ttdeci">int const WEST</div><div class="ttdef"><b>Definition</b> <a href="../../d6/d2a/cme_8h_source.html#l00395">cme.h:395</a></div></div>
<div class="ttc" id="acoast_8h_html"><div class="ttname"><a href="../../de/d65/coast_8h.html">coast.h</a></div><div class="ttdoc">Contains CRWCoast definitions.</div></div>
<div class="ttc" id="ai__line_8h_html"><div class="ttname"><a href="../../da/d11/i__line_8h.html">i_line.h</a></div><div class="ttdoc">Contains CGeomILine definitions.</div></div>
<div class="ttc" id="aline_8h_html"><div class="ttname"><a href="../../d7/d5d/line_8h.html">line.h</a></div><div class="ttdoc">Contains CGeomLine definitions.</div></div>
<div class="ttc" id="araster__grid_8h_html"><div class="ttname"><a href="../../db/d8c/raster__grid_8h.html">raster_grid.h</a></div><div class="ttdoc">Contains CGeomRasterGrid definitions.</div></div>
<div class="ttc" id="asimulation_8h_html"><div class="ttname"><a href="../../dd/d6a/simulation_8h.html">simulation.h</a></div><div class="ttdoc">Contains CSimulation definitions.</div></div>
<div class="ttc" id="autils__global_8cpp_html_a20842d0a19d0ca952c91f3e1eb175fee"><div class="ttname"><a href="../../d2/dfd/utils__global_8cpp.html#a20842d0a19d0ca952c91f3e1eb175fee">nRound</a></div><div class="ttdeci">int nRound(double const d)</div><div class="ttdoc">Version of the above that returns an int.</div><div class="ttdef"><b>Definition</b> <a href="../../d2/dfd/utils__global_8cpp_source.html#l00053">utils_global.cpp:53</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="../../d8/dce/calc__shadow__zones_8cpp.html">calc_shadow_zones.cpp</a></li>
    <li class="footer">Generated on Mon Aug 18 2025 20:25:50 for CoastalME (Coastal Modelling Environment) by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.13.2 </li>
  </ul>
</div>
</body>
</html>
